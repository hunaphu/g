<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::271425</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>467</td><td>Rust</td><td>250521T020016Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/281839#281839">ceilingc</a></td></tr>
<tr d-ix="1"><td>nan</td><td>Go</td><td>250531T044532Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/282071#282071">Ahamad</a></td></tr>
<tr d-ix="2"><td>365</td><td>C gcc</td><td>250527T032444Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/281994#281994">ceilingc</a></td></tr>
<tr d-ix="3"><td>201</td><td>Ruby</td><td>250522T075107Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/281884#281884">Value In</a></td></tr>
<tr d-ix="4"><td>153</td><td>Uiua</td><td>240304T192036Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/271534#271534">jan</a></td></tr>
<tr d-ix="5"><td>209</td><td>JavaScript Node.js</td><td>240304T031642Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/271512#271512">tsh</a></td></tr>
<tr d-ix="6"><td>263</td><td>JavaScript ES6</td><td>240303T174617Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/271504#271504">Arnauld</a></td></tr>
<tr d-ix="7"><td>116</td><td>Charcoal</td><td>240303T090238Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/271495#271495">Neil</a></td></tr>
<tr d-ix="8"><td>795</td><td>JavaScript Node.js</td><td>240302T015918Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/271474#271474">2pichar</a></td></tr>
<tr d-ix="9"><td>117</td><td>K ngn/k</td><td>240229T174254Z</td><td><a href="https://codegolf.stackexchange.com/questions/271425/%c2%b5unitdc-a-unit-aware-rpn-calculator/271426#271426">ovs</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://www.rust-lang.org/" rel="nofollow noreferrer">Rust</a>, <s>1559 1514 1493 1448 1347 1306 663 609 580 564 538 508 492 484</s> 467 bytes</h1>

<pre class="lang-rust prettyprint-override"><code>fn f(x:&amp;[&amp;str])-&gt;String{let(mut a,mut u,mut i,z)=(vec![0;25600],format!(&quot;&quot;),0,256);for t in x{if&amp;&quot;0&quot;&gt;t{i-=z;match t{&amp;&quot;+&quot;=&gt;a[i-z]+=a[i],&amp;&quot;/&quot;=&gt;a[i-z]/=a[i],_=&gt;a[i-z]*=a[i]}for m in 1..z{if&amp;&quot;+&quot;!=t{a[i-z+m]+=a[i+m]*if&amp;&quot;/&quot;&gt;t{1}else{-1}}else if a[i-z+m]!=a[i+m]{return format!(&quot;*&quot;)}a[i+m]=0}}else if&amp;&quot;A&quot;&gt;t{a[i]=t.parse().unwrap();i+=z}else{a[t.as_bytes()[0]as usize+i-z]+=1}}for t in 0..i{if a[t]!=0{if t%z&gt;0{u.push(t as u8 as char)}u+=&amp;a[t].to_string()}if!t%z&lt;1{u+=&quot; &quot;}}u}
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=VVJLbtswEEW3PgVNoIJoybJkIEVgRwbaI7RAN4ZhsAoVE9EP4rBJRfAk3XjRnqir9Aa9RYf6OA4BcYacx6c3n5-_Wq3gfP6tIV_e_n33J69I7j9vvL2noD2w5e4LtLJ6MIUAv9RAeOh23e8y7FjqfxfZfB9v1zcf4vgQ5nVbcpj7lLIwDvGSbfGKILgiz0bmHo3pDoxcpt0WgdmJgPFoQNMd38tldwhStIfQo6vL1Wq4Ok7nRX-2jrZ0tEkUdT1zQOcpmB4UlAMT2oULrdxPEysKJcwysb1DZE4m8HwEm1aAbrEGUxoLyuwQSuPLM49-dHxORgpRw1slfBbp6qnljc-2Mki74Vd8DxFXx28_QCif7eMDV0Qr2YlgyBWVXKoTR5E0vSRAObFz4X23i42OGq1OPtYeH9-6PTvxllkdpJ4DR1AfVd8ln1mZz_HVXWIwSgm1Vtuhty__NGpXcL_ZGFnjhq6swk86_yz4vbXbGba-5LLyGTEzgsspk1Wje3U9GpMs6uzRGVm5jEakWzggIzod7Gs93mCgfhSV2pCvIrtzM7a74FVTSDg-nSQWq-GZK2lWF4XI4JqjwUShqLA1xtIQh9UbGNmIsbMx4fOLTWYJUe4jaxyVAL2SuNOKvHrBGFdkQSZ0H7lCu9frK_TEMTGWeFKzm55nMdpgUPEf" rel="nofollow noreferrer">Try it online!</a></p>
<p>Slightly less golfed:</p>
<pre class="lang-rust prettyprint-override"><code>fn f(x:&amp;[&amp;str])-&gt;String{
  let mut a:[i32;12800]=[0;12800];
  let(mut u,mut i)=(String::new(),0);
  for t in x{
    if&amp;&quot;0&quot;&gt;t{                            // +, * or /
      i-=1;
      if&amp;&quot;+&quot;==t{                         // + operator
        for m in 1..128{
          if a[128*(i-1)+m]!=a[128*i+m]{
            return format!(&quot;*&quot;)
          }
        }
        a[128*(i-1)]+=a[128*i]
      }else{
        if&amp;&quot;*&quot;==t{                       // * operator
          a[128*(i-1)]*=a[128*i];
          for m in 1..128{
            a[128*(i-1)+m]+=a[128*i+m]
          }
        }else{                           // / operator
          a[128*(i-1)]/=a[128*i];
          for m in 1..128{
            a[128*(i-1)+m]-=a[128*i+m]
          }
        }
      }
      for m in 1..128{
        a[128*i+m]=0
      }
    }else
      if&amp;&quot;A&quot;&gt;t{                          // numbers
        a[128*i]=str::parse::&lt;i32&gt;(t).unwrap();
        i+=1
      }else{                             // units
        a[128*(i-1)+(t.as_bytes()[0]as usize)]+=1
      }
    }
  for t in 0..i{
    u.push_str(&amp;a[128*t].to_string());
    for v in 1..128{
      if a[128*t+v]!=0{
        u.push(v as u8 as char);
        u.push_str(&amp;a[128*t+v].to_string())
      }
    }
    u.push(' ')
  }
  u
}
</code></pre>
</div>
<div id="pu1" class="pu"><h1><a href="https://go.dev" rel="nofollow noreferrer">Go</a>, <del>665</del> <del>519</del> <del>518</del> <del>513</del> <del>502</del> 500 bytes</h1>
<p><em>Saved (146+1+5+11+2)=165 bytes thanks to @ceilingcat</em></p>
<p> 
 
 </p>
<p>Golfed version. <a href="https://ato.pxeger.com/run?1=VVLbitswEKWP8Veohnal2HHsQGGx1wtdSmFfSiGFPhi3eBM5iERysOVtauMv6ctS2o9Kv6Mf0BlL2aQP9ozmnDlzdPnxc1M9Hd_ti9W22HAiC6EcR8h9VWtCnYn70JaiciEppcZQNfhvdL2q1KNNhdpAlf1udTm7_vPib9mqFSnpIcsNyEzoC1_4XZzKYstplgul_WhxHYbMDzFJHouatMTqBXet2K15nZRVTb76Ok7rQoHBQy9KN3RvdS9maZfAwsNFkYlZl09TiPnAdw0ngMzPiHdGbGVuKqO-jNMokTddIj2vHyXTFAaUZKR6Mn-JZIh9zXVbK3fqDhdaAHiWMJXFPjNbwA32wIwjH5zEs2jINMwzvDQcnm2-RZtwvMGyWRWKav81OmOJ8NLucgroUZ2FOYNp0WCcP5-LMHY1WA0x1a-627Bvg8-10Pzuu-b0AX9QZmxIbH05GqX2NoN7XRUUNZAiytkXYN9E_4lckSsGo80xkDawCmwwl3_8Nd49viLKSO9McEeK1yROyfiSgg_829LUaNVA-1oo5kxwK5YaIGyaJ0LtW429J-wTP2gK_Imutlw1I2Tfy3vBd-uGji3IwAP9CJDeKVpSw2cADI71-nQcIiciDX5kQSTxIJMEV3NyzjyLN2RKTuwRuWBj9-KCfdI4KUpYNc6bUWdqo2dc_AM" rel="nofollow noreferrer">Attempt This Online!</a></p>
<pre class="lang-go prettyprint-override"><code>func f(x[]string)string{a,i,z:=make([]int,12800),0,128;var u strings.Builder;for _,t:=range x{if&quot;0&quot;&gt;t{i-=z;if&quot;+&quot;&gt;t{a[i-z]*=a[i]}else if&quot;/&quot;&gt;t{a[i-z]+=a[i]}else{a[i-z]/=a[i]};for m:=1;m&lt;z;m++{if&quot;+&quot;==t{if a[i-z+m]!=a[i+m]{return&quot;*&quot;}}else{a[i-z+m]+=a[i+m]*map[string]int{&quot;*&quot;:1,&quot;/&quot;:-1}[t]};a[i+m]=0}}else if&quot;A&quot;&gt;t{fmt.Sscan(t,&amp;a[i]);i+=z}else{a[i-z+int(t[0])]+=1}};for t:=range i{if a[t]!=0{if t%z&gt;0{u.WriteByte(byte(t%z))};u.WriteString(strconv.Itoa(a[t]))};if-^t%z&lt;1{u.WriteByte(' ')}};return u.String()}
</code></pre>
<p>Less golfed version. <a href="https://ato.pxeger.com/run?1=pVTBatwwEL30Yn3F1JfI1q7XXiiEJntIDoVeSiGFHhYTnI28iF3LiyS7KcFf0kso5KPaX-mlGkne7AbaFHqwNJp58_xmPNa37-v24eGxM_X09OerX7tqtanWHJpKSEJEs2uVAUqi-KarRRtbo24Mbq3GVRu1amUfTCHX1psQUndyBTW9g2Xp3Qn4He5JVMHbheXfcLoshTQTKOaneZ6QqK8UdAGos8tObG-5IpFAfE4iEtWtgusJGHSoSlqZd0gYidr6ziHOY7iH2QzYBFKw2JmN2fTpAgpnIWyxgJiNOGh3XFWmVRh29A1yF2d2P0dd1mDMvcPnV0vrTKmYFglrSni9CB6BpwCLFDedkhCnsXcM5Gk9ICiB7dNLDA7At5oHmr3YNIhNj8UeM6XHTC_XEj2rhB1WciQ7iEIJs79JmP2vhOkfJZBxeYHy4Fu4ifFZoYJxSC5CP2XX3HClEdVX2wlcI2-Y5-zCtIKahDyRIqXFuTlijBw3ppPCaPKsJDvb1Czz0n9onECrZhjn2A1xfuY0CbuFIrrssxKGX7mfgI5y3pu2op7blAnKQoo-dKIfO9GPndhPqmG9m9I8dCjQX341nN7g0ju2f3mvZfLYwVdyxHUCJ0koLkx_lwWuhAzhQsA7hSaoRK8qKblC_e5eyT7wL1feR1ttM2-FTHyfAjTDsE-OhNx1rn1j7BO_MxS1mXbDpQ4f0t0i7wTf3mrqUlzfGpN9tCGzlbSmHp846YO_A8NV-PBjKEgBGh-Y22Fj1moATzN4sliIa_t7jmgXOUBj9vwAPXKMjI09afLG8aRhZ17Fbw" rel="nofollow noreferrer">Attempt This Online!</a></p>
<pre class="lang-go prettyprint-override"><code>package main

import (
&#9;"bufio"
&#9;"fmt"
&#9;"os"
&#9;"strconv"
&#9;"strings"
)

func f(x []string) string {
&#9;a := make([]int, 12800)
&#9;var u strings.Builder
&#9;i := 0
&#9;
&#9;for _, t := range x {
&#9;&#9;if t &lt; "0" { // +, * or /
&#9;&#9;&#9;i -= 1
&#9;&#9;&#9;if t == "+" { // + operator
&#9;&#9;&#9;&#9;for m := 1; m &lt; 128; m++ {
&#9;&#9;&#9;&#9;&#9;if a[128*(i-1)+m] != a[128*i+m] {
&#9;&#9;&#9;&#9;&#9;&#9;return "*"
&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;a[128*(i-1)] += a[128*i]
&#9;&#9;&#9;} else {
&#9;&#9;&#9;&#9;if t == "*" { // * operator
&#9;&#9;&#9;&#9;&#9;a[128*(i-1)] *= a[128*i]
&#9;&#9;&#9;&#9;&#9;for m := 1; m &lt; 128; m++ {
&#9;&#9;&#9;&#9;&#9;&#9;a[128*(i-1)+m] += a[128*i+m]
&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;} else { // / operator
&#9;&#9;&#9;&#9;&#9;a[128*(i-1)] /= a[128*i]
&#9;&#9;&#9;&#9;&#9;for m := 1; m &lt; 128; m++ {
&#9;&#9;&#9;&#9;&#9;&#9;a[128*(i-1)+m] -= a[128*i+m]
&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;}
&#9;&#9;&#9;for m := 1; m &lt; 128; m++ {
&#9;&#9;&#9;&#9;a[128*i+m] = 0
&#9;&#9;&#9;}
&#9;&#9;} else if t &lt; "A" { // numbers
&#9;&#9;&#9;val, _ := strconv.Atoi(t)
&#9;&#9;&#9;a[128*i] = val
&#9;&#9;&#9;i++
&#9;&#9;} else { // units
&#9;&#9;&#9;a[128*(i-1)+int(t[0])] += 1
&#9;&#9;}
&#9;}
&#9;
&#9;for t := 0; t &lt; i; t++ {
&#9;&#9;u.WriteString(strconv.Itoa(a[128*t]))
&#9;&#9;for v := 1; v &lt; 128; v++ {
&#9;&#9;&#9;if a[128*t+v] != 0 {
&#9;&#9;&#9;&#9;u.WriteByte(byte(v))
&#9;&#9;&#9;&#9;u.WriteString(strconv.Itoa(a[128*t+v]))
&#9;&#9;&#9;}
&#9;&#9;}
&#9;&#9;u.WriteByte(' ')
&#9;}
&#9;
&#9;return u.String()
}

func main() {
&#9;scanner := bufio.NewScanner(os.Stdin)
&#9;for scanner.Scan() {
&#9;&#9;input := scanner.Text()
&#9;&#9;tokens := strings.Fields(input)
&#9;&#9;fmt.Println(f(tokens))
&#9;}
}
</code></pre>
</div>
<div id="pu2" class="pu"><h1><a href="https://gcc.gnu.org/" rel="nofollow noreferrer">C (gcc)</a>, <s>481 464 448 429 417 402 391 380</s> 365 bytes</h1>

<pre class="lang-c prettyprint-override"><code>z=-128;*strtok();atoi();*f(char*s){int a['2d']={},*b=a,*c,*k=a,i=0,m;char*p;for(;m=p=strtok(i++?0:s,&quot; &quot;);)if(*p&gt;47)*p&gt;57?b[*p+z]=1:(*b=atoi(p),b-=z);else for(b-=m=-z,c=b+z,*p&gt;46?*c/=*b:*p%2?*c+=*b:(*c*=*b);--m;b[m]=0)if(*p-43)c[m]-=b[m]*(*p%2*2-1);else if(c[m]-b[m])return&quot;*&quot;;for(p=s;k&lt;b;k++,m=-~m%z)p+=sprintf(p,&quot;%c%2$d%3$s&quot;+(m?!*k*6:2),m,*k,(m&lt;~z)+&quot; &quot;);return s;}
</code></pre>
<p><a href="https://tio.run/##TVDbcqMwDH3nK7RsmdqyvQV624nj5kMyeQAHWoaaeDB5IZP@elamyWwfbOlYR0fWserd2stlNqoo/2oM0zgdesZ1NR06Ctgy@1GNGPipGyaotvfl/n5nTmeJtakkWok9xc7k0umF6XV7GJl2xpurWCfEJl8FmULKNe9ahv7t6ZXT/fy6qbfoxbwzxYpFxTjVc1krM3PdfIYGohpBZ9QsranFLGP7ywbtg8F6hT4rKRcxZ2iRItdKOV1v3c7k3@PU0yO3hJWJr8hiE5aquI4gzlKNRT4203EcUkyXPWgJ3a9r3Qsh6QtfLpu5Fyb4kexomZdpZrPybp893oVUMLf5hT2@rEouHTkjmVt/zVwsm38LQ9Dny@9usJ/HfbMO0747/Pl4S6K5ruoGxk8JQDQSwrbI850muBjavjdTYEHSo4xtA3kZuQD@SIWWBc4j@ZycL0VSQIgHSnAgKHMQ0QP8z8S1HgDhxl4qP9ixu/zBvmncFB2hkDwvOniN4h8" rel="nofollow noreferrer" title="C (gcc) – Try It Online">Try it online!</a></p>
<p>Slightly less golfed.</p>
<pre class="lang-c prettyprint-override"><code>*strtok(int*,int);atoi();
*f(char*s){
  int a['2d']={},i=0,j=0,k=0,m;
  for(char*p;p=strtok(i++?0:s,&quot; &quot;);)          // split input string
    if(m=128,*p&lt;48){                          // +, * or /
      j--;
      if(*p-43)                               // * or /
        for(*p-47?a[m*~-j]*=a[m*j]:(a[m*~-j]/=a[m*j]);--m;)
          a[128*~-j+m]+=a[128*j+m]*(*p-47?1:-1);
      else                                    // +
        if(a[~-j*m]+=a[j*m],bcmp(a+m*j+1,a+m*~-j+1,508))
          return&quot;*&quot;;
      bzero(a+128*j,512);
    }else
      *p&gt;57?a[m*~-j+*p]=1:(a[j++*m]=atoi(p)); // number or unit
  for(i=0;m=k&lt;j;strcat(s+i++,&quot; &quot;),k++)        // construct output
    for(i+=sprintf(s+i,&quot;%d&quot;,a[k&lt;&lt;7]);m&lt;128;m++)
      a[k*128+m]?i+=sprintf(s+i,&quot;%c%d&quot;,m,a[k*128+m]):0;
  return s;
}
</code></pre>
</div>
<div id="pu3" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, 201 bytes</h1>
<p>Errors due to mismatched types when adding throw a <code>NameError</code> by calling the uninitialized variable <code>X</code>.</p>
<pre class="lang-ruby prettyprint-override"><code>-&gt;i,*s{i.map{|o|o=~/[a-z]/?s[-1][1][o]=1:s&lt;&lt;(o=~/\d/?[o.to_i,{}]:(x,y=s.pop 2;a,b=x;c,d=y
[eval([a,c]*o),o==?+?b==d ?b:X: b&amp;&amp;d ?b.merge(d){o==?*?_2+_3: _2-_3}.reject{_2==0}:b||d]))}
s.map{[_1,*_2]*''}}
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=TU9rToNAEP7PKeaHKbAsINuYGNqVa5ismw2PbcUUl7BUW2G9iH8ao4fpEXoboY_YZCbzTb5HZr5-mnW23X0v6O-6Xfj3h73_UGKkuzKo0rrrVa_oZ8hS_4OHiWZ-xNlQitMo1vO5M5JPRZgwFbRKlLgzPHY2eEt1UKsayCzFGd3MclzQrcXkW7pyWIpzjpSLFaWJl2SUFpBk8WMM2WQywqCSzVI6hduNCpQI4olpDIL4YmqCRr7IvO0EofTWxFnfF9x1jaWP5zIRYSQIR7ZtzPkh7_25XElYylZbADU4C3YjAl2vypZDI3W-lmAj27Xka3Gy7A4msiLQYwOBCrwBVTBuIfwj78xrQHBRH5kr9egmV-pLxiWxGjZt3R1z0Hl6pyv-AA" rel="nofollow noreferrer">Attempt This Online!</a> (prints <code>*</code> if it errors out)</p>
</div>
<div id="pu4" class="pu"><h1><a href="https://www.uiua.org/" rel="nofollow noreferrer">Uiua</a>, <s>204 192 178</s> 153 characters</h1>
<p><em>-12: remove error handling and output reversal and redundant spaces that the formatter always puts back in.</em> <br>
<em>-14: use &quot;uiuisms&quot; page to golf character range, use <code>content ◇</code> instead of unbox, and golf creation of the stack.</em> <br>
<em>-25: Get less stingy with memory usage, etc.</em></p>
<pre class="lang-uiua prettyprint-override"><code>P←⊙:⊙⊙°⊂∩°⊂°⊂◌
r←⇡27
a←⍜°⊂(@ ◌)+@`r
i←⊙(⟨⊂⊂⊓×+P|⊂⊂⊓+⟜(⍤&quot;*&quot;≍)P|◌|◌|◌|⊂⊂⊓÷-P|⟨⍜⊙°⊂+=a|⊂×=0r⋕⟩⍣(1◌⋕)0.⟩↧6/+-@*.):°□°⊂ 
(↘1/◇⊂♭≡(⨬(□&quot;&quot;◌◌|□⊂⊙°⋕)≠0,a)◌⍥i⧻.:↯0r)
</code></pre>
<p><a href="https://www.uiua.org/pad?src=0_12_0-dev_1__UCDihpAg4oqZOuKKmeKKmcKw4oqC4oipwrDiioLCsOKKgiAjIHBvcCAyIGZyb20gc21hbGwgc3RhY2sgYW5kIHNlcGFyYXRlIG51bWJlciBhbmQgdW5pdHMKciDihpAg4oehMjcKYSDihpAg4o2cwrDiioIoQCDil4wpK0BgcgppIOKGkCDiipkoCiAg4qisKAogICAg4oqC4oqC4oqTw5crUOKXjCAgICAgICAgIyB0aW1lcwogIHwg4oqC4oqC4oqTK-KfnCjijaQiKiLiiY0pUOKXjCAjIHBsdXMKICB8IOKXjAogIHwg4peMCiAgfCDil4wgICAgICAgIyBvdGhlciBjaGFyYWN0ZXJzCiAgfCDiioLiioLiipPDty1Q4peMICMgZGl2aWRlZCBieQogIHwg4qisKAogICAgICDijZziipnCsOKKgis9YSAjIGxldHRlcjogYWRkIG9uZSB0byBjb3JyZXNwb25kaW5nIGNlbGwgaW4gdG9wIG9mIHNtYWxsIHN0YWNrCiAgICB8IOKKgsOXPTBy4ouVICAjIG51bWJlcjogcHVzaCB1bml0bGVzcyBudW1iZXIgdG8gc21hbGwgc3RhY2sKICAgICnijaMoMeKXjOKLlSkwLgogICnihqc2LystQCouICMgLS0tdGhlIGRpZmZlcmVuY2UgZnJvbSBzdGFyLCBvciA2IGlmIGl0J3MgYSBudW1iZXIgb3IgbGV0dGVyCik6wrDilqHCsOKKgiAgICAgICMgcHJvY2VzcyBvbmUgdG9rZW4gZnJvbSB0aGUgaW5wdXQgCmYg4oaQICgKICDil4zijaVp4qe7Ljrihq8wciAgICAgICAgICAgICAjIHNldHVwIHRoZSBsYWJlbCBhbmQgc21hbGwgc3RhY2sKICDiiaEo4qisKOKWoSIi4peM4peMfOKWoeKKguKKmcKw4ouVKeKJoDAsYSkgIyBhcHBlbmQgdW5pdCB0byBlYWNoIG51bWJlciBpbiB0aGUgc21hbGwgc3RhY2sKICDihpgxL-KXh-KKguKZrSAgICAgICAgICAgICAgICAjIGZpbmFsIGNvbmNhdGVuYXRpb24KKQprIOKGkCDiipzilqHiiaAsIEAgCmZ7IjE3IiAiYSIgIjIiICJhIiAiKiJ9CmYgayAiMTcgbSAyIHMgLyAxIHMiCmYgayAiMSIKZiBrICIxIHMiCmYgayAiMSBtIDEgcyAvIDEgbSAxIHMgLyArIgpmIGsgIjEgcyAyIHMgKiAxIHMiCmYgayAiMSBzIDEgcyAvIgpmIGsgIjEgbSAxIHMgLyAyIG0gMiBzIC8gKyIKZiBrICIxIHMgMSBzIC8gMSArIgpmIGsgIjEgbSAxIG0gLyBzIgpmIGsgIjUgcyAyICoiCuKNoyhmIGsgIjEgcyAyIG0gKyIp4oiYCuKNoyhmIGsgIjUgcyAyICsiKeKImAo=" rel="nofollow noreferrer">commented version with tests</a> <a href="https://www.uiua.org/pad?src=0_12_0-dev_1__eyIxNyIgIm0iICIyIiAicyIgIi8iICIxIiAicyJ9CgpQIOKGkCDiipk64oqZ4oqZwrDiioLiiKnCsOKKgsKw4oqC4peMCnIg4oaQIOKHoTI3CmEg4oaQIOKNnMKw4oqCKEAg4peMKStAYHIKaSDihpAg4oqZKOKorCjiioLiioLiipPDlytQfOKKguKKguKKkyvin5wo4o2kIioi4omNKVB84peMfOKXjHzil4x84oqC4oqC4oqTw7ctUHziqKwo4o2c4oqZwrDiioIrPWF84oqCw5c9MHLii5Up4o2jKDHil4zii5UpMC4p4oanNi8rLUAqLik6wrDilqHCsOKKggoo4oaYMS_il4fiioLima3iiaEo4qisKOKWoSIi4peM4peMfOKWoeKKguKKmcKw4ouVKeKJoDAsYSnil4zijaVp4qe7Ljrihq8wcikKJCBQ4oaQ4oqZOuKKmeKKmcKw4oqC4oipwrDiioLCsOKKguKXjAokIHLihpDih6EyNwokIGHihpDijZzCsOKKgihAIOKXjCkrQGByCiQgaeKGkOKKmSjin6jiioLiioLiipPDlytQfOKKguKKguKKkyvin5wo4o2kIioi4omNKVB84peMfOKXjHzil4x84oqC4oqC4oqTw7ctUHzin6jijZziipnCsOKKgis9YXziioLDlz0wcuKLleKfqeKNoygx4peM4ouVKTAu4p-p4oanNi8rLUAqLik6wrDilqHCsOKKggokICjihpgxL-KXh-KKguKZreKJoSjiqKwo4pahIiLil4zil4x84pah4oqC4oqZwrDii5Up4omgMCxhKeKXjOKNpWnip7suOuKGrzByKQrip7sKJCBhCiQgYgrin5zip7sK" rel="nofollow noreferrer">golfed version</a></p>
<pre class="lang-uiua prettyprint-override"><code>P ← ⊙:⊙⊙°⊂∩°⊂°⊂ # pop 2 from small stack and separate number and units
r ← ⇡27
a ← ⍜°⊂(@ ◌)+@`r
i ← ⊙(
  ⨬(
    ⊂⊂⊓×+P◌        # times
  | ⊂⊂⊓+⟜(⍤&quot;*&quot;≍)P◌ # plus
  | ◌
  | ◌
  | ◌       # other characters
  | ⊂⊂⊓÷-P◌ # divided by
  | ⨬(
      ⍜⊙°⊂+=a # letter: add one to corresponding cell in top of small stack
    | ⊂×=0r⋕  # number: push unitless number to small stack
    )⍣(1◌⋕)0.
  )↧6/+-@*. # ---the difference from star, or 6 if it's a number or letter
):°□°⊂      # process one token from the input 
f ← (
  ◌⍥i⧻.:↯0r             # setup the label and small stack
  ≡(⨬(□&quot;&quot;◌◌|□⊂⊙°⋕)≠0,a) # append unit to each number in the small stack
  ↘1/◇⊂♭                # final concatenation
)
</code></pre>
<p>Input is a boxed array (<code>{}</code>) of token strings, or there is an extra string parsing function in the formatted version link.</p>
</div>
<div id="pu5" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 209 bytes</h1>
<pre class="lang-javascript prettyprint-override"><code>p=&gt;p.map(n=&gt;a.push(y=+n?[+n,...Buffer(36)]:n&lt;0+a.pop()?a.pop().map((o,i)=&gt;(m=y[i],i)?n&lt;'+'?o+m:n&lt;'/'?o-m?E:o:o-m:eval(o+n+m)):(y[parseInt(n,36)]=1,y)),a=[])&amp;&amp;a.map(x=&gt;x.reduce((x,v,i)=&gt;v?x+i.toString(36)+v:x))
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=bZHPa4MwFMfZ1b_i4aFNGhtnB2PYRmHQw847uh7EaSs0iSQqSukfMnYpY_uDdtz-mkW7H21XD3kPvp_3Pgk-vwr5mO5eMvZWldn45uO9YEFBeVwgwYKYFpVeoZYREUZEOJTS2yrLUoWurvHCF7NLYhBZIBx-134SSSfHLECctVG-MH0oZkMyDCXhZmbomm7Mw7kvfVP9tI7XSBJBOMY-aqMiVjq9EyUSTmdhntNi7MQsWuDBIO4FDQsaqtLHKkkRapy619VhQ3JayvtS5WLZ3ZDUfoPx_mGfF0_TyAKwPduBc5_rgtfnoM8SXa5_CJgAB3LCGWK0zzl0jBn47TrW5BM99vjBEg0jOBb20ORQ1S_4r_Lg2NXdaHLk4p6xHW0xJzlx_S3hJtf2mScvLJpJNY-TFdLAAthYpWphA4kUWq5TupZLlCFNdbHOS-Q-aOJijKewtZK4TFaAUnxC23OlpLJ7Zout_R_a7fb1Cw" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Input array of tokens, output array of values or throw error.</p>
</div>
<div id="pu6" class="pu"><h1>JavaScript (ES6), 263 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>s=&gt;s.replace(/\S+/g,v=&gt;v&gt;{}?s[0][1]=[[v,1]]:s=[[(u=[])|v||([[y,q],[x,u],...s]=s,v+1|0?e|=u+''!=q:q.map(([U,e])=&gt;(u.find(o=&gt;o[0]==U)||u.push(o=[U,0])&amp;&amp;o)[1]+=v&lt;&quot;/&quot;?e:-e),eval(x+v+y)),u.filter(o=&gt;o[1]).sort()],...s],e=s=[])|e?&quot;*&quot;:s.reverse().join` `.split`,`.join``
</code></pre>
<p><a href="https://tio.run/##bY/NcoIwFEb3PkXKQhOJwbC0Da76BB1XaWZgNCoOEORKRqf02WnA/og1i0wm38l3bg6JTWBdpeVpVpiNbreiBREBq3SZJWuNg/c3P9hRKyIbfXwuQc6V5EpIaSlXagHuhGshFWls02ApL/SoqDzTWlHGGCgB1Pq8mS91I2p/MnkSx8WR5UmJsVxRrYiIcM22abHBRkTG1QuxIk1Ts7KGvbtz1FyR8dgQ5/WFffECb6kXM02otkmGz771L4TQriQ76epawxVhYKoTJt9zUC2gH1Mvvam36D5odQUaE3YwaRGjmEGZpaeYxteLuH2WI4Q87lH0aAUB4n2O4CHR5fBDoBDlyL/jHDG95jnqGPfg99SxLg9hxvObEkBTNBT2UHir6gv@qzgaurqJwoEr5842aHG7f@f6K8ldDt6DL6sR25rqNVnvMSARobUpwGSaZWaHtxgIIe0X" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
</div>
<div id="pu7" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, <s>123</s> 116 bytes</h1>
<pre><code>Ｆ⪪Ｓ ¿Σι⊞υ⁺⟦Ｉι⟧Ｅβ⁰¿№βι§≔§υ±¹⊕⌕βι¹«≔⊟υζ≔⊟υη⊞υ∧∨⬤∧ζη∨¬λ⁼κ§ζλ⁻+ιＥ∧ζη⎇λ⁻κ×§ζλ⊖﹪℅ι³§⟦×κ§ζλ⁺κ§ζλ÷κ§ζλ⟧℅ι»Ｅυ⭆∨ι*⎇μ⎇λ⁺§β⊖μλωλ
</code></pre>
<p><a href="https://tio.run/##bVHBbsIwDD2vX2H15KydtrJjTwg2iQOsEtwQh0IDREtT1iRsY9q3d05JNypWqa3zbD@/52z2eb2pctk026oGnB@kMDhRB2vmphZqhyyGEELGQGwpbUsUFGdW79HGkEmrcTnKtSF4FcM0P@A6hgfGWApcat52jSqrjMNd61BrsVNDM1EF/8DuT1wzvssNx4TRxIna1LzkyvACn4UqfHMMScf7FdycmTCrDmgpdWLpFbZ3WCd2SDwvNQ6lRBeeXDoGQmaVQUnh05vNpcZXKvWyqEaSF8pNhSKrYRR6Ic7pBcuC1yqvP1F2lUSyECXX2KOKYcz/nE2rwsqKNBVC5ZI2GMPjeVrXtDxzXCnym/8HnygzFkdR8OvkypntRrVPGnwHGd2yQWeHVnS@c3egtQi6@dvwwlzZ89kq6Cas@85KJ8XZfWd@g2nTJJCAbt8BlBD5SMPtL35P39JHrmbQRlEvH/makk46aO6O8gc" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Since the whole stack is output, I've effectively included several test cases in the link. Explanation:</p>
<pre><code>Ｆ⪪Ｓ 
</code></pre>
<p>Split the input on spaces and loop over the resulting tokens.</p>
<pre><code>¿Σι⊞υ⁺⟦Ｉι⟧Ｅβ⁰
</code></pre>
<p>If this token is a positive integer, then push its value with zero exponents for all letters.</p>
<pre><code>¿№βι§≔§υ±¹⊕⌕βι¹
</code></pre>
<p>Otherwise, if this token is a letter, then set the exponent for that letter to <code>1</code> for the latest value.</p>
<pre><code>«
</code></pre>
<p>Otherwise:</p>
<pre><code>≔⊟υζ≔⊟υη
</code></pre>
<p>Retrieve the two arguments.</p>
<pre><code>⊞υ∧∨⬤∧ζη∨¬λ⁼κ§ζλ⁻+ιＥ∧ζη⎇λ⁻κ×§ζλ⊖﹪℅ι³§⟦×κ§ζλ⁺κ§ζλ÷κ§ζλ⟧℅ι
</code></pre>
<p>If the arguments are compatible or the operations is not sum, calculate the product, sum and quotient of the two arguments, selecting according to the ordinal of the token. (In the case of the exponents, the ordinal modulo <code>3</code> is decremented and multiplied by the second exponent, and this is subtracted from the first exponent.)</p>
<pre><code>»Ｅυ⭆∨ι*⎇μ⎇λ⁺§β⊖μλωλ
</code></pre>
<p>For each value on the stack, concatenate its value with any non-zero exponents, unless the value was invalid, in which case output a <code>*</code>.</p>
</div>
<div id="pu8" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, <s>797</s> 795 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>Z=require('util');O=Object;N=&quot;length&quot;;A=u=&gt;O.fromEntries([...u.matchAll(/([a-zA-Z])(-?\d+)/g)].map(_=&gt; _.slice(1)));B=u=&gt;{s=&quot;&quot;;e=O.entries(u);for(i=0;i&lt;e[N];i++){s+=e[i][0]+e[i][1]}return s};D=T=&gt;{S=[];U=[];p=/[+*\/]/;for(t of T){if(/\d+/.test(t[0])||/\d+/.test(t[1])&amp;&amp;(t[0]==&quot;-&quot;||t[0]==&quot;+&quot;)){S.push(t)}else if(p.test(t)){let[r,l]=[S.pop(),S.pop()];[h,H]=[U.pop(),U.pop()];if(H){f=A(h);g=A(H);m=1;if(t==&quot;+&quot;){if(Z.isDeepStrictEqual(g,f)){n=B(g)}else{return'*'}}if(t==&quot;/&quot;){m=-1}L=O.keys(g);P=O.keys(f);z={};for(i=0;i&lt;L[N];i++){k=L[i];if(k in f){y=+g[k]+m*+f[k];y!=0?(z[k]=y):0}else{z[k]=+g[k]}}for(i=0;i&lt;P[N];i++){k=P[i];if(!(k in z||k in g)){z[k]=m*+f[k]}}n=B(z);n!=&quot;&quot;?U.push(n):0}S.push(&quot;&quot;+eval(l+t+r))}else{if(t[N] &gt; 1){U.push(t)}else{U.push(t+1)}}}return S.map((E,I)=&gt; E+(U[I]||&quot;&quot;)).join(&quot; &quot;)}
</code></pre>
<p><a href="https://tio.run/##bVTLbts6EF3HX8FoUZORTVlZXpYJUiRAehEkBlJvogqBalMyE@pRkUrrB7/dd6hH4l50YXM4M@fwzHCol@Qt0ctaVmZalCtxCAI0L9UmlUpplJY1yqXWssiQNkmxSuoV@vcdgXJh1uVKjx5@vIiloSuRykLM67IStdngR1MDkFZ1aUqzqcQEeXlilusrpbwJ2o1O3hLVCFwLAvaJEgbV8OMoilm/N3nlzF9rqQSGDQRrQcVvscRmLTVpgSeAolWj1ziilEJWTBzIjtpIUxeOFjx2ZCHwd6mdd4LGaV3mNwUIF3p8pFF0rneh5Y8X0LKz7iBoEnY@CZ4Zg@Uz6tOpEkVm1uDz/U4q4KI@GMk4msUxgI4cYfw/6QAYpB@eeC1@NrIWeNwYqcaEPfBOOLvnXneWx654wy8e6FEhbV8aOvQeBzhKptur6VNM8PTy@8onQUZiiFf4mV@gZ6qVXAocEkLYF8e209zzmOAPtJeKG8Jc2ZLPmPwsovuYtSVqn4uuLl905di@Dm3ZNf8GVI8crnfh/ioeRP7Z9yAOWi5oaoq@kZ1McQCaAmqENtgAF9nv//CEMfn0qY1w7k29/b43fQ8G4rEbBUOsUFogYKt6HAThmqJ6omIeQVpZYTLp15hF68kt@Be9fzH4geCW7FJ@hdeEZbDcEpbz0PlNd6ZT/ESlvhaiciO/NDc/m0ThbJLCkQX/grNOzK7rxfhsbG0PDwCe82lo76C5r2KjIZfNBzslbMthyD5afffe6ld@Bx12Ml6RLFBKdhvuZ9Fr7Odnfgor25zy2SXegsk35J9ZJ6HdtnnWftDOj2jnPe1pR7zd79s1g1pacE9vratsS1hxCsNxuejaXriD@ivwPF/A68HKN35N@ha4uuEwdIFCslv8cVfvWz8k1g6D89jOJb6ZfCUwmzc@XkRf4/3eg7umL6UssIc8Yg/t16MqnkEpR/DFWQqtaVJnb/0wn8PT/8tD7SDDO@2f6bIsdKkEVWWGr3GXAk2hulLS4DEau4cxsodDeAiRdj90jnLkg5UjtwvQh@X3cY3O0JDdRo6yHfr8KHvgGBhz2On/AA" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a> Input is as an array of token strings passed to <code>D</code>. Output is to STDOUT. There's probably a shorter way, but this is what I've got (and JS is not a golfing language).</p>
</div>
<div id="pu9" class="pu"><h1><a href="https://codeberg.org/ngn/k" rel="noreferrer">K (ngn/k)</a>, <s>134</s> <s>124</s> 117 bytes</h1>
<pre><code>{,//$x,(!y),'.y}.'|(){(,$[43=*y-*|&amp;/=/h;E;1=C;**x;^[_%;.y].|*'h],(&amp;~b)_b:(y!C;*|(1-3!*y)/h:C#x)2=C),(C:3!&quot;0a&quot;'*y)_x}/
</code></pre>
<p><a href="https://ngn.codeberg.page/k#eJxVTMEOgjAMvfMVpSpsc64CnraQmBDPJlwRUQ+Giyc9bAH8dkGMaJr29fX1vatuJNHcSuY7LkPlOhW2jDdMzotNkgq3Em1AKdVmZ6I0M0JYcyyqhVGuVK0I61Ky4Hnh1UUz5/d6y6JV4gvHqdbZzPI4zbhkmU58XJ8x7IXKduR5D92oAgHpujWyxwOitOa0y/N9XnbeAyMcBtw/ADHcYDmSGwwHgmlbTl93EPBje+v/tiEpnmwjHVv0FX9jCF+Q30J4" rel="noreferrer">Try it online!</a> Input and output as list of strings, <code>t</code> converts between that and space separated format.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/271425/">271425</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




