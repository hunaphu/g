<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::271329</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>008</td><td>Uiua</td><td>241105T022648Z</td><td><a href="https://codegolf.stackexchange.com/questions/271329/contract-a-tensor/276512#276512">nyxbird</a></td></tr>
<tr d-ix="1"><td>014</td><td>Wolfram Language Mathematica</td><td>240309T080007Z</td><td><a href="https://codegolf.stackexchange.com/questions/271329/contract-a-tensor/271646#271646">lesobrod</a></td></tr>
<tr d-ix="2"><td>081</td><td>Charcoal</td><td>240227T083828Z</td><td><a href="https://codegolf.stackexchange.com/questions/271329/contract-a-tensor/271338#271338">Neil</a></td></tr>
<tr d-ix="3"><td>038</td><td>Pyth</td><td>240227T154458Z</td><td><a href="https://codegolf.stackexchange.com/questions/271329/contract-a-tensor/271349#271349">CursorCo</a></td></tr>
<tr d-ix="4"><td>023</td><td>APL Dyalog Unicode</td><td>240226T222400Z</td><td><a href="https://codegolf.stackexchange.com/questions/271329/contract-a-tensor/271332#271332">Kamila S</a></td></tr>
<tr d-ix="5"><td>024</td><td>Python + NumPy</td><td>240227T035945Z</td><td><a href="https://codegolf.stackexchange.com/questions/271329/contract-a-tensor/271336#271336">alephalp</a></td></tr>
<tr d-ix="6"><td>115</td><td>JavaScript Node.js</td><td>240227T033010Z</td><td><a href="https://codegolf.stackexchange.com/questions/271329/contract-a-tensor/271335#271335">tsh</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://uiua.org" rel="nofollow noreferrer">Uiua</a>, 8 bytes</h1>
<pre><code>/+⌝⤸0_0⤸
</code></pre>
<p><a href="https://www.uiua.org/pad?src=0_14_0-dev_1__ZiDihpAgLyvijJ3ipLgwXzDipLgKZiAwXzEgWzBfMV8yIDNfNF81IDZfN184XQpmIDBfMSBbWzRfOF80IDFfNl84IDJfOF8yXVs4XzRfOSA3XzlfMiAwXzRfNF1bMl83XzcgNl8zXzAgM184XzhdXQpmIDBfMiBbWzRfOF80IDFfNl84IDJfOF8yXVs4XzRfOSA3XzlfMiAwXzRfNF1bMl83XzcgNl8zXzAgM184XzhdXQpmIDBfMiBbW1s4XzUgN185XVsyXzAgNl8wXV1bWzhfMyAyXzJdWzFfMyA5XzFdXV0KZiAxXzQgW1tbW1s3XV1dXV0K" rel="nofollow noreferrer">Try it!</a></p>
<pre><code>/+⌝⤸0_0⤸
       ⤸ # re-orient the specified axes to the front
  ⌝⤸0_0  # collapse the first two axes into one
/+       # sum along the new first axis
</code></pre>
</div>
<div id="pu1" class="pu"><h1><a href="https://www.wolfram.com/wolframscript/" rel="nofollow noreferrer">Wolfram Language (Mathematica)</a>, 14 bytes</h1>
<pre><code>TensorContract
</code></pre>
<p>Axes are 1-indexed.<br />
-5 thanks to @att<br />
<a href="https://tio.run/##y00syUjNTSzJTE78n2b7PyQ1rzi/yDk/r6QoMbnkf0BRZl6JQ1p0dXW1iY6ChY6CSa2OQrWhjoKZjoIliGkEFjWqBbGrQfJQcXMgDRIHMg3AolwKCkDNYGVAPUBpcxAbaIyxjoIBiGkMNsmiFqhGOVZN36EaaA1QP5A0rq39DwA" rel="nofollow noreferrer" title="Wolfram Language (Mathematica) – Try It Online">Try it online!</a></p>
</div>
<div id="pu2" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, <s>103</s> <s>82</s> 81 bytes</h1>
<pre><code>≔ＬθεＷ⁺υΣθ«≔ιθ→»≔Ｅθ⟦⟧δＵＭＥθ﹪÷κＸε⮌…·⁰ⅈε∧⁼§ιη§ιζ⊞Ｏ§δ↨Φι∧⁻μη⁻μζε§θκＵＭδΣιＦⅈ≔⪪δεδ⭆¹⊟⮌§δ⁰
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=VVHLToNAFI3L8hU3XQ3JNMG2sdWu6itpIpG0GxPCAmEKk_JmoKbGtR_hpguNrvwf_RrvwPThLGAO59xzz728fXmhW3ipG223H5VY9sa_J9_TsuRBQu5YEoiQ5DoFpk-0dcgjBsSKqpJUFBZVjJSuw7PWUQWcQo7CjpnWjFzMeRAKhC-aok03IzkF20FDHwnEV2kcu4m_o8zUr6KUzBJxzWvuM7KiYKVrVhBGYc5qVpQMWQ8j8JrN3SRgxKDwQHR5ZEx8TNHvJq_cqCRTMUt89iSDhZI5wI1UWlUZ3mescEVa7LU-hUsX29zySGBj3hqaPMGx49ZnDzZHXVU5TrHS_w_nt8vi8vMyLYDIvKCWssgiLqSEqa1YBU8EWQh8BXItp3IFGdlNfxTTaKaevJePXql-3qfd7dVR1_l5tfEMKYwpDB2qAYCNRmcUzhXqN1zfaaBtS92BHOFVki0yGm64k2Il8iNFouUAoyg0aFzHDmrBkA5trD8" rel="nofollow noreferrer" title="Charcoal – Attempt This Online">Attempt This Online!</a> Link is to verbose version of code. Explanation:</p>
<pre><code>≔Ｌθε
</code></pre>
<p>Get the size of the tensor.</p>
<pre><code>Ｗ⁺υΣθ«≔ιθ→»
</code></pre>
<p>Flatten the tensor into a list and get <code>1</code> less than the number of dimensions.</p>
<pre><code>≔Ｅθ⟦⟧δ
</code></pre>
<p>Create a temporary holding list of lists for the elements of the tensor that will be summed to make the contracted tensor. This list is still the same size as the flattened tensor for now.</p>
<pre><code>ＵＭＥθ﹪÷κＸε⮌…·⁰ⅈε∧⁼§ιη§ιζ⊞Ｏ§δ↨Φι∧⁻μη⁻μζε§θκ
</code></pre>
<p>For each element of the tensor, calculate whether it contributes to the contracted tensor, and if so, append that element to the relevant list element.</p>
<pre><code>ＵＭδΣι
</code></pre>
<p>Sum each of the lists.</p>
<pre><code>Ｆⅈ≔⪪δεδ
</code></pre>
<p>Unflatten the list back into a tensor of the original dimension.</p>
<pre><code>⭆¹⊟⮌§δ⁰
</code></pre>
<p>Retrieve the first element of the first element to produce the final result.</p>
<p>Previous 103-byte version was a backport to TIO of a 79-byte version using my experimental multidimensional indexing branch:</p>
<pre><code>≔θδＷ⁺υδ«≔⌊δδ→»≔Ｘ⁰⊕↔…⌊θ¹εＦΦＥＸＬθⅈ﹪÷ιＸＬθ…⁰ⅈＬθ⁼§ιη§ιζ«≔⁺⟦⁰⟧Φι∧⁻λη⁻λζγ≔⊟γβ≔εαＦγ≔§ακα≔θγＦι≔§γκγ§≔αβ⁺§αβγ»⭆¹⊟ε
</code></pre>
<p><a href="https://tio.run/##ZVHda8IwEH@ef8U9ppBB/WC6@SRuA2GCuJdB6UO1WRoWU21T3Rz727u7NNaCeWl/9/vI3WWbJcU2T3Rdz8pSScMOHNJg2jtlSgtgK12VrKJSAL@9O69ZKqN21Y6lQSO@W@ZHwZ7WSmYW4V/P61b5SRQs5LAw20LshLEiZbNNmevKCjb/2Woxz/J9m3fAvH6Ah4PAnM@8APaqtMWQZbL3cW/CSJs57Qcj6TJPK52zhbHP6qhSwRSHG@k6MVJQK@QhV8sReDlUiS7ZzC5MKr4pIMNqB57J1NmA20sUxhx8f6iZmZQmQUI3/hacmyslrapdzZ5JrG06NcEhIejmlgH48qWNhMNX4CXXx5KtQ904ZOPo3NvJ2uCWaIpuyYndC64KZSx7t/iRtPs@7XTPBA4yresIz4jDhMMo5j0AiJB/4PDo0cBxg9jBKCLdlRzjL5ENCh03ukjRifzYkxg55BB6NHSpkxi1EFJCfX/U/w" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation:</p>
<pre><code>≔θδＷ⁺υδ«≔⌊δδ→»
</code></pre>
<p>Calculate the number of dimensions of the input tensor.</p>
<pre><code>≔Ｘ⁰⊕↔…⌊θ¹ε
</code></pre>
<p>Generate a list of a zero tensor of two fewer dimensions as the initial value of the result tensor.</p>
<pre><code>ＦΦＥＸＬθⅈ﹪÷ιＸＬθ…⁰ⅈＬθ⁼§ιη§ιζ«
</code></pre>
<p>Loop over the multidimensional indices of all the elements of the tensor where the coordinates in the two given axes are identical.</p>
<pre><code>≔⁺⟦⁰⟧Φι∧⁻λη⁻λζγ≔⊟γβ≔εαＦγ≔§ακα
</code></pre>
<p>Get the parent list of the corresponding element of the result tensor.</p>
<pre><code>≔θγＦι≔§γκγ§≔αβ⁺§αβγ
</code></pre>
<p>Get the element of the input tensor and add it to that result element.</p>
<pre><code>»⭆¹⊟ε
</code></pre>
<p>Pretty-print the final result. (This is to show that the result is a single element when the input has two dimensions, as otherwise the output would be indistinguishable.)</p>
<p>Explanation of the 79-byte multidimensional indexing version:</p>
<pre><code>≔θδＷ⁺υδ«≔⌊δδ→»
</code></pre>
<p>Calculate the number of dimensions of the input tensor as before.</p>
<pre><code>≔×⁰…⌊θ¹ε
</code></pre>
<p>Generate a list of a zero initial result tensor. (This is slightly shorter because <code>Times</code> fully vectorises on that branch but it only vectorises over single dimensional arrays on TIO.)</p>
<pre><code>ＦＥＸＬθⅈ﹪÷ιＸＬθ…⁰ⅈＬθ«
</code></pre>
<p>Loop over the multidimensional indices of the input tensor.</p>
<pre><code>≔⁺⟦⁰⟧Φι∧⁻λη⁻λζδ
</code></pre>
<p>Get the multidimensional index of the result element.</p>
<pre><code>¿⁼§ιη§ιζ§≔εδ⁺§εδ§θι
</code></pre>
<p>Update that element if the coordinates in the two given axes are identical.</p>
<pre><code>»⭆¹⊟ε
</code></pre>
<p>Pretty-print the final result.</p>
</div>
<div id="pu3" class="pu"><h1><a href="https://github.com/isaacg1/pyth" rel="nofollow noreferrer">Pyth</a>, 38 bytes</h1>
<pre><code>.N?T:RtTtYN?tY:CN1Y?sIssNs.e@bkN:CMNT2
</code></pre>
<p><a href="https://tio.run/##JYsxCsMwDEX3nEIHEMF2TJN6cSF46FANxYsRWgqFQpeCvfT0ruJOeryn//m2V@8zxRzuLbdCsZWwky2xXmulOj8vjzeF/UbZ9ZBS6szsETYEL8gW4YRwVnLDOVHkI/7tquewyGY4P7r@algVdbwgGKVl7DcRmcxkfw" rel="nofollow noreferrer" title="Pyth – Try It Online">Try it online!</a></p>
<p>Defines a function <code>:</code> which takes three inputs: a nested list, first axis, and second axis. This assumes that the first axis is less than the second axis.</p>
<h3>Explanation</h3>
<p>The function operates recursively. The two axis inputs are <code>T</code> and <code>Y</code>. There are four cases to consider:</p>
<ul>
<li>In the base case <code>T=0</code>, <code>Y=1</code>, and the matrix has depth 2. In this case we simply take the trace of the matrix, which is straightforward to implement.</li>
<li>In the case that <code>T&gt;0</code> we map <code>:</code> over the list with axes <code>t-1</code> and <code>y-1</code>.</li>
<li>In the case that <code>T=0</code> and <code>Y&gt;1</code>, we transpose the matrix and call <code>:</code> on the transposition with axes <code>1</code> and <code>Y</code>.</li>
<li>And finally in the case that <code>T=0</code>, <code>Y=1</code>, and the matrix has depth greater than 2, we map transposition over the list and call <code>:</code> on that with axes <code>0</code>, <code>2</code>.</li>
</ul>
<pre><code>.N                                        # define :(N, T, Y)
  ?T                                      # if T != 0:
    :RtTtYN                               #   map : over N with additional arguments T-1, Y-1
           ?tY                            # else if Y &gt; 1:
              :CN1Y                       #   :(transpose(N), 1, Y)
                   ?sIssN                 # else if matrix depth is 2
                         s                #   sum of
                          .e   N          #   map lambda k, b over the indices, values of N
                            @bk           #     b[k]
                                          # else
                                 CMN      #   map transposition over N
                                :   T2    #   :(above, T, 2)
</code></pre>
</div>
<div id="pu4" class="pu"><h1>APL (Dyalog Unicode), 23 bytes</h1>
<pre><code>+/⊢⍉⍨-⍨⍥≢∘⍴⌊{⍋⍋⍺∊⍨⍳≢⍴⍵}
</code></pre>
<p>Follows a golf suggested by Marshall and Adam. My original answer that shows the idea better:</p>
<pre><code>{+/⍺⍉⍨(⍳r-2)@(⍵~⍨⍳r)⊢(r-2)@⍵⊢0⍴⍨r←⍴⍴⍺}
</code></pre>
<p>Matrix on the left, the two axes on the right. Works by noticing that tensor contraction on two axes given a tensor A is equivalent to dyadic transposition with rank(A)-2 in place of axes and iota everywhere else. Then we sum once by trailing axis. Transposition reduces rank by one, sum on trailing axis also reduces rank by one. Hence the resulting tensor has rank of rank(A)-2. Assumes quad IO of zero.</p>
</div>
<div id="pu5" class="pu"><h1><a href="https://www.python.org" rel="noreferrer">Python</a> + <a href="https://numpy.org/doc/stable/index.html" rel="noreferrer">NumPy</a>, 24 bytes</h1>
<p>-3 bytes thanks to <a href="https://codegolf.stackexchange.com/users/91267/mukundan314">@Mukundan314</a>.</p>
<pre class="lang-python prettyprint-override"><code>lambda a,i:a.trace(0,*i)
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=zVI7TsQwFJQofQaKp61s9HaVOGGTXWm5iHFhWCKCSGIZp8hZaCIhOANn4TQ8fxAFF6CKPTNvZuSX1w-7-MdpXN-60-377Ltt-_lshruzAYP90ey8M_cPvMCrXiT66-KyH-zkPIzzYBcwLzBaxs7GGziB4koVCCWC1MhAVQg1wnU87xEahFZrhCARyEisiG5JFBSgaI5Uh3SRkZE6Dqs2OmWKfA45AkJeHRySTsaUJlFkRg2KdKmiH-X_kwIyFwjO8YWyr07qYFRkeB-O2T_Iq4zLn3qEl78wVSv1nxjV6ASSshaaMdZNjtYMPcIT9COEHR7JYJo9rbLjo90Z58zCjUDgQSUE0db1o-c8DxK1ge0NbDDM5Z9kXdP3Gw" rel="noreferrer">Attempt This Online!</a></p>
</div>
<div id="pu6" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 115 bytes</h1>
<pre class="lang-javascript prettyprint-override"><code>f=(m,x,y,j)=&gt;(r=m.map?.((n,i)=&gt;f(n,x-1,y-1,x?j:i)),y?x?r:r.reduce(a=(u,v)=&gt;u.map?.((w,i)=&gt;a(w,v[i]))??u+v):r[j])??m
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=xVPBjtMwED1w61eMtIfarJs2aXfb7SrNiQsHOHBCrqU1rdNNaZzKTtpEiC_hsgf4KPgaxnYKC-JOpMj287w3b6yZL191tVVPT9-aOh8tvts8JSVrWcf2NF0Rk5ZRKY9ZRIhmBSI5ru0oZh3-bbZfFpSyLmszszSRUdtmo4hMScNOGNtcqGdPlbieeCEozbLm-kSXhu8F7suQ-seL97Wy9UZaZSGFhwHnEwYxg0SwAfApgxmDG7-_ZTBnsBCCgQuB0QriBK6gNnKjoMqhflRQytoU7QBlOBIXSHdc4KiI_LtwSPxNIrwsX_gc_RVmuOuTg3MycwohLvH55-EKxdDbJBymXg-dPbPGY6QmN3iaif9rJwl2nJWJt4Nvti3yXBmla5DanpUBeaj07jncKuttOz_-_Xs3IuRw6Sc9fOu2vSsXPu3x5FIU4vFvGAuKxZ_muHPW1_LPj8co4GjBE5-LoIDoLCh4CCvbVNo1RF1UGos6y85C6FBcpf4IHzpIBg8RdklJKDbv8YDdQ8ZX0cvxjsFwSCN7PBQ1Ga71WuMJm5mcIF3Bqb8YMyDr7TXtF5d9HMJaF_b63ds30VEaq0hLKb0f_GrvKK_MK7l5JISXDFoGHQMlqCN9wrrRuK2hwiHIwywiN6DVQUWHake8tEXnelfkHamQmqbwF6rQWIXUz_Q-TNhlyH8C" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/271329/">271329</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




