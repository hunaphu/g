<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::222941</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>020</td><td>APLNARS</td><td>251005T080410Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/284007#284007">Rosario</a></td></tr>
<tr d-ix="1"><td>162</td><td>Python 3</td><td>210406T044610Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222943#222943">hyperneu</a></td></tr>
<tr d-ix="2"><td>074</td><td>Retina</td><td>210406T193515Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222972#222972">Neil</a></td></tr>
<tr d-ix="3"><td>069</td><td>Haskell</td><td>210406T150840Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222961#222961">Delfad0r</a></td></tr>
<tr d-ix="4"><td>080</td><td>R</td><td>210406T114928Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222959#222959">Kirill L</a></td></tr>
<tr d-ix="5"><td>038</td><td>Charcoal</td><td>210406T113945Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222958#222958">Neil</a></td></tr>
<tr d-ix="6"><td>067</td><td>JavaScript ES6</td><td>210406T065143Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222950#222950">Arnauld</a></td></tr>
<tr d-ix="7"><td>047</td><td>Wolfram Language Mathematica</td><td>210406T054220Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222947#222947">ZaMoC</a></td></tr>
<tr d-ix="8"><td>014</td><td>Stax</td><td>210406T045105Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222944#222944">Razetime</a></td></tr>
<tr d-ix="9"><td>2523</td><td>J</td><td>210406T051342Z</td><td><a href="https://codegolf.stackexchange.com/questions/222941/truncate-continued-fractions/222946#222946">Jonah</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>APL(NARS), 20 chars</h1>
<pre><code>{↑k/⍨⍺≥÷1∨¨k←⌽+∘÷\⍵}
</code></pre>
<p>Input ⍺ one positive integer, ⍵ one array of elements rational type.
Output one rational.</p>
<pre><code>↑k/⍨⍺≥÷1∨¨k←⌽+∘÷\⍵
    ⍺            ⍵  ⍺ is the input left, ⍵ is the input right 
             +∘÷\⍵  this would make +∘÷/⍵ save each '+∘÷ partial sums' in a array of rational numbers
          k←⌽       this would reverse the array of rationals found, and put that array in the k variable
                      note that here in k each element has a better approximation of the input ⍵
                      than the next in the array k.
      ÷1∨¨          this would find each denominator of the array of rationals k, and return the array of them
    ⍺≥              this would build one boolean array ⍺≥denominators   
↑k/⍨                this would get the first in the array k that has denominator with ⍺≥denominator
                    so it return the better approximation of the number in ⍵ that has ⍺≥denominator
</code></pre>
<p>The array of rational type it seems can be defined write one &quot;x&quot; after the first element of the array.</p>
<p>test:</p>
<pre><code> f←{↑k/⍨⍺≥÷1∨¨k←⌽+∘÷\⍵}
 43 f 0x 2 3 6 1 3 3 
3r7 
 44 f 0x 2 3 6 1 3 3 
19r44 
 99 f 5x 6 7  
222r43 
 43 f ,1x  
1
  1 f ,1x  
1 
  1 f 0x 2 3 6 1 3 3 
0 
</code></pre>
</div>
<div id="pu1" class="pu"><h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a>, 162 bytes</h1>

<pre class="lang-python prettyprint-override"><code>lambda x,y:min((abs(q-g(*x)),q)for q in[g(*x[:i+1])for i in range(len(x))]if q.denominator&lt;=y)[1]
g=lambda v,*k:v+Fraction(*k and(1,g(*k)))
from fractions import*
</code></pre>
<p><a href="https://tio.run/##hY27DoJAEEV7v2LKGRyNiI9IpPUnkGIVFjfILKwbI1@PK7Gws5uce@6dbvA3K8mos/N4V@2lVPDiIW2NIKrLA/tFjdGLiHvS1kEPRvIPyVMzj4uJmcDAKakrvFeCQS6Mhn5ZVmLDjvLWHbOB8riY1dn3x5OjJn3OT05dvbGCUQNKSow5bDdENNPOtqC/8QNM21nno7FzRjxqzFcMa4aEYccQT0dSMGySUP3nbH6d7ZTuAz8ciMY3" rel="nofollow noreferrer" title="Python 3 – Try It Online">Try it online!</a></p>
<p>-28 bytes thanks to ovs</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://github.com/m-ender/retina/wiki/The-Language" rel="nofollow noreferrer">Retina</a>, 74 bytes</h1>
<pre><code>,
¶$%`,
¶
/1¶
+`\d+,(\d+)/(.+)
$.($2*_$1**)/$1
N$r`.*(\d+)
$1
L`.+¶(?!.+/)
</code></pre>
<p><a href="https://tio.run/##K0otycxLNPyvqhGcYP1fh@vQNhXVBBDFpW8IJLQTYlK0dTSAhKa@hp62JpeKnoaKkVa8iqGWlqa@iiGXn0pRgp4WWAEXkOuToKd9aJuGvaKetr7mf/cEvf8GOkY6xjpmOoZA0tjaxJgLTcCEyxTIMbe2tAQA" rel="nofollow noreferrer" title="Retina – Try It Online">Try it online!</a> Takes the continued fraction and denominator on separate lines, but link includes test suite that splits on <code>;</code> for convenience. Explanation:</p>
<pre><code>,
¶$%`,
</code></pre>
<p>Get all prefixes of the continued fraction.</p>
<pre><code>¶
/1¶
</code></pre>
<p>Start each prefix with a denominator of 1.</p>
<pre><code>+`\d+,(\d+)/(.+)
$.($2*_$1**)/$1
</code></pre>
<p>Calculate each resulting rational number from right to left.</p>
<pre><code>N$r`.*(\d+)
$1
</code></pre>
<p>Sort the desired denominator into the list of rational numbers.</p>
<pre><code>L`.+¶(?!.+/)
</code></pre>
<p>Output the rational number whose denominator is the largest that does not exceed the desired denominator.</p>
</div>
<div id="pu3" class="pu"><h1><a href="https://www.haskell.org/" rel="nofollow noreferrer">Haskell</a>, <sup><s>70</s></sup> 69 bytes</h1>

<pre class="lang-hs prettyprint-override"><code>x?m=last[y|y&lt;-f x,y!!1&lt;=m]
f(h:t)=[h,1]:[[a*h+b,a]|[a,b]&lt;-f t]
f[]=[]
</code></pre>
<p><a href="https://tio.run/##dY5LboMwEED3nGISIYHLRBRDExExyQV6A8sLE0iwwk/gRZByd2pIqq66m3nvjTSVGu9lXc/z49xQrUYjpueU7a7wwGmziTJqpHP1q6NhJCqM5FEI9VEFOSr5FApzubTGNkKSkHOjdEtF5wD4GjuW7cZetX5IHnksc0@30nzrtrS6Lo1vzxn9BtJj@s0vWPzx0GNuMXQ9cOheHgbyh1IVrgqCrdyy82t7RzmzVT/o1rgDkVgUXHAtjNI1FNL65c1ZfCJwhBhhjxCtQywRkhjoBHF4cP4LkiWI0jBJHPG1yoPFabpgznmYxD8" rel="nofollow noreferrer" title="Haskell – Try It Online">Try it online!</a></p>
<p>The relevant function is <code>(?)</code>, which takes as input the continued fraction <code>x</code> (as a list of integers) and the maximum denominator <code>m</code>. The output is a list of integers <code>[numerator,denominator]</code>.</p>
<h2>How?</h2>
<pre class="lang-hs prettyprint-override"><code>x?m=            -- x=continued fraction, y=maximum denominator
  last[         -- return the last
    y|y&lt;-f x,   --   convergent of x
    y!!1        --   whose denominator (i.e. second element)
      &lt;=m       --     is at most m
  ]
</code></pre>
<pre class="lang-hs prettyprint-override"><code>f                   -- helper function for computing convergents
  (h:t)=            --   h=first number, t=rest of the continued fraction
    [h,1]:          --     the first convergent is h (i.e. h/1)
    [[a*h+b,a]      --     the other convergents are h+b/a (i.e. (a*h+b)/a)
      |[a,b]&lt;-f t]  --       where a/b ranges over the convergents of t
f[]=[]              -- base case for the empty continued fraction
</code></pre>
</div>
<div id="pu4" class="pu"><h1><a href="https://www.r-project.org/" rel="nofollow noreferrer">R</a>, <s>88</s> 80 bytes</h1>

<pre class="lang-r prettyprint-override"><code>function(x,y,`~`=cbind,z=1:0~0:1){for(i in x)z=z[,1]*i+z[,2]~z;z[,z[2,]&lt;=y][,1]}
</code></pre>
<p><a href="https://tio.run/##fclNCsIwFEbRuat4w0S/QX6q0tSspASKkUAmKZQKbaTZemxdgKN74Uw12Breyc9xTGzBiqEM1j9jeiFbaUQRRvJPGCcWKSZaeLa5h3TneNmrXMnd3twruIdd3UFbDcwzAVIgDbqB5G80BzWan/5oc@jV3EFty@sX" rel="nofollow noreferrer" title="R – Try It Online">Try it online!</a></p>
</div>
<div id="pu5" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 38 bytes</h1>
<pre><code>ＦＬθ«≔⟦§θι¹⟧ζＦ⮌…θι≔⁺⁺⊟ζ×ζκζζ¿¬›§ζ¹ηＰ⪫ζ/
</code></pre>
<p><a href="https://tio.run/##NY6xCsIwEIZn@xSH0wUiWisuTuIgioqIW3Eo9bTBmNgkFa347DHVuhwH//99d3mRmVxn0vuTNoArUmdXYMkYvKLO1FpxVphO3UId6YElB8E4xAcONZtEnS@yozsZSzh75pJmhb79asHQ4ltZ2XaEsA6CvbiSxZrDhbFG1erECXCjHc4NZY4M/s@GYhw6ReNcV9KJmxHK4VIL1WTdfpcF/O19mg44DDkkHMaB@S5JeHaUHHzvLj8" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation:</p>
<pre><code>ＦＬθ«
</code></pre>
<p>Loop over the prefixes.</p>
<pre><code>≔⟦§θι¹⟧ζ
</code></pre>
<p>Form a &quot;fraction&quot; of the current element.</p>
<pre><code>Ｆ⮌…θι
</code></pre>
<p>Loop over the preceding elements.</p>
<pre><code>≔⁺⁺⊟ζ×ζκζζ
</code></pre>
<p>Invert the fraction and add on the element. This is some decidedly tricky coding. The old denominator is popped from the fraction, leaving behind the old numerator as a list of one element. This is vectorised multiplied by the element and added to the denominator, thus making a list of just the new numerator. The old numerator, still in its list, is then list concatenated to it, where it becomes the new denominator.</p>
<pre><code>¿¬›§ζ¹ηＰ⪫ζ/
</code></pre>
<p>If the denominator is still small enough, overprint the previous fraction (if any) with the current fraction.</p>
</div>
<div id="pu6" class="pu"><h1>JavaScript (ES6), <s> 72 68  </s> 67 bytes</h1>
<p>Expects <code>(max_denominator)(seq)</code>. Returns <code>[numerator, denominator]</code>.</p>

<pre class="lang-javascript prettyprint-override"><code>m=&gt;g=([v,...a],n=0,d=1,N=1,D=0)=&gt;(d+=D*v)&lt;=m?g(a,N,D,N*v+n,d):[N,D]
</code></pre>
<p><a href="https://tio.run/##fctBDoIwEAXQvafosoWRQlslGAc3rLkAYdFQIBqgRkyvXysrw8JJfjI/@e@hnV671/35Pi7W9H5AP2M5Im0cJEmiW1gwBYMZ1CEVpgxLamKsIseuON9GqqGGCurIxQsYdmlCa31nl9VOfTLZkQ5USUabFIgAIoGcgWTbI1vGCOdE8vywA@ovyAqu1I4URSCnbZx/Z78XiBCCK@k/" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Commented</h3>
<pre class="lang-javascript prettyprint-override"><code>m =&gt;             // outer function taking m = maximum denominator
g = (            // inner recursive function taking:
  [v,            //   v = next term from the continued fraction
      ...a],     //   a[] = remaining terms
  n = 0,         //   n = previous numerator
  d = 1,         //   d = previous denominator
  N = 1,         //   N = current numerator
  D = 0          //   D = current denominator
) =&gt;             //
  (d += D * v)   // we compute the new denominator d = D * v + d
                 // this results in NaN if v is undefined,
                 // which forces the comparison to fail
  &lt;= m ?         // if it's less than or equal to m:
    g(           //   do a recursive call:
      a,         //     pass the remaining terms of the continued fraction
      N, D,      //     pass the current numerator and denominator
      N * v + n, //     pass the new numerator
      d          //     pass the new denominator
    )            //   end of recursive call
  :              // else:
    [N, D]       //   we're done: return [N, D]
</code></pre>
</div>
<div id="pu7" class="pu"><h1><a href="https://www.wolfram.com/wolframscript/" rel="nofollow noreferrer">Wolfram Language (Mathematica)</a>, 47 bytes</h1>
<pre><code>Last@*Cases[a_/;Denominator@a&lt;=#]@*Convergents&amp;
</code></pre>
<p><a href="https://tio.run/##y00syUjNTSzJTE78n2b73yexuMRByzmxOLU4OjFe39olNS8/NzMvsSS/yCHRxlY5FiiZn1eWWpSemldSrPY/oCgzryRaWdcuLVo5OtooNjbWAUgbAmm1uuDkxLy6aq7qagMdBSMdBWMdBTMdBUMww7hWR8EESOCWNAFLmoKFzYEClpa1XLX/AQ" rel="nofollow noreferrer" title="Wolfram Language (Mathematica) – Try It Online">Try it online!</a></p>
<p>-25 bytes from @att</p>
</div>
<div id="pu8" class="pu"><h1><a href="https://github.com/tomtheisen/stax" rel="nofollow noreferrer">Stax</a>, 14 <a href="https://github.com/tomtheisen/stax/blob/master/docs/packed.md#packed-stax" rel="nofollow noreferrer">bytes</a></h1>
<pre><code>╪£pÇUßi⌂Ω♫M⌂░◘
</code></pre>
<p><a href="https://staxlang.xyz/#p=d89c708055e1697fea0e4d7fb008&amp;i=43,+%5B0,+2,+3,+6,+1,+3,+3%5D%0A%0A44,+%5B0,+2,+3,+6,+1,+3,+3%5D%0A%0A99,+%5B5,+6,+7%5D%0A&amp;m=1" rel="nofollow noreferrer">Run and debug it</a></p>
<p>takes inputs as <code>&lt;max denominator&gt;,&lt;continued fraction&gt;</code>.</p>
<h2>Explanation</h2>
<pre><code>|[{r{su+km{Rn^&lt;oH
|[{      m        for each prefix of the continued fraction
   r               reverse
    {   k          reduce by:
     su+            swap, reciprocal and add
          {    o  order by:
           R       denominator
            n^&lt;    lesser than 2nd input + 1 ? 
                H last element
</code></pre>
</div>
<div id="pu9" class="pu"><h1><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, <sup>25</sup> 23 bytes</h1>
<pre><code>(]{:@#~0#.&gt;:)2 x:(+%)/\
</code></pre>
<p><a href="https://tio.run/##y/qvpKeepmBrpaCuoKNgoGAFxLp6Cs5BPm7/NWKrrRyU6wyU9eysNI0UKqw0tFU19WP@a3KlJmfkKxgrmCvoWimYGCukKRjoKBjpKBjrKJjpKBiCGcYVEFVGRkYgJUCFlpZAhaZgJeZQSUNLBRMTsCEmOAz5DwA" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
<p><sup>-2 thanks to Bubbler</sup></p>
<h2>how</h2>
<p>We'll use <code>43 f 0, 2, 3, 6, 1, 3, 3x</code> as an example...</p>
<ul>
<li><p><code>(+%)/\</code> For each prefix <code>\</code>, reduce from the right <code>/</code> using the J hook <code>(+%)</code>, which adds its left arg to the inverse of its right argument.  This returns rational numbers:</p>
<pre><code>0 1r2 3r7 19r44 22r51 85r197 277r642
</code></pre>
</li>
<li><p><code>2 x:</code> Convert to pairs:</p>
<pre><code>0   1
1   2
3   7
19  44
22  51
85  197
277 642
</code></pre>
</li>
<li><p><code>]...#~...</code> Filter that list for valid denominators with the following mask:</p>
<ul>
<li><p><code>&gt;:</code> Is each number less than or equal to the left arg:</p>
<pre><code>1 1
1 1
1 1
1 0
1 0
0 0
0 0
</code></pre>
</li>
<li><p><code>0#.</code> Convert to a &quot;base 0&quot; number.  This will be <code>1</code> only for pairs whose 2nd element (denominator) is <code>1</code>:</p>
<pre><code>1 1 1 0 0 0 0
</code></pre>
</li>
</ul>
</li>
<li><p>Our filtered list becomes:</p>
<pre><code>0   1
1   2
3   7
</code></pre>
</li>
<li><p><code>{:@</code> Return the last element.</p>
</li>
</ul>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/222941/">222941</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




