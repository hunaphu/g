<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::203446</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>551</td><td>Python3</td><td>250528T190845Z</td><td><a href="https://codegolf.stackexchange.com/questions/203446/make-a-rectangle-from-a-collection-of-sliced-squares/282023#282023">Ajax1234</a></td></tr>
<tr d-ix="1"><td>148</td><td>Wolfram Language Mathematica</td><td>200413T235114Z</td><td><a href="https://codegolf.stackexchange.com/questions/203446/make-a-rectangle-from-a-collection-of-sliced-squares/203462#203462">ZaMoC</a></td></tr>
<tr d-ix="2"><td>186</td><td>Python 2</td><td>200413T140531Z</td><td><a href="https://codegolf.stackexchange.com/questions/203446/make-a-rectangle-from-a-collection-of-sliced-squares/203451#203451">newbie</a></td></tr>
<tr d-ix="3"><td>188</td><td>JavaScript ES6</td><td>200413T104255Z</td><td><a href="https://codegolf.stackexchange.com/questions/203446/make-a-rectangle-from-a-collection-of-sliced-squares/203450#203450">Arnauld</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Python3, 551 bytes</h1>
<pre class="lang-py prettyprint-override"><code>def C(p,L):
 q,s=[([],[],p)],[]
 for a,b,p in q:
  if len(a)==L and(a,b+p)not in s:yield a,b+p;s+=[(a,b+p)]
  if len(a)&lt;L and p:
   q+=[(a,b+[p[0]],p[1:])]
   if len(V:=a+p[0])&lt;=L:q+=[(V,b,p[1:])]
def f(n):
 W=[[i]*i for i in range(1,n+1)for _ in range(i)]
 n-=1
 while(n:=n+1):
  if sum(map(len,W))%n:continue
  q,s=[([a],b)for a,b in C(W,n)],[]
  while q:
   (a,p),*q=sorted(q,key=lambda x:sum(map(len,x[1]))) 
   if[]==p and len(a)&gt;1:return a
   for A,P in C(p,n):
    if a+[A]not in s and(a+[A])[::-1]not in s:q+=[(a+[A],P)];s+=[a+A,(a+[A])[::-1]]
</code></pre>
<p><a href="https://tio.run/##VVFNa8MwDL3nV@gysBYXFrqN4dWD0msPPbUHY4a7OKtZ6jgfZe2vz2I72TIwWOg96UlP7tadKrt8cU3f57qADXF0iyyBmrZcECHp8Bz6L4GiakDRI3VgLNQDCUwBpbZEIedbUDYnA5w6tFXnKS27GV3mEJKvbTo0jLicl65CJTjfD@qJJJx4kIO0yJgM/Klgz7hKPYgrvmWBv/czjUS/REGsX@HAhTDy3oS5jR@oUfZTk4zaNEOffP9LGi9iFzxL4PtkSk0s4542btlezuSsHBkmoAfEO8s@KtsZe9EDPnqlJD3i6JFvvCEHakfrYtNoGgwLOqT3NW@rptM5qemXvvFSnY@5giuba11FJhERogFCcu6CW9G6t4w1urs0FpQneO013UVtR4MJ0TiVirWcrhIP5TMoGFtkv0B0MyB0hzJcTKVr@o8se9cY25GCLBGTKX6cxU@z@Bmx/wE" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h1><a href="https://www.wolfram.com/wolframscript/" rel="nofollow noreferrer">Wolfram Language (Mathematica)</a>, 148 bytes</h1>

<p>finds random matrix with only horizontal tiles.<br>
It is very slow for n>5 but this is code-golf...    </p>

<pre><code>(While@!MatrixQ[Join@@@(w=TakeList[d=RandomSample@Flatten[Table[#~Table~#,#]&amp;/@Range@#,1],r=RandomChoice@IntegerPartitions[#(#+1)/2][[2;;-2]]])];w)&amp;
</code></pre>

<p><a href="https://tio.run/##LY7NCoJAFEZfpRgQJUMUWokwEARFgf1Ai2EWN72Ml3SM8YKtfPVJqtXZnPPxdcANdsBUgTeFD@8NtSiXJ2BH77M69GSllOFY3OCJRxpY1cUFbN13V@hes7prgRmtusGjRSWmLycRCx0kcjYNShGnOnb/bNv0VKHcW0aDrgTHxNTbQYlQrNIoybRSWZ6vM611pPMxCnzpyHIiw98ZMe8ujNroyPsP" rel="nofollow noreferrer" title="Wolfram Language (Mathematica) – Try It Online">Try it online!</a>     </p>

<p>here is also a very quick random generator for test cases up to 6   </p>

<h1><a href="https://www.wolfram.com/wolframscript/" rel="nofollow noreferrer">Wolfram Language (Mathematica)</a>, 97 bytes</h1>

<pre><code>(While@!MatrixQ[Join@@@(w=Partition[RandomSample@Flatten[Table[#~Table~#,#]&amp;/@Range@#,1],3])];w)&amp;
</code></pre>

<p><a href="https://tio.run/##JY29CsIwFEZfRRsoLQ0UEVxq4E4dBKH@gEPIcNXQXmgSCRfq1FePpU5n@M7HcciDdcj0wtSrVDwGGi1sz8iRvhd9CuQBoJhUh5GJKXh9Rf8O7obus5jtiMzW6zs@R6vFvHIWUpi8hsXsLQi5M3JvStNMZZ7aEDWpvaSjOkiqKtlF8lxD8U@J5bbpNZmyWQfIMpPSDw" rel="nofollow noreferrer" title="Wolfram Language (Mathematica) – Try It Online">Try it online!</a></p>
</div>
<div id="pu2" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a>, <s>238 ...</s> 186 bytes</h1>

<p><em>-2 bytes thanks to @Arnauld!</em></p>

<p><em>-5 bytes thanks to @ovs!!</em></p>

<p><em>-6 bytes thanks to @Jonathan Allan!!</em></p>



<pre class="lang-python prettyprint-override"><code>n=input()
p=w=~n*n*(~n-n)/6
e=range(n+1)
def f(a,b,c,d=[]):1&gt;a&gt;exit(c);1&gt;b&gt;f(a-1,w,c+[d]);g=n;exec"e[g]-=1;g&lt;=b&gt;-1&lt;e[g]&gt;f(a,b-g,c,d+[g]*g);e[g]+=1;g-=1;"*n
while 1:1&gt;p%w&gt;f(p/w,w,[]);w-=1
</code></pre>

<p><a href="https://tio.run/##HY3LCoMwEEX3foUIhTyRdNFC4@RHxIXGGIUyDcUSu/HX06TLO3PuueG7ry@8poSwYfjshFYBIpzIkJETJdL2Vjl4j@gdQa5oNbulXsgoJmHFDP1AH8qMxh3bTizVykwmf6USUVjezwPVHlC7w9nG9X6QoLTvYDJSdSWbv0r6IuM5M091ufPCFbhhWMV1e7pa5aFwibkR2pj1eVrHjKR0/wE" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>

<p>Notice that the above code only used horizontal tiles. To prove it's correct...</p>

<hr>

<h1><a href="https://gcc.gnu.org/" rel="nofollow noreferrer">C++ (gcc)</a>, 4355 bytes</h1>

<p>This code is an explicit construction using only horizontal tiles for <span class="math-container">\$n&gt;6\$</span>. It can produce correct solutions (at least) up to <span class="math-container">\$n=99\$</span>.</p>



<pre class="lang-cpp prettyprint-override"><code>#include &lt;bits/stdc++.h&gt;
using namespace std;
void dim(int x,int&amp;p,int&amp;q)
{
&#9;int u[]={x,x+1,x+x+1},o=0;
&#9;while(u[o]%2) ++o; u[o]/=2;
&#9;o=0; while(u[o]%3) ++o; u[o]/=3;
&#9;sort(u,u+3);if(x%3==1)swap(u[0],u[1]);
&#9;p=u[0];q=u[1]*u[2];
}
int o[100][99999],c[99999],g[99999];
void brute(int n,int&amp; v,int&amp; u,bool t)
{
&#9;for(int i=1;i&lt;=n;++i) c[i]=i;
&#9;if(t)
&#9;{
&#9;&#9;u=n*(n+1)*(2*n+1)/6,v=2;
&#9;&#9;while(u%v) ++v;
&#9;&#9;if(n&gt;=5) v=u/v;
&#9;&#9;u/=v; c[2]-=n==6;
&#9;}
&#9;for(int i=1;i&lt;=v;++i)
&#9;{
&#9;&#9;int s=u,cnt=0;
&#9;&#9;for(int j=n;j&gt;=1;--j) while(s&gt;=j&amp;&amp;c[j])
&#9;&#9;{
&#9;&#9;&#9;s-=j, --c[j]; for(int k=j;k--;) o[i][++cnt]=j;
&#9;&#9;}
&#9;}
&#9;c[2]+=t&amp;&amp;n==6;
&#9;for(int i=u;i&gt;=u-1&amp;&amp;i;--i)
&#9;&#9;for(int j=1;j&lt;=v;++j) if(!o[j][i])
&#9;&#9;{
&#9;&#9;&#9;int x=0; while(!c[x]) ++x;
&#9;&#9;&#9;--c[x]; int l=x; --j;
&#9;&#9;&#9;while(l--) o[++j][i]=x;
&#9;&#9;}
}
int s0[99999],s1[99999];
//find a subset of a with sum b
//guaranteed b is half of a's sum
//guaranteed a is consecutive
pair&lt;vector&lt;int&gt;,vector&lt;int&gt;&gt; solve2(vector&lt;int&gt; a,int b)
{
&#9;if(!a.size()) return make_pair(a,a);
&#9;int w=0,s=0,as=a.size();
&#9;for(int i=0;i&lt;as;++i)
&#9;&#9;s0[i+1]=s0[i]+a[i],
&#9;&#9;s1[i+1]=s1[i]+a[as-1-i];
&#9;while(w&lt;a.size()&amp;&amp;s+a[w]&lt;=b)
&#9;&#9;s+=a[w++];
&#9;assert(w!=a.size()&amp;&amp;w&gt;0);
&#9;for(int l=0;l&lt;w;++l)
&#9;{
&#9;&#9;int r=w-1-l;
&#9;&#9;int p=s0[l]+s1[r];
&#9;&#9;if(p&gt;b) continue;
&#9;&#9;int q=b-p;
&#9;&#9;if(!(a[l]&lt;=q&amp;&amp;q&lt;=a[as-r-1]))
&#9;&#9;&#9;continue;
&#9;&#9;//first l, last r, q.
&#9;&#9;vector&lt;int&gt; A,B;
&#9;&#9;for(int j=0;j&lt;l;++j) A.push_back(a[j]);
&#9;&#9;A.push_back(q);
&#9;&#9;for(int j=as-r;j&lt;as;++j) A.push_back(a[j]);
&#9;&#9;for(int j=l;j&lt;as-r;++j)
&#9;&#9;{
&#9;&#9;&#9;if(a[j]==q) q=-1;
&#9;&#9;&#9;else B.push_back(a[j]);
&#9;&#9;}
&#9;&#9;return make_pair(A,B);
&#9;}
&#9;assert(0);
}
int main()
{
&#9;int n,p,q;
&#9;cin&gt;&gt;n;
&#9;assert(n&gt;=3);
&#9;if(n&lt;=6) brute(n,p,q,1);
&#9;else
&#9;{
&#9;&#9;if(n%3==1)
&#9;&#9;{
&#9;&#9;&#9;int x=n%3,pp,qq;
&#9;&#9;&#9;dim(x,p,q);
&#9;&#9;&#9;brute(x,p,q,0);
&#9;&#9;&#9;while(n!=x)
&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;//x+1...x+3
&#9;&#9;&#9;&#9;int xx=x+3; dim(xx,pp,qq);
&#9;&#9;&#9;&#9;assert(pp-p==2&amp;&amp;qq-q==x*3+6);
&#9;&#9;&#9;&#9;for(int i=x+1;i&lt;=x+3;++i) c[i]=i;
&#9;&#9;&#9;&#9;int mr=x/6;
&#9;&#9;&#9;&#9;for(int i=1;i&lt;=p;++i)
&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;int cnt=q;
&#9;&#9;&#9;&#9;&#9;vector&lt;int&gt; rv;
&#9;&#9;&#9;&#9;&#9;if(i&lt;=mr) rv=vector&lt;int&gt;{x+2,x+2,x+2};
&#9;&#9;&#9;&#9;&#9;else rv=vector&lt;int&gt;{x+1,x+2,x+3};
&#9;&#9;&#9;&#9;&#9;for(int j:rv)
&#9;&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;&#9;assert(c[j]); --c[j];
&#9;&#9;&#9;&#9;&#9;&#9;for(int k=j;k--;) o[i][++cnt]=j;
&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;vector&lt;int&gt; rv;
&#9;&#9;&#9;&#9;for(int i=x+1;i&lt;=x+3;++i)
&#9;&#9;&#9;&#9;&#9;for(int j=c[i];j;--j) rv.push_back(i);
&#9;&#9;&#9;&#9;pair&lt;vector&lt;int&gt;,vector&lt;int&gt;&gt; s=solve2(rv,qq);
&#9;&#9;&#9;&#9;for(int i=p+1;i&lt;=pp;++i)
&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;int cnt=0;
&#9;&#9;&#9;&#9;&#9;for(auto j:(i==pp)?s.first:s.second)
&#9;&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;&#9;assert(c[j]); --c[j];
&#9;&#9;&#9;&#9;&#9;&#9;for(int k=j;k--;) o[i][++cnt]=j;
&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;p=pp; q=qq; x=xx;
&#9;&#9;&#9;}
&#9;&#9;}
&#9;&#9;else
&#9;&#9;{
&#9;&#9;&#9;int x=n%6,pp,qq;
&#9;&#9;&#9;dim(x,p,q);
&#9;&#9;&#9;brute(x,p,q,0);
&#9;&#9;&#9;while(n!=x)
&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;int xx=x+6; dim(xx,pp,qq);
&#9;&#9;&#9;&#9;if(n%6==0)
&#9;&#9;&#9;&#9;&#9;assert(pp-p==1&amp;&amp;qq-q==24*x+90); //[1 2 3 4 5 6]*3+[2 3 5 5 6 6]
&#9;&#9;&#9;&#9;else if(n%6==2)
&#9;&#9;&#9;&#9;&#9;assert(pp-p==2&amp;&amp;qq-q==12*x+39); //[1 2 3 4 5 6]+[1 1 2 3 5 6]
&#9;&#9;&#9;&#9;else if(n%6==3)
&#9;&#9;&#9;&#9;&#9;assert(pp-p==2&amp;&amp;qq-q==12*x+45); //[1 2 3 4 5 6]+[1 2 4 5 6 6]
&#9;&#9;&#9;&#9;else if(n%6==5)
&#9;&#9;&#9;&#9;&#9;assert(pp-p==1&amp;&amp;qq-q==24*x+78); //[1 2 3 4 5 6]*3+[1 1 2 2 4 5]
&#9;&#9;&#9;&#9;else assert(0);
&#9;&#9;&#9;&#9;vector&lt;int&gt; uv;
&#9;&#9;&#9;&#9;if(n%6==0) uv=vector&lt;int&gt;{2,3,5,5,6,6};
&#9;&#9;&#9;&#9;else if(n%6==2) uv=vector&lt;int&gt;{1,1,2,3,5,6};
&#9;&#9;&#9;&#9;else if(n%6==3) uv=vector&lt;int&gt;{1,2,4,5,6,6};
&#9;&#9;&#9;&#9;else uv=vector&lt;int&gt;{1,1,2,2,4,5};
&#9;&#9;&#9;&#9;for(int j=1;j&lt;4/(pp-p);++j)
&#9;&#9;&#9;&#9;&#9;for(int k=1;k&lt;=6;++k) uv.push_back(k);
&#9;&#9;&#9;&#9;for(int i=x+1;i&lt;=x+6;++i) c[i]=i;
&#9;&#9;&#9;&#9;for(int i=1;i&lt;=p;++i)
&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;int cnt=q;
&#9;&#9;&#9;&#9;&#9;for(auto j_:uv)
&#9;&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;&#9;int j=j_+x;
&#9;&#9;&#9;&#9;&#9;&#9;assert(c[j]); --c[j];
&#9;&#9;&#9;&#9;&#9;&#9;for(int k=j;k--;) o[i][++cnt]=j;
&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;vector&lt;int&gt; rv;
&#9;&#9;&#9;&#9;for(int i=x+1;i&lt;=x+6;++i)
&#9;&#9;&#9;&#9;&#9;for(int j=c[i];j;--j) rv.push_back(i);
&#9;&#9;&#9;&#9;if(pp-p==2)
&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;pair&lt;vector&lt;int&gt;,vector&lt;int&gt;&gt; s=solve2(rv,qq);
&#9;&#9;&#9;&#9;&#9;for(int i=p+1;i&lt;=pp;++i)
&#9;&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;&#9;int cnt=0;
&#9;&#9;&#9;&#9;&#9;&#9;for(auto j:(i==pp)?s.first:s.second)
&#9;&#9;&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;&#9;&#9;assert(c[j]); --c[j];
&#9;&#9;&#9;&#9;&#9;&#9;&#9;for(int k=j;k--;) o[i][++cnt]=j;
&#9;&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;else
&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;int i=pp,cnt=0;
&#9;&#9;&#9;&#9;&#9;for(auto j:rv)
&#9;&#9;&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;&#9;&#9;assert(c[j]); --c[j];
&#9;&#9;&#9;&#9;&#9;&#9;for(int k=j;k--;) o[i][++cnt]=j;
&#9;&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;}
&#9;&#9;&#9;&#9;p=pp; q=qq; x=xx;
&#9;&#9;&#9;}
&#9;&#9;}
&#9;}
&#9;cerr&lt;&lt;p&lt;&lt;","&lt;&lt;q&lt;&lt;"\n";
&#9;for(int i=1;i&lt;=p;++i,cout&lt;&lt;"\n")
&#9;&#9;for(int j=1;j&lt;=q;++j)
&#9;&#9;&#9;cout&lt;&lt;setw(2)&lt;&lt;o[i][j]&lt;&lt;" ";
&#9;if(n&gt;6)
&#9;{
&#9;&#9;for(int i=1;i&lt;=n;++i) c[i]=i;
&#9;&#9;for(int i=1;i&lt;=p;++i)
&#9;&#9;&#9;for(int j=1;j&lt;=q;++j)
&#9;&#9;&#9;{
&#9;&#9;&#9;&#9;int u=o[i][j];
&#9;&#9;&#9;&#9;assert(u&gt;=1&amp;&amp;u&lt;=n);
&#9;&#9;&#9;&#9;for(int k=2;k&lt;=u;++k)
&#9;&#9;&#9;&#9;&#9;assert(o[i][++j]==u);
&#9;&#9;&#9;&#9;--c[u];
&#9;&#9;&#9;}
&#9;&#9;for(int i=1;i&lt;=n;++i) assert(!c[i]);
&#9;}
}
</code></pre>

<p><a href="https://tio.run/##xVdtc5s4EP5s/wolN/WZIGyDY@5akG/av@FjMpiQRDYGjBBmruPfnlu9YIODm7Y3nUvGgJZ9ebTaZyWiPLeeo@j19TeaRgl/jJG/piWbsvIxMs3Jy3LIGU2fURruYpaHUYzgjTesMvqIHuluTNMS1Riuo1xe98bw63AgpHwVkK81rk0bfnA94ozMvOHg8EKTeMxXWfDBMZBpZh4Sgylx4KVQQS2NeUdjDhosK8oxx9ycGx59Gtcf5oTYBjuEOVjMAsxXdmCAXk7E0NsTIbjjKyfwhsehAJat7NksWH0UfwGOmodn/aAnty54GcvppXJiqFI3jtdZlqBSzvMpK6QKJbZHfZJ6pkkNFK1oQChgAHygNwDFASfp3Tg1beNu7NyJ@9TFlZxyk5APlZhrJSRgly7JwkAV4VMp4VNSeeDYCSySEuKC7PgmfCXDq3hCzAjHUVrKrJ90N4ByswQDy9oYOtVsSTajUbTaBGAtzQfMIhuMLEsIPdQYb8nG21qWZ0ASabAyTXAfgAwsjhKRQGiScjTSIM8IuUeXhFv2aEQhtIDZgmR7GwUfIMHkbzKICgFOaGSVnUvjJlrVgchWLSIPBMoaUAqthNQewJaQdGYTyxJ4wbnwSWqFVtUCmzXLz@zT@k@nTzR9RCFifM1iKJgneD7Q8gUEO7SG9888LMK0jGOoE0QZegmTJ6n2OxM6XY1QaERZyuKIl7SKh3lIC7@KozIrfACxxK3nJWJZUsXOuCVDoSg9tFbUgvSEE0b/iceGgYq45EWKduE2fhBuxyEORfUL/QOZYQa/kJHGoLMiM6iZkOmaGUAmqGkHRNwDM4QLFlJbS20lDZllWzQ40fjgN65HIwbvD4FP1tKdSWBkmkI1ZCwG0h5uyFn5sJy10SSAJvEPACZpFXBBDhAu8fQwF@CSwAQwRaB5ki/XhkhuSVMeN4p7srZyrXAzDsHGJ/vRaO8TOYPCghYhQA7ahmLVCwZQMEpCuBcY7Scgby/EZ/yly6UZFG6i6vbzJOfs5WEdRlsIuZFNaNAW7o2urUAC5nIJrtmftROpChZC@cSLJ6lKyN6ASVu2rPo4YTH60ucNCDp4UzEwJ0O1E71OYmEUO3YhTcenhp7iHO9BM6Lpcpme1xVa1dxQ3S71iWvo1inVsS3eCER6VUFHdewutUGIc9DfyxmIjaUW5hL1QPmTAjwzWsxOb0gt11F6ghWEbWYymdTmXI6l65rA0JN7VV2rGMpFAx82wJwQB8pjb@0Jqe/mpqs1zlwBx6LDClfdFq/D7ApST91LK2mTNwxrYEoD0ZfVZLsVVlRaCJkC410BHK9IS@NrbTpY/45aV674GzVbq80btVMxfSoqBahB1ORCbgFe0/b1u@9o/gNVW821b0JXc3mBjYjUehu1PRVVq4ypXpV32ifRDbSozkt9Dp6r4Pn1VZm1shXyMoN0jSkBC@MvNpEt4hObQC/P0sdfmsRcgARWAyeAILXa6o6axYpRXQa5/51BJ8a4vYyR7HUJmemJdxhkNwxy7u9q8yOEQdPpykYOmqN7tEBuAMxaidFCjGA8PNVu49jpc3yipu2A4/nHt45NGKnxotft/H2394t@t4567nW7eD8Nf/zZnwaFVzpvOW414Esa8epyCUDUIbyD53gB/y52NeEvUntpYGMbK6Neg3mPgYPv30bodSs1j132qXPe/VRmymg2sg45bG8LWwi82oroLfJvr7dk921L/uEWfCb7wyd@2RwV9s2DPm7@X@3S/bl2KQ5JquA7GfiJLvrtNtpJV7uR/kAnPfn4Zoa/M8U6u51U677ZqQOYTY6vdP5fvFF@q8eLr6m4KHw/9/1bfOv7e7j/nd56w97yxlHGS6XR8221P7FNqcFnzWHsGL4vEW4CMES3@gy3dPUR/J2v2@ssuxr8vMtwoiN3zmJ8Kfonh1gXdN/CpzJ0Bi47Q6fr6hSLQzDXRmJVeHDKZf80tPmNmI46/x5fX@3Zvw" rel="nofollow noreferrer" title="C++ (gcc) – Try It Online">Try it online!</a></p>

<hr>

<h1>How does the construction work?</h1>

<p>It's an incremental construction. Consider <span class="math-container">\$n \bmod 6\$</span>, we can have these values for height and width of rectangles:</p>

<ul>
<li><p><span class="math-container">\$n/6\times (n+1)(2n+1)~(n\bmod 6=0)\$</span></p></li>
<li><p><span class="math-container">\$(2n+1)/3\times n(n+1)/2~(n\bmod 6=1)\$</span></p></li>
<li><p><span class="math-container">\$(n+1)/3\times n(2n+1)/2~(n\bmod 6=2)\$</span></p></li>
<li><p><span class="math-container">\$n/3\times (n+1)(2n+1)/2~(n\bmod 6=3)\$</span></p></li>
<li><p><span class="math-container">\$(2n+1)/3\times (n+1)n/2~(n\bmod 6=4)\$</span></p></li>
<li><p><span class="math-container">\$(n+1)/6\times n(2n+1)~(n\bmod 6=5)\$</span></p></li>
</ul>

<p>(dimensions might be <span class="math-container">\$1\$</span> for <span class="math-container">\$n\leq 6\$</span> so these small cases are handled manually)</p>

<p>So the main idea of my construction is:</p>

<ul>
<li><p>We construct rectangles with the heights and widths as in above list.</p></li>
<li><p>If <span class="math-container">\$n\bmod 3 \neq 1\$</span>, construct the solution for <span class="math-container">\$n-6\$</span> recursively, add in <span class="math-container">\$n-5,n-4\cdots n\$</span>. The height of the rectangle will only increase 1 or 2.</p></li>
<li><p>If <span class="math-container">\$n\bmod 3=1\$</span>, construct the solution for <span class="math-container">\$n-3\$</span> recursively and add in <span class="math-container">\$n-2,n-1,n\$</span>. The height of the rectangle will only increase 2.</p></li>
<li><p>We first carefully assign the new numbers to the added columns, and then put rest of the numbers into one or two added rows.</p></li>
</ul>

<p>The rest of the job is some careful casework to pick the numbers. These details are left as an exercise to the readers (Be ready for some long and tedious casework!). If you complete all the details, this should become a formal proof for the existence of the solutions (and using only horizontal tiles!).</p>
</div>
<div id="pu3" class="pu"><h1>JavaScript (ES6), 188 bytes</h1>
<p>A shorter version inspired by <a href="https://codegolf.stackexchange.com/a/203451/58563">@newbie's answer</a>.</p>

<pre class="lang-javascript prettyprint-override"><code>f=(n,w=2)=&gt;(g=(h,a,m,r=[])=&gt;h%1||r[w]?1:r[w-1]?--h*g(h,a,M=[...m,r]):a.every((_,j,[...a])=&gt;a[j]++&gt;j++||g(h,a,m,[...r,...Array(j).fill(j)])))(n*(~n-n)*~n/6/w,Array(n).fill(0),[])?f(n,w+1):M
</code></pre>
<p><a href="https://tio.run/##XU5LboMwEN3nFLOpmMHGKa2UBalBPUBOQFFlJfwsMo6cKigqzdWpSbPqZt7o/fSsuZjz3venr4TdoZ7nRiPLUb@QzrHV2Ekjj9LrsgpE95ROky/HqkizAElaFUnSxe3dtdOlUip4K8qMqi@1vyJ@SisX2ixxU9pKiNwKMU3to3kRvQzn3XtzRUuq6YchYEVEyDHeOGGKb7zerEf5Z@KH6ZlkmFU0y2CRUrabG@eRQcPrFhjeNGwCCkHwvQLYOz67oVaDazFiHYEApu0/oVnKj@aEHnQOXlnXM0YQET3eD44oJO@4@pl/AQ" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Commented</h3>
<pre class="lang-javascript prettyprint-override"><code>f = (                           // f is a recursive function taking:
  n, w = 2                      //   n = input, w = width of matrix
) =&gt; (                          //
g = (                           // g is a recursive function taking:
  h, a,                         //   h = height of matrix, a[] = array of counters
  m, r = []                     //   m[] = matrix, r[] = current row
) =&gt;                            // (g returns 0 for success or 1 for failure)
  h % 1 ||                      // if h is not an integer or
  r[w] ?                        // the length of r[] is w + 1 (i.e. r[] is too long):
    1                           //   abort
  :                             // else:
    r[w - 1] ?                  //   if the length of r[] is w:
      --h *                     //     decrement h and force success if h = 0
      g(                        //     do a recursive call with:
        h, a,                   //       h and a[] unchanged
        M = [...m, r]           //       a new matrix M[] with r[] appended
      )                         //     end of recursive call
    :                           //   else:
      a.every((_, j, [...a]) =&gt; //     for each entry at position j in a[]:
        a[j]++ &gt; j++ ||         //       unless a[j] is greater than j,
        g(                      //       do a recursive call with:
          h, a, m,              //         h, a[] and m[] unchanged
          [ ...r,               //         j added j times to the current row
            ...Array(j).fill(j) //         NB1: both j and a[j] where incremented above
          ]                     //         NB2: a[] is a local copy defined in this loop
        )                       //       end of recursive call
      )                         //     end of every()
)(                              // initial call to g with:
  n * (~n - n) * ~n / 6 / w,    //   h = n(n+1)(2n+1) / 6 / w
  Array(n).fill(0),             //   a[] initialized to n 0's
  []                            //   an empty matrix
) ? f(n, w + 1) : M             // return M[] on success, or try again with w + 1
</code></pre>
<hr />
<h1>JavaScript (ES6), <s> 297 </s> 287 bytes</h1>
<p>A brute-force search, which always try to put the biggest available rectangles first.</p>

<pre class="lang-javascript prettyprint-override"><code>f=(n,i=2,k=n*(~n-n)*~n/6,A=n=&gt;n?[0,...A(n-1)]:[])=&gt;k%i||!(g=(m,a,x,y=m.findIndex(r=&gt;r.some(v=&gt;!v*~++x,x=-1)))=&gt;~y?a.some((v,j)=&gt;[0,1].some(r=&gt;v&lt;(o=n-j)&amp;o&lt;=(r?i-y:k/i-x)&amp;&amp;g(M=m.map(r=&gt;[...r]),b=[...a],b[(h=p=&gt;p--?h(p,M[y+r*p][x+!r*p]=o):j)(o)]++))):1)(A(i).map(_=&gt;A(k/i)),A(n))?f(n,i+1):M
</code></pre>
<p><a href="https://tio.run/##PVDBboJAEL37FeuhOiMLlpp4oA6EYw@eeqSkQUVclFmyGgKp5dfpoklP72Vm3nszU2ZNdt0bVd9c1od8GI4ELBW9yTPxAnp2GRc9L9cyJqaQo@RVep4XA7s@pkGSIoXnF3W/T6EgqGQmW9lR5R0VHz74kLdgKDTeVVc5NBROm0XvOK1sycrRavsuyp5daGRpC9bfT58Vq2w2oIndEmd6Q2Ai5XbBeancFmezArY2qMrqcTCxS5kU5Y5GlqVyl8CJagpr141OUMtt0jlmUadJ60xHJI1BiaAxdRy7SeAjxKDw4fdNYQw2BlHaQxGj4/gTx8dgOxy1ARYkVu@CxUb4rxatg/iZCLHXfNWX3LvoAqzkaWYEhcI8KI@UvZv@vBnFBazWiF6pFcN8/s@@eI7CEQ@c/A5/" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/203446/">203446</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




