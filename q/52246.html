<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::52246</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>106</td><td>Ruby</td><td>160828T050846Z</td><td><a href="https://codegolf.stackexchange.com/questions/52246/display-a-midi-track/91395#91395">Jordan</a></td></tr>
<tr d-ix="1"><td>nan</td><td>PHP</td><td>190207T235206Z</td><td><a href="https://codegolf.stackexchange.com/questions/52246/display-a-midi-track/179672#179672">640KB</a></td></tr>
<tr d-ix="2"><td>065</td><td>Japt</td><td>190213T192745Z</td><td><a href="https://codegolf.stackexchange.com/questions/52246/display-a-midi-track/179879#179879">Kamil Dr</a></td></tr>
<tr d-ix="3"><td>145</td><td>Python 2</td><td>160828T074421Z</td><td><a href="https://codegolf.stackexchange.com/questions/52246/display-a-midi-track/91404#91404">Sherlock</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Ruby, 106 bytes</h1>
<p>This was fun. I'm not sure why no one attempted it.</p>
<p>This function takes input as four array arguments and returns an array of strings, one for each line of the chart.</p>
<pre class="lang-ruby prettyprint-override"><code>-&gt;a,*r{q=(0..z=127).map{|i|&quot;%3d|&quot;%(z-i)+&quot; &quot;*1e4}
a.zip(*r){|n,v,o,f|q[z-n][o+4]=&quot;O=#-@+0*&quot;[v/16]*(f-o)}
q}
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=LY1LCsIwEIb3PcUQEdo0qWmtsZuIK7ceIGRRkUIF-9IK9nESN0X0UN7GCbr4Zn7-efyPV9Me7tNzp97tNePJ58Q3KaNNXytXBEGnwmjtBee06od8IPPlEYvb8dzzCRAaCjE6adDllUsbrx8KdmMly4Zad7wwuvRjo8hezfjWF5To2yKUhroZL73Rqcd_4qFqrxfYaS0FAxkhMbJiAHJtmKMjtGM7QhIEQ60NKAE3IUELrwB_W9tKabcQOw4TY35J0_TrXw" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>The code above assumes no more than 10,000 ticks; the ATO link lowers that to 100 to avoid the output being truncated. You can change <code>1e4</code> to any number you want if you run it locally but you'll run out of memory eventually. You may want to pipe the output through <code>less</code> so you can scroll horizontally.</p>
</div>
<div id="pu1" class="pu"><h1><a href="https://php.net/" rel="nofollow noreferrer">PHP</a>, 127 + 571 = 698 total score*</h1>
<p>Okay, I'm claiming the bonus. :) This will take a standard MIDI file and display the output.</p>
<p>I've broken up the score above into the main challenge (analyze note on/off and display as chart) and the bonus challenge (read input from standard MIDI) to make scores more comparable.</p>
<h2>Main: 170 bytes - 25% = 127</h2>
<p>For the main, the function <code>$d()</code> takes the required array and displays the ASCII output.  Included are all tests and output of test MIDI file below.</p>

<pre class="lang-php prettyprint-override"><code>$d=function($a){for($l=max($n=$a[0]);$l&gt;=min($n);){$r=' |';foreach($n as$c=&gt;$e)while($e==$l&amp;$a[2][$c]&lt;$a[3][$c])$r[++$a[2][$c]+1]='O=#-@+0*'[$a[1][$c]/16];echo$l--,$r,&quot;
&quot;;}}
</code></pre>
<p><a href="https://tio.run/##xVZRj9s2DH5ufoXQCru4l8MkWVZkuO72MmAPA9r3ICiCNG0OSJPAl2IDbvfbbyRFKnLurnsZMCCkJYqiqO@j6Ry3x8d3vxy3R7UZhsPwadgcD8Ppdv91aqpO6c/945fv@/Xp9rCf6lV1/@UwTPWu/7b6a6r3vV4tzLLq9O59/@0WHPZVV93rob9Sf1914LpZrbdgVas7ve7f60315/Z2t5nqTd/r3U@w2y0Xer18B6OaRpUeFtfXeeHaLvurD/2bm1@vzdurBdgt2X@2Ydlt1tuD3t3czPQwez153T08PHYTfdrcne5UrxYTRQI6mJkKDsSDNDOlwnw5S0sOljwug0QQa4wswUzBBhXBCpsVHCmbMAT6gqCHjUtYoNXiRB/TqX6eTvZ0MipfgwWs3qZ8aJ49ZAuFkCMDuNTgPgeX1qSMXI1Ph4nA5hpn7Uw1GBgzBM9Ii2CMkG4Lhrktb6dQORbPgjdLKvLlDYsTIHy6t0UMRqCMAgUWivNcIInDgUDQ6QmWiGPTMHvMIKLX8DPIGoRsXLITeqyILTymKRyDk7wRdBREuJQIsIUwltoksaZ@qhznlETCE8YiRTnJnbEAHdgd2GuXhBWC52kbQRpTSTUwaTLqEkZd1CRGQDixPBxnLhFUjfFqHFGh@MAINUaQfq6eqUJLLgR/4YLtNHZSwGdORm9h4de0/BSf//Kc0la8k3mvP/uPzvPjWE/WwvlsfOHIxxd@5uzfxCL/ol6buohRPt1FnGfukO4qRRDBQjJnabAQUGE5tBCnrdNKSw3Bnt2h342V5Y5RVresYgcRKazzJOxs5VgK4ngd@w8f2RZ7zns9B8BtZLX8dIyYVErDSHOro1eT58GmGiakEXX2D4x0Ewska95jUne0JvLlYoaBZwhg5GfL/TePg1zApAnj7sQke0N54aIJ5x86vtAaLtpDlpC@Xd7PLrrDWXLTFAGfOeydh/S9I@EcKU/HuRbCVHsGKV0uKcrYZBVFUfvB/KynhuSzwlXkyGIJs6L7mqzo00K2KApTtphzUvSlTgqdMXFLpd0SbCYrRA5zToo@moQsKcKXwE0qiqpdVkGUN1nRNF6o/DkhJoXCgtEX2Qxn9kgKRks2L1lEEQZHjL7AZmKx4M49Q@oP@SQCL0mNmUXzQz7jiNR/4dP/j3xi9iNFzIJadpOJ/KVV/DdzdQcjVan7ySv9eapPVTd5hX9L1cffP3767cMfMxl0k4fHfwA" rel="nofollow noreferrer" title="PHP – Try It Online">Try it online!</a></p>
<h2>Bonus: 761 bytes - 25% = 571</h2>
<p>Function <code>$m()</code> will load a standard MIDI file (either locally or by URL) and return an array of tracks, each containing an array in the specified note format for all of the MIDI file tracks.</p>
<pre class="lang-php prettyprint-override"><code>$m=function($f){$a=function($f){do$s=($s&lt;&lt;7)+(($c=unpack(C,fread($f,1))[1])&amp;127);while($c&amp;128);return$s;};$r=function($n){foreach($n as$e){if($e[4]==9&amp;&amp;$e[1]&gt;0)foreach($n as$y=&gt;$f)if($f[0]==$e[0]&amp;&amp;($f[4]==8||($f[4]==9&amp;&amp;$f[1]==0))){$o[0][]=$e[0];$o[1][]=$e[1];$o[2][]=$e[2];$o[3][]=$f[2];$n[$y][4]=0;break;}}return$o;};$m=fopen($f,r);while($b=fread($m,8)){$z=unpack(N2,$b)[2];if($b[3]==d){$k=unpack(n3,fread($m,$z))[3]/4;}else{$t=0;$n=[];$d=ftell($m)+$z;while(ftell($m)&lt;$d){$t+=$a($m);if(($e=unpack(C,fread($m,1))[1])==255){fread($m,1);if($w=$a($m))fread($m,$w);}else{if($e&gt;127)list(,$e,$h)=unpack('C*',fread($m,($y=(240&amp;$e)&gt;&gt;4)==12?1:2));else$h=unpack(C,fread($m,1))[1];if($y==9|$y==8)$n[]=[$e,$h,(int)round($t/$k),0,$y];}}if($n)$u[]=$r($n);}}fclose($m);return$u;};
</code></pre>
<p><a href="https://tio.run/##dVPbbtpAEH3PV6B0hD2xiS@QhmZZUinv7QdYFjJmLbvYu5ZtSgn42@ns1kBaqS@wZzyXM@fs1nl9XrzWeT2ChGc7mXaFkjYkeMxUY0PJq@SXDZJDEvkxMiiXvCooQSLDIzTcGp0sRqkiSXOKjpIWUr4EgUVmg@AcStznRSmoZRTGEaTxgk5Tc0JoIse5fnCCmFvf@afJV8d/sCKKBybuBZ9jJtJcQTmZuNC493f3rO/Z3R1U/HzjnBGhjzsQ3ihouQ3tYvGMjm0TtZ2sk3Rrv7kZUd5Qkhsg0iAcB@EzsoFrSmiOrBHdrpHQsp7RqrfO0qjzYWWBR7NvNIs5/zIe0ymIlz7@nXUgYTIjTEZikjaC/sZjDXXd/HS6HHWLjFpw7iPSWooSo/hPASMUDCgwKBxQaNDUoMwgGcEh1h19tiYmW5Jt2EnpnSqeqVpoqdzmuvuaD9JU7lzPfr9o9i10YY26r15hTYM431DC9pIgp@61FN5J1mnszVgvylYcoSMOdI8iYrXhWSfKktLQgfdh7jW0AN20c@jKaaiH6Zv0r3HVxTjOw6cnMuQWNvz2Qz3eKO1xIGO8WmrDy6LtbBeECzleRlhvD9Ztik222eHMJ09xuZzRuCB8DV5CRKZ7Qf5fZobGgcw86d85khsxj8ws1y5kh43aScrvPNii67tkFfmjiyTCTpvYmHfW91laqlYYNQb7dqw/6weQjPgIKtvKu65uXzxvv98/zqXqRPuYqspr6dWo0quKTeHVRSKVtxaiy9VPIVdqI1adWv1Qh0f6biE7/wY" rel="nofollow noreferrer" title="PHP – Try It Online">See it online!</a> <em>Obviously TIO is sandboxed as to not allow remote requests or local files, so you'll have to run this code locally to see it in action.  The first [tests][TIO-jrwa60tu] in the display function includes the array result from the <a href="https://www.8notes.com/school/midi/piano/beethoven_ode_to_joy.mid" rel="nofollow noreferrer">test MIDI file</a>.</em></p>
<h3>MIDI file load routine ungolfed:</h3>
<pre class="lang-php prettyprint-override"><code>$m=fopen($f,'r');                           // m = midi file handle
while($b=fread($m,8)){                      // read chunk header
    $z=unpack('N2',$b)[2];                  // z = current chunk size
    if($b[3]=='d'){                         // is a header chunk?
        $k=unpack('n3',fread($m,$z))[3]/4;  // k = ticks per quarter note (you can change the 4 to 8 or 16 to &quot;zoom in&quot; so each char represents eights or sixteenth notes)
    }else{                                  // is a track chunk?
        $t=0;                               // track/chunk time offset starts at 0
        $d=ftell($m)+$z;                    // d = end of chunk file pos
        while(ftell($m)&lt;$d){                // q = current file pos
            $t+=$a($m);                     // decode var length for event offset and add to current time
            if(($e=unpack('C',fread($m,1))[1])==255){ // is a META event 
                fread($m,1);                // read and discard meta event type
                if($w=$a($m))
                    fread($m,$w);
            }else{                          // is a MIDI event
                if($e&gt;127) {                // is a new event type
                    list(,$e,$h)=unpack('C*',  // if is a prog change (0x0c), event is 1 byte
                        fread($m,($y=(240&amp;$e)&gt;&gt;4)==12?1:2)); // otherwise read 2 bytes
                } else {                    // is a MIDI &quot;streaming&quot; event, same type as last
                    $h=unpack('C',fread($m,1))[1];
                }
                if($y==9|$y==8)             // if is a Note On or Note Off
                    $n[]=[$e,$h,(int)round($t/$k),0,$y];  // add note to output
            }
        }
        if($n)                              // if this track has notes,
            $u[]=$r($n);                    // add to array of output tracks ($u)
    }
}
fclose($m); // yes, could golf this out and rely on PHP GC to close it
</code></pre>
<p>A test MIDI file of &quot;Ode to Joy&quot; that can be used <a href="https://www.8notes.com/school/midi/piano/beethoven_ode_to_joy.mid" rel="nofollow noreferrer">downloaded here</a>. Example use:</p>
<pre class="lang-php prettyprint-override"><code>$d( $m( 'beethoven_ode_to_joy.mid' )[0] );      // display first track

$d( $m( 'https://www.8notes.com/school/midi/piano/beethoven_ode_to_joy.mid' )[0] );

foreach( $m( 'multi_track_song.mid' ) as $t ) {  // display all tracks
    $d( $t );
}
</code></pre>
<p><strong>&quot;Ode to Joy&quot; <a href="https://www.8notes.com/school/midi/piano/beethoven_ode_to_joy.mid" rel="nofollow noreferrer">MIDI file</a> output</strong></p>
<pre class="lang-php prettyprint-override"><code>67 |            0000++++                                                        00000000                                                                                                                        00000000
66 |
65 |        0000        ++++                                                0000        0000                                                              @@              @@                                0000        ++++
64 |++++++++                ++++                0000000000          00000000                0000                0000                        @@@@        @@  ----        @@  ----                ++++++++++++                ++++                0000
63 |
62 |                            ++++        0000          00++++++++                            ++++        0000    000000          @@@@----        ----            @@@@        ----    ----                                    ++++        0000    000000
61 |
60 |++++                            ++++0000                        0000                            ++++0000              ++00000000            ----            ----                ----            00000000                        ++++0000    ****      ++00000000
59 |                                                        ++++++++
58 |                                                                                                                                                                                                        00000000
57 |                                                                                                                                                                                ----                            ++++++++
56 |                                                                                                                                                                        --------
55 |++++++++++++++++++++++++00000000000000000000000000000000++++++++00000000000000000000000000000000000000000000000000000000        ----------------------------------------                --------                                        0000    ++++++++00000000
54 |                                                                                                                                                                                    ----
53 |                                                                                                                                                                                                                        ++++++++
52 |                                0000000000000000                                                0000000000000000                                                                                                                ++++0000                00000000
51 |
50 |
49 |
48 |++++++++++++++++                0000000000000000                0000000000000000                0000000000000000        ++++++++                                                                                                                        00000000
</code></pre>
<p><strong>Notes</strong></p>
<p>In MIDI format, Note On / Note Off events are atomic, meaning that you see a Note On event at a certain time for a given note (say E5), and it's implied that it will play until a Note Off event for another E5 note is seen.  As such, it's necessary to analyze the MIDI events and match up a given Note On to it's Note Off, which the code for that is <del>297</del> 184 bytes.  Further complicating this, it's fairly common in standard MIDI format to see a subsequent matching Note On with a velocity 0 representing the same thing as a Note Off.</p>
<p>This will now correctly read files that have zero-velocity Note On's instead of Note Off's, so should open most standard files.</p>
<p><strong>Caveats</strong></p>
<p>This is by no means a complete implementation of the MIDI format, however I have tested this with a fairly extensive collection of MIDI files and it reads them all nicely.</p>
<p>This submission has not been golfed to an extreme yet, so entirely likely this can be made smaller.  I do think it's very unlikely that the 25% score reduction bonus would offset the code needed to read a standard MIDI file.  As the (current) smallest submission that just does the ASCII display is <del>106</del> 65 bytes, it would require the MIDI file routines to be implemented in <del>25</del> 21 bytes to beat.  I'd challenge anyone to do that (without using a language built-in or module). :)</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://github.com/ETHproductions/japt" rel="nofollow noreferrer">Japt</a>, 65 bytes</h1>
<pre><code>®Æ"O=#-@+0*"gXzG
#&#128;Çs ú3 +'|ÃúUmg2 rÔ+5
£VhXÎVgXv)hXÎ+4Xo pXra
Vw
</code></pre>
<p><a href="https://ethproductions.github.io/japt/?v=1.4.6&amp;code=rsYiTz0jLUArMCoiZ1h6RwojgMdzIPozICsnfMP6VW1nMiBy1Cs1CqNWaFjOVmdYdiloWM4rNFhvIHBYcmEKVnc=&amp;input=W1s2MCwwLDIsMjBdCls2Miw0LDYsNDBdCls2NCw4LDEwLDYwXQpbNjUsMTIsMTQsODBdCls2NywxNiwxOCwxMDBdXQotUg==" rel="nofollow noreferrer">Try it online!</a></p>
<p>Takes input as a list of notes in the format <code>[pitch, start_tick, end_tick, velocity]</code>. If taking input as separate lists is mandatory (i.e. one list containing all the pitches, one containing all the velocities etc.), that can be accomplished at the cost of <a href="https://ethproductions.github.io/japt/?v=1.4.6&amp;code=1a7GIk89Iy1AKzAqImdYekcKI4DHcyD6MyArJ3zD+lVtZzIgctQrNQqjVmhYzlZnWHYpaFjOKzRYbyBwWHJhClZ3&amp;input=W1s2MCwgNjIsIDY0LCA2NSwgIDY3XQpbIDAsICA0LCAgOCwgMTIsICAxNl0KWyAyLCAgNiwgMTAsIDE0LCAgMThdClsyMCwgNDAsIDYwLCA4MCwgMTAwXV0KLVI=" rel="nofollow noreferrer">1 byte</a>.</p>
<p>Explanation:</p>
<pre><code>®Æ"O=#-@+0*"gXzG          #Gets the velocity character to use for each note
®                         # For each note in the input
 Æ                        # Replace the last item X with:
             XzG          #  Integer divide X by 16
  "O=#-@+0*"g             #  Get the character at that index in the string "O=#-@+0*"

#&#128;Çs ú3 +'|ÃúUmg2 rÔ+5    #Generate the blank chart
#&#128;Ç        Ã              # For each number X in the range [0...127]:
   s                      #  Turn X into a string
     ú3                   #  Right-pad with spaces until it is 3 characters long
        +'|               #  Add "|" to the end
            ú             # Right pad each of those with spaces to this length:
             Umg2         #  Get all the end_tick values
                  rÔ      #  Find the largest one
                    +5    #  Add 5

£VhXÎVgXv)hXÎ+4Xo pXra    #Put the notes into the chart
£                         # For each note:
     VgXv)                #  Get a line from the chart based on the note's pitch
          h               #  Overwrite part of that line:
           XÎ+4           #   Starting at index start_tick +4
               Xo         #   Overwrite characters with the velocity character
                  pXra    #   For the next end_tick - start_tick characters
 VhXÎ                     #  Put the modified line back into the chart

Vw                        #Print the chart
V                         # Get the chart
 w                        # Reverse it (so 127 is the first line)
                          # Implicitly print it
</code></pre>
</div>
<div id="pu3" class="pu"><h1>Python 2, <s>163</s> <s>160</s> <s>156</s> 145 bytes</h1>



<p>This is not the golfiest way to do it, but it was one of the simplest. If I could figure out how to replace parts of strings without turning them into lists, replacing, and turning them back into strings, that would be very helpful here. Golfing suggestions welcome.</p>

<p><strong>Edit:</strong> 18 bytes thanks to Leaky Nun. <a href="http://ideone.com/gkQa25" rel="nofollow">Try it on Ideone</a>!</p>

<pre class="lang-python prettyprint-override"><code>a=input();z=[" "*max(a[3])]*128
for n,v,b,e in zip(*a):z[n]=z[n][:b]+"O=#-@+0*"[v/16]*(e-b)+z[n][e:]
for i in range(128)[::-1]:print"%3d|"%i+z[i]
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/52246/">52246</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




