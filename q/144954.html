<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::144954</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>140</td><td>Julia</td><td>250616T192835Z</td><td><a href="https://codegolf.stackexchange.com/questions/144954/fold-up-a-matrix/282306#282306">Sort of </a></td></tr>
<tr d-ix="1"><td>328</td><td>Python3</td><td>250616T155322Z</td><td><a href="https://codegolf.stackexchange.com/questions/144954/fold-up-a-matrix/282301#282301">Ajax1234</a></td></tr>
<tr d-ix="2"><td>060</td><td>APL Dyalog</td><td>171015T213542Z</td><td><a href="https://codegolf.stackexchange.com/questions/144954/fold-up-a-matrix/145402#145402">Ad&#225;</a></td></tr>
<tr d-ix="3"><td>158</td><td>Python</td><td>171011T063532Z</td><td><a href="https://codegolf.stackexchange.com/questions/144954/fold-up-a-matrix/144956#144956">KSab</a></td></tr>
<tr d-ix="4"><td>059</td><td>Dyalog APL</td><td>171013T110239Z</td><td><a href="https://codegolf.stackexchange.com/questions/144954/fold-up-a-matrix/145238#145238">Uriel</a></td></tr>
<tr d-ix="5"><td>021</td><td>Jelly</td><td>171015T171646Z</td><td><a href="https://codegolf.stackexchange.com/questions/144954/fold-up-a-matrix/145385#145385">Dennis</a></td></tr>
<tr d-ix="6"><td>113</td><td>JavaScript</td><td>171011T065815Z</td><td><a href="https://codegolf.stackexchange.com/questions/144954/fold-up-a-matrix/144957#144957">tsh</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://julialang.org" rel="nofollow noreferrer">Julia</a>, 140 bytes</h1>
<pre><code>!X=begin
n=size(X,1)
c=n÷2+1
for j in 1:4
X=rotr90(X)
for i in 1:c-1
b=i+1:n-i
X[i+1,b].+=X[i,b]
X[i,b].=-1
end
end
filter(a-&gt;a&gt;=0,X[:])end
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=NY9BDoJADEX3PUXdQQDDCKJCauLOI0xCWICCqSGjGXHjGbyBGzeewQN4Cm9jBV389KX_p_m9Pfbnlsv7_XHummD-vo40VfWODRg68aV2tK9c2JB5PSeeguZgcY9sUKUxaLKHzi5CR7u9wYOxCRRUxJ5KTcCgcyG_KsYeCQrAMMYksdpsezXcdrV1ymBZLin0dZ4Wrux_ndYrJMwVTjASqQzCHiIMM4gFpphglMEMY5zhAuNvIBEUpwA4WjZda5zRyh3u_X_9AA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Lots of features of Julia made this an attractive problem to try. Matrix rotation is built in (<code>rotr90</code>), so we can just repeat one accumulation step four times, once for each side of the matrix. The <code>X[:]</code> on the last line dumps <code>X</code> as a vector in column major order, and <code>filter</code> makes for a compact way to drop off-diagonal elements.</p>
<p>As a fun easter egg, mutating functions in Julia are usually denoted by adding a <code>!</code> to the end of the function name (e.g. <code>fill</code> returns a new array but <code>fill!</code> modifies an existing one in-place). Overloading unary operators is a standard golf trick in Julia, so overloading <code>!</code> for this mutating function made me happy.</p>
</div>
<div id="pu1" class="pu"><h1>Python3, 328 bytes</h1>
<pre class="lang-py prettyprint-override"><code>def f(b):
 B,L=[*zip(*b)],len(b)
 for x in range(L):
  for y in range(L):
   if x==y or x==L-y-1:b[x][y]+=sum(b[x][:y])*(y&lt;=L//2)+sum(b[x][y+1:])*(y&gt;=L//2)+sum(B[y][:x])*(x&lt;=L//2)+sum(B[y][x+1:])*(x&gt;=L//2)
 return[j for i,a in enumerate(zip(*b))for j in[a[i-L*(i&gt;=L//2)],a[L-1-i-L*(i&gt;=L//2)]][:[2,1][i==L//2]][::[1,-1][i&gt;L//2]]]
</code></pre>
<p><a href="https://tio.run/##bZLNbqswEIXX9VOMsqlNoI0xSQmqu@ga9QVcVBHVtK4SgwyR4L587tig/qkL4/E3c@YMmG4a3lsr8s5dLq@6gYYeWEHgMS6liv6ZjkYHVsVHbZETaFoHIxgLrrZvmpa@NMDpNwTTwCjlBF4hZZlMCS8OaqzUVK1lfz7RcCimikV0upfl7W3K1p98WvMiZB6@ZR5Rq4rR8/H@Nx8XxbgoCDg9nJ1VH2FAE9d@RG3PJ@3qQdPl3ZhPfmBK1cokZUTNoq/iWpUJT35C9FdpzCtlZCAeFIrHiUcPM6kuPQcJq9WKcEhB4OJkE3YBG5LhvoUdCHIHGdzBHjLM7jBCTryqT3/IM8RbfM6NOO5bL0PRHnKMdsSLczxtZrn4lAvwHjkKBMmDG0Z43gRHgcu3yEiK0TY0w@lCbrbD@mW2PJhmJPSCNLB9sCP@txnal0Nbu1fa4@1fzV8elIpOdUeNHWIwN313NANlrJrvw99GY46DdvSptTqGfqm4frbXWEVI51BJG/rVmzPG/sDp31ggvvwH" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu2" class="pu"><h1><a href="https://www.dyalog.com/" rel="nofollow noreferrer">APL (Dyalog)</a>, 60 bytes*</h1>



<p>In collaboration with my colleague <a href="http://dyalog.com/meet-team-dyalog.htm#Marshall" rel="nofollow noreferrer">Marshall</a>.</p>

<p>Anonymous prefix lambda. Takes matrix as argument and returns vector. Assumes <code>⎕IO</code> (<strong>I</strong>ndex <strong>O</strong>rigin) to be zero, which is default on many systems.</p>

<pre class="lang-apl prettyprint-override"><code>{(,⍉{+/,(s×-×⍺)↓⍵×i∊¨⍨s←⌊⊃r÷2}⌺r⊢⍵)/⍨,(⊢∨⌽)=/¨i←⍳r←⍴⍵}
</code></pre>

<p><a href="https://tio.run/##XU2xSsRAEO39iu2ywYRskttLUvgBVn5DODkJBJUECzmuEsIZsiKKpLcKtirCgc3lT@ZH4puNhVjMzJs3773Jr0v//DYvry78VZnXdbGa6OHl9IyaRzWt0TfSI3O/OQ48WY@9P/Zk9i41z2Q@x76gXXsYyAw1lNS11N5V41e0pW5fUfsKjRvg6kledgN13@5JcBgKVpv3yo4PqLZTdXPJz8i8OcKRoBxqnhy55gjXnoUWGupQRCJGhULZGWMuMLVYAifAicjQFfaE@aP/3gVv6HNKiKmtR6FSoKV1psxYbyIS653TU6hjdP4zI2V/xajM8hGQtkmM@Tb/Yr36zdZ/siLLZT8" rel="nofollow noreferrer" title="APL (Dyalog Classic) – Try It Online">Try it online!</a></p>

<p><code>{</code>…<code>}</code> anonymous lambda; <code>⍵</code> is right argument (as rightmost letter of the Greek alphabet):</p>

<p> <code>⍴⍵</code> shape of the argument (list of two identical elements)</p>

<p> <code>r←</code> store as <code>r</code> (as in <strong>r</strong>ho)</p>

<p> <code>⍳</code> all <strong>ɩ</strong>ndices of an array of that size, i.e. <code>(0 0)</code>,<code>(0 1)</code>…</p>

<p> <code>i←</code> store in <code>i</code> (as in <strong>i</strong>ota)</p>

<p> <code>=/¨</code> Boolean where the coordinates are equal (i.e. the diagonal)</p>

<p> <code>(</code>…<code>)</code> apply this anonymous tacit prefix function:</p>

<p>  <code>⌽</code> reverse the argument</p>

<p>  <code>⊢∨</code> OR that with the unmodified argument</p>

<p> <code>,</code> ravel (straighten into simple list)</p>

<p> We now have a Boolean mask for the diagonals.</p>

<p> <code>(</code>…<code>)/⍨</code> use that to filter the following:</p>

<p>  <code>⊢⍵</code> yield (to separate from <code>r</code>) the argument</p>

<p>  <code>{</code>…<code>}⌺r</code> call the following anonymous infix lambda on each element, with the <code>r</code>-neighbourhood (padded with zeros as needed) as right argument (<code>⍵</code>), and a two element list of number padded rows,columns (negative for bottom/right, zero for none) as left argument (<code>⍺</code>):</p>

<p>   <code>r÷2</code> divide <code>r</code> with two</p>

<p>   <code>⊃</code> pick the first element (they are identical)</p>

<p>   <code>⌊</code> floor it</p>

<p>   <code>s←</code> store as <code>s</code> (for <strong>s</strong>hape)</p>

<p>   <code>i∊⍨¨</code> for each element of <code>i</code>, Boolean if <code>s</code> is a member thereof</p>

<p>   <code>⍵×</code> multiply the neighbourhood therewith</p>

<p>   <code>(</code>…<code>)↓</code> drop the following number of rows and columns (negative for bottom/right):</p>

<p>    <code>×⍺</code> signum of the left argument (i.e. the direction of paddings)</p>

<p>    <code>-</code> negate</p>

<p>    <code>s×</code> multiply <code>s</code> therewith</p>

<p>   <code>,</code> ravel (straighten into list)</p>

<p>   <code>+/</code> sum (plus reduction)</p>

<p>Now we have full matrix of sums, but we need to filter all the values read columnwise.</p>

<p>  <code>⍉</code> transpose</p>

<p>  <code>,</code> ravel (straighten into simple list)</p>

<hr>

<p>* By counting <code>⌺</code> as <code>⎕U233A </code>. <a href="https://tio.run/##SyzI0U2pTMzJT9dNzkksLs5M/v//Ud/UR20THnUuUq/W0HnU21mtra@jUXx4uu7h6Y96d2k@apv8qHfr4emZjzq6Dq141LuiGKS6p@tRV3PR4e1GtY96dhU96loEVKOpD5TV0QBxOlY86tmraat/aEUmSHXv5iIwtQWoqlb9/38A" rel="nofollow noreferrer" title="APL (Dyalog Classic) – Try It Online">Try it online!</a></p>
</div>
<div id="pu3" class="pu"><h1>Python, <strike>159</strike> 158 bytes</h1>

<pre class="lang-py prettyprint-override"><code>def f(m):l=len(m)-1;r=range(1,l);return m[0][::l]+f([[sum(m[x][1%y*y:(y&gt;l-2)-~y])+m[0][y]*(x&lt;2)+m[l][y]*(x&gt;l-2)for y in r]for x in r])+m[l][::l]if l else m[0]
</code></pre>

<p><a href="https://tio.run/##XY/NasMwEITveoq9FKREBv/Frp24LyJ0KFRqDJISFAesS1/dkVaGlsIeZkffzqB7WK4312zbl9KgqWWjmYxyURTV2U/@030rWnHDzl4tT@/AilKKcTTyqKkQj6elVqxSVG/hEEYaPkxRs@InSHZEMsgDXS912sy@IaJvHgLMDrxMcs1yx1L8rMGAMg@FjRsQCxMIIioOJYeWQx@F5ETUHBoONXpdMvJ2QqL/JToOQ3xJRs5o8OQkiSR3P7uFpu8z8qcoZmS022NavBr23Aa3CL3HSUaLzT3OkIwcMGB5@a9oewE" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu4" class="pu"><h1><a href="https://www.dyalog.com/" rel="nofollow noreferrer">Dyalog APL</a>, <s>101</s> <s>99</s> <s>64</s> <s>62</s> 59 bytes</h1>

<p><sub><a href="https://chat.stackexchange.com/transcript/message/40562622#40562622"><em>3 bytes saved by @Adám</em></a></sub></p>



<pre class="lang-apl prettyprint-override"><code>{+/∘,¨⍵∘×¨d∘=¨k[⍋k←↑∪/,d←∘.((+/1x×××⌊/∘|),)⍨(⍳x)-⌈.5×x←≢⍵]}
</code></pre>

<p><a href="https://tio.run/##dY6xTsMwEIb3PIW32mraOEldJ0OeBDFUisrQSjAGAQtDFUItwZTOnSJW4AWSN7kXCf85DB1A1t3/@3z3nTd3@0V5v9nf3ozjlg5vD/OI6lPYd@S@YYa270po0Xe7K3KvO7TQ4Z3qjygs2denpZTzKK6Glg8dG55/VKEi10lyn5Va0LFemqGtuP/lDPD10zhKSc0zNWcVbpUwwpD7ikUiUkQstNcUuoIasYa38FbkyBp3y/VgVhTFLPgXteIb8gSNocYjNCKDW3tQxpW/UFZYj5p2ZxhOkfkXk9P@Jyki9/UEzngwe36bVnO//l1lLliJr@Ui@AE" rel="nofollow noreferrer">Try it online!</a></p>

<p>Using Dennis' <a href="https://codegolf.stackexchange.com/a/145385/65326">awesome algorithm</a>.</p>
</div>
<div id="pu5" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, <s>25</s> <s>23</s> 21 bytes</h1>

<pre><code>AṂ×ṠṚ
LHŒRṗ2Ç€ḅLĠịFS€
</code></pre>

<p><a href="https://tio.run/##VY89DsIwDIX3nCIHyNCfJA0jCzB0gjHKyIJ6AdZKiIGNpRJTD8ABiBgLBwkXCa7TRO1ixZ8dv/dOx6Y5e792th06Z3tnH6Tefe97Z7tiuP7ap3td6k/v3rfNATqPbOu9JlTrnNGC0RJrbhihVGexh5oFxLEXjEqgAVWMAoW6gkf6KBGNuwbYQoCPEPcENgvNHHsRDqZrcFohkgGF6woH2UygRM5xJJJDFR0K3FApTfBZYg0SU4ACkYiqY@r5j2S6SlFSZBXd8yQu4rqcYhli/g" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>

<h3>Alternate version, 19 bytes</h3>

<pre><code>AṂ×ṠṚ
LHŒRṗ2Ç€ĠịFS€
</code></pre>

<p>This didn't use to work because <code>Ġ</code> behaved improperly for nested arrays. The only difference is that the pairs <strong>[q, p]</strong> mentioned in <em>How it works</em> are sorted lexicographically instead of mapping them to <strong>p + nq</strong> before sorting.</p>

<p><a href="https://tio.run/##VY8tEsIwEIV9TpEDRPQnSYPEAAIFMhOJYXoBbA0Ch@kMqgfgAhlk4SDhImG7aXao2cl@u9n33vnUtpcY18F3Yx/8EPyD7Xef@yH4vhqv3@75HsLrtjnCK2K/jdEybm0peCV4jbV0gnFui9xDLRKS2CvBNdCEGsGBQl3Bgz5qRNOuA7YQkBPEPYXNQrPEXqWDdA1OG0Q6oXTd4KD4E6iRSxwpcmiyQ4UbhtIknzXWJDEHqBCprDql/v9BphuKQpFNdi9JXOV1PcdyzP0A" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>

<h3>Background</h3>

<p>We start by replacing its elements with coordinates, increasing leftwards and downwards and placing <strong>(0, 0)</strong> in the center of the matrix.</p>

<p>For a 7x7 matrix <strong>M</strong>, we get the following coordinates.</p>

<pre><code>(-3,-3) (-3,-2) (-3,-1) (-3, 0) (-3, 1) (-3, 2) (-3, 3)
(-2,-3) (-2,-2) (-2,-1) (-2, 0) (-2, 1) (-2, 2) (-2, 3)
(-1,-3) (-1,-2) (-1,-1) (-1, 0) (-1, 1) (-1, 2) (-1, 3)
( 0,-3) ( 0,-2) ( 0,-1) ( 0, 0) ( 0, 1) ( 0, 2) ( 0, 3)
( 1,-3) ( 1,-2) ( 1,-1) ( 1, 0) ( 1, 1) ( 1, 2) ( 1, 3)
( 2,-3) ( 2,-2) ( 2,-1) ( 2, 0) ( 2, 1) ( 2, 2) ( 2, 3)
( 3,-3) ( 3,-2) ( 3,-1) ( 3, 0) ( 3, 1) ( 3, 2) ( 3, 3)
</code></pre>

<p>We now compute the minimum absolute value of each coordinate pair and multiply the signs of both coordinate by it, mapping <strong>(i, j)</strong> to <strong>(sign(i)m, sign(j)m)</strong>, where <strong>m = min(|i|, |j|)</strong>.</p>

<pre><code>(-3,-3) (-2,-2) (-1,-1) ( 0, 0) (-1, 1) (-2, 2) (-3, 3)
(-2,-2) (-2,-2) (-1,-1) ( 0, 0) (-1, 1) (-2, 2) (-2, 2)
(-1,-1) (-1,-1) (-1,-1) ( 0, 0) (-1, 1) (-1, 1) (-1, 1)
( 0, 0) ( 0, 0) ( 0, 0) ( 0, 0) ( 0, 0) ( 0, 0) ( 0, 0)
( 1,-1) ( 1,-1) ( 1,-1) ( 0, 0) ( 1, 1) ( 1, 1) ( 1, 1)
( 2,-2) ( 2,-2) ( 1,-1) ( 0, 0) ( 1, 1) ( 2, 2) ( 2, 2)
( 3,-3) ( 2,-2) ( 1,-1) ( 0, 0) ( 1, 1) ( 2, 2) ( 3, 3)
</code></pre>

<p>Matrix elements that correspond to the same pair have to be summed. To determine the order of the sums, we map each pair <strong>(p, q)</strong> to <strong>p + nq</strong>, where <strong>n</strong> is the number of rows/columns of <strong>M</strong>.</p>

<pre><code>-24 -16  -8   0   6  12  18
-16 -16  -8   0   6  12  12
 -8  -8  -8   0   6   6   6
  0   0   0   0   0   0   0
 -6  -6  -6   0   8   8   8
-12 -12  -6   0   8  16  16
-18 -12  -6   0   8  16  24
</code></pre>

<p>The order of sums corresponds to the order of integers the correspond to its summands.</p>

<h3>How it works</h3>

<pre><code>LHŒRṗ2Ç€ḅLĠịFS€  Main link. Argument: M (matrix)

L                Compute n, the length (number of rows) of M.
 H               Halve it.
  ŒR             Symmetric range; map t to [-int(t), ..., 0, int(t)].
    ṗ2           Compute the second Cartesian power, yielding all pairs [i, j]
                 with -t ≤ i, j ≤ t.
      Ç€         Map the helper link over the resulting array of pairs.
         L       Yield n.
        ḅ        Unbase; map each pair [q, p] to (p + nq).
          Ġ      Group the indices of the resulting array of n² integers by their
                 corresponding values, ordering the groups by the values.
            F    Flatten M.
           ị     Index into the serialized matrix.
             S€  Compute the sum of each group.


AṂ×ṠṚ            Helper link. Argument: [i, j] (index pair)

A                Absolute value; yield [|i|, |j|].
 Ṃ               Minimum; yield m := min(|i|, |j|).
   Ṡ             Sign; yield [sign(i), sign(j)].
  ×              Multiply; yield [p, q] := [sign(i)m, sign(j)m].
    Ṛ            Reverse; yield [q, p].
</code></pre>
</div>
<div id="pu6" class="pu"><h1>JavaScript, 113 bytes</h1>

<pre><code>s=&gt;(l=s.length-1,a=[],s.map((v,y)=&gt;v.map((n,x)=&gt;a[q=2*[x,y,l-y].sort((u,v)=&gt;u-v)[1]+(y&gt;l/2),q-=q&gt;l]=~~a[q]+n)),a)
</code></pre>

<p><div class="snippet" data-lang="js" data-hide="true" data-console="true" data-babel="false">
<div class="snippet-code snippet-currently-hidden">
<pre class="snippet-code-js lang-js prettyprint-override"><code>f=

s=&gt;(l=s.length-1,a=[],s.map((v,y)=&gt;v.map((n,x)=&gt;a[q=2*[x,y,l-y].sort((u,v)=&gt;u-v)[1]+(y&gt;l/2),q-=q&gt;l]=~~a[q]+n)),a)</code></pre>
<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;p&gt;&lt;textarea id="i" style="width: 400px; height: 120px"&gt;1 2 3 2 1
0 3 2 3 0
4 2 5 6 3
7 4 7 9 4
0 6 7 2 5&lt;/textarea&gt;&lt;/p&gt;
&lt;p&gt;&lt;button onclick="o.value=f(i.value.trim().split`\n`.map(l=&gt;l.trim().split(/\s+/).map(v =&gt; parseInt(v,10)))).join` `"&gt;Run&lt;/button&gt;&lt;/p&gt;
&lt;p&gt;&lt;output id="o"&gt;&lt;/output&gt;&lt;/p&gt;</code></pre>
</div>
</div>
</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/144954/">144954</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




