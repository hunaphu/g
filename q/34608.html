<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::34608</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>348</td><td>C GCC</td><td>240615T040436Z</td><td><a href="https://codegolf.stackexchange.com/questions/34608/recover-a-bzip2-file/273667#273667">EasyasPi</a></td></tr>
<tr d-ix="1"><td>nan</td><td>Python 3</td><td>140727T185916Z</td><td><a href="https://codegolf.stackexchange.com/questions/34608/recover-a-bzip2-file/35231#35231">Ray</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>C (GCC, 32-bit Linux <code>-fno-signed-char -fno-common</code>*), <s>237</s> 227(<s>353</s> 348 chars)</h1>
<pre class="lang-c prettyprint-override"><code>c,p,o;char*r,*t,d,s,w[];i(){sprintf(w+4,&quot;%i&quot;,o++);while(r&lt;t){p=creat(w,4);write(p,w,4);while(r&lt;t){s=0;while(s++&lt;8){d+=d;if(r&lt;t){d+=*r++;c--;}}write(p,&amp;d,1);}}}main(){read(p,w,4);while(read(p,&amp;d,1)&gt;0){r=realloc(r,c+8);s=0;while(s++&lt;8){r[c++]=d&gt;&gt;7;d+=d;}}while(t=memmem(r+48,c-48,&quot;\0\0\1\1\0\0\0\1\0\1\0\0\0\0\0\1\0\1\0\1\1\0\0\1\0\0\1\0\0\1\1\0\0\1\0\1\0\0\1\1\0\1\0\1\1\0\0\1&quot;,48))i();t=r+c;i();}
</code></pre>
<p>For display, C escapes are used in the string, it actually uses raw 0x00/0x01 bytes which SE hates.</p>
<p>Base64 BZIP2 data (compressed with <a href="https://github.com/logological/lbzip2/releases/tag/v2.5" rel="nofollow noreferrer"><code>lbzip2 2.5</code></a>)</p>
<pre><code>QlpoOTFBWSZTWfB/t1oAAGbbgGAAE35kzwAKL2fciiAA6EEqfqRE2kBoAAAA0IIA0aAAABFFhhkiiKqCKiiMgqRzpMg2PLIz2z0WCPu4OfaSWiprTtRijx6pj5V2HeKRhPI1SO8CmCArVNnU2KBBGoZ7uDiE5rRc6bhAlG0XM1hCwGEkSEVEbhQgheGNdFWvmHAYn2b2WfdpCl/g+CvA1hPHwJwDhyvF4L22UqwToyiBJJW+adTQ4N4CGH43/qViAsFnp5aiwrbg17yvtsynydwtJGA6wGAZfxdyRThQkPB/t1o=
</code></pre>
<p><a href="https://tio.run/##pVppj6tKkv3OryhpPlq3vZTtsqXukTLZDHhLMHj5MsJbQiUuwHj/8z0nqNs99aa7Z6SZp7ouF4bMyIgTJ07E8zaukr/@29v@cMrftq@06Lwd0@ygbePq0O@@/dq//fnPb/9hzqy3f3@r4lORHf60fXU0kRX5bGHxZbBZLI@D7JUKfhknK8mYEDOhcqHLebN5zG3m3XDxx3@GwSf6Wrc/3UKu165caEy0NtPJP1z/vsynkaPzyaefq8e0PAS2ra/Nuzm1FwsjYMcJG5ZyrLNmxV6O0RbaqJLzgm2EYcq5cizpWE0ml3cxDh2rEnZCHw2EkYrRgW0VfzpGT46GJatynjF6IhcjZerdhN2uGls7Rl/aUoxzOXXktMVLMarESGdxwq5MjJdsw9nlyboRW3XEyGaHAeuZ/CVHHzrH8lUqy5Zj6J5@1q6mfs/1pxiZcrY3zRYeWcupzlpy9BS2z3aOY/U8VgVi1JGzJ10/KP2Ssu7dwI0OT7FkW1hPOZpocpLzk6kPFJdy1pfjlrR3bOjwh2PgwlRYbSWnAftQPBd2i3VNfmbTKDRvEdsmrJISe08SEW1ghVaYXOV6G07oCw@PnMToEfBlxWC6kLMeixUfhDK6sInJU6VXUSCjq5zuCmHBqA0WhBdSdo9EoLUdYyJnLcWvwkYgUvF5YzO43ZGnB1uLUZnrfTjXkROfbUoR7WHLwTFc0@ybTnnIxbjvGPj0LpcDjT3Y/MUmnF0DNuDs9sGmd7lCiEI5K9g@ZS9BznuwzR1oWJfs9nAZ7LmEHMF@yjFAgdMwOfeZdrSENfTZPpbjjsWj1DEyNk1Z74nomAygUIiNY71LW4jxjCJ7a6jQWqVs3@JtXT@4IQcgTPYIpVYO4IooDFehnANykbDgQuymy/FETkL2xA4tLM5ZpXjiGB058hyjdAw/5IcdgwuqlL3D0S47aCF76fouzK3jXc5fwpjp/GDyLpb4YpOILWFxweYnx/AC1lUc4I3ZIWRtOcoBKmH32A4g37ANHtKknQmrObtguR220PlaymVMntQZ7sVdWLFga12H00z2DEJ3CfR1eT/h82HtFIc/c14BWJocl6EOS/vCANw/2XzpGENhwEcbdhxI4AF4KVUeXOFcJFsjZcMna4f86LPj3de/3tkkELZDLtC6ciQcC/Hw2BEw@ACk@vCPyRHaq88OjyD1kJBXMfpi8yeCOWMHnAthXIsxtscWSth9x/3gTLs4/GLyhsM70oYrlJzTVqytU4yAEM42Hru6lOQZm5nCVpQFNzaXcpqFJlJg2fvtip3mAK0jIafIZGTsAFDOKVkfglAV8l2L7A9YbJbuOGFzD97jlPmuY3BGCIbf3h2jK7GLNniyHhA@85FeLZBFAHghaAxhBxxuMxAWCAKJhVPFrsiOjXXuPRde/Iry@@dNBl@3/oAxXedPU8t0FvJm82PI7jwa/IFJ2Q@a/Bfs@fOyW2q5lE4rnppFz25PC3G/L9iJJfkzXse50RejGwAuRkOiycOTDbu8acJ5RIKw2UJQryW79HO9gz@1HRHMU87vcuZThtzrVGvJ@UfIN8IO@RBJAb7MQDEegnlha0ULnvH3ksUPEB6SdATHW0zb4t4HVgU68SpBpbnegB/hUzGaiRHQ1MNzTE77BY/OjmGFsvwAG6bIOjYDHSjHpZVjYWsFo@OAU9guxsYeAumy4459CCNi@ye4S4wADOBU2LDsauZ6LwdmYPN7u46ODRYx9WHIcw25zXY1CSPBBzAoFiMcfcO2OaqI/WQdT2ZYOaE8BagD9oJpL2R5Sax@ydgyqVkVmNSeoX5BvhAz7vEkik/GzntyTIo08z2@4mAxOY7xLwAfwys3nBU71LVrXzhGQhbYUjnaR27AEZ7jXinBPnD4L/zLwFAAu7JWOPt1gEOJReklQa8boFbmehNcrOogWETHPbgAjKwJ44FLQ8AVHluK0RocLucBpQ1yGtj2yalgtwGuZSHfCuMg7KGw@oqjTNT19Ii603TkXJvl@rBU1tKRs5ieLSLkgM4GjvEFfsE@@zrMfv3aLFEFQHfvcnRK9QNgBnckcAOugrE0L89vk5pk4d4nFWjbk2MhJ9@e7gNIfQIB6smhz3oPdoB/UAAOKRv0a05Gxp5QPxQvNNCsAs0CAD38CfeCk1IgKpfEsyDONiCMChiwXsCQ/tgVSIGygKGc7XTWBeZgAZZzNAPP90JEED4/ULSQIRdyakoRRazgD8TNEQsfV@2NpUcngvKh5bhN0A7khJwBS13@XmogBlRWxdt1QICzTsqaAWuYBJymAM8cOdsGnnkG5ClWAHgXWEBEwX0dkSw@hA0@0tnD1PgA2MCBEtqkAdurUL8ty5prcYCX4h9ty4wUFXf4qTn9dhfOc3UsYgHKd7CtnOmO5lKelTCzzvUncn6KOoZMBpMCUPe6Gk8QDL7DoZA5yGgHmbZDsQLCoQQiPsYO8N5LA3JM/qCSPEOBgRQKgFSwOuoA7HUJZNgYcobT22Waq6tHoUthPMw4u0RHF4Kq4hpqMA4asQNSA04besBMjDWd3KtMOXEM0O8MeA5wnFZtJiFXhe6q@fotXndl/97uGsdIG/2f1Os/p1/tp3p1083UThdmp@g5P56Z1sZ3cC5hNHIDJHcZQmtsiLfwAv0KY9ekzwbwzJMEGogBCSknigMWD8XfhT2Qcw8a6Jt16dEjPB0HrI8c@SRVSjV6WMsOQKEINIgOm3KJKiTRjCxJLSm8QkXgITAVwnOVcyRvwJrA1zt0bFjrWBOZ8g5jalEDqampVI9Ru0G4AYODkWswhmNbKCgL@@YGcIPUjtg5Jp5H7JFpAdZEgQQ9F3RSROiKiquBVwXCZMdsWJ8OwDLF@JXXQvZJYnRD8CJYZHyMPEF2P7FXKCeZ41VY0cf@8JOpvzTsCOaEU@8lB/BbdT7iCqjt4fHlk6SQK7yHk1sgcsi@M84OSyr8gjSOPH1ZyUkPahHHrEvdKxSfVzlDhRLy1CJ0YSPKJhgGvE@hIkucBL72TLMn/ZDq3xAlEp8BdSBP1vRwTOAR1YcyDFEHbdyEnMPOE@Fz0uJQDx0QELkNfccghD9wJNK4W53vC/adY8jWBizV@gU7DqHcbxYYFlZA9SOMLcQpqdnQ5D3chsfh81f92i1wJ/K4D3Z03K6QS5AsDux42g05I0pvDHqAiINUrlCmKggfSs@LS6SWEeMij6IabTq6Ibx3jDPCrxOFkFCoGyUNlo9OcvIUixQMCbw2qLajhOJuKpA1i0/E@AScw2Xpb2GLAm2CFud@XQYQMOCz0qDUiHENwCr3hYdbKwoVuA/AkT@FLYJmylNMR0JdyaCI0XGVgX78cAx0CiA5yAMQOniuV8oIW8NIWJLK@RJpBWKsU7FZJyAq3CVygitEKEipUaC9k1Of3XI577GacDWvZtyap1/Yfkf1gsQtHBFRDmKVBOQK0m/rULfIWcXRKfYQS8XRNi4BoAokiuPoGscp36HCN0hhUHud5hQ71saitX4CwirUpicxqyPGKWl/BEJCXhCbwvHgxEsgM6XVGb3ReVzffBCjSa1v2453BYVAJpv6g8o6fvdqBKPCR0Ea4Oa8dgnanRjwc5EDGjxdn36eMFh2AdAA9WctdOSM/Y1uqVqGfE9p8CQjCXuxnnjNwUNE6hS2s6VsBVrKc8todxkzTUO5nslyo9l873Opn7t/VLg/FOqPxv/nZe3n9UUUMPlptmJ3soi/VJLIE59ww1etO3XZtYIAXD7YBPAOOSDRhz5icAPiAUmvHe@OVZk6mghiKvqsaRIw0e/0SAU21ryJZsyjKQLgAxUynzi1cP0gzXgM6zRAMkAyaaTyDrXMLU29iwxac2XqkEMAxBFUtuYfdwMARLPTqa9v0PCBpUwwyc9hQey4hVbz3BTsJwzqeCFEmFydvpVtzPo5upM9undIyk82Leg2E2vCMDQ/RFnEsrcpFc9bqPGDYhC5q4LNQMIgWwRMKVLjO9oD2g6/1wCbzLDyzrFgN3SegmEuFJ9fZ9pFWF8BX4Ec4c2GJ7y2hESNwfaOgaZYglhJtawLdrbQi27RbILI0HbtQ/I1HCyxfkmJu98QQOEu7XtegNozUWKxrkkWgMJRv2pZG0MshGjRU/b0@dxJrAVChVYTaX7CcSV0MEKEPhSek5pjNdf8Bs8VdUcYiNGSqksjIOU9Ix9RVkMzIYaoU@AFdIwI2JM6RZJXcBmUToH8bWvUxVHnCrtfpC8gmBkan52QqwPNCqouRbfZR9d3cFCZ0eq6XQjKlMQ5SUzklVnm@TVhR23DDgiN98eJAcTLepB/c2tO3HpBY4N1ar29zzmghXOiMqfgwi4ObHYfwmtqqp4ZTEyi1gelpCRqhfbsAaTwFFTchNRy/27go4oNGXE@oiRN2h@C3WQt6rbR6mvUMeMw8PiADO9S/m@I9znoSDruF5sIw3VrZkUXW5pmsyVnIU2rPIlu6ANQQr@DoveUmo1lbHYArvpydKOsa/YIgtg7whIkN9DWD7@HCGj4oERlas2vYDpUIgR89AAWvkcG2jettn7ODACzWOVpldKgqyNHlJIXNseaG7BqPf1LfswM/j4yaGt/mxl0CGK2SRkKuaH@@9hA/xdjA49dIG4pTQBV7TetokuhJsJiS/hT2hZbId8CeptZvgsa6N1piILzFLWKpR7sx9zgAw4FBe2V50Y3JBJCz/82OkD0n6gYEAQXNq3HC5cEncDfVezRyD8fTJf9P4pY7f@nYn@IWDdn2sLP1XNa/JFWIfrYb1rty9@0KohWA9TkEZVEqtJI@W35rWD3NFOcaHVtuzvGnfIOnUIjrJm1lr7fzEpafYeHGy00GnNQGuQU8KtontlGewTKkFOSp22N2pMJ1se14ze3mlTHU2rzj2iMly05bX9LWJobUJ@DJuopR0gy73sUWwtrkuSwDFtQz1SQBJFAI7yPiq@Dw1IqpTuSEQ@scQFSPNJYQCu0aL8eOgPyOek48IcUmt1gOwBhiRKOck9HR/ggAUA3Qe4eKkajFJpBQFBSx4xV@25Nr7g@yS10wEjRLhRUxDRwK5jsTkR55MJ7J40yCWSUQMh26raxDSe8vmc12wLgy924HufGNeWB/fa@DrWE0qyBQKcPtpajM8gFbuybPAUrAnHUXaX1RLZ3d8rDpR7mQZm86vnM32cGXdBJPTKw2@jqqAULqA717/XEGD1NveeU9AIorunWQh81sKqF@xBW1PoOGf5AoEFSKCgfJEMr1KSQX2lS8D02yI1Ph@YrqwSeEdapjnUzw703j@a2ZaofoAw5Ndkc9Asjy8iyAJIPjVp3ht6gejJssyGNadOyX1T1qJKvU4ZW8gGli/qKegDmpka5oCrYhVUpe/l8pqN/7mj11OCLun45OoHST3XC74FLtGAgDJcmBPXUAI@1xaioW1pUjFtZkzz0QMgBq72ZMe2cOMae8gPU@85AQy8ar399tzAAqmlCIwNbPrg2oElYGyWv4RgpwRTt0VWO0m9CVEIbTeuOQv5RxQ5IlBxofh@6yyFAj61aNHKzL3Vr0tzo1vxSsy2V1xFCh0zVNnUL2CdUAoFZPfXuYnXk0yUM/SXErM6wwwDXUI6ouwEhtev1qYv3IbDlF2C0TJn27rMjsIGsQrY6RjOksUFcjw0gSAcoe@xqEgkg8Y/UHqKBgT6H6Lp6MsuwyIM@osGY0viNGqEd7gD9Iv4opiRj616hHuGsENB6Ec9Lg/eclCzCRauo@n@V0GS6Uw8d71rdmX7Pow6UezvgkWqwSxjfsx1N82hMndNcE1G6PCw9avZSeXYnxXl@MTcrnU@q4fnOmOY4IycIHY7WoXlrGcxadI/Ct1xd6mVm5iErpZmr/H8XtLis/RS0amDGC2tqD0O2mbKwdIR3WPiqvRh623AbDs228hqFftu5biLOjcCKXf3aT1Y3JxqW1kZp3iOwjqGpHtydt7k7bZmqI9Wpr7x2gM@9hqvvet5nK8jbbrh3vc9OkDfvwWKSLDf6rdSDuNCvylRdXNOGT2uNza7ivNSDXU@/BOJ8dKJKecNWstLFOcZlx3UvTnTSgy2uMddt4Jed@ffMb7nhtgiPReSOw0zz84hN0sjWc973Cnetq2sQjSaZf7OshVO6M6xyxoGe1hHbeOIspfoKSndiOVGjp1@rZFklqzjz7J6jRQ9liMxXmZ9GQdCWxTiX54GrV08rFsGicKJUeR/wQSzOWK2jvG5hbt1wdy/GF9/7xLb9ILLxzve0zzjIX/jJXf9dee/kDVP1W8lyHUVLob4uWDdxp2WuWmlm4PStwDqEhejUTo1x3k3tlIHyIy3PfAmrfGupO@F0kCytMNjCRwV3J7BsH1jrtMzspzj7TtTGMY@BtQ2TZeqoK1aaKe@Z58seDiDO2i0yv/DgLHMiiW0zr7xWpvowk2Vk6b3UCT9g7AcCW@gX7HFT3gPO2ugVdsIzXXhw8H2iTqHpN9/5rIL8Q5VzCrwbxkGEFiQ6Y7PSnUtaxAvgCQQu5sEqDfJ3Ze3MZIXQ9PTguA@Dw84P9/1Ccw9lzpM6wPEzGi0hB81yZpbTZzTOYDEOvsahCRjqdvBQfKMRVv5o5eWOhRlclHifgMI9yO@aI6MOjMJ@DRlmT4AQHo98N1feXXkvvSx7Kll5erChA5bzyPsssBsQvGHFGEfu47xTJ8L5G5quvD6iYobjtAiSRinOWKOFG3BfN4miGBHADlj@RbnkRKpAcSonAOPe@3zVUGhQBiEuGsH82xy8Q0RC1215mTey4VUsic@O2MCsPwNOC4QCiYDbA88q6hhOXM@Aacg77dqz9GbbiZ7AjfJ6rn7BojE8H3jhBGm3S5YI4gPAxZq9Ity54QEIfYeLgryr0GGpfAY4rRFW7an8B86fBKuhGx6fVqQ3dGvtkTFLF@HCBgi7X@/WAIgjL5wjXdeALgLzRFofAjMBSDqBpR2QWT3gewgOME31TsThuiluh8/hh7alD7uuC6BcXf2GU@HdCemPqICDsOaWnCFmVeZXWuY/kdsb7zPEuyDvIM/w08r8MvN7wNgjCj6RYO@FXklVgYxw6zLI@6qcIgbTkA1wzQpVxYOlBqDiB4i5IqkQJTy/Vhak3JncC@tAbkVtwh7HagJlZuYPw3ICPOHdtVRZN815L4Ahms7uFBqLjgs0HXIzHYAFsf8eHCU8PzoOVjsVdkOXO0u5itlf/qLR9yG0f/oVie2rcz7s8tvh/KcdfVHir3/4osQqu147JmOusZU2Y@Z7T73uzBt3jrs0ZVzPZbYYBn7B5gFjUwbldHJa9ulE4j1N79r96ftWxC3ft0VcqUZWvZi99L@@OuoyDH173F8ku2CLk1hfu0TkZV90ijkrAHp/5n6trv4@XgXDbml3hlp68grR666yQVp2ltGXFPH@azu3JjcrTx0vE9XM08c8lEGUbL1lx9/57yxqVMarP7/E982wO7f5/hxVYxZq3UXHvrhdIxllRsvq2fadz@OFLBOg4F1Um8HDKlftyW3jbS7P02XvJMyQm@KM5Trjz2z02df5qculvRqstN/u7m3Pl@Svv31dfzPl1179g4e1f3v7dfzKf1Wp/Drsf@2S@Px9YZefTvnXW1q9nQ/lNT0f9m@X/O0UX3bJW5Lf35g/edsekvh2qDS52739Or1jh/vbr/irSv/nNX/a8PYr//G39qfmf/3x9uefX5nJqrdf2e2v/wk" rel="nofollow noreferrer" title="Bash – Try It Online">Try it online!</a></p>
<p>Time to revive an old challenge. It has my favorite number in it, it has one of my favorite algorithm categories in it, I can't resist.</p>
<p>Notes:</p>
<ul>
<li>Due to ABI/compiler defaults and memory layout (a.k.a. writing out of bounds lol), you need to use <code>-fno-signed-char -fno-common</code> to allow it to run on x86 GCC glibc. This is not true on some other platforms like ARM Clang Bionic.</li>
<li>Unconditionally writes the first block, but does not require it to start with 0x314159265359</li>
<li>You will need to chmod the files.</li>
<li>If your realloc is slow (e.g. Scudo), replace it with the realloc_hack function.</li>
<li>Outputs files as BZh9N, where N is the block number starting at 0.</li>
</ul>
<p>Optimizing this for bzip2 was quite interesting since larger code is sometimes better. For example, using <code>read(a,&amp;e,1)</code> is normally silly compared to <code>getchar()</code>, but it compresses slightly better (unless I am missing something) since the function is called in the same way as <code>write</code>.</p>
<p>Similarly, it is actually not silly to put a 48 byte lookup table in the code since it compresses really well, and most strangely, using <code>for</code> to combine statements instead of <code>while</code> actually seems to compress worse, even if it allows eliminating braces and statements. I haven't tested other variable names though.</p>
<p>I tried a few implementations, namely <code>bzip2</code>, <code>pbzip2</code>, <code>7z</code>, and <code>lbzip2</code>, with <code>lbzip2</code> seemingly compressing the best.</p>
<p>I also did a brute force search on the variable names for a good compression ratio and got 227 bytes with this one specific combination (not that there isn't guaranteed to be a shorter one, though, I'm not running a truly exhaustive search because that will take forever)</p>
<p>Ungolfed commented code:</p>
<pre class="lang-c prettyprint-override"><code>#define _GNU_SOURCE // ensure memmem
#include &lt;fcntl.h&gt;  // creat, close
#include &lt;unistd.h&gt; // read, write
#include &lt;stdio.h&gt;  // sprintf
#include &lt;stdlib.h&gt; // realloc
#include &lt;string.h&gt; // memmem

#ifdef REALLOC_HACK
// Hack to switch incremental realloc to power-of-2 realloc since the
// realloc loop can be painfully slow. With the Scudo allocator, this
// little maneuver will save you MINUTES on d2.in.
void *realloc_hack(void *buf, size_t len) {
    static size_t real_size = 16;
    if (buf == NULL || len &gt; real_size) {
        while (len &gt; real_size) {
            real_size *= 2;
        }
        return realloc(buf, real_size);
    }
    return buf;
}
#define realloc realloc_hack
#endif

// Variables
static int length;         // c
static int fd;             // p
static int block_num;      // o
// Golfed code assumes char is unsigned (-fno-signed-char or any non x86 arch)
static unsigned char *ptr; // r
static unsigned char *end; // t
static unsigned char temp; // d
static unsigned char i;    // s
// ungolfed code just uses [] and writes out of bounds
// This requires -fno-common on some toolchains to keep it
// from reordering the variables and breaking things.
static char filename_header[0x80]; // w

// The magic header split into bits
// The golfed code puts binary data in a string literal, inline 
static const unsigned char magic[] = {
    0,0,1,1,0,0,0,1, // 0x31
    0,1,0,0,0,0,0,1, // 0x41
    0,1,0,1,1,0,0,1, // 0x59
    0,0,1,0,0,1,1,0, // 0x26
    0,1,0,1,0,0,1,1, // 0x53
    0,1,0,1,1,0,0,1, // 0x59
};

static void write_block(void) // n
{
    // Filenames are BZhNi, where i is the block number and N is the window size
    sprintf(filename_header + 4, &quot;%i&quot;, block_num++);
    // while and if function the same, while compresses better
    while (ptr &lt; end) {
        // Create the file. The golfed code just uses mode 004, you will
        // need to chmod it to read it.
        fd = creat(filename_header, 0644);
        // Write the header which is the first 4 bytes of the filename
        write(fd, filename_header, 4);
        // Loop through the block
        while (ptr &lt; end) {
            // Consolidate the bits
            for (i = 0; i &lt; 8; i++) {
                temp += temp; // shift left
                if (ptr &lt; end) {
                    temp += *ptr++;
                    length--;
                }
             }
             // Write to the file
             write(fd, &amp;temp, 1);
        }
        // close the file
        // This is skipped in the golfed code, surely we won't run into the file limit :P
        close(fd);
    }
}

int main(void)
{
    // Defaults to 0 anyways
    fd = STDIN_FILENO;
    // Read the header to the same buffer as the filename
    read(fd, filename_header, 4);
    // Read the rest of the archive from stdin
    while (read(fd, &amp;temp, 1) &gt; 0) {
        // Grow the buffer (define REALLOC_HACK for best results)
        ptr = realloc(ptr, length + 8);
        // Split it into bits
        for (i = 0; i &lt; 8; i++) {
            ptr[length++] = temp &gt;&gt; 7;
            // Shift left
            temp += temp;
        }
    }
    // Scan the string for the magic bits with memmem
    // While this doesn't require the first bits to be 0x314159265359,
    // it will always write the first block as such.
    while ((end = memmem(
                     ptr + sizeof(magic), length - sizeof(magic),
                     magic, sizeof(magic)
                  )
           ) != NULL) {
        write_block();
    }
    // Write tail block (may be empty)
    end = ptr + length;
    write_block();
}
</code></pre>
</div>
<div id="pu1" class="pu"><h1>Python 3 -- 375(534 chars)</h1>

<p>It can process the example file <code>d2.in</code> in about 10 seconds, using Pypy3. With CPython 3, it will cost 60 seconds.</p>

<p>It's interesting and weird that some old golf tricks would make the score worse! For example, replacing <code>&lt;space&gt;+&lt;space&gt;</code> by <code>+</code> would increase the score from 375 to 384; replacing all <code>range</code> by <code>R</code> will also increase the score to 384.</p>

<h2>Golfed</h2>

<pre><code>import sys
from collections import deque
def T(B):
 for i in range(0,len(B),8):
  x=0
  for j in range(min(8,len(B)-i)): x |= B[i + j] &lt;&lt; (7-j)
  yield x
V=sys.argv
C=F=0
B=bytearray()
I=open(V[1],'rb')
H=I.read(4)
P=deque([(x&gt;&gt;(7-j)) &amp; 1 for x in b'1AY&amp;SY' for j in range(8)])
Q=deque([0]*48)
for x in I.read():
 for j in range(8):
  b=(x&gt;&gt;(7-j)) &amp; 1
  B.append(b)
  Q.popleft()
  Q.append(b)
  if Q!=P: continue
  C+=1
  M,B=B[:-48],B[-48:]
  if F:F.write(bytes(T(M)))
  F=open(V[2] + str(C),'wb')
  F.write(H)
F.write(bytes(T(B)))
</code></pre>

<h2>Base64</h2>

<pre><code>QlpoOTFBWSZTWSoMWQ0AAMLfgAAQYf901zlibSo/t//kMAFaCIaCQANTTTKMnlGg8oeRpPaoNDDAAAAAaAAAAABKaSGmmpplD0jQaAABo00ZNqLfKsdHBd3QgkQ2wY3RfYpMMjPpsyit5Ee6+k6E6ObzlFT2vmgbSKPkni7ZgDkcwTRiLFBmNCuEX/HtOC8KJ+Rg51SkMCiAGXZpXbvaK+DzMLvaEhAM8reCB8HFAsNYfRghS9+i5/IpLrDzGZVhsbVOpQzHIIVZ7zCCgDkcElOMvTuvfw2bruKz2WQuvEg99gDa8T3Kw2GdyMNjEVFVVQj4sU1MaOTUcwQROwt86LfUZAOJE6HqnB60CFO38NJmpifx+trcQ8x5alqRiEGoKC2wJpPkCXpT7fbtFDbLCLQaplK23qMTC5gqGwCghjN3zEtwyKhCz3kixqBr7gya6yPG03rMOGY9hlmV3tS0W/SdC2taUpCoNSEaEnUXckU4UJAqDFkN
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/34608/">34608</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




