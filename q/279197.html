<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::279197</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>153</td><td>C clang</td><td>250418T083053Z</td><td><a href="https://codegolf.stackexchange.com/questions/279197/utf-8-character-decoder-with-invalid-sequence-handling/279235#279235">ceilingc</a></td></tr>
<tr d-ix="1"><td>128</td><td>Charcoal</td><td>250419T222824Z</td><td><a href="https://codegolf.stackexchange.com/questions/279197/utf-8-character-decoder-with-invalid-sequence-handling/279239#279239">Neil</a></td></tr>
<tr d-ix="2"><td>165</td><td>JavaScript Node.js</td><td>250418T094350Z</td><td><a href="https://codegolf.stackexchange.com/questions/279197/utf-8-character-decoder-with-invalid-sequence-handling/279236#279236">l4m2</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="http://clang.llvm.org/" rel="nofollow noreferrer">C (clang)</a>, <s>241 233 220 194 181 170 164</s> 153 bytes</h1>

<pre class="lang-c prettyprint-override"><code>C,x;f(*s){int v=*s,m=64;C=v&gt;127;do if(m&lt;&lt;=5,C&amp;&amp;*s-194&gt;50u|(x=s[C]^128)&gt;63|(v=v&lt;&lt;6|x)&gt;&gt;5==448|v&gt;&gt;5==475|v-15632&lt;256u)return-1;while(C++,v&amp;m);return~-m&amp;v;}
</code></pre>
<p><a href="https://tio.run/##ldXrSuNAGMbx715F6GJJarLOOzM5kQNo2vm0F7BgXCjWrgVTpYdswOqtd5smU97EBDJCsRT58YT@Z3yynl7n67/HY2IWwVKfbI2P1Xqn5dFka2aRw4MkymOgbrB401ZLPQvDyDaT8XiytcDnsU32B72Itg/J4x@gnhE77KDnUR6GzqEw4tiOIs69Q169c@1DboHtMBpS29kbm@fdfrO2IPj3snp91pObGzMfZ0ZQff5lZeM8@Dz@WGXvb5tduN0tTtN@vsRX5cJsvlrrxsf5/RweHqNfo7QgZBTc3mqXHyuufhMNrt43pz9d6qPr39r1Il2PzKU@B8NMjKAyqDSg24AegyKD1YYrOg1X9BgMGbw2EpoWHn6eGvGIRjsRjhC7RqYiLe7FN8QVogexEeLUyIykxR3BayrFI0RjnYqDFFcq07TwG3POyrTc0q24SPGkMit3fNsyI71bPKT4UjnvOL2mDUUIMe1RfKQAaTOizfQ9EhDsyGzF6YF80niwEgJSPhXvhnC6INsV/AQ0R50gIOdFPRDuFxiKj3TEZ/WdAsAJA0f5uUKFwRGD3QqQtAIsne6MAXcMTitBVwx2cMngtiJMhu/BLYPX6iehgx1cM/itfmbD9@CeKWnlIwY7FPdMu3oW9qXnCuo@GLRxFXf1LMQwqO65lmTQXvd/ht4QKe6Zyp7vhaLCG2Nkz4nqGFwzlTUnoKjglqmLzpanctIpTpl6iPFVTjrFJVNcstoaHDIjmFFZwwj@ohigC@NOZQ7DGTOKmHulOY2IGUPHwVeagytmHDFqc/CtzGTF9cke3B/DFTNZsXAVFVwxkxULT1HBETMZsUgUFdwwuzQ8U1RwwvySsOJVw/FNzOFy7eGXoli3/Hn8Dw" rel="nofollow noreferrer" title="C (clang) – Try It Online">Try it online!</a></p>
<p>Golfed version of the reference implementation.</p>
<p>Thanks to @l4m2 for -14 and a bugfix!</p>
<h5>Closed course, professional driver.</h5>
<p>This makes extensive use of clang specific quirks. Kids, as always for code golf, please don't try any of these tricks in production without adult supervision.</p>
</div>
<div id="pu1" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 128 bytes</h1>
<pre><code>Ｎθ≡θ²²⁴≔³²ζ²⁴⁰≔¹⁶ζ≔⁰ζ≡θ²³⁷≔³²ε²⁴⁴≔¹⁶ε≔⁶⁴ε¿÷⁻²⁴⁴θ⁵¹⊞υ∨±÷θ¹²⁸θ«⊞υ＆θ÷³¹⊕‹²²³θＷ＆θε«≦⊗θ≔⁻Ｎ¹²⁸η¿№…ζεη⊞υη«ＵＭυ⁰⊞υ⊖⊟υ≔⁰θ»≔⁰ζ≔⁶⁴ε»»Ｉ⟦↨υεＬυ
</code></pre>
<p><a href="https://tio.run/##bVHLjoIwFF3DV3TZJkyCwDjOzMpHJjFRx8zWuKhwlSZYlLZqNHw701IRTNw0cM@555Ebp7SIc5pV1ZQflFyo/QYKfCTfrjgzGadIf6ObG1MBKAiiLzQUgu04DgMPXTXLApH/AHp9CySwpSqTj7lvx@Ur3fDjSRda3ehJF17o9iM7L122RXjK5YSdWAJ4zrgSWCt46Eg89N4jBC2VSLHy0G@BF7CjEjr8o4d6wYAQQ9dykGn/m@s0KyMmz0zAkCeG2a6FPfMXF7AHLiHBMxDaNQhrGWKUnHPKMkD4WQGIqe84c3q4F5nkapNBYhb1knOf2hrd2xAb1ENpzTOtx7niEv9RvgN8NdoGbOtaYtOo9hzn@z3VSTTq1@ij6ATaMsv8gJUt8QjkNwFLtzu7dkM3N9Gc0l0WTIcbUyHxaqSvakxMwhnwndSWZK0NqmrlX360jn/5rN/B/V1Xb6fsHw" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Prefers to input and output in decimal on separate lines but will accept hexadecimal input if formatted as shown in the link. Explanation:</p>
<pre><code>Ｎθ≡θ²²⁴≔³²ζ²⁴⁰≔¹⁶ζ≔⁰ζ≡θ²³⁷≔³²ε²⁴⁴≔¹⁶ε≔⁶⁴ε
</code></pre>
<p>Input the first byte and assuming that the first byte is in the range <code>194..224</code> calculate the valid ranges for the second byte offset by <code>128</code>.</p>
<pre><code>¿÷⁻²⁴⁴θ⁵¹⊞υ∨±÷θ¹²⁸θ«
</code></pre>
<p>If the first byte is not in the range <code>194..224</code> then push it or <code>-1</code> if it is <code>128</code> or more to the base <code>64</code> result list.</p>
<pre><code>⊞υ＆θ÷³¹⊕‹²²³θ
</code></pre>
<p>Otherwise, start by pushing the lower <code>3</code> to <code>5</code> bits as appropriate of the first byte to the base <code>64</code> result list.</p>
<pre><code>Ｗ＆θε«
</code></pre>
<p>Repeat while there are still bytes to process. (Although the variable is not always <code>64</code> at this point, conveniently the first loop will always execute anyway.)</p>
<pre><code>≦⊗θ
</code></pre>
<p>Decrement the number of remaining bytes to process.</p>
<pre><code>≔⁻Ｎ¹²⁸η
</code></pre>
<p>Get the next byte, offset by <code>128</code>.</p>
<pre><code>¿№…ζεη⊞υη
</code></pre>
<p>If it's valid then push it to the base <code>64</code> result list.</p>
<pre><code>«ＵＭυ⁰⊞υ⊖⊟υ≔⁰θ»
</code></pre>
<p>Otherwise, set the base <code>64</code> result list to <code>-1</code> (without changing its length) and clear the number of remaining bytes to process.</p>
<pre><code>≔⁰ζ≔⁶⁴ε
</code></pre>
<p>Set the valid range for the remaining bytes. (This also sets the base to <code>64</code> for the output, necessary when the length of the list is greater than <code>1</code>.)</p>
<pre><code>»»Ｉ⟦↨υεＬυ
</code></pre>
<p>Convert the base <code>64</code> list to decimal and also output its length.</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 165 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>([b,...c],t=b*4+c[0]/16-904,k=64)=&gt;b&lt;128?[1,b]:t&lt;-120^t&lt;0^t&lt;2^t&lt;54^t&lt;56^~~t==64^t&lt;81?c.some((e,i)=&gt;y=(e^=128)&lt;64?(b=b-k&lt;&lt;6|e,k*=32,k&gt;b&amp;&amp;[i+2,b]):[i+1],b-=128)&amp;&amp;y:[1]
</code></pre>
<p><a href="https://tio.run/##dZRNc6JAEIbv/ApOZoiAPYgILmBFYQ45ZA97JLoBRJf1A0uozVq1lb/u9oAmKkDVAP3U293zNlP8Dv@EeXxI94WyyxbJaemcSBDJqqrGM7lwoke9Gwcw61FDsUCX146hS44b2VQzxwGVo9mosBWqwbyw@dJwDXR@M@YfH4WDcgxMOo7VPNsmhCRyivlHhyRzB2tItqGPSeREytq2jX@JvH50@pq8dqNOJ0i7GjaQRvhCZ3KklAmdznEU0NnpW5zt8myTqJtsRd4EAPHzUtzqCSIVgNY5RT5kNY6IClNNNOGWY6wJHhMn7IYPGUPug/gE55SKm7iVvuB7onVJKbnH9ch9Lr7S@1DpS/HE@@SMMe@Ls2vO6zAQLTiX4pwCr6MLTBfNSwpyCqVeF7gxuDOm8EGgsSFr4JUxgFuunY0NWY2XxqZ1fbkV7H7HKwN@TV8ZYNCsxxZscMX7X4YZu@GCWT8RpbEJa@bCtCVhSpu5D7WjcuFW00RZi57zJj0f9VNjA@/@LJ4TcBZWYwe9OQFH2eiMDVu42cKnLdxv4S2f4E09JPtNGCekR9SupLi97UomP@Ucfxl59/nH9xc1Lw7pbpUuj2RJcnUbFvEv0nt9f33vrSQM9yRx3Af4@9BNFJAkSd2HC3@3IHSAwek/" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<ul>
<li>If ASCII, take 1 byte</li>
<li>Assuming byte 2 in [0x80,0xc0), if first two bytes bad, reject 1 byte</li>
<li>Scan through from byte 2. If out of [0x80,0xc0), reject till here</li>
<li>If enough bytes, take till here</li>
</ul>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/279197/">279197</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




