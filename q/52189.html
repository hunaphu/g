<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::52189</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>150</td><td>Uiua</td><td>250306T215513Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/278545#278545">janMakos</a></td></tr>
<tr d-ix="1"><td>786</td><td>APLNARS</td><td>250306T131026Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/278534#278534">Rosario</a></td></tr>
<tr d-ix="2"><td>306</td><td>Python</td><td>241126T154915Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/276866#276866">Joon Yor</a></td></tr>
<tr d-ix="3"><td>364</td><td>Python 3</td><td>190106T001936Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/178437#178437">Neil A.</a></td></tr>
<tr d-ix="4"><td>137</td><td>CJam</td><td>190103T132717Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/178314#178314">Peter Ta</a></td></tr>
<tr d-ix="5"><td>242</td><td>Lua</td><td>170519T200318Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/121688#121688">Sgt. Dog</a></td></tr>
<tr d-ix="6"><td>176</td><td>CJam</td><td>150628T054027Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/52369#52369">Reto Kor</a></td></tr>
<tr d-ix="7"><td>333</td><td>CoffeeScript</td><td>150626T163054Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/52313#52313">rink.att</a></td></tr>
<tr d-ix="8"><td>277</td><td>JavaScript ES6</td><td>150626T164600Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/52315#52315">rink.att</a></td></tr>
<tr d-ix="9"><td>667</td><td>Java</td><td>150626T151131Z</td><td><a href="https://codegolf.stackexchange.com/questions/52189/ionic-compound-golf/52304#52304">cmxu</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Uiua, 150 bytes</h1>
<pre class="lang-none prettyprint-override"><code>⍥⋅&quot;H2O&quot;⊸≍&quot;HOH&quot;⊂˜∩(⨬◌(⊂⍥$&quot;(_)&quot;&gt;1⧻⊚=1⊸±:°⋕)⊸≠1)∩⌞˜÷÷◡⊃∨×∩+₁⌊÷₆⊙≥₆⊸₂˜∩(⊗□:⊜□⊸≠@,)&quot;H,Na,Ag,K,Li,NH4,Ba,Ca,Cu,Mg,Zn,Pb,Fe,Al&quot;&quot;Cl,Br,F,I,OH,NO3,O,S,SO4,CO3&quot;
</code></pre>
<p><a href="https://uiua.org/pad?src=0_15_0-dev_2__IyBFeHBlcmltZW50YWwhCkYg4oaQIOKNpeKLhSJIMk8i4oq44omNIkhPSCLiioLLnOKIqSjiqKzil4wo4oqC4o2lJCIoXykiPjHip7viipo9MeKKuMKxOsKw4ouVKeKKuOKJoDEp4oip4oyey5zDt8O34peh4oqD4oiow5fiiKkr4oKB4oyKw7figobiipniiaXigobiirjigoLLnOKIqSjiipfilqE64oqc4pah4oq44omgQCwpIkgsTmEsQWcsSyxMaSxOSDQsQmEsQ2EsQ3UsTWcsWm4sUGIsRmUsQWwiIkNsLEJyLEYsSSxPSCxOTzMsTyxTLFNPNCxDTzMiCkcg4oaQICgKICAiQ2wsQnIsRixJLE9ILE5PMyxPLFMsU080LENPMyIKICAiSCxOYSxBZyxLLExpLE5INCxCYSxDYSxDdSxNZyxabixQYixGZSxBbCIKICDiirjigoLLnOKIqSjiipfilqE64oqc4pah4oq44omgQCwpCiAg4oipK-KCgeKMisO34oKG4oqZ4oml4oKGCiAg4oip4oyey5zDt8O34peh4oqD4oiow5cKICDiioLLnOKIqSjiqKzil4wo4oqC4o2lJCIoXykiPjHip7viipo9MeKKuMKxOsKw4ouVKeKKuOKJoDEpCiAg4o2l4ouFIkgyTyLiirjiiY0iSE9IIgopCgrijaTipJniiY0gIkgyTyIgRiAiSCIgIk8iCuKNpOKkmeKJjSAiQ2FDTzMiIEYgIkNhIiAiQ08zIgrijaTipJniiY0gIkFsMihTTzQpMyIgRiAiQWwiICJTTzQiCuKNpOKkmeKJjSAiSDJPIiBGICJIIiAiT0giCg==" rel="nofollow noreferrer">Online test cases</a></p>
<h2>Expanded</h2>
<pre class="lang-none prettyprint-override"><code>&quot;Cl,Br,F,I,OH,NO3,O,S,SO4,CO3&quot;
&quot;H,Na,Ag,K,Li,NH4,Ba,Ca,Cu,Mg,Zn,Pb,Fe,Al&quot;
⊸₂˜∩(⊗□:⊜□⊸≠@,)
∩+₁⌊÷₆⊙≥₆
∩⌞˜÷÷◡⊃∨×
⊂˜∩(⨬◌(⊂⍥$&quot;(_)&quot;&gt;1⧻⊚=1⊸±:°⋕)⊸≠1)
⍥⋅&quot;H2O&quot;⊸≍&quot;HOH&quot;
</code></pre>
</div>
<div id="pu1" class="pu"><h1>APL(NARS), 786 chars</h1>
<pre><code>r←a opz w;i;l;b;t;k
r←⍬⋄→0×⍳(≢w)≠l←≢a⋄i←0
→8×⍳l&lt;i+←1⋄b←↑a[i]⋄t←w[i]
→6×⍳t=1⋄→5×⍳∼2=k←≢b⋄→6×⍳∼b[2]∊⎕A∪⎕D
b←'(',b,')'⋄→6
→6×⍳∼2&lt;k←≢b⋄→4
→7×⍳∼(,'1')≡k←⍕t⋄k←''
r,←⊂(b)(k)⋄→2
r←∊r
→0×⍳∼(r≡'HHO')∨r≡'HOH'⋄r←'H2O'

r←a u w;i;l
r←⍬⋄→0×⍳(≢w)≠l←≢a⋄i←0
→0×⍳l&lt;i+←1⋄r,←⊂(↑a[i])(i⊃w)⋄→2

r←f w;D;q;v;t;d;g;a;h;a0;a1;a2;s;m;b
D←('OwSw')('HwClBrFwIw')('00')('HwNaAgKwLi')('BaCaCuMgZnPb')('FeAl')('Cw')('Nw')('Sw')
r←'NoSol'⋄q←⎕A∪⎕a⋄v←{∊2{(⍵∊⎕D)∧⍺∊⎕A:⍺,'w'⋄⍺}/∊2{(⍺∊q)∧∼⍵∊⎕a∪⎕D:⍺,'1'⋄⍺}/⍵,'  '}⋄s←{0≤×/⍵:⍬⋄(∨/⍵)÷⍨⌽∣⍵}
d←{((⍵∊q)⊂⍵)(⍎¨(⍵∊⎕D)⊂⍵)}⋄g←{a←{(2⊃⍵){w←⍵⋄⍺×¯3+⍸∨/¨{w⍷⍵}¨D}↑⍵}¨⍵⋄1=≢⍵:↑a⋄k/⍨m=⌊/m←∣k←↑+/a}
h←{g{1=≢j←↑⍵:,/⍵⋄j u↑⌽⍵}⍵}⋄a←(w≠'+')⊂w⋄a0←v¨a⋄a1←d¨a0⋄a2←h¨a1⋄t←{1=k←≢⍵:⍵⋄l←≢a←∊(∘.,)/⍵⋄,/(⌊l÷k)k⍴a}a2
m←t/⍨b←{⍬≢⍵}¨a0←s¨t⋄→0×⍳0=≢m⋄r←↑b/a0
t←↑m⋄→A0×⍳∼t[1]&lt;t[2]⋄r←⌽r⋄a1←⌽a1⋄a←⌽a
A0: r←a opz r
</code></pre>
<p>//20+22+26+33+20+15+22+14+5+31+12+22+31+37+87+103+91+103+37+38+14 = 783</p>
<p>The D array is built in this way, the position of the string searched -3, is the ionization number of the element of the string.
The H (That is Hw in D array) could have both +1 and -1 ionization numbers. As it seems S could have -2 and +6.
The g function would find the ionization number of the input have string elements of D.
I searched a general solution for this problem for the elements of D array, the result is a little
more long and possible full of errors. u is the function concatenate 2 - 2 elements of 2 arrays of ugual lenght.</p>
<pre><code>  f 'H+OH'
┌3───┐
│ H2O│
└────┘
  f 'Cl+OH'
┌5─────┐
│ NoSol│
└──────┘
  f 'Cl+O'
┌5─────┐
│ NoSol│
└──────┘
  f 'Na+O'
┌4────┐
│ Na2O│
└─────┘
  f 'Na+SO4'
┌6──────┐
│ Na2SO4│
└───────┘
  f 'H+O'
┌3───┐
│ H2O│
└────┘
  f 'Ca+CO3'
┌5─────┐
│ CaCO3│
└──────┘
  f 'Al+SO4'
┌9─────────┐
│ Al2(SO4)3│
└──────────┘
  f 'Ba+OH'
┌7───────┐
│ Ba(OH)2│
└────────┘
  f 'Ba+NO3'
┌8────────┐
│ Ba(NO3)2│
└─────────┘
  f 'Ba+SO4'
┌5─────┐
│ BaSO4│
└──────┘
  f 'Ca+Cl'
┌5─────┐
│ CaCl2│
└──────┘
  f 'Cl+Ca'
┌5─────┐
│ CaCl2│
└──────┘
</code></pre>
</div>
<div id="pu2" class="pu"><h1><a href="https://www.python.org" rel="nofollow noreferrer">Python</a>, 306 bytes</h1>
<pre class="lang-python prettyprint-override"><code>f=lambda x,y,t=&quot;NH4 NO3 H Na Ag K Li OH I F Br Cl CO3 SO4 Ba Ca Cu Mg Zn Pb S O Fe Al&quot;.split():[&quot;H2O&quot;,[[x,f&quot;({x})&quot;][x[-1]in&quot;34&quot;]+str((j:=t.index(y)//12+(y in(z:=t[-2:]))+1)//(g:=math.gcd((i:=t.index(x)//12+(x in z)+1),j))),x][j//g&lt;2]+[[y,f&quot;({y})&quot;][y[-1]in&quot;34&quot;]+str(i//g),y][i//g&lt;2]][x+y!=&quot;HOH&quot;]
import math
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=bZGxbsIwFEXVla949WQrhojAUEXNAJGQq7ZxJbZaHkIhwSiEKBjJpuqXdGFp_6drv6YmUCFoJU_n3ft89e77Z2X1fFXudh8bnbVvvq--sqhIl5NpCoZaqiOUsD4kvAcMkhQGOdzDgwLO4A5GMKwhLiB20zHvwzCF2L0NPObwXMLTBMbAYTSDQYE666pQGpNQIBZwRIUwNEP41bwRJIUR7a5UJer1kfTWusZ4EUa6o8rpzGBLfL8beNiCKvHWcdEOQkmI13UDnIfRMtXzTv4yxVidXOboMs4F272YLggh1Eix8P38NpCeELbJYJsM9jKDcjJCrRTqoHcxPXsdIcYZki21rFa1hv3frapWpcYZRgxRxBEhJxKnDrkDnUF3D4rcxc5g42VnKGnMxR_Z5T5X0T90rxw5cmj2WPBv0T8" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Heavily inspired by <a href="https://codegolf.stackexchange.com/a/178437/126008">Neil A</a>'s Answer, I really wanted a sub-300 but I'm stuck on saving any more bytes. The only major change is using a 1D array instead of a 2D array and then using <code>(j:=t.index(y)//12+(y in(z:=t[-2:]))+1)</code> and <code>(i:=t.index(x)//12+(x in z)+1)</code> to get the charges of <em>y</em> and <em>x</em> respectively, the rest is minor improvements on syntax.</p>
</div>
<div id="pu3" class="pu"><h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a>, 364 bytes</h1>

<p>Stores the ions by the absolute value of their charges as <code>index+1</code> in a 2-D array (0-index elements have +- 1 charge, etc.). Uses string.split() to save a few characters there. Handles the special case of <code>H + OH = H2O</code> first, then it calculates how many ions are needed of each sort as the LCM of their two charges divided by its charge. Then adds in parentheses if needed as well as the actual number of ions.</p>



<pre class="lang-python prettyprint-override"><code>from math import*
o=["NH4 NO3 H Na Ag K Li OH I F Br Cl".split(),"CO3 SO4 Ba Ca Cu Mg Zn Pb S O".split(),["Fe","Al"]]
p=["H","OH"]
def c(i):
 for h,k in enumerate(o):
  if i in k:return-~h
def b(x,y):
 if x in p and y in p:return"H20"
 i,j=c(x),c(y);g=gcd(i,j);i//=g;j//=g;return((x,"(%s)"%x)[x[-1]in"34"]+str(j),x)[j==1]+((y,"(%s)"%y)[y[-1]in"34"]+str(i),y)[i==1]
</code></pre>

<p><a href="https://tio.run/##XZDBauMwFEXX1VdcNBSkVm2TODOLBC9SQ3GZaTzQXYUWjuM4ShPbyArYm/n1zFPSTmFACOnovPfEbQe/berodNq45oBD7rewh7Zx/oY1sebLdIplFiHFMseiwk/8sshSPOMJjw7Jnt937d56IRVPyHvNpnjMkdA64qXCW43fK7wi@/I0fyq54os9N4a1NCOlW5Zyw9blBoWwcsawaRy26h22RlkfD6XLfSma8AK7gQ38feZKf3T13Z/tuXIlejUEg4Q@CC3yeo3hfPxweToZcTLULi5EL1UhBjmv4qpYC2Jybh8e4mq@O@@XCkFdubjuJL/upe713djYmkdTbm4778ROKsK7OB6bWyGGT3WQevhftZK@p21QT77sfJF3ZYcYGt8Q/fjOrkRIAjzjUhFKJ1lASR4YRXuhSU7HwCk@4hT3hS/2E0EXGX21ST/7jJhhLAQapoY0/k2fsavW2dqLlQhMj4w6P@qxkfL0Fw" rel="nofollow noreferrer" title="Python 3 – Try It Online">Try it online!</a></p>
</div>
<div id="pu4" class="pu"><h2>CJam (137 bytes)</h2>

<pre><code>{{"SO4CO3ClBrFINO3OHNaAgKLiNH4BaCaCuMgZnPbFeAl":I\#~}$_s"HOH"="HO"1/@?_{I\#G-_0&lt;B*-B/_W&gt;+z}%_~1$=\1?f/W%[.{:T1&gt;{_{'a&lt;},,1&gt;{'(\')}*T}*}]s}
</code></pre>

<p>This is an anonymous block (function) which takes two ions as strings wrapped in a list, and returns a string.</p>

<p><a href="http://cjam.aditsu.net/#code=e%23%20Test%20cases%0A%22H%20OH%0A%20Ca%20CO3%0A%20CO3%20Ca%0A%20Al%20SO4%0A%20F%20Fe%22N%25%7BS%25_p%0A%0A%7B%7B%22SO4CO3ClBrFINO3OHNaAgKLiNH4BaCaCuMgZnPbFeAl%22%3AI%5C%23~%7D%24_s%22HOH%22%3D%22HO%221%2F%40%3F_%7BI%5C%23G-_0%3CB*-B%2F_W%3E%2Bz%7D%25_~1%24%3D%5C1%3Ff%2FW%25%5B.%7B%3AT1%3E%7B_%7B&#39;a%3C%7D%2C%2C1%3E%7B&#39;(%5C&#39;)%7D*T%7D*%7D%5Ds%7D%0A%0A~pNo%7D%2F" rel="nofollow noreferrer">Online demo</a>.</p>

<h3>Dissection</h3>

<pre><code>{                        e# Begin a block
  {                      e#   Sort the input list
    "SO4...Al"           e#     Ions in ascending order of charge
    :I                   e#     Stored as I for future reuse
    \#~                  e#     Index and bit-invert to sort descending
  }$

  _s"HOH"="HO"1/@?       e#   Special case for water: replace ["H" "OH"] with ["H" "O"]

  _{I\#G-_0&lt;B*-B/_W&gt;+z}% e#   Copy the list and hash index in I to find the charges
  _~1$=\1?f/             e#   Replace [2 2] by [1 1]
  W%                     e#   Reverse the charges
  [                      e#   Gather in an array
    .{                   e#   Pairwise for each ion and its opponent's reduced charge...
      :T1&gt;{              e#     If the charge (copied to T) is greater than 1
        _{'a&lt;},,         e#       Count the characters in the ion which are before 'a'
        1&gt;{'(\')}*       e#       If there's more than one, add some parentheses
        T                e#       Append T
      }*
    }
  ]
  s                      e#   Flatten the list to a single string
}
</code></pre>
</div>
<div id="pu5" class="pu"><h1><a href="https://www.lua.org/pil/contents.html" rel="nofollow noreferrer">Lua</a>, <s>174</s> 242 bytes</h1>

<p>I forgot the brackets '-_-, that got me up to 242. Oh well, it was a fun enough challenge at least.</p>

<pre><code>i,c,a={Ba=2,Ca=2,Cu=2,Mg=2,Zn=2,Pb=2,Fe=3,Al=3,O=2,S=2,SO4=2,CO3=2},io.read(),io.read()
p,d=i[c]~=i[a],{SO4=1,NO3=1,OH=1,CO3=1}
k,m=p and i[c]or'',p and i[a]or''
a=k==m and a or (d[a]and'('..a..')'or a)
print(c..a=='HOH'and'H2O'or c..m..a..k)
</code></pre>

<p><a href="https://tio.run/nexus/lua#RY0/C8IwEMX3fIpsaeEItHW9QQXJohHclA5nUyTU/iHoVOpXr5eAONyPe@/e41YPDRDOO8IS9glvxvHBuA6M851xaLGC7ZNhWV3i2E3M2grLBfyoQ0suy/@bmMChvzX1h0k1zLFQwIkLBVjDiN1iER30OEkanIzpMSgFP0lJCsIOsU8eyTHIzPGFlcqU1qS1yhW7xC@DH15ZwyaiMtaoGDKljWd2@5Tu8nU1wpov" rel="nofollow noreferrer" title="Lua – TIO Nexus">Try it online!</a></p>

<p>Old version:</p>

<pre><code>i,c,a={Ba=2,Ca=2,Cu=2,Mg=2,Zn=2,Pb=2,Fe=3,Al=3,O=2,S=2,SO4=2,CO3=2},io.read(),io.read()
p=i[c]~=i[a]
k,m=p and i[c]or'',p and i[a]or''
print(c..a=='HOH'and'H2O'or c..m..a..k)
</code></pre>

<p>Abusing Lua's tendency to initialize everything with a nil value we can cut down on storage costs. Still, Lua is still a bit clunky :(</p>
</div>
<div id="pu6" class="pu"><h1>CJam, 176 bytes</h1>

<pre><code>"O S SO4 CO3 ""Cl Br F I OH NO3 """"H Na Ag K Li NH4 ""Ba Ca Cu Mg Zn Pb ""Fe Al "]_2{r\1$S+f#Wf=0#((z@}*_2$*_4=2*-_@/\@/@\]2/{~_({1$1&gt;_el={'(@@')\}|0}&amp;;}/]s"HOHH"1$#){;"H2O"}&amp;
</code></pre>

<p><a href="http://cjam.aditsu.net/#code=%22O%20S%20SO4%20CO3%20%22%22Cl%20Br%20F%20I%20OH%20NO3%20%22%22%22%22H%20Na%20Ag%20K%20Li%20NH4%20%22%22Ba%20Ca%20Cu%20Mg%20Zn%20Pb%20%22%22Fe%20Al%20%22%5D_2%7Br%5C1%24S%2Bf%23Wf%3D0%23((z%40%7D*_2%24*_4%3D2*-_%40%2F%5C%40%2F%40%5C%5D2%2F%7B~_(%7B1%241%3E_el%3D%7B&#39;(%40%40&#39;)%5C%7D%7C0%7D%26%3B%7D%2F%5Ds%22HOHH%221%24%23)%7B%3B%22H2O%22%7D%26&amp;input=Al%20SO4" rel="nofollow">Try it online</a></p>

<p>This was somewhat painful, particularly with all the special cases for parentheses, showing counts, the H2O, etc.</p>

<p>The data is not in a super compact format. It could be trimmed more, but the code needed to interpret it would probably compensate for the savings. So I went with an array of strings, where each string contains the atoms with the same charge, ordered from -2 to +3 (where the string for 0 is empty).</p>

<p>Explanation:</p>

<pre><code>[..]  Data, as explained above.
_     Duplicate data, will need it for both inputs.
2{    Loop over two inputs.
  r     Get input.
  \     Swap data to top.
  1$    Copy input to top (keep original for later).
  S+    Add a space to avoid ambiguity when searching in data.
  f#    Search for name in all strings of data.
  Wf=   Convert search results to truth values by comparing them to -1.
  0#    Find the 0 entry, which gives the index of the matching string.
  ((    Subtract 2, to get charge in range [-2, 3] from index.
  z     Absolute value, we don't really care about sign of charge.
  @     Swap second copy of data table to proper position for next input.
}*    End loop over two inputs.
_2$*  Multiply the two charges.
_4=   We need the LCM. But for the values here, only product 4 is not the LCM.
2*-   So change it to 2.
_@/   Divide LCM by first charge to get first count.
\@/   Divide LCM by second charge to get second count.
@\]2/ Make pairs of name/count for both ions...
{     ... and loop over the pairs.
  ~     Unpack the pair.
  _(    Check if count is &gt; 1.
  {       Handle count &gt; 1.
    1$    Get copy of name to top of stack.
    1&gt;    Slice off first character to check if rest contains upper case.
    _el   Create lower case copy.
    =     If they are different, there are upper case letters.
    {       Handle case where parentheses are needed.
      '(    Opening parentheses.
      @@    Some stack shuffling to get values in place.
      ')    Closing parentheses.
      \     And one more swap to place count after parentheses.
    }|    End parentheses handling.
    0     Push dummy value to match stack layout of other branch.
  }&amp;    End count handling.
  ;     Pop unused count off stack.
}/    End loop over name/count pairs.
]s    Pack stack content into single string, for H2O handling.
"HOHH"  String that contains both HOH and OHH, which need to be H2O.
1$#)  Check if output is in that string.
{     If yes, replace with H2O.
  ;     Drop old value.
  "H2O" And make it H2O instead.
}&amp;    End of H2O handling.
</code></pre>
</div>
<div id="pu7" class="pu"><h2>CoffeeScript, <s>371</s> 333 bytes</h2>

<p>This count includes newlines (some newlines can be replaced with semicolons but that wouldn't affect character count)</p>

<pre class="lang-coffee prettyprint-override"><code>f=(x,y)-&gt;(i='indexOf';d='~NH4KNaAgLiBa~CaCuMgZnPbFeAlSO4CO3ClBrFIOHNO3';k=d[i] x;r=-1+Math.ceil k/11;l=d[i] y;a=if k&lt;28then x else y
b=if k&lt;28then y else x
s=if b=='F'then 0else 32&gt;l
r=s=0if r==s;a='(NH4)'if'NH4'==a&amp;&amp;s;b='('+b+')'if/[A-Z]{2}/.test(b)&amp;&amp;r;if'H'==a&amp;&amp;b=='OH'then'H2O'else a+(if!s then''else 1+s)+b+(if!r then''else 1+r))
</code></pre>

<hr>

<pre class="lang-coffee prettyprint-override"><code># Original attempt, 371 bytes
p={H:1,Na:1,Ag:1,K:1,Li:1,NH4:1,Ba:2,Ca:2,Cu:2,Mg:2,Zn:2,Pb:2,Fe:3,Al:3}
n={Cl:1,Br:1,F:1,I:1,OH:1,NO3:1,O:2,S:2,SO4:2,CO3:2}
f=(x,y)-&gt;(a=if p[x]then x else y
b=if p[x]then y else x
z=p[a]==n[b]==2;r=+z||n[b];s=+z||p[a];if--r&amp;&amp;a=='NH4'then a='(NH4)'
if--s&amp;&amp;/[A-Z]{2}/.test(b)then b='('+b+')'
if'H'==a&amp;&amp;b=='OH'then'H2O'else a+(if!r then''else r+1)+b+(if!s then''else s+1))
</code></pre>
</div>
<div id="pu8" class="pu"><h2>JavaScript (ES6), <s>316</s> 277 bytes</h2>

<p><s>I've globalized the <code>p</code> and <code>n</code> variables (just like I did in CoffeeScript) for easier testing. Localizing the variables would not make a difference in character count.</s></p>

<pre class="lang-js prettyprint-override"><code>f=(x,y)=&gt;{i='indexOf',d='~NH4KNaAgLiBa~CaCuMgZnPbFeAlSO4CO3ClBrFIOHNO3',k=d[i](x),l=d[i](y),a=k&lt;28?x:y,b=k&lt;28?y:x,r=Math.ceil(k/11)-1,s=b=='F'?0:l&lt;32;if(r==s)r=s=0;a=s&amp;&amp;a=='NH4'?'(NH4)':a;b=r&amp;&amp;/[A-Z]{2}/.test(b)?`(${b})`:b;return'H'==a&amp;&amp;b=='OH'?'H2O':a+(s?s+1:'')+b+(r?r+1:'')}


// Original attempt, 316 bytes
p={H:1,Na:1,Ag:1,K:1,Li:1,NH4:1,Ba:2,Ca:2,Cu:2,Mg:2,Zn:2,Pb:2,Fe:3,Al:3},n={Cl:1,Br:1,F:1,I:1,OH:1,NO3:1,O:2,S:2,SO4:2,CO3:2},f=(x,y)=&gt;{a=p[x]?x:y,b=p[x]?y:x,z=p[a]==2&amp;&amp;n[b]==2,r=+z||n[b],s=+z||p[a];a=--r&amp;&amp;a=='NH4'?'(NH4)':a;b=--s&amp;&amp;/[A-Z]{2}/.test(b)?`(${b})`:b;return'H'==a&amp;&amp;b=='OH'?'H2O':a+(r?r+1:'')+b+(s?s+1:'')}
</code></pre>

<h3>ES5 variant, <s>323</s> 284 bytes</h3>

<p>Not much changes apart from getting rid of the arrow function and template string:</p>

<pre class="lang-js prettyprint-override"><code>f=function(x,y){i='indexOf',d='~NH4KNaAgLiBa~CaCuMgZnPbFeAlSO4CO3ClBrFIOHNO3',k=d[i](x),l=d[i](y),a=k&lt;28?x:y,b=k&lt;28?y:x,r=Math.ceil(k/11)-1,s=b=='F'?0:l&lt;32;if(r==s)r=s=0;a=s&amp;&amp;a=='NH4'?'(NH4)':a;b=r&amp;&amp;/[A-Z]{2}/.test(b)?'('+b+')':b;return'H'==a&amp;&amp;b=='OH'?'H2O':a+(s?s+1:'')+b+(r?r+1:'')}


// Original attempt, 323 bytes
p={H:1,Na:1,Ag:1,K:1,Li:1,NH4:1,Ba:2,Ca:2,Cu:2,Mg:2,Zn:2,Pb:2,Fe:3,Al:3},n={Cl:1,Br:1,F:1,I:1,OH:1,NO3:1,O:2,S:2,SO4:2,CO3:2},f=function(x,y){a=p[x]?x:y,b=p[x]?y:x,z=p[a]==2&amp;&amp;n[b]==2,r=+z||n[b],s=+z||p[a];a=--r&amp;&amp;a=='NH4'?'(NH4)':a;b=--s&amp;&amp;/[A-Z]{2}/.test(b)?'('+b+')':b;return'H'==a&amp;&amp;b=='OH'?'H2O':a+(r?r+1:'')+b+(s?s+1:'')}
</code></pre>

<p><div class="snippet" data-lang="js" data-hide="true">
<div class="snippet-code snippet-currently-hidden">
<pre class="snippet-code-js lang-js prettyprint-override"><code>f=function(x,y){i='indexOf',d='~NH4KNaAgLiBa~CaCuMgZnPbFeAlSO4CO3ClBrFIOHNO3',k=d[i](x),l=d[i](y),a=k&lt;28?x:y,b=k&lt;28?y:x,r=Math.ceil(k/11)-1,s=b=='F'?0:l&lt;32;if(r==s)r=s=0;a=s&amp;&amp;a=='NH4'?'(NH4)':a;b=r&amp;&amp;/[A-Z]{2}/.test(b)?'('+b+')':b;return'H'==a&amp;&amp;b =='OH'?'H2O':a+(s?s+1:'')+b+(r?r+1:'')}

;['H', 'Na', 'Ag', 'K', 'Li', 'NH4', 'Ba', 'Ca', 'Cu', 'Mg', 'Zn', 'Pb', 'Fe', 'Al'].forEach(function (q) {
    ['Cl', 'Br', 'F', 'I', 'OH', 'NO3', 'O', 'S', 'SO4', 'CO3'].forEach(function (w) {
        document.body.innerHTML += '&lt;p&gt;' + q + ' + ' + w + ' = ' + f(q, w);
    });
});</code></pre>
</div>
</div>
</p>
</div>
<div id="pu9" class="pu"><h1>Java (<s>619</s> <s>647</s> 667 bytes)</h1>

<p>[Fixed] Update: H + OH returns HOH even though I hard coded it not to.... working on it</p>

<p>[Fixed] Update: Sometimes Parenthesis appear when they shouldn't</p>

<p><strong>Code</strong></p>

<pre><code>String f(String[]a){if(Arrays.equals(a,new String[]{"H","OH"})|Arrays.equals(a,new String[]{"OH","H"}))return "H2O";List&lt;String&gt;b=Arrays.asList(new String[]{"H","Na","Ag","K","Li","NH4","Ba","Ca","Cu","Mg","Zn","Pb","Fe","Al","Cl","Br","F","I","OH","NO3","O","S","SO4","CO3"});Integer[]c={1,1,1,1,1,1,2,2,2,2,2,2,3,3,1,1,1,1,1,1,2,2,2,2},d={5,18,19,22,23};List&lt;Integer&gt;j=Arrays.asList(d);int e=b.indexOf(a[0]),f=b.indexOf(a[1]),g=c[e],h=c[f],i;if(f&lt;e){String p=a[0];a[0]=a[1];a[1]=p;i=g;g=h;h=i;i=e;e=f;f=i;}boolean k=j.contains(e),l=j.contains(f),m=g==h,n=g==1,o=h==1;return (k&amp;!m&amp;!o?"("+a[0]+")":a[0])+(m?"":h==1?"":h)+(l&amp;!m&amp;!n?"("+a[1]+")":a[1])+(m?"":g==1?"":g);}
</code></pre>

<p>I wasn't sure how to do this without hard coding every ions charge, so it ended up being long. Lucky cause all the charges are 1, 2, or 3 so finding the amount of each ion is easy.</p>

<p><strong>Expanded</strong></p>

<pre><code>import java.util.Arrays;
import java.util.List;
public class Compound {
    public static void main(String[]a){
        //System.out.println(f(a));
        String[] pos = new String[]{"H","Na","Ag","K","Li","NH4","Ba","Ca","Cu","Mg","Zn","Pb","Fe","Al"};
        String[] neg = new String[]{"Cl","Br","F","I","OH","NO3","O","S","SO4","CO3"};
        for(int i = 0; i &lt; pos.length; i++){
            for(int j = 0; j &lt; neg.length; j++){
                System.out.println(pos[i] + " + " + neg[j] + " = " + f(new String[]{pos[i],neg[j]}));
                System.out.println(neg[j] + " + " + pos[i] + " = " + f(new String[]{neg[j],pos[i]}));
            }
        }
    }
    static String f(String[]a){
        if(Arrays.equals(a,new String[]{"H","OH"})|Arrays.equals(a,new String[]{"OH","H"}))
            return "H2O";
        List&lt;String&gt;b=Arrays.asList(new String[]{"H","Na","Ag","K","Li","NH4","Ba","Ca","Cu","Mg","Zn","Pb","Fe","Al","Cl","Br","F","I","OH","NO3","O","S","SO4","CO3"});
        Integer[]c={1,1,1,1,1,1,2,2,2,2,2,2,3,3,1,1,1,1,1,1,2,2,2,2},d={5,18,19,22,23};
        List&lt;Integer&gt;j=Arrays.asList(d);
        int e=b.indexOf(a[0]),f=b.indexOf(a[1]),g=c[e],h=c[f],i;
        if(f&lt;e){String p=a[0];a[0]=a[1];a[1]=p;i=g;g=h;h=i;i=e;e=f;f=i;}
        boolean k=j.contains(e),l=j.contains(f),m=g==h,n=g==1,o=h==1;
        return (k&amp;!m&amp;!o?"("+a[0]+")":a[0])+(m?"":o?"":h)+(l&amp;!m&amp;!n?"("+a[1]+")":a[1])+(m?"":n?"":g);
    }
}
</code></pre>

<p><a href="http://ideone.com/RgXFkV" rel="nofollow">Try it here</a></p>

<p><strong>Data</strong></p>

<p>Let me know if any of them are wrong</p>

<pre><code>H + Cl = HCl
Cl + H = HCl
H + Br = HBr
Br + H = HBr
H + F = HF
F + H = HF
H + I = HI
I + H = HI
H + OH = H2O
OH + H = H2O
H + NO3 = HNO3
NO3 + H = HNO3
H + O = H2O
O + H = H2O
H + S = H2S
S + H = H2S
H + SO4 = H2SO4
SO4 + H = H2SO4
H + CO3 = H2CO3
CO3 + H = H2CO3
Na + Cl = NaCl
Cl + Na = NaCl
Na + Br = NaBr
Br + Na = NaBr
Na + F = NaF
F + Na = NaF
Na + I = NaI
I + Na = NaI
Na + OH = NaOH
OH + Na = NaOH
Na + NO3 = NaNO3
NO3 + Na = NaNO3
Na + O = Na2O
O + Na = Na2O
Na + S = Na2S
S + Na = Na2S
Na + SO4 = Na2SO4
SO4 + Na = Na2SO4
Na + CO3 = Na2CO3
CO3 + Na = Na2CO3
Ag + Cl = AgCl
Cl + Ag = AgCl
Ag + Br = AgBr
Br + Ag = AgBr
Ag + F = AgF
F + Ag = AgF
Ag + I = AgI
I + Ag = AgI
Ag + OH = AgOH
OH + Ag = AgOH
Ag + NO3 = AgNO3
NO3 + Ag = AgNO3
Ag + O = Ag2O
O + Ag = Ag2O
Ag + S = Ag2S
S + Ag = Ag2S
Ag + SO4 = Ag2SO4
SO4 + Ag = Ag2SO4
Ag + CO3 = Ag2CO3
CO3 + Ag = Ag2CO3
K + Cl = KCl
Cl + K = KCl
K + Br = KBr
Br + K = KBr
K + F = KF
F + K = KF
K + I = KI
I + K = KI
K + OH = KOH
OH + K = KOH
K + NO3 = KNO3
NO3 + K = KNO3
K + O = K2O
O + K = K2O
K + S = K2S
S + K = K2S
K + SO4 = K2SO4
SO4 + K = K2SO4
K + CO3 = K2CO3
CO3 + K = K2CO3
Li + Cl = LiCl
Cl + Li = LiCl
Li + Br = LiBr
Br + Li = LiBr
Li + F = LiF
F + Li = LiF
Li + I = LiI
I + Li = LiI
Li + OH = LiOH
OH + Li = LiOH
Li + NO3 = LiNO3
NO3 + Li = LiNO3
Li + O = Li2O
O + Li = Li2O
Li + S = Li2S
S + Li = Li2S
Li + SO4 = Li2SO4
SO4 + Li = Li2SO4
Li + CO3 = Li2CO3
CO3 + Li = Li2CO3
NH4 + Cl = NH4Cl
Cl + NH4 = NH4Cl
NH4 + Br = NH4Br
Br + NH4 = NH4Br
NH4 + F = NH4F
F + NH4 = NH4F
NH4 + I = NH4I
I + NH4 = NH4I
NH4 + OH = NH4OH
OH + NH4 = NH4OH
NH4 + NO3 = NH4NO3
NO3 + NH4 = NH4NO3
NH4 + O = (NH4)2O
O + NH4 = (NH4)2O
NH4 + S = (NH4)2S
S + NH4 = (NH4)2S
NH4 + SO4 = (NH4)2SO4
SO4 + NH4 = (NH4)2SO4
NH4 + CO3 = (NH4)2CO3
CO3 + NH4 = (NH4)2CO3
Ba + Cl = BaCl2
Cl + Ba = BaCl2
Ba + Br = BaBr2
Br + Ba = BaBr2
Ba + F = BaF2
F + Ba = BaF2
Ba + I = BaI2
I + Ba = BaI2
Ba + OH = Ba(OH)2
OH + Ba = Ba(OH)2
Ba + NO3 = Ba(NO3)2
NO3 + Ba = Ba(NO3)2
Ba + O = BaO
O + Ba = BaO
Ba + S = BaS
S + Ba = BaS
Ba + SO4 = BaSO4
SO4 + Ba = BaSO4
Ba + CO3 = BaCO3
CO3 + Ba = BaCO3
Ca + Cl = CaCl2
Cl + Ca = CaCl2
Ca + Br = CaBr2
Br + Ca = CaBr2
Ca + F = CaF2
F + Ca = CaF2
Ca + I = CaI2
I + Ca = CaI2
Ca + OH = Ca(OH)2
OH + Ca = Ca(OH)2
Ca + NO3 = Ca(NO3)2
NO3 + Ca = Ca(NO3)2
Ca + O = CaO
O + Ca = CaO
Ca + S = CaS
S + Ca = CaS
Ca + SO4 = CaSO4
SO4 + Ca = CaSO4
Ca + CO3 = CaCO3
CO3 + Ca = CaCO3
Cu + Cl = CuCl2
Cl + Cu = CuCl2
Cu + Br = CuBr2
Br + Cu = CuBr2
Cu + F = CuF2
F + Cu = CuF2
Cu + I = CuI2
I + Cu = CuI2
Cu + OH = Cu(OH)2
OH + Cu = Cu(OH)2
Cu + NO3 = Cu(NO3)2
NO3 + Cu = Cu(NO3)2
Cu + O = CuO
O + Cu = CuO
Cu + S = CuS
S + Cu = CuS
Cu + SO4 = CuSO4
SO4 + Cu = CuSO4
Cu + CO3 = CuCO3
CO3 + Cu = CuCO3
Mg + Cl = MgCl2
Cl + Mg = MgCl2
Mg + Br = MgBr2
Br + Mg = MgBr2
Mg + F = MgF2
F + Mg = MgF2
Mg + I = MgI2
I + Mg = MgI2
Mg + OH = Mg(OH)2
OH + Mg = Mg(OH)2
Mg + NO3 = Mg(NO3)2
NO3 + Mg = Mg(NO3)2
Mg + O = MgO
O + Mg = MgO
Mg + S = MgS
S + Mg = MgS
Mg + SO4 = MgSO4
SO4 + Mg = MgSO4
Mg + CO3 = MgCO3
CO3 + Mg = MgCO3
Zn + Cl = ZnCl2
Cl + Zn = ZnCl2
Zn + Br = ZnBr2
Br + Zn = ZnBr2
Zn + F = ZnF2
F + Zn = ZnF2
Zn + I = ZnI2
I + Zn = ZnI2
Zn + OH = Zn(OH)2
OH + Zn = Zn(OH)2
Zn + NO3 = Zn(NO3)2
NO3 + Zn = Zn(NO3)2
Zn + O = ZnO
O + Zn = ZnO
Zn + S = ZnS
S + Zn = ZnS
Zn + SO4 = ZnSO4
SO4 + Zn = ZnSO4
Zn + CO3 = ZnCO3
CO3 + Zn = ZnCO3
Pb + Cl = PbCl2
Cl + Pb = PbCl2
Pb + Br = PbBr2
Br + Pb = PbBr2
Pb + F = PbF2
F + Pb = PbF2
Pb + I = PbI2
I + Pb = PbI2
Pb + OH = Pb(OH)2
OH + Pb = Pb(OH)2
Pb + NO3 = Pb(NO3)2
NO3 + Pb = Pb(NO3)2
Pb + O = PbO
O + Pb = PbO
Pb + S = PbS
S + Pb = PbS
Pb + SO4 = PbSO4
SO4 + Pb = PbSO4
Pb + CO3 = PbCO3
CO3 + Pb = PbCO3
Fe + Cl = FeCl3
Cl + Fe = FeCl3
Fe + Br = FeBr3
Br + Fe = FeBr3
Fe + F = FeF3
F + Fe = FeF3
Fe + I = FeI3
I + Fe = FeI3
Fe + OH = Fe(OH)3
OH + Fe = Fe(OH)3
Fe + NO3 = Fe(NO3)3
NO3 + Fe = Fe(NO3)3
Fe + O = Fe2O3
O + Fe = Fe2O3
Fe + S = Fe2S3
S + Fe = Fe2S3
Fe + SO4 = Fe2(SO4)3
SO4 + Fe = Fe2(SO4)3
Fe + CO3 = Fe2(CO3)3
CO3 + Fe = Fe2(CO3)3
Al + Cl = AlCl3
Cl + Al = AlCl3
Al + Br = AlBr3
Br + Al = AlBr3
Al + F = AlF3
F + Al = AlF3
Al + I = AlI3
I + Al = AlI3
Al + OH = Al(OH)3
OH + Al = Al(OH)3
Al + NO3 = Al(NO3)3
NO3 + Al = Al(NO3)3
Al + O = Al2O3
O + Al = Al2O3
Al + S = Al2S3
S + Al = Al2S3
Al + SO4 = Al2(SO4)3
SO4 + Al = Al2(SO4)3
Al + CO3 = Al2(CO3)3
CO3 + Al = Al2(CO3)3
</code></pre>

<p><strong>Note</strong></p>

<p>I started in Pyth, but then I got annoyed with the order and the parenthesis, <a href="https://pyth.herokuapp.com/?code=%3DG%5B%22H%22+%22Na%22+%22Ag%22+%22K%22+%22Li%22+%22NH4%22+%22Ba%22+%22Ca%22+%22Cu%22+%22Mg%22+%22Zn%22+%22Pb%22+%22Fe%22+%22Al%22+%22Cl%22+%22Br%22+%22F%22+%22I%22+%22OH%22+%22NO3%22+%22O%22+%22S%22+%22SO4%22+%22CO3%22+1+1+1+1+1+1+2+2+2+2+2+2+3+3+1+1+1+1+1+1+2+2+2+2)J%40G%2B24xG%40QZK%40G%2B24xG%40Q1%40QZ%3FkqJKK%40Q1%3FkqJKJ&amp;input=%22Al%22%2C%22SO4%22&amp;debug=1" rel="nofollow">here</a> is what I had if anyone wants to finish it.</p>

<pre><code>=G["H" "Na" "Ag" "K" "Li" "NH4" "Ba" "Ca" "Cu" "Mg" "Zn" "Pb" "Fe" "Al" "Cl" "Br" "F" "I" "OH" "NO3" "O" "S" "SO4" "CO3" 1 1 1 1 1 1 2 2 2 2 2 2 3 3 1 1 1 1 1 1 2 2 2 2)J@G+24xG@QZK@G+24xG@Q1@QZ?kqJKK@Q1?kqJKJ
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/52189/">52189</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




