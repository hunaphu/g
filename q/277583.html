<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::277583</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>155</td><td>Charcoal</td><td>250111T225535Z</td><td><a href="https://codegolf.stackexchange.com/questions/277583/galton-board-optimization/277599#277599">Neil</a></td></tr>
<tr d-ix="1"><td>653</td><td>Python3</td><td>250112T160413Z</td><td><a href="https://codegolf.stackexchange.com/questions/277583/galton-board-optimization/277606#277606">Ajax1234</a></td></tr>
<tr d-ix="2"><td>129</td><td>JavaScript ES6</td><td>250111T132901Z</td><td><a href="https://codegolf.stackexchange.com/questions/277583/galton-board-optimization/277588#277588">Arnauld</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 155 bytes</h1>
<pre><code>≔⟦⟦⟦⁰⟧⟧⟧θＦ⊖Ｎ«≔⟦⟧ηＦθ«⊞ηＥκ⎇⁼⊕μＬκ⁺λ⟦⊕⌈λ⟧λＦ§κ±¹⊞η⁺κ⟦⟦λ⟧⟧»≔ηθ»Ｆθ«≔⟦⟧ηＦι«≔⟦⟧ζＦ⊕⌈Ｅι⌈λ⊞ζＥ∨⁺∧η§§η±¹λ∧ζ§ζ±¹⟦⟦¹¦⁰⟧⟧⎇№κλ⁺§μ⁰μ⟦¹§μ¹⟧⊞ηζ»ＵＭηＥκ∕ΣＥμ⊟ξＸ²⊕⁺λν⊞υΣ⁺Ｅη↨κ⁰⊟η»Ｉ⌈υ
</code></pre>
<p><a href="https://tio.run/##bVKxboMwFJzDV3i0JVcKXTulSYdITYrUbojBDW5AsU1icJpS5dvpeyYGKmUy8ru7d3dmVwi7q4TqukVdl3tD0zSdZ1nGyYk9RV@VJXQld1ZqaRqZ07U5umbr9Ke0lDFGfqNZ4AGlAMrMc05@NEtcXdCCk4040gMnH9IaYX/oy8kJVYPYKKwZJ6/S7JuCHhh8J8rVVHGSTkEbcSm101QxlgEGDlzYb1w0a5PLC67Zyr1oJI3RYHDg9WCWpirLPO06WC/6sNdoYv1uqrJPNZm1o4F7RjF3ifEH34Ontm/lzVJvbWFy9BFShLOYpvGJAQPQdoS2/wIzjBhzAm/IxsKXlTMNxleh2sDWAIU7rB9pk@sYOu77DR22t9rA97LSWvSWb2@7Ks9lLun7LTUIJNWRXryjpPqG/@WRk2lH4YWNLwWl/R7HCWr4KQrBhmdRS1wx77XgzuOvUWJLiLUUdTM07nDUdfG8ezirPw" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Slow, so can only reach <code>k=10</code> on TIO. Explanation: Assumes all solutions have the following properties: a) the topmost peg is blue b) all forward diagonals only contain one run of blue pegs c) no blue peg lies below two red pegs.</p>
<pre><code>≔⟦⟦⟦⁰⟧⟧⟧θ
</code></pre>
<p>Start with a blue topmost peg.</p>
<pre><code>Ｆ⊖Ｎ«
</code></pre>
<p>Repeat for each additional peg.</p>
<pre><code>≔⟦⟧η
</code></pre>
<p>Start building a new list of layouts.</p>
<pre><code>Ｆθ«
</code></pre>
<p>Loop over the old list of layouts.</p>
<pre><code>⊞ηＥκ⎇⁼⊕μＬκ⁺λ⟦⊕⌈λ⟧λ
</code></pre>
<p>Create a new layout with a peg appended to the last forward diagonal.</p>
<pre><code>Ｆ§κ±¹⊞η⁺κ⟦⟦λ⟧⟧
</code></pre>
<p>Create layouts with a new forward diagonal starting at each valid position according to property c) above.</p>
<pre><code>»≔ηθ
</code></pre>
<p>Save the new list of layouts.</p>
<pre><code>»Ｆθ«
</code></pre>
<p>Loop over the list of layouts with <code>k</code> pegs.</p>
<pre><code>≔⟦⟧η
</code></pre>
<p>Start building up an array of ball values and scores.</p>
<pre><code>Ｆι«
</code></pre>
<p>Loop over each forward diagonal of the layout.</p>
<pre><code>≔⟦⟧ζ
</code></pre>
<p>Start building up a list of ball values and scores for this diagonal.</p>
<pre><code>Ｆ⊕⌈Ｅι⌈λ
</code></pre>
<p>Loop over enough reverse diagonals to cover all possible routes though blue pegs.</p>
<pre><code>⊞ζＥ∨⁺∧η§§η±¹λ∧ζ§ζ±¹⟦⟦¹¦⁰⟧⟧⎇№κλ⁺§μ⁰μ⟦¹§μ¹⟧
</code></pre>
<p>For each route to this peg, calculate the new ball value and score, and save those values to the list.</p>
<pre><code>⊞ηζ
</code></pre>
<p>Save the list of ball values and scores to the array.</p>
<pre><code>»ＵＭηＥκ∕ΣＥμ⊟ξＸ²⊕⁺λν
</code></pre>
<p>For each peg, calculate half of the expected value of routes that reach the peg, taking the chance of reaching the peg into account.</p>
<pre><code>⊞υΣ⁺Ｅη↨κ⁰⊟η
</code></pre>
<p>For each peg on the rightmost side of the array, there is a 50% chance of the ball bouncing out of the array, in which case the expected value of balls leaving the array is half of the peg's expected value, and similarly for each peg on the bottom row of the array, except for the bottom rightmost peg, which is simply scored twice. Save the resulting total score for all exits from the array.</p>
<pre><code>»Ｉ⌈υ
</code></pre>
<p>Output the maximum possible score.</p>
<p>Additionally assuming that the centre column is only composed of blue pegs (at least as far down as the pegs reach) increases the speed allowing <code>k=14</code> on TIO. <a href="https://tio.run/##dZPBctowEIbP8BQan6QZdwbanJoTJU0nmZIyKTfXBwUUrEGSQZYIpZNnJ7uSZcw0uSCs3f3332/tZcXtsubqdJo0jVwbWhTFqCzLnOzY9fC5toTeiKUVWhgnVvTObL178PpJWMoYI/@Gg1QHJRWUDELNLoTi/1upHKRP3J1ZiQPd5ORBrLkTdMxYTn6KpqEKT7N2Fd0wlJ37pqJVTubKN1hQFKosGaoP5DOhP6zgKHnVlb0r3lea8S0GF8Iabv/S7zvPVQPjnEfTrG@i7Q3Gin7SjB@k9poqxkrIgQNNvXYUqsjtddg@t7PvcjJRisqcTGtvHMpqhk06yLuPWcrIshc7BhIh@J45nFXiyJ3XjsQxkvhlaRhvYlZoOdFLZ3W5IoU/mHo8px4vQQMm1P0Mt7UDlIFOgh1n3qBQizWp6JyMGLKA@vFZHK7HoBAXnjZ4bElDn2mtNY/W273eyL1cCfq7nR4E5vWWHoKzef0CKwBrfVZpuybAQenQx@cENUIUhaDDN94IbDGKWnAX8rsVJ9Ow41sJpvyZvA/9cZMzr5zcWgkcvt7UL@ZRriuXk/taGvoo9sJCD@z30Tp730K6liyCX0gtGprZ7HJAGaPZH5Oh3fl/vfuyPY2ZNEkeWDgoW7fvU/aURVT3Xm8XNf2CTJLylDeO9ue@Pp3GV6dPe/UG" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. This version also includes a diagram of the pegs (but using <code>b</code> and <code>r</code> for blue and red instead of <code>1</code> and <code>0</code>).</p>
</div>
<div id="pu1" class="pu"><h1>Python3, 653 bytes</h1>
<pre class="lang-py prettyprint-override"><code>from itertools import*
E=enumerate
P=lambda n,k:[0]*int((len(n)-len(k))/2)
def f(k):
 F=[]
 for i in range(1,k+1):
  if sum(map(len,t:=[[1]*j for j in range(1,i+1)]))&gt;=k:
   L=count()
   D={next(L):(x,y)for x,r in E(t)for y,_ in E(r)}
   for l in combinations(D,k):
    T=eval(str(t))
    for u in l:X,Y=D[u];T[X][Y]=2
    T=[[*map(int,'0'.join(map(str,k)))]for k in T];T=[P(T[-1],k)+k+P(T[-1],k)for k in T]
    q,R=[(1,0,0,T[0].index(2)if 2 in T[0]else T[0].index(1))],[]
    for b,e,x,y in q:
     if x==len(T):R+=[e];continue
     B,V=[1,b*2][T[x][y]==2],[e,e+b][T[x][y]==2]
     q+=[(B,V,x+1,y+1),(B,V,x+1,y-1)]
    F+=[sum(R)/len(R)]
 return max(F)
</code></pre>
<p><a href="https://tio.run/##VZJRb5swEMff@RR@qw1OG@g2TVTew5TmqQ9VhKZWljVBYjYHsIkxE9G0z57dkW1l8MDd@X7/893Rn8N3Z@8/9v5yqb3riAnaB@fagZiudz7E0aPQduy0L4OOnkVbdtWhJJY3uVyr2NhAaasttWyFn4axu4xFB12TGpw8IlshVURq54khxhJf2m@aprxJUjwlpibD2NGu7FGGh1xImar4OBPHJWGAUIx9Eg1y5Ens3QjVGTob8dPqKdAnltOJnxnCE/eIP9Iwu2f@9ep69gsRjLUY2buuMrYMxtmBbvh8aXgKoX@ULR2CB4G5yIyMiLT5C38VGzmqh0K@KPmqRPYHkjLGXmAu/GZ9c3t0xs7NgQ5IM6ZQpEGRAmAhn2khV6mCs6RJ3pxF1ix84jshYQhreAsY/K2xBz3RjMH8sjkPgrodNFmcplCOS/Xv7hXXHKaD6adrkzj@SQjcXMHyXSKkVg97Z4Oxo75mfOZfhEx5FWdKFnJS8qyEyEBXc51U/8WuwAlUKFB8SlJ@hqXxN28FK5yztpCEe9@xOyy@w7DXYfSWdOVEt@zSe/y3amwi@mtnC/t@Yb9b2O8X9gfGLr8B" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu2" class="pu"><h1>JavaScript (ES6), 129 bytes</h1>
<p>Returns a floating point number.</p>
<p>This assumes that the best score is always achieved by putting either 1 or 2 blue pegs as close as possible to the central column.</p>
<pre class="lang-none prettyprint-override"><code>f=(n,m,r)=&gt;m&gt;&gt;n?r:f(n,-~m,(g=(x,v=1,y=0,b=n,q=m&gt;&gt;y&amp;b&gt;1)=&gt;s=b&amp;&amp;(g(x-=y&amp;1,v=x+q&amp;&amp;x?1:v*2,++y,b+=~q)+g(x+1,v,y,b)+v-v%2)/2)``&lt;r?r:s)
</code></pre>
<p><a href="https://tio.run/##XY9NbsIwEIX3nGIWEM3EDtRZAg6LtuoBuEBsEiIqcMCxokQRXD0dt7uu5um9b/6@TW@6k7/cQ@baqp7ns0Ynb9KTLm5F4Q5@e2Yje90kNhoH2WslR/0mrXbyoRkZE1sopjttkwQbHDI9Joq5QTySZDiobZ/mUohRWqFfDxKMCM4lGyT6rF/ltMmpLPeel3U0n1rXBfh6/wANaCRYAl2AhUP00EowsIrmFszi3Hq81gEcs2rHZc81ZyEEwbQAiKGvO475DZJQscohTQEdZKDYadiJgyOVQsUI7bgxXtFe6/W1bbA0uJzcOrTH4C@uQVrfTXUMxgfM6cnnwXLi9n/Ap6tQcQ74m8bhsIHmuVlOf4JK3vScfwA" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Full output</h3>
<p>You can use <a href="https://tio.run/##XY5BboMwEEX3PcUsEjTGJqmRugkMWbRVD5ALYAJBqRKTGBcFIXp1Om53Xc3Xf39m/qcZTH9055tPbFc3y4kWS8V06hw6elZX0nlus2uSZAJbwocaSKuRSUVW3elaFGNUFVpQ0VMVRdjiI6Ex0px7yHsUPfZ6N8SpknJUlaTvu5AckcwVG0IOybBOxTYVZZm7vds56jPX@C9nwc3LsbO9h4/XNyBAo6ASQAVUsA8eVgoMrIO5A/MUKl8aD5azOuOR83xhIaWA6QkgQNf0jE9ohYKaVQpxDGghAc1Oy044HFIx1BwRGS@GFt2l2Vy6FkuDq8lufHfw7mxbFJubqQ/eOI@pmLkerCZe/xd4tzVq5oC/NByHLbTzdjX9CVHyp3n5AQ" rel="nofollow noreferrer">this version</a> (less recursive but otherwise identical) to get all answers up to <span class="math-container">\$n=15\$</span>:</p>
<pre><code>a( 1) = 1            (1/1)
a( 2) = 2            (2/1)
a( 3) = 3.25         (13/4)
a( 4) = 5            (5/1)
a( 5) = 7.125        (57/8)
a( 6) = 9.4375       (151/16)
a( 7) = 13.5         (27/2)
a( 8) = 17.875       (143/8)
a( 9) = 22.40625     (717/32)
a(10) = 31           (31/1)
a(11) = 39.8671875   (5103/128)
a(12) = 48.87109375  (12511/256)
a(13) = 66.46875     (2127/32)
a(14) = 84.3125      (1349/16)
a(15) = 103          (103/1)
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/277583/">277583</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




