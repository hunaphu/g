<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::207711</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>070</td><td>Dyalog APL</td><td>250808T195753Z</td><td><a href="https://codegolf.stackexchange.com/questions/207711/where-will-the-gem-picking-robot-end-up/283040#283040">Aaron</a></td></tr>
<tr d-ix="1"><td>243</td><td>C gcc</td><td>200729T153200Z</td><td><a href="https://codegolf.stackexchange.com/questions/207711/where-will-the-gem-picking-robot-end-up/207812#207812">Noodle9</a></td></tr>
<tr d-ix="2"><td>198</td><td>Python 2</td><td>200728T003326Z</td><td><a href="https://codegolf.stackexchange.com/questions/207711/where-will-the-gem-picking-robot-end-up/207716#207716">fireflam</a></td></tr>
<tr d-ix="3"><td>130</td><td>JavaScript ES7</td><td>200728T075629Z</td><td><a href="https://codegolf.stackexchange.com/questions/207711/where-will-the-gem-picking-robot-end-up/207722#207722">Arnauld</a></td></tr>
<tr d-ix="4"><td>109</td><td>J</td><td>200728T135634Z</td><td><a href="https://codegolf.stackexchange.com/questions/207711/where-will-the-gem-picking-robot-end-up/207734#207734">xash</a></td></tr>
<tr d-ix="5"><td>070</td><td>Charcoal</td><td>200727T235410Z</td><td><a href="https://codegolf.stackexchange.com/questions/207711/where-will-the-gem-picking-robot-end-up/207713#207713">Neil</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Dyalog APL, 70 chars</h1>
<pre><code>{(⍸0=⍵)(⍺{1≠≢n←c/⍨⊃{(∨/¨⍵)/⍵}⍺⍺=⊂⍵[c←⍸⍺{1=+/|⍺-⍵}¨⍳⍴⍵]:⍺⋄n∇-∘1@n⊢⍵})⍵}
</code></pre>
<p>Tied Charcoal, yusssss.  Takes robot's program on the left and the grid on the right.</p>
<pre><code>{(⍸0=⍵)(⍺{1≠≢n←c/⍨⊃{(∨/¨⍵)/⍵}⍺⍺=⊂⍵[c←⍸⍺{1=+/|⍺-⍵}¨⍳⍴⍵]:⍺⋄n∇-∘1@n⊢⍵})⍵}­⁡​‎‎⁪⁡⁪⁠⁪⁢⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁡⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁡⁤⁪‏‏​⁡⁠⁡‌⁢​‎‎⁪⁡⁪⁠⁪⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁢⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁢⁢⁪‏‏​⁡⁠⁡‌⁣​‎‎⁪⁡⁪⁠⁪⁣⁢⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁢⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁡⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁡⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁡⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁡⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁢⁡⁪‏‏​⁡⁠⁡‌⁤​‎‎⁪⁡⁪⁠⁪⁣⁣⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁣⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁣⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁣⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁤⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁤⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁤⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁤⁤⁪‏‏​⁡⁠⁡‌⁢⁡​‎‎⁪⁡⁪⁠⁪⁣⁡⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁢⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁢⁢⁪‏‏​⁡⁠⁡‌⁢⁢​‎⁪⁪⁠‎⁪⁡⁪⁠⁪⁣⁡⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁡⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁢⁢⁪‏‏​⁡⁠⁡‌⁢⁣​‎⁪⁪⁠‎⁪⁡⁪⁠⁪⁢⁤⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁤⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁤⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁡⁡⁪‏‏​⁡⁠⁡‌⁢⁤​‎‎⁪⁡⁪⁠⁪⁢⁡⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁢⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁢⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁢⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁢⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁣⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁣⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁣⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁣⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁤⁡⁪‏‏​⁡⁠⁡‌⁣⁡​‎‎⁪⁡⁪⁠⁪⁤⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁣⁪‏‏​⁡⁠⁡‌⁣⁢​‎‎⁪⁡⁪⁠⁪⁤⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁣⁪‏‏​⁡⁠⁡‌⁣⁣​‎‎⁪⁡⁪⁠⁪⁣⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁣⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁢⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁢⁤⁪‏‏​⁡⁠⁡‌⁣⁤​‎‎⁪⁡⁪⁠⁪⁤⁣⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁣⁣⁪‏‏​⁡⁠⁡‌⁤⁡​‎‎⁪⁡⁪⁠⁪⁤⁣⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁤⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁤⁢⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁤⁣⁪‏⁠‎⁪⁡⁪⁠⁪⁤⁤⁤⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁡⁡⁪‏⁠‎⁪⁡⁪⁠⁪⁢⁡⁡⁢⁪‏‏​⁡⁠⁡‌­
       (⍺{                                                        })    # ‎⁡Binds the original left arg as the left operand of this inner function
{(⍸0=⍵)                                                             ⍵}  # ‎⁢Find index of 0 in input which will become of the left argument of the inner function
                                      ⍺{        }¨⍳⍴⍵                   # ‎⁣For each of the indices of input matrix
                                        1=+/|⍺-⍵                        # ‎⁤Find if the sum of the absolute difference of their indices from the left arg equals 1 (orthogonal neighbor)
                                   c←⍸                                  # ‎⁢⁡Find which indices those correspond to and store in c
                                 ⍵[                  ]                  # ‎⁢⁢Select those from the original input (the number of gems)
                             ⍺⍺=⊂                                       # ‎⁢⁣See where each of those is equal to one of the elements of the robot's program
                   {(∨/¨⍵)/⍵}                                           # ‎⁢⁤Filter out any empty ones
               c/⍨⊃                                                     # ‎⁣⁡And take it from the set of coordinates saved earlier so we know where to send the robot
             n←                                                         # ‎⁣⁢Save that in n (new location)
          1≠≢                                         :⍺                # ‎⁣⁣And while I'm here, check if the length is 1.  If its not, return the left argument (the robot's position) because we cannot move again
                                                         n∇             # ‎⁣⁤Call this function again with the left argument the new location and
                                                           -∘1@n⊢⍵      # ‎⁤⁡the right argument as the original input subtracting 1 gem from the location we're moving to
💎
</code></pre>
<p>Created with the help of <a href="https://vyxal.github.io/Luminespire" rel="nofollow noreferrer">Luminespire</a>.</p>
</div>
<div id="pu1" class="pu"><h1><a href="https://gcc.gnu.org/" rel="nofollow noreferrer">C (gcc)</a>, <sup><s>289</s> <span class="math-container">\$\cdots\$</span> <s>246</s></sup> 243 bytes</h1>
<p>Saved a whopping <s>37</s> <s>41</s> <s>43</s> 46 bytes thanks to <a href="https://codegolf.stackexchange.com/users/52904/ceilingcat">ceilingcat</a>!!!</p>

<pre class="lang-c prettyprint-override"><code>q;c;v;s;d;i;b;u;r;f(g,e,w,p,n)int*g,*p;{r=wcslen(g);for(c=d=0;c-n&amp;&amp;!d;!d&amp;c&lt;n&amp;&amp;--g[r=s])for(c=n,b=4;b--;d=v?q&lt;c?c=q,s=u,0:q&gt;c?d:1:d)for(i=~-(b&amp;2)*(b&amp;1?1:w),v=g[u=r+i]*(u&gt;=0&amp;u&lt;e)*(r%w|~i&amp;&amp;r%w-w+1|i-1),q=0,i=n;i--;)q+=v-p[i]?0:i;*g=r/w;g[1]=r%w;}
</code></pre>
<p><a href="https://tio.run/##rVVdb5swFH3Pr3CRgoAYFUi6qThuHqZpr9NeaTQ1hjBHlDgmCdHa9K9nlw8DCWxPizC@@Jz7wXG4ZnbM2OWyI4wcSUZCwsmKHIgkayPGEc6xwKnJ070VY0uQN0lzliVRasQmWW@lwWhIHcLsVNfvQnIX6mwOpm3HgaTZ0qwoKV7RGVnZNgnpcbGbswWjO5zRA3b83RNbhL7rhyWX0w/bWOmeacHdXbh@buIjjYMDlRO@tIzDE3X0wzwCXI7z9w@u6zDb@cR957Zr4h11MKcp4ZDL3E3o0RYBXy4cnxMrpvI@J3HgLin4kPNFSHgvo3g3lGAEM2LVJE30NkLwg5JQQUAcUeQQmOaIETSZcMW4Ym0q1gZYsmBtTFTmWBvaOBuHGkabhYY0XwMrCbgl0QRtliZpIin2c6rVq@fReVSEfn3hqWGOqqTFwj7K9j9jJ1hCzjcHI@TBcGFM66Gey7UzuXF0W0dFntbkWTF6Dl7r0M3i3mTzeo7TyrGbwevM3QquSlZ2L@DsvwW06ohZFbGWFCuJlOEpY6qMnjx5FQEIn3GR6QGuW05ScR5LDtzdh2LcsoTThIICenKKeuNgk7wyU08f4f07QL0fbundh2eNt4cHtBJdrYTSSiithNJKKK1ET6u0yTArayiuDic6iei0j8JKh7JQbwB2axhK@DQAezXsDXtP2@BDuWctfCWBwmu4KRW3ZbWm15rT1lRysF8v0kKy0kJ7Pn31nk@PX2A8QHPoPk818LjpRmkYneqOVJpzlPHf0XZtqCzmfb1gNStl2yrY3dZVvlUModSHUDKWpEtAKFGEZBjPFZ4P4RYSChd/SZAqQjocIAK80f6WoZrmN8lDv@2cDQTnGEruc4zygU77XW5j@fLqo76bKD@gtLNeHIlJfSRevwHbShmxPZQZBw5sKZRbzLqOivOmenYHav4RZYdk76NxiGGgcQb14zIGLj0x/EPq2EPnhD38uzo@Ln8A" rel="nofollow noreferrer" title="C (gcc) – Try It Online">Try it online!</a></p>
<p>Inputs the grid as a flat array, the length of that array, the grid width, the program as an array of integers and the length of the program.<br />
Returns the robot's final position (as zero-based row and column) by storing them in the first two positions of the grid.</p>
<p><strong>Before golfing</strong></p>
<pre class="lang-c prettyprint-override"><code>new_rank;current_rank;new_value;current_pos;has_doubled;i;news_bits;new_pos;robot_pos;
f(grid,grid_end,grid_width,prog,prog_end)int*grid,*prog;{
    for(robot_pos=0;grid[robot_pos];++robot_pos);
    for(current_rank=has_doubled=0; current_rank!=prog_end &amp;&amp; has_doubled == 0;) {
        for(current_rank=prog_end,news_bits=0; news_bits&lt;4; ++news_bits) {
            i = (news_bits&amp;2 - 1)*(news_bits&amp;1?1:grid_width);
            new_pos = robot_pos + i;
            new_value = new_pos &gt;= 0 &amp;&amp; new_pos &lt; grid_end?grid[new_pos]:0;
            if((robot_pos%grid_width == 0 &amp;&amp; i == -1) ||
               (robot_pos%grid_width == grid_width-1 &amp;&amp; i == 1))
                new_value = 0;
            for(i = 0; i &lt; prog_end; ++i)
                if(new_value == prog[i])
                    new_rank = i;
            if(new_value &gt; 0 &amp;&amp; new_rank == current_rank) {
                has_doubled = 1;
            }
            if(new_value &gt; 0 &amp;&amp; new_rank &lt; current_rank) {
                current_rank = new_rank;
                current_pos = new_pos;
                has_doubled = 0;
            }
        }
        if (has_doubled == 0 &amp;&amp; current_rank &lt; prog_end) {
            robot_pos = current_pos;
            --grid[robot_pos];
        }
    }
    grid[0]=robot_pos/grid_width;
    grid[1]=robot_pos%grid_width;
}
</code></pre>
</div>
<div id="pu2" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a>, <s>205</s> 198 bytes</h1>

<pre class="lang-python prettyprint-override"><code>def s(g,w,r):
 p=g.index(0)
 while 1:
    a=[((r+[0]).index(v),n)for n,v in enumerate(g)if(abs(n-p)in[1,w])&gt;(p-n)%w*(p/w!=n/w)];m,n=min(a)
    if~-sum(k[0]==m&lt;len(r)for k in a):return p/w,p%w
    p=n;g[p]-=1
</code></pre>
<p><em>-6 bytes thanks to @ovs</em></p>
<p><em>-1 byte thanks to @user202729</em></p>
<p><a href="https://tio.run/##tZJRa9swFIWfo1@hGgr3btdrZGcUnKkwygaDvYU9GT@ojeyIxqqwnbrdw/56JtlJ6q3ty2AyyJJ173eOzHFP3ebeJvv9Wpe8hYp6ajBj3Mnqg7Fr/QhzZLzfmK3mImMzJXOA5n0@L/Bw/oBksbxvuKUHbizXdlfrRnUaKjQlqJsWbOzQ2FxQX@AVuNjief8O3EV/Ju1Fj8WyJitrY0Ehm5nyV9zuarjzGlLWn7baQjMI3AW8wqzR3a6x3PeTO@/ZzEm7rHJXxFLsb1WrWy55zrgfMMxh5HNKSFDqn/D2q4JOh@mryzz1ZcmkDBJKcdghvcQHcOhY0GLSI56XlxP0YiyewgVdvg0fnYuD@@QfvKdvex99D2Aa73H4RWF@XerjRGpwNSnzvEXxf6SG6/8plRykWMFCRirahAiTfnT6ttPrEJkhE9lQ5nw0jikfPzTGdqeuSF5F5Ea@KbmyT6Bjwc8kVzzQFekA/GkcOOJHDcTs5GjkRV8/f/u@PBVkEXE4bnysY/HcnAu/Hb3obav/IkG0@nF9/WW1ipDtfwM" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>
<p>Take the input grid as a flattened list with width also passed. Outputs 0-indexed (x,y) coordinates of the final position (I doubt index in the flattened list would be acceptable).</p>
<h3>Explanation:</h3>
<pre class="lang-python prettyprint-override"><code># Function of flattened grid g, width w, pRiorities r
def s(g,w,r):
    # starting position p
    p = g.index(0)
    while 1:
        a = [
            # pair (priority rank of the cell, cell id)
            # priority rank is n for v=0
            ((r+[0]).index(v),n)
            # for each adjacent cell id n with v gems
            for n,v in enumerate(g) if abs(n-p) in [1,w] and (p%w==n%w or p/w==n/w)
        ];
        # min comparison is done by tuple, so it selects one with minimum priority rank
        # m = min priority rank; n = corresponding cell id
        m,n = min(a)
        if sum( # how many adjacent cells
            k[0]==m # have priority rank equal to m
            &lt;len(r) # and the cell value is not 0
            for k in a
        ) ^ 1: # If this count is not 1, then the robot is stuck; return
            return(p/w, p%w)
        # Otherwise, continue with updated position,
        p = n;
        # and take one gem
        g[p] -= 1
</code></pre>
</div>
<div id="pu3" class="pu"><h1>JavaScript (ES7), <s> 142 </s> 130 bytes</h1>
<p>Expects <code>(program)(matrix)</code>, with highest precedence coming first for the program. Returns <code>[column, row]</code>, both 0-indexed.</p>

<pre class="lang-javascript prettyprint-override"><code>p=&gt;m=&gt;(g=(a,X,Y)=&gt;a.some(k=&gt;m.map((r,y)=&gt;r.map((v,x)=&gt;(X-x)**2+(Y-y)**2-1|v^k||(H=x,V=y,n--)),n=1)|!n)?g(p,H,V,m[V][H]--):[X,Y])``
</code></pre>
<p><a href="https://tio.run/##fVDRaoNAEHzPV1zf9tI96WmeAmdf/QJJOK7kSI20iXeiRRT8d7vRYivSwLHczO7MDvtpG1ufq4/ySzj/ng0XNZQqLlQMuQKLBzxyFdug9kUGV2oEhS0BKuyIribQYEsADqLl2234DEfR3T9C9s3bte8hUS2mqkMnBOfolOT9k@OvOZSYYIqFTo1ODDX3mtYZfjoNZ@9qf8uCm89hw9gFdIRMIgsNJwiaCmOavRBDPDP4Q9AUvfCXkKMsYoYwaflm7bwbTe7@K/NobiGjsd0jm/8CTuv/BFwS4SR75CynIEvnOdfyAITm3OszjFXOu4Zv" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Commented</h3>
<pre class="lang-javascript prettyprint-override"><code>p =&gt; m =&gt; (             // p[] = program, m[] = matrix
g = (                   // g is a recursive function taking:
  a,                    //   a[] = list of possible neighbor values,
                        //         from most to least preferred
  X, Y                  //   (X, Y) = current position
) =&gt;                    //
  a.some(k =&gt;           // for each value k in a[]:
    m.map((r, y) =&gt;     //   for each row r[] at position y in m[]:
      r.map((v, x) =&gt;   //     for each value v in r[]:
        (X - x) ** 2 +  //       compute the squared distance
        (Y - y) ** 2    //       between (X, Y) and (x, y)
        - 1 |           //       abort if it's not equal to 1
        v ^ k ||        //       or v is not equal to k
        (               //       otherwise:
          H = x, V = y, //         save (x, y) in (H, V)
          n--           //         decrement n
        )               //
      ),                //     end of inner map()
      n = 1             //     start with n = 1
    )                   //   end of outer map()
    | !n                //   yield a truthy value if n = 0
  ) ?                   // end of some(); if truthy:
    g(                  //   do a recursive call to g:
      p,                //     using a[] = p[]
      H, V,             //     using (X, Y) = (H, V)
      m[V][H]--         //     decrement the cell at (H, V)
    )                   //   end of recursive call
  :                     // else:
    [ X, Y ]            //   we're stuck: return (X, Y)
)``                     // initial call to g with a[] = ['']
</code></pre>
<p>Because <code>g</code> is first called with <code>a = ['']</code> and both <code>X</code> and <code>Y</code> undefined, the test on the squared distance is disabled (because it's always NaN'ish) and <code>v ^ k</code> is equal to <code>0</code> only if <code>v == 0</code>. So the first recursive call is triggered on the <code>0</code> cell as expected.</p>
</div>
<div id="pu4" class="pu"><h1><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, 109 bytes</h1>
<p>Takes in the program on the left, the grid on the right, and returns the 1-based end position.</p>
<pre><code>($-_2&amp;u)@((](r@|.~d{.@/:])`[@.(]2=/@{./:~)[i.(d=:(,-)=i.2){::])^:_)0(]|.~u=:$@]#:(i.~,))_1(r=:-1$!.0~$)@,._,]
</code></pre>
<p><a href="https://tio.run/##lY4xa8QwDIV3/wr1anoSOErsBAoKBkOhU6euh@sbjgvpeHBTSv56arvZCoUO0vD0vaf3uR34eAUvcAQDHUiehuHl/e11Q90k93SngBjxFr54vSwcWol0PgXG6HwbFm5lpdPMePGCpiE/s6NFMvQhiTqM2Xb3okN8FJx5NUTJ4s1LY/UDd6umYDiZuNE2eRnHq1I9WHAwwYFHTg6wtiLVZdHmYw9O2Yz0ipQaslj4CdDCM@hcv9@lAQb6I6wE9HW7gpQwW72/2J@48tzt8XuBPFbVH65W@J/vGw" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
<h3>How it works</h3>
<p>Because I didn't want to handle 3 arguments (program + grid + current position) as this is awkward in tacit J definitions, this approach shifts the grid around with the upper left tile having the robot. A fix point <code>_2</code> to reconstruct the end position is in the padding.</p>
<pre><code> _1(r=:…)@,._,]
</code></pre>
<p>Pad with <code>_</code> on the top, and <code>_1</code> on the left.</p>
<pre><code> r=:-1$!.0~$
</code></pre>
<p>This subtracts one from the top left tile. That makes the <code>_1</code> to a <code>_2</code>, and as we'll use this later again, assign this function to <code>r</code>.</p>
<pre><code> 0(]|.~u=:$@]#:(i.~,))
</code></pre>
<p>This is a bit longer than needed, but in this version we can assign <code>x u y</code> to find the position of <code>x</code> in the grid <code>y</code>. Here we use it to shift the grid so the <code>0</code> is at the top left – later we'll use it to search for the <code>_2</code>.</p>
<pre><code> (…)^:_
</code></pre>
<p>Until the output of <code>…</code> does not change, i.e. until the robots moves:</p>
<pre><code> (d=:(,-)=i.2)
</code></pre>
<p>The 4 directions, saved as <code>d</code>.</p>
<pre><code> (d=:…){::]
</code></pre>
<p>Get the numbers at the directions, e.g. <code>0 0 3 1</code>.</p>
<pre><code> [i.
</code></pre>
<p>Find their position in the program with non-found numbers like <code>0 _ _1</code> having program length + 1, e.g. with <code>1 2 3</code>: <code>3 3 2 0</code>.</p>
<pre><code> ](…)`[@.(]2=/@{./:~)
</code></pre>
<p>If the first 2 items of the sorted indices <code>0 2 3 3 -&gt; 0 2</code> are equal, return the grid (stop moving), otherwise …</p>
<pre><code> r@|.~d{.@/:]
</code></pre>
<p>Sort the directions based on the indices. Take the first one, shift the grid by it and call <code>r</code> to subtract 1 from the top left, i.e. the robots takes a gem.</p>
<pre><code> ($-_2&amp;u)@
</code></pre>
<p>After the robot stopped moving, find the <code>_2</code> and subtract its position from the grid size to get the final result.</p>
</div>
<div id="pu5" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 70 bytes</h1>
<pre><code>≔⪪Ｓ¹θＷＳ⊞υι≔⪫υ¶ηＰη…η⌕η0≔ＥＫＶ⌕θιυＷ⁼¹№υ⌈υ«Ｍ✳⁻χ⊗⌕υ⌈υＰＩ⊖ＫＫ≔ＥＫＶ⌕θκυ»≔⟦ⅈⅉ⟧υ⎚Ｉυ
</code></pre>
<p><a href="https://tio.run/##jVBLS8QwED5vf0XoaQIVmva4J2kVFCqFBVHUQ7YbNmHTpI9kVcTfXid1l6onD3lMvvkek0byobFcT9PlOKq9gU2nlYMb03m3cYMye6AJYbh6uo5epdKC/EYpqf0owSdEYcdJ5dYqE57iZxMjVyJSee1UhxwHoaznW/HeaFFI24FMyLUyu3DGaUzpolXxDmohDvfW3AnfcmNCpLm5D6ZY@CXbVe@5HoElpLAeHTBExd9U61vwqErJR7Sq7FFAqQbROGXRQBmPjDQhpfVbLXYwi/9losfqxxAFHx2UohlEK4xDUsgIp75/RT@co3@eR316CPgj0JdvoNCCD7D8VrDELOtpynIW4cpwT/MsixjLGYumi6P@Ag" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Takes input as the program in ascending order of priority and then the newline-terminated grid and outputs 0-indexed coordinates. Explanation:</p>
<pre><code>≔⪪Ｓ¹θ
</code></pre>
<p>Input the program as separate characters.</p>
<pre><code>ＷＳ⊞υι≔⪫υ¶η
</code></pre>
<p>Input the grid.</p>
<pre><code>Ｐη…η⌕η0
</code></pre>
<p>Print the grid without moving the cursor, then print the part up to the <code>0</code> so that the cursor is now at the starting cell.</p>
<pre><code>≔ＥＫＶ⌕θιυ
</code></pre>
<p>Get the priorities of the neighbours of the starting cell (or <code>-1</code> for directions that lie outside the grid).</p>
<pre><code>Ｗ⁼¹№υ⌈υ«
</code></pre>
<p>Repeat while there is exactly one neighbouring cell of highest priority.</p>
<pre><code>Ｍ✳⁻χ⊗⌕υ⌈υ
</code></pre>
<p>Move to that neighbour.</p>
<pre><code>ＰＩ⊖ＫＫ
</code></pre>
<p>Decrement its value.</p>
<pre><code>≔ＥＫＶ⌕θκυ
</code></pre>
<p>Get the priorities of the neighbours of the new cell (or <code>-1</code> for illegal directions).</p>
<pre><code>»≔⟦ⅈⅉ⟧υ
</code></pre>
<p>Capture the final position.</p>
<pre><code>⎚Ｉυ
</code></pre>
<p>Clear the grid and output the position.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/207711/">207711</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




