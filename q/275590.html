<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::275590</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>203</td><td>ZX Spectrum 48K Basic</td><td>240918T121524Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275609#275609">Neil</a></td></tr>
<tr d-ix="1"><td>307</td><td>JavaScript</td><td>240920T204734Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275664#275664">rougepie</a></td></tr>
<tr d-ix="2"><td>174</td><td>C GCC using OSS</td><td>240921T162403Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275674#275674">G. Sliep</a></td></tr>
<tr d-ix="3"><td>228</td><td>Chipmunk Basic</td><td>240918T153621Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275614#275614">roblogic</a></td></tr>
<tr d-ix="4"><td>2302</td><td>Zsh +ffplay</td><td>240923T094444Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275717#275717">roblogic</a></td></tr>
<tr d-ix="5"><td>320</td><td>JavaScript</td><td>240919T161621Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275646#275646">Jordan</a></td></tr>
<tr d-ix="6"><td>nan</td><td>CP1610 machine code</td><td>240919T013051Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275627#275627">Arnauld</a></td></tr>
<tr d-ix="7"><td>270</td><td>Javascript</td><td>240920T193816Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275663#275663">ccprog</a></td></tr>
<tr d-ix="8"><td>077</td><td>MATL 1 language</td><td>240917T230511Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275600#275600">Luis Men</a></td></tr>
<tr d-ix="9"><td>290</td><td>PowerShell</td><td>240918T153022Z</td><td><a href="https://codegolf.stackexchange.com/questions/275590/play-the-final-fantasy-prelude/275613#275613">bigyihsu</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>ZX Spectrum 48K Basic, <s>246</s> 203 bytes</h1>
<pre><code>  10 LET t=VAL &quot;.14&quot;: LET a$=&quot;&lt;0
247&lt;?0237&lt;&lt;0247&lt;?0237&lt;C0247&lt;A024
7&lt;@047;&lt;&gt;047;&lt;&quot;: FOR i=SGN PI TO
 LEN a$ STEP VAL &quot;6&quot;: FOR j=NOT
PI TO INT PI: FOR k=SGN PI TO VA
L &quot;4&quot;: BEEP t,VAL &quot;12&quot;*j+CODE a$
(i+k)-CODE a$(i): NEXT k: NEXT j
: FOR j=INT PI TO NOT PI STEP -S
GN PI: FOR k=VAL &quot;5&quot; TO VAL &quot;2&quot;
STEP -SGN PI: BEEP t,VAL &quot;12&quot;*j+
CODE a$(i+k)-CODE a$(i): NEXT k:
 NEXT j: NEXT i
</code></pre>
<p>The above is how the program lists on screen as the ZX Spectrum's screen is 32 characters wide. The byte count was calculated by subtracting the system variables for the end and start of the program; this will be one less than the save file length as an empty program has a save file length of 1. Unfortunately I was using an online emulator which only has a save snapshot option, so you'll have to retype this yourself to test it. Note that if you try to enter this program literally in 128K mode it will try to tokenise the <code>&lt;&gt;</code> inside the string, breaking the program, so either replace it with <code>&lt;&quot;+&quot;&gt;</code>, do some magic with POKE, or use 48K mode and type <code>&lt;&gt;</code> as two characters rather than the token. In both modes you may also need to use the keyboard layout to enter some special characters such as <code>-</code> or <code>*</code>. Explanation:</p>
<pre><code>  10
</code></pre>
<p>Arbitrary line number (always costs 2 bytes).</p>
<pre><code>LET t=VAL &quot;.14&quot;
</code></pre>
<p>Timing variable, adjusted to make the overall run time about 48s of real time. (Processing overhead makes the program take about 50% longer than the actual notes).</p>
<pre><code>LET a$=&quot;&lt;0247&lt;?0237&lt;&lt;0247&lt;?0237&lt;C0247&lt;A0247&lt;@047;&lt;&gt;047;&lt;&quot;
</code></pre>
<p>String of tonic and arpeggio data.</p>
<pre><code>FOR i=SGN PI TO LEN a$ STEP VAL &quot;6&quot;
</code></pre>
<p>This steps through each tonic in the data string, thus repeating <code>8</code> times. <code>SGN PI</code> is used as it's even shorter than <code>VAL &quot;1&quot;</code>, which saves a few bytes because numeric literals take up six bytes for their internal representation.</p>
<pre><code>FOR j=NOT PI TO INT PI
</code></pre>
<p>Repeat for four octaves; <code>NOT PI</code> is <code>0</code> and <code>INT PI</code> is of course <code>3</code>.</p>
<pre><code>FOR k=SGN PI TO VAL &quot;4&quot;
</code></pre>
<p>Repeat for four notes.</p>
<pre><code>BEEP t,VAL &quot;12&quot;*j+CODE a$(i+k)-CODE a$(i)
</code></pre>
<p>Compute the note index (<code>C‚ÇÑ=0</code>) and play it.</p>
<pre><code>NEXT k: NEXT j
</code></pre>
<p>Repeat for the rest of the ascending arpeggio.</p>
<pre><code>FOR j=INT PI TO NOT PI STEP -SGN PI
</code></pre>
<p>Loop back down through the octaves.</p>
<pre><code>FOR k=VAL &quot;5&quot; TO VAL &quot;2&quot; STEP -SGN PI
</code></pre>
<p>Loop down through the notes.</p>
<pre><code>BEEP t,VAL &quot;12&quot;*j+CODE a$(i+k)-CODE a$(i)
</code></pre>
<p>Compute and play the note.</p>
<pre><code>NEXT k: NEXT j: NEXT i
</code></pre>
<p>Repeat for the remainder of the prelude.</p>
<p>Edit: Saved 43 bytes thanks to @Arnauld's suggesting of indexing into a single data string.</p>
<h1>ZX Spectrum 128K Basic, 195 bytes</h1>
<pre><code>  10 LET a$=&quot;CDEG  #BGED abCE  A
     ECb  fgaC  FCag  gabD  GDBa
       $aC$EG$AG$EC$bDFA $BAFd &quot;
     : FOR i= NOT PI TO VAL &quot;84&quot;
      STEP VAL &quot;12&quot;: FOR j= INT
     PI TO VAL &quot;6&quot; STEP INT PI :
      FOR k=j TO VAL &quot;9&quot;-j STEP
     SGN ( VAL &quot;9&quot;-j-j): PLAY &quot;O
     &quot;+ STR$ k+&quot; 2&quot;+(a$( TO VAL
     &quot;24&quot;)+a$)(i+j+j- VAL &quot;5&quot; TO
      i+j+j): NEXT k: NEXT j: NE
     XT i
</code></pre>
<p>The above is how the program displays during edit mode as the ZX Spectrum's screen is 32 characters wide and it wraps lines to column 5. The byte count was calculated by subtracting the system variables for the end and start of the program as the code is automatically tokenised (in edit mode tokens are always preceded with spaces but if you list the program then some of those will disappear) although when typing in the program you won't need to enter spaces except inside the string literal or between consecutive tokens. Explanation:</p>
<pre><code>  10
</code></pre>
<p>Arbitrary line number (always costs 2 bytes).</p>
<pre><code>LET a$=&quot;CDEG  #BGED abCE  AECb  fgaC  FCag  gabD  GDBa  $aC$E$G$AG$EC$bDFA $BAFd &quot;
</code></pre>
<p>Arpeggio data. Lower case letters play an octave below, so each octave command actually selects two octaves from which notes can be played, but to be able to play all of the arpeggios using the given four octaves I have had to cheat and play the C‚Çá as a BùÑ∞‚ÇÜ. Note that the first two arpeggios are only shown once here and doubled up below.</p>
<pre><code>FOR i= NOT PI TO VAL &quot;84&quot; STEP VAL &quot;12&quot;
</code></pre>
<p>Loop eight times, stepping though the arpeggio data string.</p>
<pre><code>FOR j = INT PI TO VAL &quot;6&quot; STEP INT PI
</code></pre>
<p>Switch between starting at octave <code>3</code> and octave <code>6</code>.</p>
<pre><code>FOR k=j TO VAL &quot;9&quot;-j STEP SGN ( VAL &quot;9&quot;-j-j)
</code></pre>
<p>Loop through the four octaves.</p>
<pre><code>PLAY &quot;O&quot;+ STR$ k+&quot; 2&quot;+(a$( TO VAL &quot;24&quot;)+a$)(i+j+j- VAL &quot;5&quot; TO i+j+j)
</code></pre>
<p>Select the octave and the note duration (the default tempo is 120 bpm but a note length code of <code>2</code> gives us the desired duration at this tempo) and play the current arpeggio at this octave.</p>
<pre><code>NEXT k: NEXT j: NEXT i
</code></pre>
<p>Repeat for the remainder of the prelude.</p>
<p>The figure of 195 bytes compares well to the 272 byte string needed to play the prelude in a single PLAY command: (line wrapping not part of the string)</p>
<pre><code>T80O3(1CDEGO5cdegCDEGO7cdegCgedcO5GEDCgedcO3GED
abCEABO5ceabCEABO7ceaeaO5BAECbaecO3BAECb)
fgaCFGAO5cfgaCFGAO7cfcO5AGFCagfcO3AGFCag
gabDGABO5dgabDGABO7dgdO5BAGDbagdO3BAGDba
$aC$EG$AO5c$eg$aC$EG$AO7c$eg$ag$ecO5$AG$EC$ag$ecO3$AG$EC
$bDFA$BO5dfa$bDFA$BO7dfa$bafdO5$BAFD$bafdO3$BAFD
</code></pre>
</div>
<div id="pu1" class="pu"><h1>JavaScript, <s>324</s> 307 bytes</h1>
<p>I used an array containing as many elements as there are notes to play, making sure that each element can be represented by a single hexadecimal character.</p>
<p>This character represents a number of semitones of difference between this note and the previous note (except for the first element which is played as is)</p>
<p>I then realized that some big chunks were repeated (those corresponding to the arpeggios in add2 and Maj7) and that I could factorize these portions of code</p>
<p>EDIT: with the suggestion from @G.Sliepen, @Neil, @Arnauld and @Fhuvi, I got a 307 bytes. Thanks guys!</p>
<p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false" data-babel-preset-react="false" data-babel-preset-ts="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint-override"><code>f=

_=&gt;{a=new AudioContext;with(a.createOscillator(r=(s,n=4)=&gt;(""+s).repeat(n))){[...`6${b=r("889b")+r(1344,c=3)+134}1${d=r("87ab")+r(1254,3)+125}7${b+1+d+0+b+6+b}5${D=r("a9a7")+r(5232,3)+523}4`+D].map((u,i)=&gt;{frequency.setValueAtTime(110*2**(c/12),i/5);c+="0x"+u-6});connect(a.destination);start();stop(51.2)}}</code></pre>
<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;button type="button" onclick="f()"&gt;Play (Warning: Loud)&lt;/button&gt;</code></pre>
</div>
</div>
</p>
</div>
<div id="pu2" class="pu"><h1>C (GCC) using OSS, <s>201</s> <s>197</s> <s>177</s> 174 bytes</h1>
<pre><code>i;main(c,n,a){for(open(&quot;/dev/dsp&quot;,1);write(3,&amp;n,1);n=(a+=901*exp2(n/4+(&quot;047;02470237&quot;[n%4+(5732&gt;&gt;c*2&amp;12)]-&quot;,/,/310.&quot;[c])/12.))&gt;&gt;9)n=i++/1500,c=n/32%8,n%=32,n=n&gt;16?32-n:n;}
</code></pre>
<p>The score includes 3 bytes for the <code>-lm</code> compiler flag. It runs on any UNIX system with support for the Open Sound System (OSS), or any other sound system that provides compatibility with OSS. On modern Linux, you might have to <code>sudo modprobe snd_pcm_oss</code> if this is not done automatically already. If you compile with GCC 14 or later, you might need to pass the <code>-std=gnu89</code> flag, but earlier versions don't need it.</p>
<p>The code opens <code>/dev/dsp</code>, which by default accepts 8-bit, unsigned, 8 kHz mono audio. It has three nested loops:</p>
<ul>
<li>Outer loop for each chord</li>
<li>Middle loop for the arpeggio</li>
<li>Inner loop to generate samples</li>
</ul>
<p>However, you'll only see one <code>for</code>-loop; it calculates the chord number and position in the arpeggio from the sample counter <code>i</code>. It also reuses the arpeggio position <code>n</code> for the sample value.</p>
<p>It uses a several lookup tables to find out which note to play:</p>
<ul>
<li><code>5732</code> is 8 2-bit values storing which type of chord to play (major seventh, major and minor)</li>
<li><code>&quot;047;02470237&quot;</code> stores the notes of each of the three chord types</li>
<li><code>&quot;,/,/310.&quot;</code> stores the first note of the start of each up-down arpeggio, inverted (higher ASCII code means lower note), as it will be subtracted from the previous table's values</li>
</ul>
<p>It then calculates the change in phase per sample for the waveform at that frequency in fixed point format, and adds it to the phase accumulator  <code>a</code>. This is then converted to a byte to be send straight to the audio device, thus generating a sawtooth wave with the right frequency.</p>
<p>This version loops (for at least six days). To make it write the output to <code>stdout</code> instead of <code>/dev/dsp</code>, change the first <code>3</code> in the code to a <code>1</code>. You can then pipe it through <code>aplay -fU8 -c1 -r8000</code> or a similar command.</p>
</div>
<div id="pu3" class="pu"><h1><a href="https://www.nicholson.com/rhn/basic/" rel="nofollow noreferrer">Chipmunk Basic</a>, <sub><s>677</s></sub> <sub><s>303</s></sub> <sub><s>280</s></sub> <sub><s>241</s></sub> 228 bytes</h1>
<pre class="lang-basic prettyprint-override"><code>dim m(20):d$=&quot;GIKNDFGKGIKNDFGK@BDGBDFICGJNEILP&quot;:for k=0to 7
for i=0to 4:for o=1to 4:m(o+4*i)=555*2^(asc(mid$(d$,k*4+o))/12+i-8):next:next
for i=1to 17:s(m(i)):next:for i=1to 16:s(m(17-i)):next:next
sub s(x):sound x,.2,50:return
</code></pre>
<p><a href="http://tpcg.io/_ZW8BG6" rel="nofollow noreferrer">Try the debug version on TutorialsPoint!</a></p>
<p>The info about chords and octaves in the &quot;music theory&quot; section helped a lot. <br>
Ungolfed:</p>
<pre class="lang-basic prettyprint-override"><code>dim m(20)
d$=&quot;GIKNDFGKGIKNDFGK@BDGBDFICGJNEILP&quot;
for k=0to 7                       :' the 8 chords
  for i=0to 4                     :' ascend arpeggio for 5 octaves
    for o=1to 4                   :' broken into 4 notes
      m(o+4*i)=555*2^(asc(mid$(d$,k*4+o))/12+i-8)
      :' ^      ^       ^-- get an ascii value from the middle of d$
      :' |      |           and convert it to a frequency (Hz)
      :' |      +-- base frequency A=440Hz, adjusted slightly
      :' +-- populate m(1) to m(20), but only use 17 notes
    next
  next
  for i=1to 17:s(m(i)):next       :' ascend
  for i=1to 16:s(m(17-i)):next    :' descend
next
sub s(x):sound x,.2,50:return
</code></pre>
<p><sub><s><a href="https://github.com/roblogic/golf/blob/46d9ed8a30eaa2785bd216b5188800784a5be9eb/basic/275590-play-the-final-fantasy-prelude.bas" rel="nofollow noreferrer">677 bytes</a></s></sub></p>
</div>
<div id="pu4" class="pu"><h1><a href="https://www.zsh.org/" rel="nofollow noreferrer">Zsh</a> +<a href="https://www.ffmpeg.org/ffplay.html" rel="nofollow noreferrer"><code>ffplay</code></a>, <sub><s>296</s></sub> <sub><s>241</s></sub> <sub><s>261</s></sub> 230 bytes x 2</h1>
<pre class="lang-bash prettyprint-override"><code>for z (GIKN DFGK GIKN DFGK @BDG BDFI CGJN EILP){W=
for i ({0..4})for o (${(s::)z})W+=($[555*2**(##$o/12.+i-8)])
for q (${W:0:18} ${(Oa)W:0:17})S+=between(t,$[p++]/5,$p/5)*$q+
};ffplay -f lavfi aevalsrc=&quot;'0.1*sin(2*PI*t*(${S%+}))'&quot;
</code></pre>
<p><a href="https://tio.run/##RY5Na8JAFEX3/oqHTnHejOaLhkrKQLGpIVVUcJGFuJjKDAaCiU6wNGF@e2rsort74B7ubcypk0UuDWhdFfJHqOOp7HR5hQZoki7XEC@SJfynt3mcwDxepPCefK7hI11tsc3EoFdyoK3nOM8WeyqBkpaaKMLGYsYFJfswDFnAGB2NSOn6gcPz6QwP@JAvfT2LvMifWbiLG4kPerG44@JL1d9KnWk9IfuK84MbTkjlhsjIhQ/s6995mGoo5E3nINVNFuZ6FMOx5/jM5GcasG3KanYf2T1xizgedt0v" rel="nofollow noreferrer">Try it Online!</a> <sub>Adjusted by ear; frequencies from <code>ffplay</code> seemed a bit off. Uses base of <code>550</code> instead of <code>440</code>.</sub></p>
<p><code>for z</code> grabs 4 <s>pseudo-hex</s> ASCII characters<br>
<code>for i</code> and <code>for o</code> populate array <code>W</code> with 20 notes based on <code>z</code>; expressed as<br>
‚ÄÉ note number: <code>n=$[##$o-71+12*i]</code>, combined with<br>
‚ÄÉ frequency (Hz): <code>f=$[440*2**((n-21)/12.)]</code> <br>
<code>for q</code> goes up &amp; down 17 notes of <code>W</code>, adding to string <code>S</code>:<br>
‚ÄÉ 0.2s time increments <code>p++/5,p/5</code> <br>
‚ÄÉ frequency <code>q</code><br>
Finally, we call <code>ffplay</code> using the string <code>S</code> (trailing <code>+</code> truncated).</p>
<p>The linked TIO example doesn't play sound (no <code>ffplay</code>), but you can see the humungous string <code>S</code>.</p>
<p><sub><a href="https://tio.run/##TVDRasJAEHzPVyzxxNs7E3OhQUkJFGsNqcUKPvhgfbhKggfBxCRYNNy3x8QW7Muyw8zODHstD41MlSwhSfJUXoJ4f8iaJCvgCjSMFkuYzcMFPLaX6SyE6WwewWv4voS36GOF9SYwuhMFtHZs@0ljhzKgpKal7@NVY20A5IU6VgmQba9HMmssuHCZ2n2BabbkhgeUbD3PYy5jtFOMhGtzZU1wh4Y2ul73kEtnu/EdX0w0/lmafVu0E8jloTv900Fb5FPiHY01rnnwHVc/cXyk1ZBsc853I29I8pGHjJy4oZ9/nwFWAqk8JwpkfJZpWewDc@DYgpXqSF22iljF2pB1n2vEgdk0Nw" rel="nofollow noreferrer">Debug</a> <s><a href="https://tio.run/##NY89b4MwGIT3/AqLuoltwocdFwsCQ8ZOVGJgQEgx1FZIUCAhStUifjuBNp1Op3vf53Q/3WGUdSU7oHVby@9IlYdm1M0VVADtdVN/AouGYSj8QnFPFP/qMi4Y9/yNkOrNL/eAunhnRghm1HuBlSVyvJgpJ4B617bFgPt4SvtdAE@EB3zAII22z575YjPg2R0nR217ytNfGoyzY25SRqon8AImShq4gUUHAHsUS5xOrxHMOHcJIwQheLEYxQ5lNs6XyySCiVGo25dSZ3RbGzBrTTM3HLGGrSMwgdo0tsPibz6wNKjlXVdAqrusu2sZGSvXpqSrzoiRj3dyI1N/8moOGK@McXwA" rel="nofollow noreferrer" title="Zsh ‚Äì Try It Online">296B</a></s> <s><a href="https://tio.run/##RY@9boMwFIX3PMVV6iq@dgDb4SdQ8QCdWomBIc1gkEmQUCABJSrIz05DO3Q7Z/i@ozP251k3te6hqrpGf6emPLdz1d5gBBrFhQE/jAr4T0L5ESg/jGEXaQNBXJ5wytPVgtRAJ@G6O4tLa4GSifZJgqPFnKeUHKJAMMUYpTJ8IVPrnTwprKP2XCpWoyeVi0f8VV0XOE9E4kgLT82HxtxilpLsqzDDw5gLHbbk0HF@9IIt6bwAGbnylX37@wFOBY2@VzVoc9dNfyvT9Ua4kvX1hSr2@c4G9lzIXrlF3Kzn@Qc" rel="nofollow noreferrer">241B</a></s> <s><a href="https://tio.run/##RY/PaoNAGMTveYqPdEv2203U3finpvoAPbWQgwcRXGVNBIkmSkqVfXZr0kNvM8xvYGbsz7NqatVDVXWN@ol1eW7nkmIURST1PIdJxigV/gsRO/nGhWREoi2khdmqam8wAg3CQoPrBwX8K0e6AUjXD2EfKA1eWJ5wSuJnpQY6OZa1N/hwLVAy0f5wwNFgwmOal0Cm1j7ZwjFA6hyfpeuCJfDIxlRk4OYLRD8VJgaPPC708K31hQ5bknacZ7a3JZ3tISNXvjLvf99gV0Gj7lUNSt9V09/KeL1xLMH6@kIl@/pgA1u2HF@5Qdys5/kX" rel="nofollow noreferrer">261B</a></s></sub></p>
</div>
<div id="pu5" class="pu"><h1>JavaScript, 320 bytes</h1>
<p>I don't golf with JavaScript much so I'm sure there's a lot of opportunities for golfing here. Should work on most browsers.</p>
<pre class="lang-js prettyprint-override"><code>x=&gt;{a=new AudioContext
with(a.createOscillator()){[y=[0,2,4,7],z=[-3,-1,0,4],y,z,[-7,-5,-3,0],[-5,-3,-1,2],[-4,0,3,7],[-2,2,5,9]].map((c,t)=&gt;{p=s=&gt;frequency.setValueAtTime(440*2**(s-1.75),(t*32+i)*.19)
for(i=0;i&lt;32;i++)p(i&lt;17?c[i%4]/12+(i/4|0):c[3-(i-1)%4]/12+((32-i)/4|0))})
connect(a.destination)
start()
stop(48.64)}}
</code></pre>
<p>-3 bytes thanks to <a href="https://codegolf.stackexchange.com/users/17602/neil">Neil</a></p>
<h2>Try it</h2>
<p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint-override"><code>f =

x=&gt;{a=new AudioContext
with(a.createOscillator()){[y=[0,2,4,7],z=[-3,-1,0,4],y,z,[-7,-5,-3,0],[-5,-3,-1,2],[-4,0,3,7],[-2,2,5,9]].map((c,t)=&gt;{p=s=&gt;frequency.setValueAtTime(440*2**(s-1.75),(t*32+i)*.19)
for(i=0;i&lt;32;i++)p(i&lt;17?c[i%4]/12+(i/4|0):c[3-(i-1)%4]/12+((32-i)/4|0))})
connect(a.destination)
start()
stop(48.64)}}</code></pre>
<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;button type="button" onclick="f()"&gt;Play (Warning: Loud)&lt;/button&gt;</code></pre>
</div>
</div>
</p>
</div>
<div id="pu6" class="pu"><h1><a href="https://en.wikipedia.org/wiki/General_Instrument_CP1600" rel="nofollow noreferrer">CP-1610</a> machine code, 125 DECLEs<sup>1</sup>=156.25 bytes</h1>
<p><em><sup>1. CP-1610 instructions are encoded with 10-bit values (0x000 to 0x3FF), known as DECLEs. Although the Intellivision is also able to work on 16-bit data, programs were really stored in 10-bit ROM back then.</sup></em></p>
<p>A fantasy console?!? Let's do it on a real one!</p>
<p>This code is meant to be run on a PAL Intellivision (50Hz). It would also work on an NTSC system (60Hz), but at a different pitch and speed.</p>
<h2>Demo</h2>
<p><a href="https://youtu.be/2DOweHnZf0g" rel="nofollow noreferrer">Here is what we get</a> on the real hardware (YouTube video), using the <a href="http://ltoflash.leftturnonly.info/" rel="nofollow noreferrer">LTO Flash!</a>.</p>
<h2>Source code</h2>
<pre><code>                             ROMW  10          ; use 10-bit ROM width
0x4800                       ORG   $4800       ; map our code at $4800
                   
                     ;; -------------------------------------------------------- ;;
                     ;;  build the note period table in RAM:                     ;;
                     ;;    p(0) = 1432                                           ;;
                     ;;    p(n) = p(n-1) * 483 + 350 &gt;&gt; 9                        ;;
                     ;; -------------------------------------------------------- ;;
4800   001                   SDBD              ; R0 = note period, starting at ...
4801   2B8 098 005           MVII  #1432, R0   ; ... the highest value 1432 for F-2
4804   2BC 2F0               MVII  #$2F0, R4   ; R4 = write pointer in RAM
                   
4806   260           init    MVO@  R0, R4      ; write the period
                   
4807   1D2                   CLRR  R2          ; use R3:R2 as a 32-bit value
4808   1DB                   CLRR  R3          ; (initialized to 0)
                   
4809   2B9 1E3               MVII  #483, R1    ; process multiplication by 483
                   
480B   0C2           mult    ADDR  R0, R2      ; by adding R0 that many times
480C   02B                   ADCR  R3          ; to R3:R2
480D   011                   DECR  R1
480E   22C 004               BNEQ  mult
                   
4810   2FA 15E               ADDI  #350, R2    ; R3:R2 += 350
                                               ; (carry never set -&gt; no ADCR R3)
                   
4812   042                   SWAP  R2          ; R2 = R3:R2 &gt;&gt; 9
4813   043                   SWAP  R3
4814   3BA 0FF               ANDI  #$FF, R2
4816   1DA                   XORR  R3, R2
4817   07A                   SARC  R2
                   
4818   090                   MOVR  R2, R0      ; copy R2 to R0
                   
4819   378 00F               CMPI  #$F, R0     ; loop until R0 = $F
481B   22E 016               BGT   init
                   
                     ;; -------------------------------------------------------- ;;
                     ;;  play the song                                           ;;
                     ;; -------------------------------------------------------- ;;
481D   240 1FB               MVO   R0, $1FB    ; set the volume on channel A to $F
                   
481F   001           loop    SDBD              ; R4 = pointer into chords table
4820   2BC 057 048           MVII  #chords, R4
                   
4823   2A2           chord   MVI@  R4, R2      ; R2 = initial note address
4824   092                   TSTR  R2          ; time to loop?
4825   224 007               BEQ   loop
                   
4827   274                   PSHR  R4          ; save R4 on the stack
4828   2E4                   ADD@  R4, R4      ; R4 = pointer into delta values
4829   2BD 008               MVII  #8, R5      ; R5 = octave counter
                   
482B   093           octave  MOVR  R2, R3      ; copy R2 to R3
482C   2B9 004               MVII  #4, R1      ; R1 = note counter
                   
482E   298           note    MVI@  R3, R0      ; R0 = note period
482F   240 1F0               MVO   R0, $1F0    ; save the low bits
4831   040                   SWAP  R0          ; and the high bits
4832   240 1F4               MVO   R0, $1F4    ; into the PSG registers
                   
4834   001                   SDBD              ; wait for ~184500 cycles
4835   2B8 00C 030           MVII  #12300, R0  ; (approximately 185ms)
                   
4838   010           spin    DECR  R0          ; (6 cycles)
4839   22C 002               BNEQ  spin        ; (9 cycles)
                   
483B   2E3                   ADD@  R4, R3      ; update R3
483C   33B 005               SUBI  #5, R3
483E   011                   DECR  R1          ; decrement the note counter
483F   22C 012               BNEQ  note        ; loop if not zero
                   
4841   37D 005               CMPI  #5, R5      ; compare octave counter with 5
4843   20C 003               BNEQ  phase       ; time to switch the phase? ...
                   
4845   09A                   MOVR  R3, R2      ; ... yes: copy R3 to R2
4846   200 008               B     next
                   
4848   20E 002       phase   BGT   asc         ; ascending phase?
                   
484A   33A 018               SUBI  #24, R2     ; descending phase: -12 semitones
484C   2FA 00C       asc     ADDI  #12, R2     ; ascending phase: +12 semitones
                   
484E   33C 004               SUBI  #4, R4      ; rewind R4
                   
4850   015           next    DECR  R5          ; decrement the octave counter
4851   22C 027               BNEQ  octave      ; loop if not zero
                   
4853   2B4                   PULR  R4          ; advance to the next chord
4854   00C                   INCR  R4
4855   220 033               B     chord
                   
                     ;; -------------------------------------------------------- ;;
                     ;;  chords tables                                           ;;
                     ;; -------------------------------------------------------- ;;
4857   2F7 00F       chords  DECLE $2F7, add2   - $ - 1  ; C/add2
4859   2F4 014               DECLE $2F4, add2_m - $ - 1  ; Am/add2
485B   2F7 00B               DECLE $2F7, add2   - $ - 1  ; C/add2
485D   2F4 010               DECLE $2F4, add2_m - $ - 1  ; Am/add2
485F   2F0 007               DECLE $2F0, add2   - $ - 1  ; F/add2
4861   2F2 005               DECLE $2F2, add2   - $ - 1  ; G/add2
4863   2F3 011               DECLE $2F3, maj7   - $ - 1  ; G#/maj7
4865   2F5 00F               DECLE $2F5, maj7   - $ - 1  ; A#/maj7
4867   000                   DECLE 0
                   
                             ; delta values, with +5 offset
4868   007 007 ...   add2    DECLE 7, 7, 8, 10, 0, 2, 3
486F   007 006 ...   add2_m  DECLE 7, 6, 9, 10, 0, 1, 4
4876   009 008 ...   maj7    DECLE 9, 8, 9,  6, 4, 1, 2
                   
0x487D               end
</code></pre>
<h2>How it works</h2>
<h3>About the Programmable Sound Generator (PSG)</h3>
<p>The PAL-based Intellivision uses a 4.00MHz clock. The PSG is driven from a clock signal at half this rate. Internally, the PSG divides down its clock by 16 to determine the final square-wave frequency. The frequency of a tone produced by a PAL Intellivision is therefore given by:</p>
<p><span class="math-container">$$F\_tone=\frac{4000000}{32\times P\_channel}$$</span></p>
<p>where <span class="math-container">\$P\_channel\$</span> is the period register setting for the given channel.</p>
<p><em>(adapted from the <code>psg.txt</code> file included in <a href="http://spatula-city.org/%7Eim14u2c/intv/" rel="nofollow noreferrer">jzIntv</a>)</em></p>
<h3>Building the note period table</h3>
<p>The frequency ratio between two consecutive semitones is given by:</p>
<p><span class="math-container">$$\sqrt[12]{2}\approx 1,0594631$$</span></p>
<p>And what we really need is the period ratio between two consecutive semitones:</p>
<p><span class="math-container">$$1/\sqrt[12]{2}\approx 0,9438743$$</span></p>
<p>To apply this ratio to a period <span class="math-container">\$P_n\$</span>, we use the following approximation:</p>
<p><span class="math-container">$$P_{n+1}=\left\lfloor\frac{P_n \times 483 + 350}{512}\right\rfloor$$</span></p>
<p>We start with <span class="math-container">\$P_0=1432\$</span>, which is the period for F<sub>2</sub> (87.31Hz) on a PAL Intellivision, computed with the formula described in the previous section. We stop when a period of 15 is reached -- an arbitrary choice to have a register ready to initialize the volume on the PSG.</p>
<p>The CP-1610 doesn't have any multiplication instruction, so we have to compute it with either additions and shifts (see the <a href="https://codegolf.stackexchange.com/revisions/275627/9">previous revision</a>) or just repeated additions (the current revision). Besides, we need 32-bit values to have enough precision. So we use either one or two pairs of 16-bit registers depending on the method (R0/R1 and R2/R3).</p>
<p>The integer division by 512 is of course much simpler since it boils down to a right-shift by 9.</p>
<h3>Chords encoding</h3>
<p>Each chord is described by the address of the first note in our period table, followed by a pointer to 7 delta values:</p>
<pre><code>a0, a1, a2, s, d0, d1, d2
</code></pre>
<p>where:</p>
<ul>
<li><code>a0</code>, <code>a1</code>, <code>a2</code> are the delta values for the ascending phase, repeated 4 times and starting at the next octave each time</li>
<li><code>s</code> is the delta value applied when switching from the ascending to the descending phase</li>
<li><code>d0</code>, <code>d1</code>, <code>d2</code> are the delta values for the descending phase, repeated 4 times and starting at the previous octave each time</li>
</ul>
<p>The actual delta values are obtained by subtracting 5 to the stored values.</p>
</div>
<div id="pu7" class="pu"><h1>Javascript, 270 bytes</h1>
<pre><code>x=&gt;{a=new AudioContext
with(a.createOscillator()){
for(i=0;i&lt;256;i++){n=[60,49,60,49,32,40,46,54][i&gt;&gt;5]
q=[1258,810,1804][n%4]
frequency.setValueAtTime(55*2**((b=i&amp;31?b+(i%32&gt;16?-(q&gt;&gt;i%4*3&amp;7):q&gt;&gt;(257-i)%4*3&amp;7):n&gt;&gt;2)/12),i*3/16)}
connect(a.destination)
start()
stop(48)}}
</code></pre>
<p>If you have to express the frequency in Herz, the formula given in the question is unneccessary complicated. The note A is defined as 440Hz, each octave below halves that, and the A that is lower than the lowest note played is A‚ÇÉ at 55Hz.</p>
<p>The start note frequencies of the arpeggios from that become</p>
<pre><code>f = 55 * 2 ** (s / 12)
</code></pre>
<p>with the semitones distance form the base note <code>s</code> being</p>
<pre><code>15 12 15 12 8 10 11 13
</code></pre>
<p>There are only three different chords being used that can be described by their sequence of semitone differences. The last column is a magic number encoding the differences as octal. For golfing reasons the digits are ordered as 1-2-3-0</p>
<pre><code>0:  major add2  |  2 2 3 5  |  0o2352 = 1258
1:  minor add2  |  2 1 4 5  |  0o1452 =  810
2:  major 7     |  4 3 4 1  |  0o3414 = 1804
</code></pre>
<p>The whole sequence can be described as a two-dimensional array</p>
<pre><code>[[15, 0], [12, 1], [15, 0], [12, 1], [8, 0], [10, 0], [11, 2] [13, 2]]
</code></pre>
<p>or with the chord index as the lowest two bits in one number</p>
<pre><code>[60, 49, 60, 49, 32, 40, 46, 54]
</code></pre>
<p>From there, using the same code as <strong>@Jordan</strong> for the <code>AudioContext</code> interface (ungolfed):</p>
<pre><code>x =&gt; {
  a=new AudioContext
  with (a.createOscillator()) {
    for (i = 0; i &lt; 256; i++) {
      
      n = [60,49,60,49,32,40,46,54][i&gt;&gt;5]  // after each 32 a new arpegio
      q = [1258,810,1804][n%4]             // magic chord number
      b = i&amp;31 ?                           // inside arpeggio sequence,
        b + (                              // add semitone difference
          i%32 &gt; 16 ?
          -(q&gt;&gt;i%4*3&amp;7) :                 // downward
          q&gt;&gt;(257-i)%4*3&amp;7                // upward
        ) :
        n &gt;&gt; 2                            // start new arpeggio at base note
      
      frequency.setValueAtTime(55 * 2 ** (b/12), i * 3 / 16)
    }
    connect(a.destination)
    start()
    stop(48)
  }
}
</code></pre>
<h2>Try it</h2>
<p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint-override"><code>f =

x=&gt;{a=new AudioContext
with(a.createOscillator()){
for(i=0;i&lt;256;i++){n=[60,49,60,49,32,40,46,54][i&gt;&gt;5]
q=[1258,810,1804][n%4]
frequency.setValueAtTime(55*2**((b=i&amp;31?b+(i%32&gt;16?-(q&gt;&gt;i%4*3&amp;7):q&gt;&gt;(257-i)%4*3&amp;7):n&gt;&gt;2)/12),i*3/16)}
connect(a.destination)
start()
stop(48)}}</code></pre>
<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;button type="button" onclick="f()"&gt;Play (Warning: Loud)&lt;/button&gt;</code></pre>
</div>
</div>
</p>
</div>
<div id="pu8" class="pu"><h1><a href="https://github.com/lmendo/MATL" rel="nofollow noreferrer">MATL</a> (1 language), <s>78</s> 77 bytes</h1>
<pre><code>0'!4XC@nRAxt~&amp;'F5:ZaKeK1X&quot;tP[AaABOlHN]0Y(_&amp;vhYs&quot;1875:YPE*76/@12/W*Y,E]&amp;h1e4Y#
</code></pre>
<p>This uses equal temperament, with a C<sub>3</sub> frequency of 131.6 Hz (more accurate values could be achieved at the cost of 2 or 3 bytes, namely replacing <code>76</code> in the code by <code>76.4</code> or <code>76.45</code>).</p>
<p>The timbre corresponds to a sine wave hard-clipped at half its amplitude (this clipping costs 1 byte but produces nicer sound than a pure sine wave; the latter can be obtained by removing the <code>E</code> near the end of the code).</p>
<p>Try it at <a href="https://matl.io/?code=0%27%214XC%40nRAxt%7E%26%27F5%3AZaKeK1X%22tP%5BAaABOlHN%5D0Y%28_%26vhYs%221875%3AYPE%2a76%2F%4012%2FW%2aY%2CE%5D%26h1e4Y%23&amp;inputs=&amp;version=22.8.0" rel="nofollow noreferrer">MATL online</a>!</p>
<h2>How it works</h2>
<p>Number 0 is first pushed to the stack. This will serve as the initial note. The rest of the notes will be defined by consecutive differences, measured in semitones.</p>
<p>The basic structure of the song is described by the following 4√ó8 matrix:</p>
<pre><code>2 2 2 2 2 2 4 4
2 1 2 1 2 2 3 3
3 4 3 4 3 3 4 4
5 5 5 5 5 5 1 1
</code></pre>
<p>which contains the increments (in semitones) of the ascending arpeggios, each column corresponding to one of the 8 chords in order.</p>
<p>To generate this matrix, the string <code>'!4XC@nRAxt~&amp;'</code> is interpreted as a &quot;number&quot; in the base defined by all ASCII characters except single quote, and is decoded into the base formed by the numbers [1 2 3 4 5], producing a row vector (this operation is done by the code <code>F5:Za</code>). Reshaping this with 4 rows (<code>Ke</code>) gives the above matrix. Then, the matrix is extended by replicating it 4 times vertically (<code>K1X&quot;</code>), because each ascending arpeggio is played 4 times. This yields a 16√ó8 matrix.</p>
<p>A duplicate (<code>t</code>) of this 16√ó8 matrix is produced, and it is then flipped vertically (<code>P</code>). This represents the descending arpeggios, except that the sign should be negated; and the last row is incorrect, because it does not consider the transition to the next chord. Specifically, the values of the last row should be [5 ‚àí1 5 6 0 1 2 NaN] (represented compactly in the code as <code>[AaABOlHN]</code>). The final NaN value indicates that there is no following chord in the last column. Thus, the last row of the second 16√ó8 matrix is overwritten with that vector (<code>0Y(</code>), and the two matrices are concatenated vertically (<code>&amp;v</code>). The resulting 32√ó8 matrix describes the repeated up and down arpeggios for each chord, with the correct transition to the next chord. To produce the notes it should be read in column-major order (down, then across).</p>
<p>To transform the increments between notes into the actual notes, the 0 produced at the beginning of the program is concatenated horizontally (<code>h</code>) with the 32√ó8 matrix. This causes the matrix to be read in column-major order, and gives a 1√ó257 row vector. Its cumulative sum (<code>Ys</code>) produces the notes, starting at 0, where each note is represented by the number <em>S</em> of semitones up or down from C<sub>3</sub>. The last value is NaN, which will be interpreted as no note.</p>
<p>A <em>for each</em> loop (<code>&quot;</code>...<code>]</code>) reads each note, represented by the corresponding number <em>S</em>. To generate the waveform for the note, a time vector [1 2 ... 1875] is first created (<code>1875:</code>). The length of this vector, when replayed at 10000 samples per second, determines a tempo of 80 bpm, as required. This vector is element-wise multiplied by 2œÄ <code>(YPE*)</code>, divided by 76 (<code>76/</code>), and then multiplied by 2 raised to the number that results from dividing <em>S</em> by 12 (<code>@12/W*</code>). Applying the sine function (<code>Y,</code>) produces a 1√ó1875 vector with samples of a sinusoid of the frequency correponding to <em>S</em>. The values of this vector are multiplied by 2 (<code>E</code>). The last sinusoid contains NaN values and will produce no sound.</p>
<p>The 257 resulting waveforms, each with 1875 samples, are concatened horizontally (<code>&amp;h</code>) into a single waveform. This waveform is then replayed, without scaling, at the indicated sample rate (<code>1e4Y#</code>). When replaying, sample values are clipped to the interval [1, ‚àí1].</p>
</div>
<div id="pu9" class="pu"><h1><a href="https://github.com/PowerShell/PowerShell" rel="nofollow noreferrer">PowerShell</a>, <s>401</s> <s>379</s> <s>340</s> <s>304</s> 290 bytes</h1>
<pre class="lang-powershell prettyprint-override"><code>$C=130,146,164,196,261;$A=110,123,130,174,220;$G=103,130,155,196,207
$q=[console]
function P($c=$C,$h=0){0..7|%{$i=$_;if($i-lt4){0..3|%{$q::Beep(($c[$_])*[math]::Pow(2,$i+$h/12),187)}}else{4..1|%{$q::Beep(($c[$_])*[math]::Pow(2,7-$i+$h/12),187)}}}}
P;P $A;P;P $A;P $C -7;P $C -5;P $G;P $G 2
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=jZCxboMwFEXVla-wolcJUkP9jMEpyEPKkJUdoahCRiC5kBSiDJQv6ZKlSz-pX9OEkCVTl3elc99Z7tfPrj3qj67SxpxO34e-dFe_DwtIFPqMoggphoLiS0h5iDGsFeIZc59OtRSUcxbDRiGbURBcv5m0YK-yom261ujcKg9N0ddtQ1IbCgUJhUoxZ2CeJz8fB6gVbOO6tKF2TS8m7l_4Popetd7ZZymDbe4ss_e3vsqjKG2PNqdQP0H1jNyhuJLOOGrT6UF4Hv7Dle69PY5WGqcE1vEtCCTElXMGl9xMh_DrVPNit-X-AA" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>An extremely brute-force solution, since I'm a novice at PowerShell golf. Defines a function <code>P</code> that plays a chord (array of numbers, truncated to the nearest integer) at a given half-step offset, first up 4 times then down 4 times. Each note is played using the builtin <code>[System.Console]::Beep</code> method.</p>
<p>To run, paste this into a <code>.ps1</code> file, then run it in PowerShell; or paste it directly into a PowerShell terminal.</p>
<ul>
<li>-22 from general golfs</li>
<li>-39 from replacing <code>for</code>-loops with ranges piped into <code>ForEach-Object</code>s.</li>
<li>-36 from reusing the back 4 notes of the chords, in reverse, for the descending arpeggios.</li>
<li>-14 with default arguments and some simplification</li>
</ul>
<p><em>P.S. I keep getting this weird issue where some notes are missed; I modified the code to write out the current note and index that it's on and it is indeed running correctly, but the beeps are being clobbered by something else.</em></p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/275590/">275590</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




