<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::277579</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>066</td><td>JavaScript ES6</td><td>250111T192138Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277593#277593">Arnauld</a></td></tr>
<tr d-ix="1"><td>6160</td><td>Ruby</td><td>250111T201541Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277594#277594">Level Ri</a></td></tr>
<tr d-ix="2"><td>063</td><td>R</td><td>250111T050034Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277585#277585">Eonema</a></td></tr>
<tr d-ix="3"><td>109</td><td>Retina</td><td>250111T190538Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277592#277592">Neil</a></td></tr>
<tr d-ix="4"><td>024</td><td>Jelly</td><td>250111T183610Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277591#277591">lolad</a></td></tr>
<tr d-ix="5"><td>087</td><td>Wolfram Language Mathematica</td><td>250111T181327Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277590#277590">Greg Mar</a></td></tr>
<tr d-ix="6"><td>077</td><td>JavaScript V8</td><td>250111T025253Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277582#277582">Weird Gl</a></td></tr>
<tr d-ix="7"><td>113</td><td>Python3</td><td>250111T030542Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277584#277584">Ajax1234</a></td></tr>
<tr d-ix="8"><td>170</td><td>Python 2</td><td>250111T013410Z</td><td><a href="https://codegolf.stackexchange.com/questions/277579/how-much-coffee-is-in-my-water/277581#277581">Lucenapo</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>JavaScript (ES6), 66 bytes</h1>
<p>Excepts a list of pairs: <code>[0,n]</code> for adding coffee, <code>[1,n]</code> for adding water,  <code>[2,n]</code> for drinking.</p>

<pre class="lang-none prettyprint-override"><code>a=&gt;a.map(([t,n])=&gt;(c+=t-2?!t*n:(n=n&lt;s?-n:-s)*c/s,s+=n),s=c=0)&amp;&amp;c/s
</code></pre>
<p><a href="https://tio.run/##jY/RDoIgGEav6ynqxoGCghu1udAHcV4wslYzcMF6fVLaSs1cXMA/dr7vwFU8hJH3S2ux0sfanbgTPBfxTbQAlBapCvIcyIhbnBZbG6oMKK4OpsAqwwaGMjHIRFxBZLjkBAZBd@OkVkY3ddzoMziBsqSIkqqCcOVXkmxITNazECoJomzC7r5YMi2ki4X9kQ4jvpb9k0Ajl8/t54KsIz/70PPbkr4sjPjU2DL/ZY@/TUtzX@VfS1Pmng" rel="nofollow noreferrer" title="JavaScript (Node.js) â€“ Try It Online">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, 61 (or 60) bytes</h1>

<pre class="lang-none prettyprint-override"><code>-&gt;z{v=c=0.0
z.map{|a,q|a&lt;2?c=(c*v+a*q)/v+=q:v=[v-q,0].max}
c}
</code></pre>
<p><a href="https://tio.run/##hZDfCsIgFIfv9xRCN7U5U8GCyHoQ8cKE3QUzSGp/nt10xSayLS9U8Pt95xwfz9vbVdyVl6a1XHOMcNagu6rbTkHTqTO9ar7VuS1UbnZ7W3BzslzY0kAsPffqM927GlRCCAwJllKChbUBQR6hUBBI2FwioIcfSv5ZyYw1HDQNBitbRmFUKqDHiWX@cdqTZjybSulXyvCQiKTxTAMxitfuPh0aInTsCLG1XxkGdR8" rel="nofollow noreferrer" title="Ruby â€“ Try It Online">Try it online!</a></p>
<p>This is the floating point version. It can be edited to a fractional version by changing the initialization of volume and concentration to <code>v=c=0r</code> for one less byte.</p>
<p>Function wihch takes an array of arrays, with each element of the form <code>[action,quantity]</code> and returns concentration.</p>
<p>Actions are: <code>0</code> add water <code>1</code> add coffee <code>2</code> drink.</p>
<p>The code is a conditional, which reduces the volume if action is <code>2</code> (or above) and updates both volume and and concentration if action is below <code>2</code>. Putting the conditional this way round saves 1 byte of whitespace (which would otherwise be required to avoid a syntax error I don't fully understand.)</p>
<p>The concentration is updated as</p>
<pre class="lang-none prettyprint-override"><code>((concentration * existing volume)+(concentration of new liquid * volume added)) 
divided by (new volume)   
</code></pre>
<p>Note that as the action code <code>0</code> or <code>1</code> is equal to the corresponding concentration (water = 0, coffee = 1) it can be used directly in the formula. This means it is also possible to add noninteger concentrations of coffee (an example of adding a mixture of concentration <code>0.5</code> is given in the TIO as an additional testcase.</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://www.r-project.org" rel="nofollow noreferrer">R</a>, <s>79</s> 63 bytes</h1>
<p><em>-11 and -5 to thanks to @DominicvanEssen and @pajonk, respectively!</em></p>
<pre class="lang-r prettyprint-override"><code>\(x,`?`=sum){for(y in x)F=F*max(1-y[3]/?F+!?F,0)+y[-3]
F[1]/?F}
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=m72waMGiNNulpSVpuhY37WM0KnQS7BNsi0tzNavT8os0KhUy8xQqNN1s3bRyEys0DHUro41j9e3dtBXt3XQMNLUro3WNY7ncog1BgrVQY6anaeRkFpdoJGsY6BgaAJXpJGuAaAgLxDBEFtPUVFBW0NVVMNAzN-WCa0XVYAphmJIqgjDb0MgU4rwFCyA0AA" rel="nofollow noreferrer">Attempt This Online!</a></p>
</div>
<div id="pu3" class="pu"><h1><a href="https://github.com/m-ender/retina/wiki/The-Language" rel="nofollow noreferrer">Retina</a>, 109 bytes</h1>
<pre><code>\d+
*
^
0/1Â¶Â¶
{`^(.+)/(.+)Â¶(_*)Â¶(w|(c))(_+)
$.($1*$3$.5*$2*$6)/$.($2*$($3$6))Â¶$3$6Â¶
)`Â¶(_*)(_*Â¶)d\1_*
Â¶$2
0G`
</code></pre>
<p><a href="https://tio.run/##dYxBDsIgEADv@w5MdimhUEO/4BO8NC0GPHjxYEx6qO/iAXwMl5o2MdEDw2aY5XF93u4XWw7ohzOUITYgYQTT2pxygsWPqBtqK3LCSVbOLwxEODUEQqOwUhyFdlJ0UvTUVsUTsuyJ83rzT@Q/@3xyojjYSQI/dmBOvpQZrSFYqQJaRxC@DTP@NmorHakde9atmTNV12xb3OJ/0xs" rel="nofollow noreferrer" title="Retina â€“ Try It Online">Try it online!</a> Takes input as a string of letters and digits and outputs as an unreduced fraction but link is to test suite that accepts the given test cases by removing non-word characters. Explanation:</p>
<pre><code>\d+
*
</code></pre>
<p>Convert the embedded numbers to unary.</p>
<pre><code>^
0/1Â¶Â¶
</code></pre>
<p>Insert a working area consisting of the fraction of coffee in the water bottle in decimal and the current volume of liquid in unary.</p>
<pre><code>^(.+)/(.+)Â¶(_*)Â¶(w|(c))(_+)
$.($1*$3$.5*$2*$6)/$.($2*$($3$6))Â¶$3$6Â¶
</code></pre>
<p>If adding water or coffee, the numerator is multiplied by the previous volume, and in the case of coffee the input multiplied by the denominator is added, while the denominator is multiplied by the new volume. (The new volume is of course the old volume plus the input.)</p>
<pre><code>Â¶(_*)(_*Â¶)d\1_*
Â¶$2
</code></pre>
<p>If drinking liquid, as much volume is removed as possible, up to the input.</p>
<pre><code>{`
)`
</code></pre>
<p>Repeat until the input has been exhausted.</p>
<pre><code>0G`
</code></pre>
<p>Keep just the final fraction.</p>
<p>For another 31 bytes the fraction can be reduced to its lowest terms:
<a href="https://tio.run/##dY09DoMwDEZ3XwNXshNEfhBcoUfoEkEq6NClQ1WJoZyLA@RiaQICqVI75Cn@/Gw/b6/742riiby7QHSjBAEdGKXDEhZ4@44qySojLNSLzGmmgZl6yYAVoRFIWGPLrHJZNSJHLVqBddJzK21iv82nFxYenekFpKYFffawnaWul7MzLBUlCgQsrMLCxDiR0Qwry4FMwzB8J4nj76TczYbLA4dmV63ROc7aPrjL/34f" rel="nofollow noreferrer" title="Retina â€“ Try It Online">Try it online!</a> Link is to test suite. Explanation: The fraction is computed upside-down as having the first value being non-zero simplifies the final GCD process. The second last stage is the same as the first stage, converting the decimal values to unary. The last stage then performs GCD on the two unary values and reverses the order of the results to give the desired fraction.</p>
</div>
<div id="pu4" class="pu"><h1><a href="https://github.com/DennisMitchell/jellylanguage" rel="nofollow noreferrer">Jelly</a>, 24 bytes</h1>
<pre><code>á¹ªÃ·S}CÂ¹0AÆ‘?Ã—Â¹+á¸·Âµ@Æ’Ã˜0Ã·@/â€˜Ä°
</code></pre>
<p><a href="https://tio.run/##y0rNyan8///hzlWHtwfXOh/aaeB4bKL94emHdmo/3LH90FaHY5MOzzA4vN1B/1HDjCMb/v//Hx1taKADhLE60SDaFEybksCPBQA" rel="nofollow noreferrer" title="Jelly â€“ Try It Online">Try it online!</a></p>
<p>Input is a list of lists, where each row is a 3-tuple <code>[coffee, water, drink]</code>. The index corresponding to the action contains its parameter, while the others are zero. For example,</p>
<pre><code>w(10),c(15) -&gt; [[0,10,0],[15,0,0]]
</code></pre>
<p>State is stored as <span class="math-container">\$(c,w)\$</span>, where <span class="math-container">\$c\$</span> is coffee and <span class="math-container">\$w\$</span> is water. Given an input row <span class="math-container">\$(\gamma, \omega, \delta)\$</span>, where only one of <span class="math-container">\$\gamma\omega\delta\$</span> is nonzero, there are three possiblities:</p>
<ul>
<li><span class="math-container">\$\gamma&gt;0\$</span> (adding coffee), and state becomes <span class="math-container">\$(c+\gamma,w)\$</span></li>
<li><span class="math-container">\$\omega&gt;0\$</span> (adding water), and state becomes <span class="math-container">\$(c,w+\omega)\$</span></li>
<li><span class="math-container">\$\delta&gt;0\$</span> (drinking). Given current total liquid <span class="math-container">\$V=c+w\$</span>, we calculate scale factor <span class="math-container">\$k=\frac{V-\delta}{V}=1-\frac{\delta}{V}\$</span>. If <span class="math-container">\$V=0\$</span> or <span class="math-container">\$k\le0\$</span>, set <span class="math-container">\$k=0\$</span> (so we never drink more than everything). Then, multiply, giving new state <span class="math-container">\$(kc,kw)\$</span>.</li>
</ul>
<p>Note that <span class="math-container">\$\delta=0\implies k=1\$</span>, and <span class="math-container">\$\gamma,\omega\$</span> work independently of each other. So we can apply all 3 operations at once, calculating new state <span class="math-container">\$(kc+\gamma,kw+\omega)\$</span>.</p>
<pre><code>á¹ªÃ·S}CÂ¹0AÆ‘?Ã—Â¹+á¸·Âµ@Æ’Ã˜0Ã·@/â€˜Ä°      Main monadic link taking
                               input matrix and returning
                               coffee %

á¹ªÃ·S}CÂ¹0AÆ‘?Ã—Â¹+á¸·                Dyadic chain taking (ğ›¾,ğœ”,ğ›¿) and (c,w),
                               calculating state update:
á¹ª                              ğ›¿
 Ã·S}                            Ã·the sum c+w = V
    C                          1-ğ›¿Ã·V = k
       AÆ‘?                     if k &gt; 0 (|k|=k):
     Â¹                          do nothing
                               otherwise (inc. k=NaN):
      0                         set k = 0
           Ã—Â¹                  calculate (kc,kw)
             +á¸·                and add (ğ›¾,ğœ”), giving (kc+ğ›¾,kw+ğœ”)
                               - ğ›¿ was implicitly popped earlier

               Âµ              Monadic chain on input:
                @Æ’Ã˜0          Loop through instructions:
                @Æ’             Reduce through input
                               with args reversed,
                               calling previous chain
                  Ã˜0           and using [0,0] as initial state

                    Ã·@/â€˜Ä°     Calculate final coffee %
                               from (c,w):
                    Ã·@/        wÃ·c
                       â€˜       wÃ·c + 1 = (w+c)Ã·c
                        Ä°      cÃ·(w+c)
</code></pre>
</div>
<div id="pu5" class="pu"><h1><a href="https://www.wolfram.com/wolframscript/" rel="nofollow noreferrer">Wolfram Language (Mathematica)</a>, 87 bytes</h1>
<pre><code>Last@#/Tr@#&amp;@(#&amp;/*##&amp;@@Curry[If[ListQ@#2,+##,Max[0,Tr@#-#2]#~Normalize~Tr]&amp;]/@#)@{0,0}&amp;
</code></pre>
<p>Don't try it online, I'm guessing because <a href="https://reference.wolfram.com/language/ref/Curry.html" rel="nofollow noreferrer"><code>Curry</code></a> is an older Mathematica command. Input is a list of operations in the following format: <code>{w,0}</code> for adding water, <code>{0,c}</code> for adding coffee, and <code>d</code> for drinking. For example, if we named the above function <code>g</code>, the last test case would be called using</p>
<p><code>g@{{0,10}, 5, {5,0}, 5, {5,0}, 5, {5,0}, 5}</code>.</p>
<p>The function keeps track of the water and coffee amounts as an ordered pair <code>{w,c}</code>, initialized with <code>@{0,0}</code>. The main helper function is</p>
<p><code>If[ListQ@#2,+##,Max[0,Tr@#-#2]#~Normalize~Tr]&amp;</code></p>
<p>which takes the amounts-pair as its first argument and one of the operations as its second argument, and outputs the new amounts-pair. <code>#~Normalize~Tr</code> divides the amounts-pair by the total amount of liquid; we could replace <code>Max[0,Tr@#-#2]#~Normalize~Tr</code> by <code>Max[0,1-#2/Tr@#]#</code>, except in the special case where we try to drink from an empty bottleâ€”the division by <code>Tr@#</code>, which equals <code>0</code> in that case, would cause an error.</p>
<p><code>Curry[...]/@#</code> converts the input list into a list of appropriate instances of the helper function, and the beautiful <code>#&amp;/*##&amp;@@</code> composes them together into a single function (<code>/*</code> is the right-to-left composition operator, as opposed to the standard <code>@*</code>, while <code>#&amp;</code> is just a neutral function used to invoke the <code>##</code> syntax). The result is the final amounts-pair, which is converted to a proportion by <code>Last@#/Tr@#&amp;@</code>.</p>
<p>Someone golf this by 11 bytes...!</p>
</div>
<div id="pu6" class="pu"><h1><a href="https://v8.dev/" rel="nofollow noreferrer">JavaScript (V8)</a>, <s>83</s> <s>80</s> 77 bytes</h1>

<pre class="lang-none prettyprint-override"><code>(s,C=T=0,w=i=&gt;T+=i,c=i=&gt;w(i,C+=i),d=i=&gt;i&gt;T?C=T=0:w(-i,C-=C/T*i))=&gt;1/eval(s)*C
</code></pre>
<p><a href="https://tio.run/##dY/NCsIwEITP9jF6Sur2TyiIsvEQfIPcxENIW40UI400j1/TSkSRXoaZnW8X9iYHaVWvH8902I4tjsQCR4EFONTIxBo1qMk5ooH7RKGeombiMHM7R1LfpMhzkWhKkZV5M8iOWJrwcX@KVrEjZUFjCA4UKat3Vv@N13p5Ct8bFYWP/OCbGa@KqQp4OBKWllwcnbPW9EeprsQiU@ZuTddknbmQ1v9E6fgC" rel="nofollow noreferrer" title="JavaScript (V8) â€“ Try It Online">Try it online!</a></p>
<p><em>-2 bytes thanks to l4m2</em></p>
<p>This is probably not perfect, but I'm satisfied with it.</p>
</div>
<div id="pu7" class="pu"><h1>Python3, 113 bytes</h1>
<pre class="lang-py prettyprint-override"><code>def f(s):
 A=[0,0]
 for a,b in s:
  if a&lt;2:A[a%2]+=b
  else:A=[max(0,i-b*i/sum(A))for i in A]
 return A[1]/sum(A)
</code></pre>
<p><a href="https://tio.run/##dVHRToQwEHy2X7G5xLTVcrYY1BB54Af8AexDgRKbcEDaXk5j/PazhQNNjC@b7czObHY6ffi3cbh/muz53OoOOuJojqAsKs64RNCNFhSrwQzgAg6mA/Wc5mWlrlN5W9QB0r3TeRAc1DvhzCT1jblzxwMpKY1qE7VlsLLaH21oKyEv/LxxUtbpeevVMlGRT3zCOWe4wblguMV5@lWZikvJzOCJqdI8EZJS2Ozd3k298QQzTCXy2nkHBex2O3QiglNIEuB7vjxYQ0R2gR5Qs/LiNx9q@yPM/hKs@aEfI59RtpUZ3jTprMl45FYNWq1W2X/dskGkGYrHbPd2pvfakpdx0Azmc9cAXgdMY5SKQR0iMCsejTANuHPa@vDNS@yK0qLo@lF5UlOEJhsDxkuAU5xtMT1/Aw" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu8" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a>, 170 bytes</h1>

<pre class="lang-none prettyprint-override"><code>Q=[0,0]
from fractions import*
def w(s):Q[0]+=s
def c(s):Q[1]+=s
def d(s):
 t=sum(Q)
 if s&lt;t:r=Fraction(t-s,t);Q[0]*=r;Q[1]*=r
 else:Q[0]=Q[1]=0
input()
print Q[1]/sum(Q)
</code></pre>
<p><a href="https://tio.run/##dcyxCsIwEIDhPU9xY1IjpoJLa1b3zKWDtA0GbBJyV4pPH00rbi53xwf3xxc9gj/nbHSnpOqZTWEGm@4DueAR3BxDooqNk4WVo2hMp/qDxg2GHeofjAUYkMZl5kYwcBbwSk3St2@R0xElibZkKp3a8v3ZDKYnTltcF9KKOR8X4oLF5DxBwdNezXngtRJy5Bch1zL@XW8" rel="nofollow noreferrer" title="Python 2 â€“ Try It Online">Try it online!</a></p>
<p>Probably can be improved a lot with a better approach.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/277579/">277579</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




