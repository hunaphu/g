<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::220828</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>220</td><td>Python3</td><td>250718T154858Z</td><td><a href="https://codegolf.stackexchange.com/questions/220828/simulate-walking-with-collisions/282687#282687">Ajax1234</a></td></tr>
<tr d-ix="1"><td>104</td><td>Python 2</td><td>210319T043600Z</td><td><a href="https://codegolf.stackexchange.com/questions/220828/simulate-walking-with-collisions/220883#220883">kops</a></td></tr>
<tr d-ix="2"><td>048</td><td>Charcoal</td><td>210318T232712Z</td><td><a href="https://codegolf.stackexchange.com/questions/220828/simulate-walking-with-collisions/220870#220870">Neil</a></td></tr>
<tr d-ix="3"><td>nan</td><td>J</td><td>210318T011029Z</td><td><a href="https://codegolf.stackexchange.com/questions/220828/simulate-walking-with-collisions/220834#220834">Jonah</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Python3, 220 bytes</h1>
<pre class="lang-py prettyprint-override"><code>def f(p):
 d,n={},[]
 for x,y,X,Y in p:
  if X+Y:d[v]=d.get(v:=(x+X,y+Y),[])+[(x,y)]
  else:n+=[(x,y)]
 n+=[j for k in d for j in d[k]if len(d[k])&gt;1]+[]
 return[i if len(d[a])&gt;1 or a in n else a for a in d for i in d[a]]
</code></pre>
<p><a href="https://tio.run/##lY9fa8MgFMXf8ynuo6KO2ryMQPY5EsSHgLrZFhuyrDSMffbMP2kW1/VhEPBcj@d3T/ppfDu78rkf5llpAwb1uCpAUVd/flEhCzDnAa50og1twTrovQvWQEPaSomLrNXTqx7RparRlTR0Ii32MUwE8iHs86BP77pypF5vgj5E7jEQVZSHKMVRevZJOxQkfuGShA6DHj8GJyysZhdM8Lku5Fxc4rW53SSoTdBOyrkfrBuRQULsKKSPSwqC8aTpLk77ZYI4Ji8@kRLj4h4Sny2JhejPfTaVC/COwPIUy2Os/Bl5ch83yRtvYvyW2vZk0d3863@RK@NP5IOa24e/muU78v15zfkb" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a>,  <s>127</s> <s>112</s> 104 bytes</h1>

<pre class="lang-python prettyprint-override"><code>def f(l):r=map(sum,l);exec&quot;r=[[p,x][r.count(p)&gt;1or[x+d,-d]in l]for p,[x,d]in zip(r,l)];&quot;*len(l);return r
</code></pre>
<p><a href="https://tio.run/##lY1BDoIwEEX3nqJxRWVqGNhJ8CJNFwZKhEBpRkiql8dS0Ghcufozkzf/2ft4HUw6z5WuWR11/ERFf7HRbeqh47l2utxTIaUFpyQdy2EyY2T5GQeSLq5AVKoxrFP1QMyCdBD2R2Mj8v8q3x86bXxtTnqcyDCaLTVm9CopE8BWgRQIuEQaAkGgUnz3iSXLvV3pdMvM5zcnNoT5qveUvSZcjr/VqzI0YoyBCC6xyuDvh6CYnw" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>
<p>Takes input as a list of pairs of complex numbers, outputs a list of complex numbers. Initially has everyone walk unless they would swap and then repeatedly sends back anyone who collided until there are no collisions left.</p>
<p>-8 bytes thanks to <a href="https://codegolf.stackexchange.com/users/20260/xnor">xnor</a>!</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 48 bytes</h1>
<pre><code>Ｗφ«≔⁰φＦθ¿∧§κ¹∨№θ⟦Σκ±§κ¹⟧⊖№ＥθΣλΣκ«≔⊟κφ⊞κ⁰»»Ｅθ⭆¹Σι
</code></pre>
<p><a href="https://tio.run/##VY4/D4IwEMVn@BQ3XhNIrI5ORBcHlcSRdCBQoIJFSlETw2evLf6/6b27e7@8rEpV1qaNMddKNBywIHD3vajvRSlxFkBBlr5XtAqwIyAKwEjmGOmNzPkN6wAoCWCvcNUOUmMXQHIYTljb5Y6Xqeb/r4TZw5pnip@41Dx/xbbp2UVdsiHkKWrixnV5l4nb8wSeGnnx0FcOOnNu9Ec/VuIHpa0rnaFPnJhwS2OSJAnp0ZY5Mls2nH/l4iPptA4pY8yEl@YB" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Takes input as an array of pairs of complex numbers and outputs a list of complex numbers. Explanation:</p>
<pre><code>Ｗφ«
</code></pre>
<p>Repeat while a flag value is non-zero.</p>
<pre><code>≔⁰φ
</code></pre>
<p>Zero out the flag value.</p>
<pre><code>Ｆθ
</code></pre>
<p>Loop over the people.</p>
<pre><code>¿∧§κ¹
</code></pre>
<p>If they want to move, and...</p>
<pre><code>∨№θ⟦Σκ±§κ¹⟧
</code></pre>
<p>... they would be swapping with the person at their destination, or...</p>
<pre><code>⊖№ＥθΣλΣκ«
</code></pre>
<p>... another person would end up at the same destination, then:</p>
<pre><code>≔⊟κφ
</code></pre>
<p>Set the flag value by removing that person's desired movement, and...</p>
<pre><code>⊞κ⁰
</code></pre>
<p>Replace their movement with standing still.</p>
<pre><code>»»Ｅθ⭆¹Σι
</code></pre>
<p>Print the final positions. (I've printed them on separate lines as that's what Charcoal's default output should be, although Charcoal doesn't know how to output complex numbers, so I've had to cheat slightly. I could extend that cheat and simply output the whole list as a Python array which would save two bytes.)</p>
</div>
<div id="pu3" class="pu"><h1><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, <sup>60 58 50</sup> 47 bytes</h1>
<pre><code>[:+/(*1,:1-(1&lt;1#.+/=/+/)+{.(~:*[=i.{_,~])+/)^:_
</code></pre>
<p><a href="https://tio.run/##pVFNS8NAEL33VzxUaNIkm27SVFjMRcGTePBadCkhoQahYHJQKv3rcfYjuyEiCJJMeJl582bebjtcsGWDUmCJGGsIioTh7unhftiJKA1WPBY8CfgNv2RRWqZRGkYnFpzFale@spOMz88h5V6EHMJFXR2OWLcckt4MHIlAgy@BDTJcUWWtq1QmpIJYI1IflV9YFWJmFDkV8rkOPVpIixmeBkSetEtFkEqAdplvIm23gpmHuYW6R5La4y1D/dG/79HXXY9q39U/bRbYgnu31393CxRjautSpKV6zXAz9rN6q3FssPHDuQp1XfOzsV5UFZql3RJ0hvru4O10RtKuxTEeJv3mrZcvnClu1jc8bhy6LgUzLTVuat1OtLN/yMqprqfy39Z13U7RD7FTzbrDNw" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
<p>Takes input as a matrix of complex numbers -- starting positions in the 1st row, steps to walk in the 2nd row.</p>
<p>Passes all test cases including those suggested by tsh and the cycle of 4 suggested by xnor.</p>
<h2>tldr how</h2>
<p>We iteratively adjust the steps to be 0 for impossible moves (same destination <code>(1&lt;1#.+/=/+/)</code> or <code>+</code> swaps <code>{.(~:*[=i.{_,~])+/</code>) until they reach a fixed point <code>^:_</code>.  Iteration is needed because some steps only become illegal after a walker changes from someone who will move to someone standing still.  There's a chain reaction.</p>
<p>After that iteration, impossible steps will have been converted to 0, and legal steps will remain what they were.</p>
<p>Once that's done, we just add those steps to the starting positions <code>[:+/</code>.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/220828/">220828</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




