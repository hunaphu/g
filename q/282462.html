<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::282462</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>2433</td><td>Perl 5</td><td>250705T140109Z</td><td><a href="https://codegolf.stackexchange.com/questions/282462/make-a-floor-plan-given-the-number-of-doorways/282558#282558">good old</a></td></tr>
<tr d-ix="1"><td>456</td><td>Maple</td><td>250702T003055Z</td><td><a href="https://codegolf.stackexchange.com/questions/282462/make-a-floor-plan-given-the-number-of-doorways/282507#282507">dharr</a></td></tr>
<tr d-ix="2"><td>198</td><td>JavaScript ES6</td><td>250629T235924Z</td><td><a href="https://codegolf.stackexchange.com/questions/282462/make-a-floor-plan-given-the-number-of-doorways/282475#282475">Arnauld</a></td></tr>
<tr d-ix="3"><td>800</td><td>Python3</td><td>250630T170230Z</td><td><a href="https://codegolf.stackexchange.com/questions/282462/make-a-floor-plan-given-the-number-of-doorways/282488#282488">Ajax1234</a></td></tr>
<tr d-ix="4"><td>165</td><td>Charcoal</td><td>250629T195013Z</td><td><a href="https://codegolf.stackexchange.com/questions/282462/make-a-floor-plan-given-the-number-of-doorways/282474#282474">Neil</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://www.perl.org/" rel="nofollow noreferrer">Perl 5</a>, 243 (+3) <s> 253 </s> bytes</h1>

<pre class="lang-perl prettyprint-override"><code>$.=@{eval-&gt;[0]};for((@d,$_)=/\d/g;$L&lt;@d;$_= /-|[12]\n|(.\n?){@d-$.,}[23]/?pop@a:$_.(($n=$d[$L]-/[12]$/-/[23].{$.}$/s)==1?!!push@a,$_.3:$n)){($L=y/0-3//)%$.or$_.= $\}s/./ $&amp;/g;$s.=&quot;\n|&quot;.y/3012/|| /r.($y=y/\n 2301/++  -/r)for /.+\n/g;print $y,$s
</code></pre>
<p><a href="https://tio.run/##RY/faoUwDMbv9xQ9h2y02Cb@YTfHdfYBfAMVETzbDkgt9mwg6qvP1V1sBBLySz7yxV2n4XnfAbVZrl/doF6ruNnyt3Hi3PQSWqGp7uk9h/LF9Dm0mpFaqyRtartyrG0hFtMrQLlVadZQ4UZnugu0yDlYDX0FZaPoEACFGnZwAdyAvNA6KU4n9@k/TBcuYXYBK8TCodQzxSojEo@A4xRGmkG9eUJi8HSY8ajPwcAZZ8riJKV1ZTQhhzkoa8vSACmKGFM0ifALI4xqG4Ruutk7g1mC3/fqgbEqkX/RyAPEMg7NkdN/cKD0FzTfo7vfRut3Ndj4Bw" rel="nofollow noreferrer" title="Perl 5 – Try It Online">Try it online!</a></p>
<p>The ugly warning in STDERR is harmless and because of 5.28 version at TIO, it can be ignored. E.g., no such warning at ATO (it's 5.40 there). If it hurts too much, let it be +1 to the result: escape that brace as in original answer (and in commented version below). &quot;+3&quot; is for CLI switches.</p>
<p>Somewhat un-golfed and commented:</p>
<pre class="lang-perl prettyprint-override"><code># Input as string, which is valid Perl, is already in $_.
# Parse it to get row width.
# Convert string to flat list of digits,
# clear the default variable.
$. = @{ eval-&gt;[0] };
( @d, $_ ) = /\d/g;
# Find the solution with brute force.
# Proceed while solution length is less than number of digits.
# Go cell by cell, row by row. As dumb as that.
while ( $L &lt; @d ) {
# Solution, partial (current or stored in &quot;investigate later&quot; queue)
# or the final, is a string of chars, 1 is &quot;open the door to the right&quot;, 
# 3 -- down, 2 -- both, 0 -- none of them. The &quot;\n&quot; is for (imaginary) 
# &quot;guard&quot; column on the right of the plan. Rows are just concatenated.
# Get number of cells processed.
    $L = y/0-3//;
# Append LF for guard column.
    $L % $. or $_ .= $\;
# Look left and up, calculate number of doors remaining to be open.
    $n = $d[$L] - /[12]$/ - /[23].{$.}$/s;
# Always append it to solution. The check occurs at next iteration.
# Discard current solution if number was negative, or right door was
# opened in rightmost column, or down door was opened in lowest row.
# Pop from the queue then. Branching only happens if there is one door 
# remaining to be open. Try opening to the right 1st.
    $_= /-|[12]\n|(.\n?)\{@d-$.,}[23]/
        ? pop @a
        : $_.( $n == 1 ? !!push @a, $_.3 : $n )
}
# The final solution happens to have leading LF and trailing '0'. 
# They are golfing artifacts and irrelevant for output.
# Convert the solution to ASCII plan, one row of 0-3 digits to 
# two rows of output. Repeat (prepend) final line at the beginning.
s/./ $&amp;/g;
$s .= &quot;\n|&quot;.y/3012/|| /r
   . ($y=y/\n 2301/++  -/r)
for /.+\n/g;
print $y,$s
</code></pre>
</div>
<div id="pu1" class="pu"><h1><a href="https://www.maplesoft.com/" rel="nofollow noreferrer">Maple</a>, <s> 472 </s> 456 bytes</h1>
<pre><code>proc(s)m:=nops(s);n:=nops(s[1]);M,N:=2*m+1,2*n+1;X:=Matrix(M,N,(i,j)-&gt;`if`(`and`((i,j)::~odd),&quot;+&quot;,&quot; &quot;));e:=();for p to m do for q to n do i,j:=2*p,2*q;e,=x[i,j-1]+x[i,j+1]+x[i-1,j]+x[i+1,j]=s[p,q]od od;f:={seq([x[1,p],x[M,p]][],p=2..N,2),seq([x[q,1],x[q,N]][],q=2..M,2)}=~0;Z:=subs(f,{e});Y:=indets(Z);assign(subs(x=X,map(d-&gt;`if`(rhs(d)=1,NULL,`if`(op(1,(h:=lhs(d)))::odd,h=&quot;-&quot;,h=&quot;|&quot;)),SMTLIB:-Satisfy({Z[],(Y&gt;=~0)[],(Y&lt;~2)[]})union f)));printf(&quot;%s&quot;,X)end;
</code></pre>
<p>For m rows of rooms and n columns of rooms, set up a (2<em>m+1) x (2</em>n+1) matrix X=(x)_{i,j} with an entry for each character in the printout. Set up spaces in room interiors and &quot;+&quot; at the room corners. Set up the walls for the perimeter with values 0 (0 = wall, 1 = door). So for the p,q th room (p = 1,..,m, q = 1,..,n) with given wall number s[p,q], we have x[2<em>p,2</em>q-1]+x[2<em>p,2</em>q+1]+x[2<em>p-1,2</em>q]+x[2<em>p+1,2</em>q] = s[p,q]. Solve these equations and fill in walls of the correct type.</p>
<p>Slightly ungolfed:</p>
<pre><code>proc(s)
m:=nops(s);
n:=nops(s[1]);
M,N:=2*m+1,2*n+1;
# X is matrix of characters; start with &quot;+&quot; and &quot; &quot;
X:=Matrix(M,N,(i,j)-&gt;`if`(`and`((i,j)::~odd),&quot;+&quot;,&quot; &quot;));
e:=();                      # initialize eqns to solve
for p to m do for q to n do
i,j:=2*p,2*q;
e,=x[i,j-1]+x[i,j+1]+x[i-1,j]+x[i+1,j]=s[p,q]  # eqns for door numbers
od od;
# f sets wall variables around the boundary to zero
f:={seq([x[1,p],x[M,p]][],p=2..N,2),seq([x[q,1],x[q,N]][],q=2..M,2)}=~0;
Z:=subs(f,{e});                                # set known wall vals in eqns
Y:=indets(Z);
C:=(Y&gt;=~0)[],(Y&lt;~2)[];                         # conditions for all variables 0 or 1            
R:=SMTLIB:-Satisfy({Z[],C});                   # find a solution
# where there are walls, substitute &quot;|&quot; or &quot;-&quot; (doors are already &quot; &quot;)
S:=map(d-&gt;`if`(rhs(d)=1,NULL,`if`(op(1,(h:=lhs(d)))::odd,h=&quot;-&quot;,h=&quot;|&quot;)),R union f);
assign(subs(x=X,S));
printf(&quot;%s&quot;,X)                                 # print out as string
end;
</code></pre>
</div>
<div id="pu2" class="pu"><h1>JavaScript (ES6), 198 bytes</h1>
<p>Returns a string.</p>

<pre class="lang-javascript prettyprint-override"><code>m=&gt;{for(N=0;n=N++,s=&quot;&quot;,m.some((r,y)=&gt;r.some(v=&gt;v^(k=n&amp;!!y+2*!!x++,p+=k&amp;1?&quot; +&quot;:&quot;-+&quot;,q+=k&amp;2?&quot;  &quot;:&quot;| &quot;,n&gt;&gt;2*r.length&amp;!!m[y+1])+((n/=4)/2&amp;!!r[x])-~k/2,p=&quot;+&quot;,x=q=`
`)|(y?0:t=p,s+=p+q+`|
`)););return s+t}
</code></pre>
<p><a href="https://tio.run/##bYxNboMwEIX3nGLwIrIz5ldZBQ25QS5AqYhSSFvAgKEIVNqrU6dRpEaqNJv3vXnf@2k89Wf91g6Oal7ytaC1pvizaDQ/kh8pOiLKnhiTtds3dc65lrOgWN/SSPH4zEtSG9ueMdza9mT@W6RyExwYINszB5nsriA0AAxYgEkVx@FWu1WuLsOr2dbJjEEqkHPl0U54oWE6mVLhfJdeKFtixjJRR5mViYXPB38/UCt7pBY7zBZDRSQinQ8fWkGPw9d6blTfVLlbNRde8MQCSMCXEEjwIZW/MZSwM@Qeg3trpQIQ2JNiIrL@85jh9f54/Md4a41HROsP" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<h3>Method</h3>
<p>We use a brute-force search that increments a counter <code>N</code> until its bits represent a set of doorways compatible with the input matrix.</p>
<p>We build the output string <code>s</code> while testing the bits. Each row of the input matrix is turned into two strings <code>p</code> and <code>q</code>, representing horizontal and vertical doorways respectively. The last line is a copy of the first line (saved in <code>t</code>), where all doors are closed.</p>
<p>We use 2 bits per cell to encode the doorways to the North (bit #0) and to the West (bit #1). A cleared bit means <em>closed</em>. A set bit means <em>open</em>.</p>
<p>We have 3 cells to test to compute the total number of doorways at a given position:</p>
<p><a href="https://i.sstatic.net/o9tnGbA4.png" rel="nofollow noreferrer"><img src="https://i.sstatic.net/o9tnGbA4.png" alt="encoding" /></a></p>
<h3>Commented</h3>
<pre class="lang-javascript prettyprint-override"><code>m =&gt; {                     // m[] = input matrix
for(                       // main loop
  N = 0;                   // start with a counter N set to 0
  n = N++,                 // copy N to n, then increment N
  s = &quot;&quot;,                  // start each iteration with s = &quot;&quot;
  m.some((r, y) =&gt;         // for each row r[] at index y in m[]:
    r.some(v =&gt;            //   for each value v in r[]:
      v ^ (                //     compare v against the sum of doorways
        k = n &amp;            //     k = doorway bitmask of the current cell:
          !!y +            //       allow bit #0 if y != 0
          2 * !!x++,       //       allow bit #1 if x != 0 (and increment x)
        p += k &amp; 1 ? &quot; +&quot;  //     add &quot; +&quot; to p if bit #0 is set,
                   : &quot;-+&quot;, //     or &quot;-+&quot; otherwise
        q += k &amp; 2 ? &quot;  &quot;  //     add &quot;  &quot; to q if bit #1 is set,
                   : &quot;| &quot;, //     or &quot;| &quot; otherwise
                           //     test the doorways with touching cells:
        n &gt;&gt; 2 * r.length  //     1. the cell below
        &amp; !!m[y + 1]       //        force a door if it's the last row
      ) + (                //
        (n /= 4) / 2       //     2. the cell to the right
        &amp; !!r[x]           //        force a door if it's the last column
                           //        (we also update n)
      ) - ~k / 2,          //     count the doorways of the current cell
                           //     (number of bits set in k)
      p = &quot;+&quot;,             //     start with p = &quot;+&quot;
      x = q = `\n`         //     start with q = &quot;\n&quot; and x zero'ish
    ) | (                  //   end of inner some()
      y ? 0 : t = p,       //   if this is the first row, save p in t
      s += p + q + `|\n`   //   append p, q, a pipe and a newline to s
    )                      //
  );                       // end of outer some()
);                         // end of for()
return s + t }             // return s + t
</code></pre>
</div>
<div id="pu3" class="pu"><h1>Python3, 800 bytes</h1>
<pre class="lang-py prettyprint-override"><code>from itertools import*
E=enumerate
def f(b):
 V=['+',*'+'.join('-'*len(b[0])),'+']
 U=[k for i in b for k in[V,['|',*'|'.join(' '*len(i)),'|']]]+[V]
 q=[S:={(x,y):v for x,r in E(U)for y,v in E(r)if v in['|',' ','-']}]
 M=dict(zip([i for i in q[0]if' '==q[0][i]],[j for k in b for j in k]))
 for c in q:
  T,F=[],0
  for x,y,o in[(x,y,[(x+X,y+Y)for X,Y in[(1,0),(-1,0),(0,-1),(0,1)]])for x,y in c if' '==S[(x,y)]]:
   if M[(x,y)]&gt;(H:=sum(c[O]==' 'for O in o)):T+=[(x,y,o)]
   if M[(x,y)]&lt;H:F=1
  if[]==T:
   for X,Y in c:U[X][Y]=c[(X,Y)]
   return'\n'.join(map(''.join,U))
  if F:continue
  x,y,o=T[0]
  for t in combinations([(X,Y)for X,Y in o if(c[(X,Y)]=='|'and 0&lt;Y-1 and Y+1&lt;len(U[0])-1)or(c[(X,Y)]=='-'and 0&lt;X-1 and X+1&lt;len(U)-1)],M[(x,y)]-sum(c[O]==' 'for O in o)):q+=[{**c,**{i:' 'for i in t}}]
</code></pre>
<p><a href="https://tio.run/##hVLBjtowEL3nKyz1EDuZVEnpoYpwb4v2strDAgK5PkBIVMPGBhNWS2G/nR07CWwrVSsrycz4vTfPE2@PzW@jBz@29nKprKmJakrbGPO8J6reGttEwR0v9aEu7aIpg1VZkYouWR6QKRdhHEKEr69rozQNkzB6LjVdilQyBliXAZlwsSGVsUQRpcnShxsMxRREeHb0c08nLV057jmUUsZiigo7Lp5yfqKvcGT5ixd4BevU7uiEufQIL21qmaqIi700CgJ6km8o8sBXqmjoH7WlQt387NCqqhDIuQuFkhLE@mqy87t24QbPFPi08EycABnDiAsJKYatrSMY1915BXzHMzjGc@9xBnO/k0HKgCbtJ4Uk85@MSck6CaeOLVpXT14Ld107LJKHrvCT3ud8f6hpIR4l5wh29EdHNozl45i3LgyT/zCH9/mIZ4GrCWSOvfLNIinyiZhJMZe8EBRrrYAtm4PV4S/d/a16saVhG8PETca1GOWF0Y3ShxJz352PcazdeBqvbuql0otGGb2nrf6H3ji9ivZt8VTncKFXJB3Ok4y4aB5nQ3dHJu6K4eyM/YhOOvSsQ896tINK6AeQ/H9sOxzbKYoKiKKTyrtdf1Oatzd52VqlG1pREQj8Z5BKCMQ3@A6ZCzJfCdw1aXHhlzAapH3mWIQgvFtI8WkGA3yuqde9pTfwp7qDv1Uz7wqTDHqvn0hkcF0tM@3cXP2k0Jauji7v" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu4" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="noreferrer">Charcoal</a>, <s>226</s> 165 bytes</h1>
<pre><code>ＷＳ⊞υιυＵＥ¹¦¹ＦＬυＦＬθ«Ｊ⊖⊗κ⊖⊗ιＢ³¦³»≔⁰ηＷ‹ηＬΣυ«Ｊ⊗﹪ηＬθ⊗÷ηＬθ≔ΦrdΣ⊟ＫＤ³✳κζ≔›ΣＫＫＬζεＷε«≔dζ≦⊖ηＪ⊗﹪ηＬθ⊗÷ηＬθ≔¬∧Σ⊟ＫＤ³↓⁼ -Φ⪫ＫＶω﹪μ³εＰ0ＦΦＥrdＫＤ³✳λ№λ ＵＭλ⎇⊖νＩ⊕μ|Ｐ¶-»ＦΣＫＫＵＭＫＤ³✳§ζκ⎇⊖μＩ⊖λ ≦⊕η 
</code></pre>
<p><a href="https://tio.run/##rVPBbtswDD3HXyHoJAMOEDe37ZTV3ZCiLQK02GkXN2ZjIbLkylKTZeu3e6SsIM7W9VQDtkWKfO@RotZ1ademVH2/q6UCJpa69e7eWak3Ik3Zyne18BmT6edkhU4nPK6u9g50JfKM5Wg9GcvEDeiNw1DMGdvPaP9KJte@aR@MKGBtoQHtoBKF8Y8K/9s0zdhbGzJNEXzyxezFPGNzXL8mi66TGy1mGavRjpJvoOtEnbFIee8bknFOHDFvTeWVGQWjPqKP20vtCvkiK/grgnRE6q9SObCC24pnjKhWphUrgG0hLaydNJrUnowtpSPFYYTxzUJJICEdUwUFRLoDrYGCY3UQ6jimcqINWJPbso3OUfeGxkw@sO4j851xYoGH/t@aPxVmpwPs1bMvVSc4m6LY2LBrI3XI@W70Hfim1Fpg6A7fKK6hQx6aBUOBXjnZhqHjMx5cYbQiItYfj@Gd9quAd2k8gqiMccZpMDD10jSooSLnA1hd2p9n06kpq@wctubkbAiL/@bpP/J@6GkQ@JoMEkcne8b2jtKFW@oK9uKQsW0Q/Zas5ihr7FRBFhtknaZipDxOxXCBKRLvUt9f0JNc5PMcv7N8ht/g6acv6g8" rel="noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Takes input as a rectangular list of newline-terminated digit strings. Explanation:</p>
<pre><code>ＷＳ⊞υιυ
</code></pre>
<p>Input the floorplan and write it to the canvas.</p>
<pre><code>ＵＥ¹¦¹ＦＬυＦＬθ«Ｊ⊖⊗κ⊖⊗ιＢ³¦³»
</code></pre>
<p>Space out the digits and draw boxes around each of them.</p>
<pre><code>≔⁰ηＷ‹ηＬΣυ«
</code></pre>
<p>Loop until all of the rooms have been processed.</p>
<pre><code>Ｊ⊗﹪ηＬθ⊗÷ηＬθ
</code></pre>
<p>Jump to the current room.</p>
<pre><code>≔ΦrdΣ⊟ＫＤ³✳κζ
</code></pre>
<p>Find the remaining possible doorways (i.e. that are down or right and lead to a room which still wants at least one more doorway).</p>
<pre><code>≔›ΣＫＫＬζε
</code></pre>
<p>See if there are more doorways wanted than possible.</p>
<pre><code>Ｗε«≔dζ
</code></pre>
<p>While we need to backtrack, set the possible doorways to down.</p>
<pre><code>≦⊖ηＪ⊗﹪ηＬθ⊗÷ηＬθ
</code></pre>
<p>Move to the previous room.</p>
<pre><code>≔¬∧Σ⊟ＫＤ³↓⁼ -Φ⪫ＫＶω﹪μ³ε
</code></pre>
<p>See if this was a room where we chose a single right doorway but it had both doorways available, in which case we can stop backtracking.</p>
<pre><code>Ｐ0
</code></pre>
<p>Restore the doorway count to this room.</p>
<pre><code>ＦΦＥrdＫＤ³✳λ№λ ＵＭλ⎇⊖νＩ⊕μ|
</code></pre>
<p>Remove any previous right or down doorways.</p>
<pre><code>Ｐ¶-
</code></pre>
<p>The above restored the down wall with <code>|</code>, so correct that now.</p>
<pre><code>»ＦΣＫＫＵＭＫＤ³✳§ζκ⎇⊖μＩ⊖λ ≦⊕η 
</code></pre>
<p>This room can now be satisfied, so create the desired number of doorways and move to the next room, clearing the doorway count.</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/282462/">282462</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




