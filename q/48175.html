<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::48175</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>nan</td><td></td><td>150411T130327Z</td><td><a href="https://codegolf.stackexchange.com/questions/48175/ipv4-subnet-list-cleaner-in-cidr-notation/48746#48746">F. Hauri</a></td></tr>
<tr d-ix="1"><td>094</td><td>CJam</td><td>150327T055431Z</td><td><a href="https://codegolf.stackexchange.com/questions/48175/ipv4-subnet-list-cleaner-in-cidr-notation/48212#48212">jimmy230</a></td></tr>
<tr d-ix="2"><td>172</td><td>Perl</td><td>150402T135115Z</td><td><a href="https://codegolf.stackexchange.com/questions/48175/ipv4-subnet-list-cleaner-in-cidr-notation/48370#48370">nutki</a></td></tr>
<tr d-ix="3"><td>1040</td><td>Pure bash</td><td>150329T135415Z</td><td><a href="https://codegolf.stackexchange.com/questions/48175/ipv4-subnet-list-cleaner-in-cidr-notation/48263#48263">F. Hauri</a></td></tr>
<tr d-ix="4"><td>425</td><td>Ruby</td><td>150401T090327Z</td><td><a href="https://codegolf.stackexchange.com/questions/48175/ipv4-subnet-list-cleaner-in-cidr-notation/48325#48325">Not that</a></td></tr>
</table>
<div id="pu0" class="pu"><h3>Javascript ~1335</h3>

<p>While total js is 2009, the essential part is contained in two function and main routine. html, css and ~674 chars of javascript in only cosmetic.</p>

<p><div class="snippet" data-lang="js" data-hide="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint-override"><code>var g={};function B(){document.getElementById('z').addEventListener('click',go);
window.addEventListener('resize',C);C();}function C(){document.getElementById('y'
).setAttribute('style','height:'+(window.innerHeight-46-document.getElementById(
'y').offsetTop).toFixed(0)+"px");document.getElementById('x').setAttribute(
'style','height:'+(window.innerHeight-46-document.getElementById('x').offsetTop
).toFixed(0)+"px");}function go(){document.getElementById('y').innerHTML='';
document.getElementById('A').innerHTML='...running...';w()
}function u(q,j){var o=Object.keys(g).sort(function(a,b){return a-b}),s,e;for(var
i=0;i&lt;o.length;i++){if((q*1&gt;=o[i]*1+1)&amp;(q&lt;=g[o[i]]*1+1))s=1*o[i];if((j*1&gt;=o[i]-1
)&amp;(j&lt;=g[o[i]]-1))e=1*o[i]};if(typeof(s)!=='undefined'){if(typeof(e)!=='undefined'
){if(1*s&lt;1*e){g[s]=g[e];delete g[e]}}else{if(1*q&lt;1*s){g[q]=g[s];delete g[s];s=q};
if(1*j&gt;1*g[s])g[s]=j}}else{if(typeof(e)!=='undefined'){if(1*q&lt;1*e){g[q]=g[e];
delete g[e];e=q};if(1*j&gt;1*g[e])g[e]=j}else{g[q]=j}}}function v(f,p){var e,ie,c=''
;while(typeof(f)!=='undefined'){e=32;while((ie=(~0&lt;&lt;(33-e))&gt;&gt;&gt;0)&amp;&amp;(f==((f&gt;&gt;(33-e)
)&lt;&lt;(33-e))&gt;&gt;&gt;0)&amp;&amp;(p&gt;=(((~0&lt;&lt;32)^ie)|f)&gt;&gt;&gt;0)&amp;&amp;(e&gt;0))e--;c+=(f&gt;&gt;24&amp;255)+"."+(f&gt;&gt;16&amp;
255)+"."+(f&gt;&gt;8&amp;255)+"."+(f&amp;255);c+='/'+e+'&lt;br/&gt;';ie=e&gt;0?(~0&lt;&lt;(32-e))&gt;&gt;&gt;0:0;if(p&gt;(
(f|(~0&lt;&lt;32)^ie))&gt;&gt;&gt;0){var d=f;f=1*1+((f|((~0&lt;&lt;32)^ie))&gt;&gt;&gt;0)}else{f=undefined}}
return c}function w(){var l=[];g={};document.getElementById('A').innerHTML+=
'&lt;br/&gt;reading...';var n=document.getElementById('x').value.split("\n");for(var
i=0;i&lt;n.length;i++){if(!n[i].match("/"))n[i]+="/32";var s=n[i].match(
/(\d+)\.(\d+)\.(\d+)\.(\d+)\/(\d+)/);if((s)&amp;&amp;(s.length==6)){var k=(s[1]&lt;&lt;24|s[2]
&lt;&lt;16|s[3]&lt;&lt;8|s[4])&gt;&gt;&gt;0;var e=(~0&lt;&lt;(32-s[5]))&gt;&gt;&gt;0;var t=(~0&amp;k&amp;e)&gt;&gt;&gt;0;var r=(((~0
&lt;&lt;32)^e)|t)&gt;&gt;&gt;0;u(t,r);}};var o=Object.keys(g).sort(function(a,b){return a-b});
var h=-1;for(i=0;i&lt;o.length;i++){if(1*o[i]&gt;1*h){h=g[o[i]];document.getElementById
('y').innerHTML+=v(o[i],g[o[i]]);}}document.getElementById('A').innerHTML+=
'&lt;br/&gt;printing...'};window.onload=B;</code></pre>
<pre class="snippet-code-css lang-css prettyprint-override"><code>body{font-family:Sans;background:#9ac;}#z{position:absolute;top:3em;right:2%;}
span button, span input{font-size:.63em;}#A{width:50%;min-height:3.4em;background:
#679;border:1px solid black;border-color:white black black white;border-radius:
.5em;padding:.2em 1em .2em 1em;margin:1em 0px .1em 0px;margin-left:24%;color:
#cdf;box-shadow: 2px 2px 4px black;}#y{width:72%;overflow:auto;margin-left:24%;
background:#bce;padding:1em;border-radius:.8em;border:1px solid black;box-shadow:
2px 2px 4px;border-color:white black black white;}#x{position:fixed;top:1.5em;
left:1%;padding:1em;width:18%;anchor:left;height:33em;border-radius:.3em;border:
1px solid black;border-color:white black black white;box-shadow:2px 2px 4px;}</code></pre>
<pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;button id="z"&gt; GO &lt;/button&gt;&lt;textarea id="x"&gt;&lt;/textarea&gt;&lt;div id="A"&gt;---&lt;/div&gt;&lt;pre id="y"&gt;&lt;/pre&gt;</code></pre>
</div>
</div>
</p>
</div>
<div id="pu1" class="pu"><h1>CJam, <strike>101</strike> <strike>95</strike> 94</h1>
<pre><code>qN/{'//('./1\+256b2b\{i)&lt;}/}%_|{{):T;_aM+:M(a&amp;}gT+}%${_2$#!{;}*}*]{_(!a32*+32&lt;8/2fb'.*'/@,(N}%
</code></pre>
<p>The <code>{~}2j</code> construct didn't make it shorter...</p>
<p><a href="http://cjam.aditsu.net/#code=qN%2F%7B%27%2F%2F%28%27.%2F1%5C%2B256b2b%5C%7Bi%29%3C%7D%2F%7D%25_%7C%7B%7B%29%3AT%3B_aM%2B%3AM%28a%26%7DgT%2B%7D%25%24%7B_2%24%23!%7B%3B%7D*%7D*%5D%7B_%28!a32*%2B32%3C8%2F2fb%27.*%27%2F%40%2C%28N%7D%25&amp;input=192.168.5.16%2F30%0A192.168.5.18%0A192.168.2.231%2F27%0A192.173.17.0%2F24%0A192.168.1.5%2F32%0A192.168.5.18%2F32%0A192.168.3.0%2F24%0A192.168.2.231%2F27%0A192.168.2.245%2F29%0A192.168.4.0%2F29%0A192.173.16.0%2F24%0A192.173.18.0%2F24%0A192.173.19.0%2F24%0A10.100.12.24" rel="nofollow noreferrer">Try it here</a>. (<a href="http://cjam.aditsu.net/#code=qN%2F%7B%27%2F%2F%28%27.%2F1%5C%2B256b2b%5C%7Bi%29%3C%7D%2F%7D%2525_%7C%7B%7B%29%3AT%3B_aM%2B%3AM%28a%26%7DgT%2B%7D%2525%24%7B_2%24%23!%7B%3B%7D*%7D*%5D%7B_%28!a32*%2B32%3C8%2F2fb%27.*%27%2F%40%2C%28N%7D%2525&amp;input=192.168.5.16%2F30%0A192.168.5.18%0A192.168.2.231%2F27%0A192.173.17.0%2F24%0A192.168.1.5%2F32%0A192.168.5.18%2F32%0A192.168.3.0%2F24%0A192.168.2.231%2F27%0A192.168.2.245%2F29%0A192.168.4.0%2F29%0A192.173.16.0%2F24%0A192.173.18.0%2F24%0A192.173.19.0%2F24%0A10.100.12.24" rel="nofollow noreferrer">And link for Firefox</a>.)</p>
<h3>Explanation</h3>
<pre><code>qN/               &quot; Read each line. &quot;;
{                 &quot; For each line: &quot;;
    '//           &quot; Split by / &quot;;
    ('./          &quot; Split first item by . &quot;;
    1\+256b2b     &quot; The address + 2^32 in base 2, which always has length 33 &quot;;
    \{i)&lt;}/       &quot; For each other items N (if any), get the first N+1 bits. &quot;;
}%
_|                &quot; Remove duplicates. &quot;;
{                 &quot; For each item (each array of bits): &quot;;
    {             &quot; Do: &quot;;
        ):T;      &quot; Remove last bit and save it in T. &quot;;
        _aM+:M    &quot; Add the array to M. &quot;;
        (a#)      &quot; Find the array in the original M. &quot;;
    }g            &quot; while it is found. &quot;;
    T+            &quot; Append the last T back. &quot;;
}%
$                 &quot; Sort. &quot;;
{                 &quot; Reduce and wrap in array: &quot;;
    _2$#!         &quot; Test if the previous string is a prefix of the current. &quot;;
     {;}*         &quot; If so, discard it. &quot;;
}*]
{                 &quot; For each item (each array of bits): &quot;;
    _(!a32*+32&lt;   &quot; Remove first bit and pad to 32 bits to the right. &quot;;
    8/2fb'.*      &quot; Convert to IP address. &quot;;
    '/@,(         &quot; Append / and original length - 1. &quot;;
    N             &quot; Append a newline. &quot;;
}%
</code></pre>
</div>
<div id="pu2" class="pu"><h1>Perl, 172 <s>223 245</s></h1>

<p>Using hashes was not necessary. The removal allowed for a significantly shorter code, though the idea is the same.</p>

<pre><code>#!perl -lp0a
$_=join$\,sort map{1x(s/\d*./unpack B8,chr$&amp;/ge&gt;4?$&amp;:32)&amp;$_}@F;1while s/^(.*)
\1.*/$1/m||s/^(.*)0
\1.$/$1/m;s!^.*!(join'.',map{ord}split'',pack B32,$&amp;).'/'.length$&amp;!gme
</code></pre>

<p>Test <a href="http://#!perl%20-lp0a%20$_=join$%5C,sort%20map%7B1x(s/%5Cd*./unpack%20B8,chr$&amp;/ge%3E4?$&amp;:32)&amp;$_%7D@F;1while%20s/%5E(.*)%20%5C1.*/$1/m%7C%7Cs/%5E(.*)0%20%5C1.$/$1/m;s!%5E.*!(join&#39;.&#39;,map%7Bord%7Dsplit&#39;&#39;,pack%20B32,$&amp;).&#39;/&#39;.length$&amp;!gme" rel="nofollow">me</a>.</p>

<p>Older version with explanation:</p>

<pre><code>#!perl -lp0a
s/(^|\.)(\d+)/sprintf"%08b",$2/ge,/\D/&amp;&amp;($_=$`|2x$',y/0-3/##01/)for@F;$_=join$\,sort@F;1while s/^((\d*)#*)
\2.*/$1/mg||s/^(\d*)0(#*)
\1[1]\b#*/$1#$2/mg;s!.+!$&amp;.'/'.$&amp;=~y/01//!ge;y/#/0/;s!\d{8}\B!$&amp;.!g;s!\d{8}!"0b$&amp;"!gee
</code></pre>

<p>Test <a href="http://ideone.com/xHIIab" rel="nofollow">me</a>.</p>

<p>First convert input to textual format (<code>s/(^|\.)(\d+)/sprintf"%08b",$2/ge,/\D/&amp;&amp;($_=$p|2x$',y/0-3/##01/)</code>):</p>

<pre><code>00##############################
01##############################
11##############################
10##############################
</code></pre>

<p>Sort it (<code>$_=join$\,sort@F</code>):</p>

<pre><code>00##############################
01##############################
10##############################
11##############################
</code></pre>

<p>Clean using two regexps: one to remove duplicates and more specific addresses and the second to join two adjacent networks into one with a longer mask (<code>s/^((\d*)#*)\n\2.*/$1/mg</code> and <code>s/^(\d*)0(#*)\n\1[1]\b#*/$1#$2/mg</code>).</p>

<pre><code>################################
</code></pre>

<p>And convert back to the original form (<code>s!.+!$&amp;.'/'.$&amp;=~y/01//!ge;y/#/0/;s!\d{8}\B!$&amp;.!g;s!\d{8}!"0b$&amp;"!gee</code>):</p>

<pre><code>0.0.0.0/0
</code></pre>
</div>
<div id="pu3" class="pu"><h3>Pure bash <s>1100</s> <s>1079</s> 1040</h3>

<p><strong>Edited:</strong> A little <s>better</s> more <em>golfed</em>!</p>

<pre><code>#!/bin/bash -i
alias d=done e=unset f=printf\ -v g=local h=else i=then j=for k=while C=do E=fi
n(){ g s e i;j i in ${!u[@]};C [ $1 -ge $[i+1] ]&amp;&amp;[ $1 -le $[u[i]+1] ]&amp;&amp;s=$i
[ $2 -ge $[i-1] ]&amp;&amp;[ $2 -le $[u[i]-1] ]&amp;&amp;e=$i;d;if [ "$s" ];i if [ "$e" ];i \
[ $s -ne $e ]&amp;&amp;{ u[s]=${u[e]};e u[e];};h [ $1 -lt $s ]&amp;&amp;{ u[$1]=${u[s]};e u[s
];s=$1;};[ $2 -gt ${u[s]} ]&amp;&amp;u[s]=$2;E;h if [ "$e" ];i [ $1 -lt $e ]&amp;&amp;{ u[$1
]=${u[e]};e u[e];e=$1;};[ $2 -gt ${u[e]} ]&amp;&amp;u[e]=$2;h u[$1]=$2;E;E;};q(){ 
g s=${1#*/} m=${1%/*} z;[ -z "${s//*.*}" ]&amp;&amp;s=32;y $s z;set -- ${m//./ }
m=$[$1&lt;&lt;24|$2&lt;&lt;16|$3&lt;&lt;8|$4];n $[m&amp;z] $[m|((2**32-1)^z)];};y(){ f $2 "%u" $[ (
2**32-1)^(~0^~0&lt;&lt;(32-$1))];};r(){ f $2 "%s" $[$1&gt;&gt;24].$[$1&gt;&gt;16&amp;255].$[$1&gt;&gt;8&amp;
255].$[$1&amp;255];};t(){ g s z;k [ "$1" ];C s=32;k y $[s-1] z&amp;&amp;[ $1 = $[($1&gt;&gt;(33
-s))&lt;&lt;(33-s)] ]&amp;&amp;[ $2 -ge $[$1|((2**32-1)^z)] ];C ((s--));d;r $1 x;echo $x/$s
y $s z;if [ $2 -gt $[$1|((2**32-1)^z)] ];i set -- $[1+($1|((2**32-1)^z))] $2
h shift 2;E;d;};k read w;C q $w;d;p=-1;j o in ${!u[@]};C [ $o -gt $p ]&amp;&amp;p=${u[
o]}&amp;&amp;t $o ${u[o]};d
</code></pre>

<p>which work quickly, even on wide ranges!</p>

<pre><code>./myscript.sh &lt;&lt;&lt;"63.168.3.85/2\n64.168.3.85/2\n192.168.3.85/2\n191.168.3.85/2"
0.0.0.0/0

./myscript.sh &lt; &lt;(for i in {167772416..167774464};do
     [ $i -gt 167773316 ] &amp;&amp; [ $i -lt 167773556 ] ||
         echo $[i&gt;&gt;24].$[i&gt;&gt;16&amp;255].$[i&gt;&gt;8&amp;255].$[i&amp;255]/30
   done)
10.0.1.0/24
10.0.2.0/23
10.0.4.0/25
10.0.4.128/29
10.0.5.116/30
10.0.5.120/29
10.0.5.128/25
10.0.6.0/23
10.0.8.0/24
10.0.9.0/30
</code></pre>
</div>
<div id="pu4" class="pu"><h2>Ruby - 425</h2>
<p>(broken - see comment below)</p>
<pre><code>a=(0..32).map{[]}
l=-&gt;m{2**m-1&lt;&lt;32-m}
$&lt;.map{|i|/\//=~i=i[?/]?i:i.chop+'/32'
s=$'.to_i
n=$`.split(?.).inject(0){|v,d|v*256+d.to_i}
next if s.times.any?{|t|a[t].any?{|e|n&amp;l[t]==e[1]}}
s.upto(32){|t|a[t].reject!{|e|e[1]&amp;l[s]==n}}
a[s]&lt;&lt;[i,n]
(b=k=n&amp;l[s]
break if(y=a[s+1].select{|e|e[1]&amp;l[s]==b}).size&lt;2
a[s+1]-=y
a[s]&lt;&lt;[(0..3).map{k,i=k.divmod(256);i}.reverse*?.+?/+s.to_s,b])until(s-=1)&lt;0}
puts a.flatten(1).sort_by{|v|v.pop}
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/48175/">48175</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




