<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::199102</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>2523</td><td>K ngn/k</td><td>200207T045920Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199107#199107">ngn</a></td></tr>
<tr d-ix="1"><td>068</td><td>Ruby</td><td>200207T032732Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199105#199105">Value In</a></td></tr>
<tr d-ix="2"><td>085</td><td>Haskell</td><td>200210T003507Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199198#199198">Lemming</a></td></tr>
<tr d-ix="3"><td>088</td><td>Ruby</td><td>200211T194258Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199327#199327">Level Ri</a></td></tr>
<tr d-ix="4"><td>121</td><td>Lua 5.3</td><td>200208T053628Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199152#199152">JackMacW</a></td></tr>
<tr d-ix="5"><td>060</td><td>Python</td><td>200207T041633Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199106#199106">xnor</a></td></tr>
<tr d-ix="6"><td>128</td><td>C++ gcc</td><td>200207T132348Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199129#199129">Noodle9</a></td></tr>
<tr d-ix="7"><td>054</td><td>Charcoal</td><td>200207T235121Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199147#199147">Neil</a></td></tr>
<tr d-ix="8"><td>017</td><td>Jelly</td><td>200207T105213Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199123#199123">Nick Ken</a></td></tr>
<tr d-ix="9"><td>074</td><td>Ruby</td><td>200207T125254Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199126#199126">G B</a></td></tr>
<tr d-ix="10"><td>5865</td><td>JavaScript ES6</td><td>200207T141109Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199132#199132">Arnauld</a></td></tr>
<tr d-ix="11"><td>016</td><td>05AB1E legacy</td><td>200207T134453Z</td><td><a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199130#199130">Grimmy</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://bitbucket.org/ngn/k" rel="nofollow noreferrer">K (ngn/k)</a>, 25 bytes (or 23 without imaginary internet points)</h1>

<pre><code>a:&amp;&amp;/1_|':9#2!(!8)+!8#2
a?
</code></pre>

<p><a href="https://tio.run/##y9bNS8/7/z/RSk1N3zC@Rt3KUtlIUUPRQlNb0ULZ6H@ivaG5oYJ@al5yfkoqV6KCkZmCgn5KKoj3HwA" rel="nofollow noreferrer" title="K (ngn/k) – Try It Online">Try it online!</a></p>

<p><code>8#2</code> is the list <code>2 2 2 2 2 2 2 2</code></p>

<p><code>!8#2</code> generates an 8x256 matrix whose columns represent the bits of 0,1,..,255</p>

<p><code>!8</code> is <code>0 1 2 3 4 5 6 7</code></p>

<p><code>(!8)+</code> we add these to the corresponding rows in the matrix</p>

<p><code>2!</code> mod 2</p>

<p><code>9#</code> reshape to 9 rows, i.e. copy the first row after the last to ensure wrap-around (for internet points!)</p>

<p><code>|':</code> boolean or each row with the row above it; with implicit 0 before the first</p>

<p><code>1_</code> drop the first</p>

<p><code>&amp;/</code> boolean and-reduce over the rows - the result is a boolean mask of the encodable numbers</p>

<p><code>&amp;</code> where are the 1s in this mask - return list of ints</p>

<p><code>a:</code> assign to <code>a</code>. the k language makes no distinction between function calls and list indexing, so <code>a</code> can act as the decompress function like this: <code>a 26</code> -> <code>171</code></p>

<p><code>a?</code> is a function that looks up the position of its argument in <code>a</code>. this is our compress function: <code>a?171</code> -> <code>26</code></p>
</div>
<div id="pu1" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, <s>131</s> 68 bytes</h1>
<p>The most trivial answer, which generates all valid numbers (and a few extra values that aren't used) and finding the correct index.</p>
<p>Huge bytesaves thanks to GB, and also realizing I'm allowed to store the numbers list as a separate variable (?)</p>

<pre class="lang-ruby prettyprint-override"><code>a=(0..255).select{|i|i.to_s(4)!~/1|30/}
d=-&gt;n{a[n]}
c=-&gt;n{a.index n}
</code></pre>
<p><a href="https://tio.run/##bczRCsIgGIbhc6/izzHQYM5Wwk62GxkrnAoJw0VuUDi7dVvUYWfvBx/PfRmeKcmGcMYqISjzZjRqDqtdLZuniycnunuVh/XIy4h0U7QuyM71EalvM@u0eYCL6Q@Bc14POCf2XAu6rzaIbwwzUl1BT7A9ENyW2QPOgo1QtJAF1dn@l7r7jD5iZJxObw" rel="nofollow noreferrer" title="Ruby – Try It Online">Try it online!</a></p>
<h3>Imaginary bonus points, 72 bytes</h3>
<pre class="lang-ruby prettyprint-override"><code>a=(0..255).select{|i|&quot;%08b&quot;%(i^85)*2!~/00/}
d=-&gt;n{a[n]}
c=-&gt;n{a.index n}
</code></pre>
<p><a href="https://tio.run/##LczRCoIwFIDh@z3FaSKo4BzSyBt9kbFAt10cqBVtgjHXq6@i7r7/5n@syzPneaw4Y70QNfP2YnWIO@605MNCywrPg6ib/vDqOO8SMWM7uThLpxLRPzN0xm7gUj6eWMCr9WBu8FkQuK/BAy0iJmgnKKKRqP7U8hsqUWKdyW8" rel="nofollow noreferrer" title="Ruby – Try It Online">Try it online!</a></p>
</div>
<div id="pu2" class="pu"><p><strong>Haskell</strong> (85 bytes)</p>

<p>The silly version that maps to at most 54:</p>

<pre><code>import Foreign
p y=2*y.&amp;.y&lt;1
d=filter(p.xor 170)[0..255]
f x=sum[1|y&lt;-d,y&lt;x]
g=(d!!)
</code></pre>

<p><code>f</code> encodes a byte and <code>g</code> decodes.</p>

<p>The next version should be much faster, consists of a bit of bit manipulation, but covers the range from 0 to 63 and requires 92 bytes:</p>

<pre><code>(#)=div
(&amp;)=mod
(k%j)e x=k*e(x#j)&amp;k+e(x&amp;j)&amp;k
f=8%16$(#128).(453*)
g=16%8$(737715168#).(16^)
</code></pre>

<p>Here is the expanded, hopefully more comprehensible version:</p>

<pre><code>module Compress8to6Bit where

import Data.Bits (xor, shiftL, shiftR, (.|.), (.&amp;.))
import Data.Word (Word8)

import qualified Test.QuickCheck as QC


{-
&gt; map compressNibble [0,2,3,8,10,11,14,15]
[0,7,2,4,3,6,1,5]
-}
compressNibble :: Int -&gt; Int
compressNibble x = shiftR (453*x) 7 .&amp;. 7

compress :: Int -&gt; Int
compress x =
   shiftL (compressNibble (shiftR x 4)) 3  .|.  compressNibble (x .&amp;. 15)

decompressNibble :: Int -&gt; Int
decompressNibble x = shiftR 0x2BF8A3E0 (x*4) .&amp;. 15

decompress :: Int -&gt; Int
decompress x =
   shiftL (decompressNibble (shiftR x 3)) 4  .|.  decompressNibble (x .&amp;. 7)


inverseProp :: Word8 -&gt; QC.Property
inverseProp byte =
   let k = fromIntegral byte
       kx = xor 0xAA k
   in kx .&amp;. shiftL kx 1 == 0
      QC.==&gt;
      k == decompress (compress k)
</code></pre>

<p><strong>How?</strong></p>

<p>I found the multiplication trick of <a href="https://codegolf.stackexchange.com/questions/199102/compress-8-bits-to-6-when-certain-bit-patterns-will-never-occur/199132#199132">Arnauld</a> interesting and found that you can do without modulo but simple shift and masking when using the factor 453.</p>

<p>But after all you could also encode dictionaries for compression and decompression (on a 32-bit machine you need to use Int64 instead of Int):</p>

<pre><code>compressNibble :: Int -&gt; Int
compressNibble x = shiftR 0o7600540300002100 (x*3) .&amp;. 7

decompressNibble :: Int -&gt; Int
decompressNibble x = shiftR 0xFEBA8320 (x*4) .&amp;. 15
</code></pre>

<p>This one only needs 16 bit for the dictionary but requires <code>popCount</code>:</p>

<pre><code>compressNibble :: Int -&gt; Int
compressNibble x = popCount (0x6686 .&amp;. (shiftL 1 x - 1) :: Int)
</code></pre>
</div>
<div id="pu3" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, 88 bytes</h1>

<p><strong>(with imaginary bonus points)</strong></p>



<pre class="lang-ruby prettyprint-override"><code>a=[170]+(6..51).map{|i|"UJEBA@D"[i/8].ord*257&gt;&gt;i%8&amp;255^170}
f=-&gt;n{a[n]}
g=-&gt;n{a.index n}
</code></pre>

<p>76 bytes if it is OK to check the array <code>a</code> directly instead of using <code>f</code> to do it.</p>

<p><a href="https://tio.run/##KypNqvz/P9E22tDcIFZbw0xPz9RQUy83saC6JrNGKdTL1cnRwUUpOlPfIlYvvyhFy8jU3M4uU9VCzcjUNA6op5YrzVbXLq86MTovtpYrHcLWy8xLSa1QyKv9b2KuV5KZm1pcXZNVU6AQnaWjpGpgkaSkmhadFaujkB4NomNja/8DAA" rel="nofollow noreferrer" title="Ruby – Try It Online">Try it online!</a></p>

<p>I can't beat GB's excellent answer, but this is the shortest Ruby answer claiming the imaginary bonus points so far.</p>

<p>The question asks for all bytes where the even bits are less or equal to than the adjacent odd bits. An equivalent definition is all bytes where the odd bits are greater than or equal to the adjacent even bits, so overall the set is symmetrical.</p>

<p>There is only one possible byte where all even bits are strictly less than the adjacent odd bits, this is <code>10101010</code>, decimal 170. The other 46 bytes where the even bits are less than or equal to the adjacent odd bits can be found by <code>XOR</code>ing this number with all possible bytes with no adjacent <code>1</code>'s. These comprise 7 distinct patterns and their bitwise rotations as listed below.</p>

<p>We build an array of the 47 bytes by <code>XOR</code>ing <code>10101010</code> with the patterns below, then use lookup and index functions to carry out the conversion. </p>

<pre class="lang-ruby prettyprint-override"><code>Pattern  ASCII number of rotations
01010101  U    2
01001010  J    8
01000101  E    8
01000010  B    8
01000001  A    8
01000000  @    8
01000100  D    4

Total 46 (plus 00000000)         
</code></pre>
</div>
<div id="pu4" class="pu"><h1><a href="https://www.lua.org/" rel="nofollow noreferrer">Lua 5.3</a>, <s>124</s> <s>122</s> 121 bytes</h1>

<pre class="lang-lua prettyprint-override"><code>s,l=string,""for n=0,255 do l=n&amp;n*2&lt;1 and l..s.char(n~170)or l end
f=function(n)return l:find(s.char(n),1,1),l:byte(n)end
</code></pre>

<p><a href="https://www.jdoodle.com/embed/v0/1QZq" rel="nofollow noreferrer">Try it online!</a></p>

<p>Algorithm from <a href="https://codegolf.stackexchange.com/a/199106/6484">xnor</a>, ported to the requested language of Lua. This will only work on 5.3+, but you can get 5.2 compatibility for 24 extra bytes:</p>

<pre class="lang-lua prettyprint-override"><code>s,l=string,""for n=0,255 do l=bit32.band(n,n*2)&lt;1 and l..s.char(bit32.bxor(n,170))or l end
f=function(n)return l:find(s.char(n),1,1),l:byte(n)end
</code></pre>

<p><code>f()</code> does both encoding and decoding; the first return value is for encoding and the second is for decoding. If you want separate functions for both, you can use this instead of the second line (+23 bytes): </p>

<pre class="lang-lua prettyprint-override"><code>e,d=function(n)return l:find(s.char(n),1,1)end,function(n)return l:byte(n)end
</code></pre>

<p>This version of the algorithm varies slightly from the original by using a string to store the map rather than a list, which allows using <code>string.find</code> to search for the item. <code>string.char</code>/<code>string.byte</code> also make it easy to switch between number and string formats.</p>
</div>
<div id="pu5" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python</a>, 60 bytes</h1>



<pre class="lang-python prettyprint-override"><code>l=[n^170for n in range(256)if n&amp;n*2&lt;1]
l.index,l.__getitem__
</code></pre>

<p><a href="https://tio.run/##dZFNboMwEIX3nGJWFW6tKPgPiMpJEEVUAWLJcSKgFT09nUcXUaV24c8z4/fssX3/Wi63qLYtVHV8y/LjcJsoko80dXHsU2Wd8APFp/isXrMmGeRYhYOP536V4dC2Y7/4pb@27fbZBX9u48d1porqoyQlqZCUcZQZSZpTzbPh3HBsnCSLwRrHeaYg1lDrDHDAXiuxAyRGMxwku8PtKSQ5ajlsuQEso0BUYJciZ5SQlCxRygAO4AWFxhQ6U9oCBcBHKoPI4iIWNguJtU1yn3xcKPQxfVxZJEk3z/20UBdCWg/pKh5v6IwgPOuK0sPTiF@eMYVLVNX6j/iP6umnl3cf8VEvq6j1qdm@AQ" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>

<p><code>l.index</code> compresses and <code>l.__getitem__</code> decompresses. We just make a list <code>l</code> of all valid patterns as 8-bit numbers, except we ignore wrapping around, which still leaves 55 options which fits in 6 bits.</p>

<p>A useful idea is that if we flip the bits at even positions, which <code>^170</code> does, then the condition just becomes "no two 1's are (cyclically) adjacent". This is easy to check without wrapping around using the bit condition <code>n&amp;(n*2)==0</code>, or shorter, <code>n&amp;n*2&lt;1</code>.</p>

<p><strong>Fibonacci numbers</strong></p>

<p>Binary strings with no adjacent ones have interesting connections to Fibonacci numbers. The number of such 8-bit numbers is 55, a Fibonacci number, <a href="https://math.stackexchange.com/questions/2476409/determining-the-number-of-bit-strings-of-length-n-that-contains-no-adjacent-0s">following the general result</a>. Moreover, <a href="https://en.wikipedia.org/wiki/Zeckendorf%27s_theorem" rel="nofollow noreferrer">Zeckendorf's Theorem</a> tell us that each number can be uniquely expressed in the Fibonacci base without using a pair of adjacent ones, that is as a sum of distinct Fibonacci numbers without two consecutive ones, as these can be merged into the next Fibonacci number.</p>

<p>Perhaps a base conversion to the Zeckendorf Representation can be used for a less brute-force answer than the one here. We've had challenges to convert <a href="https://codegolf.stackexchange.com/q/173601/20260">from</a> and <a href="https://codegolf.stackexchange.com/questions/2677/the-minimum-fibonacci-challenge?rq=1">to</a> the Zeckendorf representation, which could be used as the basis of a decoder-encoder pair.</p>

<p><strong>Bonus: 64 bytes</strong></p>

<p>For imaginary internet points, we can tweak the algorithm to accounts for cyclically adjacent ones, so as to limit the compression to 48 valid bit patterns from 55. We do this by modifying the bit check to <code>n&amp;n*2%255&lt;1</code>, at the cost of 4 extra bytes.</p>

<p><em>64 bytes</em></p>



<pre class="lang-python prettyprint-override"><code>l=[n^170for n in range(256)if n&amp;n*2%255&lt;1]
l.index,l.__getitem__
</code></pre>

<p><a href="https://tio.run/##dZFNboMwEIX3nGI2rXBrRcF/kKicBFFEFSCWHCcitKKnp/PoglZqF3yeGb83Hpvb53S@RrUsoazia5bv@@tIkXyksY1DlyrrhO8pPsYn9aCsfcnqpJdDGXY@nrpZhl3TDN3kp@7SNMtHG/ypie@XO5VU7SUpSYWkjKPMSNKcal4N54Zj4yRZfKxxnGcKYg21zgAHrLUDOkBiNMNBsjrcmkKSo5bDlhvAMgpEBboUOeMAyYElShnAAbyhMJjCZEpboAD4SGUQWVzEwmYhsbZObqOPE4UuptuVxY9qEEnS3u/dOFEbQlr16Sy2R3VGEN55RmlrUItfniGFS5Tl/I/4j@rxe4Q3H/HnnmdR6WO9fAE" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>

<p>The modulo 255 changes the bit-shift <code>n*2</code> to a cyclic shift</p>

<pre class="lang-python prettyprint-override"><code>abcdefgh -&gt; bcdefgha
</code></pre>

<p>by moving the post-doubling place value of <code>256*a</code> to just <code>a</code>. This is, except for <code>n=255</code>, which where <code>n*2%255</code> is zero, giving a false positive at <code>255^170=85</code>. But, since the bonus for imaginary internet points gives use one spare slot, with 48 slots for 47 values, we can just live with this hole.</p>
</div>
<div id="pu6" class="pu"><h1><a href="https://gcc.gnu.org/" rel="nofollow noreferrer">C++ (gcc)</a>, <sup><s>187</s> <span class="math-container">\$\cdots\$</span> <s>138</s></sup> 128 bytes</h1>

<p>Saved 22 bytes thanks to <a href="https://codegolf.stackexchange.com/users/89298/s-s-anne">S.S.Anne</a>!!!<br>
Saved 5 bytes thanks to <a href="https://codegolf.stackexchange.com/users/52904/ceilingcat">ceilingcat</a>!!!     </p>



<pre class="lang-cpp prettyprint-override"><code>struct F{int i,j,v[55];F(){for(i=j=0;j&lt;55;++i)i&amp;i*2?:v[j++]=i^170;}int c(int n){for(i=55;v[--i]-n;);n=i;}int d(int n){n=v[n];}};
</code></pre>

<p><a href="https://tio.run/##XZFNboMwEIX3nGLUShUUiIKxgWCgu1yC0ioyoTJKTJQAm4iz0xlQWrULPubnPTMe1OXifyk1z7f@Oqge9ndtetBe642lEJXc28696a62ztt8K9tMCOm62tEv@pW9pWPZum6V648g3sqJnMommocJ5WPp@7ryjXSkyfWqqh8qk4@lqeQ0yflZG3Ua6mOmO5zleDgX1k9pPKq@uxYWuc4HbXAoC259naZrJ8NGAePhpOtPM5xvkMN96wHzIPEgwCjgHoSYhvjmmHOMeeSBoAc1EeYBI3FI6jAgRISltqMTSMJDRESSxREtKUliqsVkizlBIBKKEjoliRE7kuxQwhgnRARsMBqM0WQsFISEgJ9knCJBFxFkEyQRYpIW7KFBLjumRaa/V3cAVwPLT8QtNBtlGwel67ZUN/SQZWAIT@AXCIz037TZ4P9x/teUvdbXxrt5kmDBZE3zNw" rel="nofollow noreferrer" title="C++ (gcc) – Try It Online">Try it online!</a></p>

<p>Is a <code>class</code> <code>F</code> with member functions <code>c</code> and <code>d</code> for compression and decompression.<br>
Uses <a href="https://codegolf.stackexchange.com/a/199106/58563">xnor's algorithm</a>.</p>
</div>
<div id="pu7" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, 54 bytes</h1>

<pre><code>Ｆ²⁵⁶Ｆ¬＆ι⊗ι⊞υ⁻｜ι¹⁷⁰＆ι¹⁷⁰Ｉ⌕υＮ
</code></pre>

<p><a href="https://tio.run/##S85ILErOT8z5/z8tv0hBw8jUTFMBzPLLL9FwyiwpzyxOdcxL0cjUUXDJL03KSQUyNYFAIaC0OEOjVEfBNzOvtBim0r8IpNDQ3EBTRwFVM0hMU9OaK6AoM69EwzmxuETDLRMoBTTBM6@gtMSvNDcptUgDZLT1//8G/3XLcgA" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try the encoder online!</a> Link is to verbose version of code.</p>

<pre><code>Ｆ²⁵⁶Ｆ¬＆ι⊗ι⊞υ⁻｜ι¹⁷⁰＆ι¹⁷⁰Ｉ§υＮ
</code></pre>

<p><a href="https://tio.run/##S85ILErOT8z5/z8tv0hBw8jUTFMBzPLLL9FwyiwpzyxOdcxL0cjUUXDJL03KSQUyNYFAIaC0OEOjVEfBNzOvtBim0r8IpNDQ3EBTRwFVM0hMU9OaK6AoM69EwzmxuETDscQzLyW1AmSIZ15BaYlfaW5SapEGyHTr//9NTf7rluUAAA" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try the decoder online!</a> Link is to verbose version of code.</p>

<p>Just the usual table-driven lookup approach. Explanation:</p>

<pre><code>Ｆ²⁵⁶
</code></pre>

<p>Loop over the 256 binary values.</p>

<pre><code>Ｆ¬＆ι⊗ι
</code></pre>

<p>Check that no two adjacent bits are set.</p>

<pre><code>⊞υ⁻｜ι¹⁷⁰＆ι¹⁷⁰
</code></pre>

<p>Flip the odd bits and save the result to the lookup table.</p>

<pre><code>Ｉ⌕υＮ
</code></pre>

<p>Look up the index of the input in the table.</p>

<pre><code>Ｉ§υＮ
</code></pre>

<p>Look up the input index in the table.</p>

<p>Rather than create a table of Fibbinary numbers by filtering out invalid numbers, I attempted a mathematical approach which calculates successive Fibbinary numbers, but the encoder was 48 bytes and the decoder was 40 bytes:</p>

<pre><code>≔⁰η≔⁰ζＷ⁻⁻｜η¹⁷⁰＆η¹⁷⁰θ«≦⊕ζ≔⊕｜η÷η²ι≧＆±ιι≔×ι⊕÷ηιη»Ｉζ
≔⁰ηＦＮ«≔⊕｜η÷η²ι≧＆±ιι≔×ι⊕÷ηιη»Ｉ⁻｜η¹⁷⁰＆η¹⁷⁰
</code></pre>

<p>Explanation:</p>

<pre><code>≔⁰η
</code></pre>

<p>Initialise the Fibbinary number <code>h</code> to <code>0</code>.</p>

<pre><code>≔⁰ζＷ⁻⁻｜η¹⁷⁰＆η¹⁷⁰θ«≦⊕ζ
</code></pre>

<p>(Encoder) Initialise the encoding index to <code>0</code>. Repeat until the desired Fibbinary number is found. Increment the encoding index...</p>

<pre><code>ＦＮ«
</code></pre>

<p>(Decoder) Repeat the desired number of times.</p>

<pre><code>≔⊕｜η÷η²ι≧＆±ιι≔×ι⊕÷ηιη»
</code></pre>

<p>Find the lowest value of <code>k</code> where <code>h&amp;3&lt;&lt;k</code> is zero. Clear the bottom <code>k</code> bits of <code>h</code> and increment the next bit, which gives the next Fibbinary number.</p>

<pre><code>Ｉζ
</code></pre>

<p>(Encoder) Output the number of loops taken.</p>

<pre><code>Ｉ⁻｜η¹⁷⁰＆η¹⁷⁰
</code></pre>

<p>(Decoder) Output the XOR of the Fibbinary number with 170.</p>
</div>
<div id="pu8" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, <s>25</s> 17 bytes</h1>

<pre><code>⁹Ḷ&amp;Ḥ$Ðḟ^170
ị¢
Ñi
</code></pre>

<p><a href="https://tio.run/##y0rNyan8//9R486HO7apPdyxROXwhIc75scZmhtwPdzdfWgR1@GJmf8Nj@znetQw59DSQ8trTu4JqTvWdWjD4em5RzZEPNzdG3loebaJUtSh5YdWAnmnmh5tXPdw185DKw8tPNz2cOcC18MTDq2zi1B6uGOx4sOds442ABmH9z1q3Fumfrjd4VHDzCSg5YeWHN0NxHuMj@x/1LRGRQdCP9y56OgeI4jQsa4sIAVCDXMUdO0UHjXMBbKcgdglNRnIsYZI5ecWFKUWF1sBRQ4tCQeKHVpirRQJpLMeNe47tO3Qtv8A" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></p>

<p>A set of links. The first link is shared and builds the list of possible valid 8-bit integers. The second link is the decompression link and the third handles compression. The footer compresses all the valid integers and then decompresses all the possible compressed values. </p>

<p>Saved 8 bytes by porting <a href="https://codegolf.stackexchange.com/a/199106/42248">xnor’s Python answer</a> with thanks!</p>
</div>
<div id="pu9" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, <s>89 85</s> 74 bytes</h1>

<pre class="lang-ruby prettyprint-override"><code>a,b='14-7',&quot;8abef&quot;
f=-&gt;n{(&quot;%o&quot;%n).tr(a,b).hex}
g=-&gt;n{(&quot;%x&quot;%n).tr(b,a).oct}
</code></pre>
<p><a href="https://tio.run/##NY9NjsIwDEb3nCKKhKAjt5okzk8XcJHSRTuisBlATJEygp69@KvEIi92/Owk90f/P88d9buN4TJuSKeuPw56NezK/eW51eurXl@KarxvRSqq8zFPq9Onlj@1nrqiuv6M09x8k7KkEikjkWFSTlInO0vOEnMg5bHECZIbC9nBdgYIwHJWYwIUdoIAZekISwol4iyiLTLgBQlRwpQUBTWUWhRrGQiAFCweZvEy6zyQALnSMiKPj3i0eSjet9Vvd3u@8uv2GP9Uk@nU5JaGBlvbfmlV7g@jnuY3" rel="nofollow noreferrer" title="Ruby – Try It Online">Try it online!</a></p>
<p>Not going for the bonus points.</p>
<h3>How:</h3>
<p>Encode and decode using an octal-hexadecimal conversion: since some patterns cannot occur, the only allowed hex digits are <code>[0,2,3,8,a,b,e,f]</code>. So, if we take the hex digits and translate them to their index in the array, we get a 1- or 2-digits octal number, that is in the range 0-63. We can invert the process to decode the number.</p>
</div>
<div id="pu10" class="pu"><h1>JavaScript (ES6), 58 bytes (with bonus: 65 bytes)</h1>

<p>I couldn't find anything shorter than a port of <a href="https://codegolf.stackexchange.com/a/199106/58563">xnor's answer</a> with recursive functions.</p>

<h3>Encoder (30 bytes)</h3>

<pre class="lang-javascript prettyprint-override"><code>E=n=&gt;n&amp;&amp;E(n-1)+!((n^=170)&amp;2*n)
</code></pre>

<h3>Decoder (28 bytes)</h3>

<pre class="lang-javascript prettyprint-override"><code>D=(n,k=n)=&gt;E(k)^n?D(n,k+1):k
</code></pre>

<p><a href="https://tio.run/##bZBNT8MwDIbv@xXmsiS0q5Y0abuhdEJakRBIHHZETKrWMsYmd@oq/n6xc4Ahcehbfzx@4@Sz/qovu/5wHmbYNe04Vh59idNpJXGmVXQjJW69zudqam5RTdZeYnz0qHxZyaPa4mrNhUir5XG8e53HYGIoYtAUaRtDSmlKf0u5pdhmMTj@iMko14bhlOlUs2QsobZgB0ZsSpIxEiaykDKScy3nsdyyOJKCo4JdipxkwciCEGMsS8ZCDcOLGd7MpI6lYKEjjeXI8UUcjzlGnHtL3ru@qncfEsGXE4Bdh5fu1Canbi8pBcBk6DZDf8C9VMm5bipspFUQgfAlCIgCJFvwQE@r1C9tAr4Z6n6QtJ6YizAFkoag/cfVhL6Ca9@GfNeyvfb9s8UP5QFhBeLlScASxMP947NQ1FQTNX4D" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>

<h3>Bonus-compliant version, 65 bytes</h3>

<p>With 7 more bytes in the encoder, we can output a value in <span class="math-container">\$[0..46]\$</span>:</p>

<pre class="lang-javascript prettyprint-override"><code>E=n=&gt;n&amp;&amp;E(n-1)+!((n^=170)&amp;2*n|n&amp;n&gt;&gt;7)
</code></pre>

<p><a href="https://tio.run/##bZBNT4NAEIbv/RXjhd0VSrrLLtCapTEpJo0mHno0NiEFa20zNJR48r/jDAetiQde5uOZd2f3o/qsLrvucO6n2NbNMJQefYFBUEqcahXeSIlbr7OZCswtfmGARZGpycpLjI4elS9KeVRbXK64EGq1OA53L7MITAR5BJoibSNIKE3obym3FNs0AscfMSnl2jCcMJ1olpRlrM3ZgRGbkKSMjBPpmDKScS3jscyyOJKco5xd8oxkzsicEGMsS8pCDcOLGd7MJI4lZ6EjjeXI8UUcjzlGnHuN39qurHbvEsEXE4Bdi5f21MSndi8pBcC4bzd9d8C9VPG5qkuspVUQgvAFCAhHSDbggV5YqV/ajPimr7pe0npiJsYpkDQEzT@uZuwruPatyXclm2vfP1v8UB4QliCeHwUsQDzcr5@EoqaaqOEb" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>

<hr>

<h1>JavaScript (ES6), 68 bytes</h1>

<p>Another version with recursive functions. The encoder is just as long, but the decoder is 10 bytes longer.</p>

<h3>Encoder (30 bytes)</h3>

<pre class="lang-javascript prettyprint-override"><code>E=n=&gt;n&amp;&amp;n%16*17%61%9+8*E(n&gt;&gt;4)
</code></pre>

<h3>Decoder (38 bytes)</h3>

<pre class="lang-javascript prettyprint-override"><code>D=n=&gt;n&amp;&amp;596357088&gt;&gt;n%8*4&amp;15|16*D(n&gt;&gt;3)
</code></pre>

<p><a href="https://tio.run/##bZBPS8NAEMXv/RRzSXe3jaH7NxslK0IjFAUPPYqH0MRaKZuSBk9@9zgTRCt4yMvMzu@9neS9/qjPu/5wGq5i17TjWJWxDHE@j4l0C5knTibF0i8qHkMwYrb@HtvCaZuvvA8hJn5h5tJ@omFNmBbjzfMqBZWCT0FiJU0KGluNb4O9wdq4FCw9yDjspSJYE60liSOZzgpKIMRoFEfI5HBTS0hOZznZckNiUTxVnlJ8jlIQUiCilCFxJDhQtJiizZS2JJ4Er1SGKksfYslmCbH2JXvt@qrevfEIZZgB7Lp47o5tduz2HFuAmA3ddugPcc9FdqqbKjbcCFgCKwMwWE4Qb6EE/KtC/NJqwrdD3Q8c12MrNrmAownaf1LVNBdwmdtg7pq3l7l/tvihSohwC@zpgcE1sPu7zSMTOBQzMX4B" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>

<h3>How?</h3>

<p>As already <a href="https://codegolf.stackexchange.com/a/199126/58563">pointed out by G B</a>, there are only 8 valid nibbles for the input. We apply the following formula to map each of them to a unique value in <span class="math-container">\$[0..7]\$</span>:</p>

<p><span class="math-container">$$f(n)=((n\times17)\bmod61)\bmod9$$</span></p>

<p>Which gives:</p>

<pre><code> bin  | hex | dec | *17 | mod 61 | mod 9
------+-----+-----+-----+--------+-------
 0000 |  0  |   0 |   0 |    0   |   0
 0010 |  2  |   2 |  34 |   34   |   7
 0011 |  3  |   3 |  51 |   51   |   6
 1000 |  8  |   8 | 136 |   14   |   5
 1010 |  A  |  10 | 170 |   48   |   3
 1011 |  B  |  11 | 187 |    4   |   4
 1110 |  E  |  14 | 238 |   55   |   1
 1111 |  F  |  15 | 255 |   11   |   2
</code></pre>

<p>Therefore, the input <span class="math-container">\$N\$</span> can be encoded as:</p>

<p><span class="math-container">$$f(N\bmod 16) + 8\times f(\lfloor N/16\rfloor)$$</span></p>

<p>which gives a unique value in <span class="math-container">\$[0..63]\$</span>.</p>

<p>The decoder retrieves the original nibbles by using the number <code>0x238BAFE0</code> (in decimal: <span class="math-container">\$596357088\$</span>) as a lookup table.</p>

<p>The conversion could also be done with this code:</p>

<pre class="lang-javascript prettyprint-override"><code>(n&amp;&amp;n&lt;3?n+9:44/n|4)^4
</code></pre>

<p><a href="https://tio.run/##y0osSyxOLsosKNHNy09J/f8/OT@vOD8nVS8nP12DS0Eh2kDHUMdIx1jHRMdUx0zHPFYvN7FAI0/B1g4oqaCgkaemlmdjbJ@nbWllYqKfV2OiGWcClNHk0vz/HwA" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>

<p>But this is even longer.</p>
</div>
<div id="pu11" class="pu"><h1><a href="https://github.com/Adriandmen/05AB1E/tree/fb4a2ce2bce6660e1a680a74dd61b72c945e6c3b" rel="nofollow noreferrer">05AB1E (legacy)</a>, 16 bytes</h1>

<h3><a href="https://github.com/Adriandmen/05AB1E" rel="nofollow noreferrer">05AB1E</a>, 17 bytes</h3>

<p>Port of <a href="https://codegolf.stackexchange.com/a/199106/6484">xnor's Python answer</a>. -1 byte on legacy thanks to Kevin Cruijssen.</p>

<p>Compression:</p>

<pre><code>ÝƵζ^x&amp;ć¢
</code></pre>

<p>Decompression:</p>

<pre><code>µNƵζ^x&amp;_
</code></pre>

<p>Modern 05AB1E uses the same compression code, but needs an additional <code>D</code> in the decompression:</p>

<pre><code>µNDƵζ^x&amp;_
</code></pre>

<p>TIO links:</p>

<ul>
<li><a href="https://tio.run/##MzBNTDJM/f//8NxjW89ti6tQO9J@aNH//yZGAA" rel="nofollow noreferrer" title="05AB1E (legacy) – Try It Online">legacy compression</a></li>
<li><a href="https://tio.run/##yy9OTMpM/f//8NxjW89ti6tQO9J@aNH//yZGAA" rel="nofollow noreferrer" title="05AB1E – Try It Online">modern compression</a></li>
<li><a href="https://tio.run/##MzBNTDJM/f//0Fa/Y1vPbYurUIv//9/QCAA" rel="nofollow noreferrer" title="05AB1E (legacy) – Try It Online">legacy decompression</a></li>
<li><a href="https://tio.run/##yy9OTMpM/f//0FY/l2Nbz22Lq1CL///f0AgA" rel="nofollow noreferrer" title="05AB1E – Try It Online">modern decompression</a></li>
</ul>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/199102/">199102</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




