<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::QNNN</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
  <!-- TXXX -->
<tr d-ix="0"><td>415</td><td>Scala</td><td>230810T092731Z</td><td><a href="https://codegolf.stackexchange.com/questions/204694/analyze-the-flow/263971#263971">138 Aspe</a></td></tr>
<tr d-ix="1"><td>081</td><td>K ngn/k</td><td>200513T201437Z</td><td><a href="https://codegolf.stackexchange.com/questions/204694/analyze-the-flow/204705#204705">ngn</a></td></tr>
<tr d-ix="2"><td>078</td><td>J</td><td>210118T224813Z</td><td><a href="https://codegolf.stackexchange.com/questions/204694/analyze-the-flow/217718#217718">xash</a></td></tr>
<tr d-ix="3"><td>390</td><td>R</td><td>200519T075320Z</td><td><a href="https://codegolf.stackexchange.com/questions/204694/analyze-the-flow/204946#204946">Xi&#39;a</a></td></tr>
<tr d-ix="4"><td>196</td><td>JavaScript Node.js</td><td>200514T050047Z</td><td><a href="https://codegolf.stackexchange.com/questions/204694/analyze-the-flow/204725#204725">l4m2</a></td></tr>
<tr d-ix="5"><td>364</td><td>Java 10</td><td>200513T175850Z</td><td><a href="https://codegolf.stackexchange.com/questions/204694/analyze-the-flow/204701#204701">Kevin Cr</a></td></tr>
<tr d-ix="6"><td>041</td><td>Jelly</td><td>200513T203952Z</td><td><a href="https://codegolf.stackexchange.com/questions/204694/analyze-the-flow/204706#204706">Jonathan</a></td></tr>
<tr d-ix="7"><td>235</td><td>Python 2</td><td>200513T204006Z</td><td><a href="https://codegolf.stackexchange.com/questions/204694/analyze-the-flow/204707#204707">Surculos</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://www.scala-lang.org/" rel="nofollow noreferrer">Scala</a>, 415 bytes</h1>
<p>415 bytes, maybe more. It can be golfed much more.</p>
<p>Port of <a href="https://codegolf.stackexchange.com/a/204701/110802">@Kevin Cruijssen' Java 10 answer</a> in Scala.</p>
<hr />
<p>Golfed version. <a href="https://tio.run/##jVJRT9swEH7PrzhFBdklMWn6VtVIaC9jYhui2xNiyHMMDXOc4rhBNMpvL7YTSlpNG5Fj@e6@7zvfnSvOJNvmxarUBh5Zzcja5JI0n1m1XAgTwQ8thD/YrQ16YOVYhJdSCm7yUpEvlvmpVLXQRuiK3AX2K38/2ih8ZbmCJggAjGa5gW/WAPtl4h44KmZwrjV7uen2C2Vub/EMfqrcWFTraDWToGaWR0GJ54/zLb7ZOvIldby@ohv3exjCgYtKWhAp1INZevOayrEM7kuN8nmcwFrZdsA1bmqmQdP8VAbuxGl@JD1@4cX7Lnlhq5uVzYKwLEN6LE94lyejBdIYWUtTpGOUxdnRdJzh0/REYivGKeIxyu9RNk/xJE7HGQhZCUiwj7fPy1wKNJTFgUVr6i51fMypuxLu4vEEe25vpTi49KcFbn1pm3lsHdXCjRE3VmVDtCjKWjhmVyuniYc@HUKfdtAU9w5eKmOnXJ1LiTYY8xM6CZ7eUrdtsNK5MlKhKhw1G1LlG9FGIx7a0NZNsn2btBtpYYUQ0w/V22AXxrIfhkP14zeiMsgj@n0awSSC1O9THHVsZI3Erz2vxXbLBYbe1Hvtnuy8iXd10lNsm/7X7C4@FEr@iTwED/N1N047/q4tXuY/j93ne@/1hVqtzQxGTUEKtkJ3pPjT9RKFUYjxwOwShxH0C9vRhHhPLrzSwpiX2Nsim8Eu7txXzouKA8r3tfE36KGK8EPIXol7Uh@o1L5OQBrmMRS4d70ra19zDfQMwvlZ/SskfMn0uUH1oPLuMt3za4PtKw" rel="nofollow noreferrer">Try it online!</a></p>
<pre class="lang-scala prettyprint-override"><code>val L=new HashSet[Set[Int]]()
val l=m.length
val R=l*l
for(i&lt;-0 until R){var r=i/l
var c=i%l
val S=new TreeSet[Int]()
do{S.add(r*l+c)
val d=m(r)(c)
r=(r-(d-d%3*d)/2+l)%l
c=(c-(if(d&lt;2)1-2*d else 0)+l)%l}while(S.add(r*l+c))
if(r==i/l&amp;&amp;c==i%l)S.add(-1)else S.add(-2)
L.add(S)}
for(z&lt;-L.asScala){if(z.remove(-1)){var c=0
for(q&lt;-L.asScala){if(q.remove(-2)){if(q.containsAll(z))c+=1
q.add(-2)}}
println(s&quot;${z.size},$c&quot;)}}
</code></pre>
<p>Ungolfed version. <a href="https://tio.run/##jVRdb5swFH3nV1yhrrJXwgh5i9pK1V7WqduqZnuquoqBk9AZkxqHqon47dn1BwSSbWpETHzuOcf3Xtup0oQnu11erEqp4Cmpk3Ctch5uPyXVcsZUAN8lY@YHDo3niJWWhWnJOUtVXorwMyo/lqJmUjFZhY@eV/56whh8SXIBW88DUDLJFXzFCeAnY3NISTGFKymT13s7Xgv18ECn8EPkClmNltUJBzFF3QUI9vJ2PfIt01rcOL2r615/DZ3QHosjqwg5Ewu17MF3CHN4D9xh7jUvJZAczkcQwVpg2@COdotqpQSJyhw@dEqLpgZ9N0A5zFyKruMmvS47rLjseQPMwiTLiNRZwRmktBfSZpmuhEhKBhGdDmpGQDIcMkxhggYZxQxjdOF0kBSYREmq@flca84hpjDGeaxlwHjFIKLHygZeljlnQA6z3CejDTEd1x44PdWLubZQV91oTO0abhrv5TcGmbWAOSrdnmz0niCjmulz2t8TveomlKwoa6bt6aCn7d5EPcwYPv/TsDV97kxjehhvGWkpFF6H6opzskFWCmcXMD6gPh@Vauv7@@@VzIXiglT@yXYTVvmGNcFJ6u/Fjdd/N@2t0tenwFxIIhdVe4lmCt0WRxdIsUoRw3DjJIBxALEZJzSwaoKTyDwDFLn20YE@GhsUx6hDIwNZ6wl1Z@VodR3vG0X/ZR6S@@vZjGOr79pibN7yx7Lv/bVYrdUUTrZFWCQr8hgWv20viR/4lPamdmE/APdQnzZut1o7/1YypV5HZs6yKXRxDd9qlBQHkm9rZTJwVBGmh5RBiQOrN1Rq7oDUd6DYn@3WWZqaa7i4BP/8sv7ph@kykVeK1L3Kae/4Nd5u9wc" rel="nofollow noreferrer">Try it online!</a></p>
<pre class="lang-scala prettyprint-override"><code>import java.util.{HashSet, TreeSet, Set}
import scala.collection.JavaConverters._

object Main {

  trait N {
    def c(m: Array[Array[Int]]): Unit
  }

  val n: N = new N {
    def c(m: Array[Array[Int]]): Unit = {
      val L = new HashSet[Set[Int]]()
      val l = m.length
      val R = l * l
      
      for (i &lt;- 0 until R) {
        var r = i / l
        var c = i % l
        val S = new TreeSet[Int]()
        do {
          S.add(r * l + c)
          val d = m(r)(c)
          r = (r - (d - d % 3 * d) / 2 + l) % l
          c = (c - (if (d &lt; 2) 1 - 2 * d else 0) + l) % l
        } while (S.add(r * l + c))
        if (r == i / l &amp;&amp; c == i % l) S.add(-1) else S.add(-2)
        L.add(S)
      }

      for (z &lt;- L.asScala) {
        if (z.remove(-1)) {
          var c = 0
          for (q &lt;- L.asScala) {
            if (q.remove(-2)) {
              if (q.containsAll(z)) c += 1
              q.add(-2)
            }
          }
          println(s&quot;${z.size},$c&quot;)
        }
      }
    }
  }

  def main(args: Array[String]): Unit = {
    test(Array(Array(3, 1, 2, 1, 3), Array(1, 0, 0, 1, 3), Array(3, 3, 3, 0, 1), Array(3, 2, 3, 2, 0), Array(0, 3, 1, 2, 3)))
    test(Array(Array(1, 2), Array(3, 0)))
    test(Array(Array(1, 2, 2), Array(3, 0, 0), Array(1, 0, 2)))
  }

  def test(m: Array[Array[Int]]): Unit = {
    println(s&quot;Input: ${m.map(_.mkString(&quot;,&quot;)).mkString(&quot;Array(&quot;, &quot;, &quot;, &quot;)&quot;)}&quot;)
    println(&quot;Pretty-printed: &quot;)
    prettyPrint(m)
    println(&quot;Output: &quot;)
    n.c(m)
    println()
  }

  def prettyPrint(m: Array[Array[Int]]): Unit = {
    for (r &lt;- m) {
      println(r.map(v =&gt; &quot;&lt;&gt;v^&quot;.charAt(v)).mkString)
    }
  }
}
</code></pre>
</div>
<div id="pu1" class="pu"><h1><a href="https://codeberg.org/ngn/k" rel="nofollow noreferrer">K (ngn/k)</a>, <s>99</s> 81 bytes</h1>
<p>thanks @bstrat for -18 bytes!</p>
<pre><code>{l,'(#'.c)-l:#'!c:={x@&lt;x:(x?a@*|x)_x}'{?x,a@x}/'a::s/s!'(+(,/-:\=2)@,/x)+!s:2##x}
</code></pre>
<p><a href="https://ngn.codeberg.page/k#eJwdyrEKwyAQgOE9b6EOp42pkPHaoA9SKBLJdJNycGB999pO3z/8F3byYA3cT7cRGlAnHl3SU9BKzOn2EfeWAT2Kz0lGgIzYQlNgV+vDhq9jd8kHcatquBsjY1kuXSqTjgGt5jpbP3Ql+svMVH8WLjSlObB2XzqsJ2k=" rel="nofollow noreferrer">Try it online!</a></p>
<p>down,right,up,left in the input are encoded as 0 1 2 3</p>
</div>
<div id="pu2" class="pu"><h1><a href="http://jsoftware.com/" rel="nofollow noreferrer">J</a>, 78 bytes</h1>
<pre><code>[:(#~1&lt;{.&quot;1)@((=([,-~)&amp;(+/)0=|)&quot;{~~.)@,](]*.[{&quot;p..0|:((,-)=0 1)|.])^:_ p:@i.@$
</code></pre>
<p><a href="https://tio.run/##hY@xCsIwFEX3fMWjFpOn6TPVLVoICk7i4FpiB2uxErAUMpSW/nosODiJwz3LgQP3GSLiFWQaOEhQoKclBIfL6RhyLWZjuuspStEIkYlcJiPOxXKFKhsw6seR0Egr7ILyPmqI1KCFkAlmClIcyOJVF9BoU5OJw3lPsAHNv9FfTdn9TdYUd5whY/fb4wUV8LL1jkNNkG@pWIO1nzPMt5NhrXMTvfeuZb70pWNuEp5heAM" rel="nofollow noreferrer" title="J – Try It Online">Try it online!</a></p>
<h3>How it works</h3>
<p>We map each index to the corresponding prime <code>p:@i.@$</code>:</p>
<pre><code> 2  3  5  7 11
13 17 19 23 29
31 37 41 43 47
53 59 61 67 71
73 79 83 89 97
</code></pre>
<p>Then shift this board by the 4 directions <code>((,-)=0 1)|.])</code>, and calculate the least common multiple between the tile <code>x</code> and the direction <code>x</code> is heading <code>]*.[{&quot;p..0|:</code>. We do this until the board does not change anymore <code>(…)^:_</code>:</p>
<pre><code>461677248802 62985        20995    3162172937  3162172937
         221   221         4199 2109169348979 91703015173
        6851  8177       172159       7402837      321997
      363103  4661     10501699    3162172937  3162172937
230838624401  4661 262460353771    3162172937  3162172937
</code></pre>
<p>For each unique <code>~.</code> number we can then count how often it occures and how many other tiles it divides: <code>= …&amp;(1#.,) 0=|</code>. We need the first number and the difference for the result: <code>([,-~)</code>:</p>
<pre><code>…
6  5
2 10
1  5
…
2  0
1  0
</code></pre>
<p>We then take only the ones where the first column is greater than 1 <code>(#~1&lt;{.&quot;1)</code>:</p>
<pre><code>6  5
2 10
2  0
</code></pre>
</div>
<div id="pu3" class="pu"><h1><a href="https://cran.r-project.org/" rel="nofollow noreferrer">R</a> <s>435 414 395</s> 390 bytes</h1>
<p>Entering the excursion map as a matrix, e.g.</p>
<pre><code>n=3;M=matrix(sample(1:4,n^2,rep=T),n)
</code></pre>
<p>where 1,2,3,4 stand for <code>down</code>, <code>up</code>, <code>right</code>, and <code>left</code>, the following heavy-going code produces rows of lengths and tributaries for the different loops</p>
<pre><code>j=cbind;l=sum;a=apply
m=l(!!M);n=m^.5
g=function(A,r=M[A])A+c((r&lt;2)*(1-n*(A[,1]==n))-(r==2)*(1-n*(A[,1]&lt;2)),(r==3)*(1-n*(A[,2]==n))-(r&gt;3)*(1-n*(A[,2]&lt;2)))
I=c()
for(i in d&lt;-1:n)I=rbind(I,j(i*d/d,d))
for(t in b&lt;-1:m)I=g(I)
p=function(i)i[,1]+n*i[,2]-n-1
K=matrix(0,m,m)
for(t in b)K[b+m*p(I&lt;-g(I))]=1
s=o=a(u&lt;-unique(K),1,l)
for(k in 1:l(!!s))s[k]=l(!a(!!sweep(K,2,u[k,],'-'),1,l))
j(o,s-o)
</code></pre>
<p><a href="https://tio.run/##VZDNboNADITv@xTJKTbxtt2kvQRciSNC3HpDRCJAok3YhS6gtk9Ps4r6k6NH39jjcbPlbZixKUenP2EoTd82oHbPZPcbck3Pb0gWRe@0HSHD@czVQds6bHmYTFhy2fftlzDcwnKZYWjZ7B9exImPk61G3VmIyXGWxwXG6wrARRsMQEkbQJyTKpgtogTHfK9fMSQvb//Jm1/89V72NIqEK0Bx7BzohbaLOpJqZzFh5wNDQmfQQf1YU403avTUwVPmSp0gub75l1uj9kHWNtD@hLRSifSnpycyZP5vwTQ/rE3QQxJJvwkLVmLgjkuYIjlZ/T41kCIpam@2i7epna9tQBzyS@ErLP340TQ9pLShKb9QQSu5uvlQnKGjQXYo5ll8Aw" rel="nofollow noreferrer" title="R – Try It Online">Try it online!</a></p>
<p>Some comments</p>
<pre><code>m=l(!!M);n=m^.5 #m=n^2
#moving all points in the square by the corresponding moves in M
g=function(A,r=M[A])A+cbind((r&lt;2)*(1-n*(A[,1]==n))-(r==2)*(1-n*(A[,1]&lt;2)),(r==3)*(1-n*(A[,2]==n))-(r&gt;3)*(1-n*(A[,2]&lt;2)))
#matrix of the (i,j) coordinates for all points in the square
I=c()#NULL
for(i in 1:n)I=rbind(I,cbind(rep(i,n),1:n))
#move long enough to remove transient points
for(t in b&lt;-1:m)I=g(I)
#turns 2D coordinates into a single integer 
p=function(i)i[,1]+n*i[,2]-n-1
K=matrix(0,m,m) #matrix of visited coordinates
for(t in b)K[b+m*p(I&lt;-g(I))]=1
#loop length (o) and associated number of transients (s)
s=o=apply(u&lt;-unique(K),1,sum)
#sum over all loops (length(o))
for(k in 1:sum(!!s))s[k]=sum(!a(!!sweep(K,2,u[k,],'-'),1,sum))
cbind(o,s-o)
</code></pre>
<p>Now, I spent too much time on this code already but I fear the parts</p>
<pre><code>I=c()
for(i in 1:n)I=rbind(I,cbind(rep(i,n),1:n))
</code></pre>
<p>creating the matrix of all starting coordinates and</p>
<pre><code>p=function(i)i[,1]+n*i[,2]-n-1
</code></pre>
<p>switching from the coordinates to a single index could be further code-golfed!</p>
</div>
<div id="pu4" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 196 bytes if width=height</h1>



<pre class="lang-javascript prettyprint-override"><code>m=&gt;m[Q='flatMap'](U=(y,I)=&gt;y[Q]((x,j)=&gt;U[T=[...m+0,Y=m.length,i=I][Q](_=&gt;0+[j=(c=m[i][j]-2,j+Y-~c%2)%Y,i=(i+Y+c%2)%Y])[k=0,Q](S=c=&gt;(S[c]=-~S[c])==2&amp;&amp;++k&amp;&amp;c).sort()]?(++U[T][0],[]):[U[T]=[1-k,k]]))
</code></pre>

<p><a href="https://tio.run/##PY4/a8NADMX3fIoscXScfJydrSB3ztAhpBmMEMVc7dT/Q2xKs@Sru3eYlsdD@gk9oab4LiZ3r29zPIyf5VLR0lPW84n2VVfMb8VtL3AheOBRUfbgkwD8YOP7C78TG2N6bTGn3nTlcJ2/sKajhK0PyqzmhsBRz7VwI3GKjc7jp9ulapf7Rah1rlcSxS1Z9LkzOcrgzE4ofoaiiNIo0rqNIqfMNN5nUPIKWvsHhK0gi3rhAMRJ3GIrotTixmEau9J04xUq4M12ywmmePBOBAOmaL3@McEgP/jDAwbbFS2u6UQ24fov" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>

<h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 205 bytes</h1>



<pre class="lang-javascript prettyprint-override"><code>m=&gt;m[Q='flatMap'](U=(y,I)=&gt;y[Q]((x,j)=&gt;U[T=[...m+0,Y=m[W='length'],X=m[W],i=I][Q](_=&gt;0+[j=(c=m[i][j]-2,j+Y-~c%2)%Y,i=(i+Y+c%2)%Y]).sort().filter(S=c=&gt;(S[c]=-~S[c])==2)]?(++U[T][1],[]):[U[T]=[k=T[W],1-k]]))
</code></pre>

<p><a href="https://tio.run/##PY5Ni4NADIbv/RW9FDNMHNTeFuKee@ihtGVXQlhkql2tH0WlbC/96@4Mskt4SZ6QN0mdP/LRDtV9Crv@UswlzS2lLR8oKJt82uf3QOBM8MSdovTJBwH4wdrVZz4RG2NaHWFGLX9Q0BTddfoOBD89C1a0E@/4ojTSXBNY16@EawkTrHUWvuwmUZvMDUKlM72QKDP2wwTKlFUzFQMcyVIKR7ZC4csnRZQoeQet3RPCsSCLemMPxDc6@dtxeBNRarZ9N/ZNYZr@CiXwar3mGBPcOjmfxwQjF/8Yow/X@MMtekULRri4Y1n57b8" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>

<p>Ungolfed version </p>



<pre class="lang-javascript prettyprint-override"><code>m=&gt;m.flatMap(
  U=(y,I)=&gt;y.flatMap(
    (x,j)=&gt;
      U[
        T=[...m+0,Y=m.length,X=y.length,i=I].map(_=&gt;(
          c=m[i][j],c%2?(i=(i+Y-2+c)%Y):(j=(j+X-1+c)%X),
          i*X+j
        )).sort().filter((c,k,S)=&gt;S[k-1]!=c&amp;S[k+1]==c)
      ]?(++U[T][1],[]):[U[T]=[k=T.length,1-k]]
  )
)
</code></pre>

<p><a href="https://tio.run/##TY9Na8MwDIbv/RXeoUOaFROnt4LScw87pYUUY0Zwk875aEobxvrrM2f9oAjB@7zoFVJd/BQXd/anITr2@3KseOw47VTVFsNncYKZEFuGK62R0@urKwT8Uh3cfx2mzF0IsWGjlOpkTDvuVFseD8M35Xx9SM9rq7qw5otTeKaEcNwZb01tyc2TFXgGL3dRIh3Od7iEmqGWeaQnzpFegv4jl/WTEdWlPw@AqvLtUJ4BHDWUhVMzk1ETafvG7j0zjdSW2eE9aFcg5dZsrNGWjMWlmYBNw5vH4TpqrA3jOMPR9cdL35aq7Q9QwfS80ZTQInTIT5hQHOqJmqYKxgMXNHV8w5huaW1nFnH8Aw" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
</div>
<div id="pu5" class="pu"><h1>Java 10, <s>374</s> <s>371</s> 364 bytes</h1>

<pre class="lang-java prettyprint-override"><code>import java.util.*;m-&gt;{var L=new HashSet&lt;Set&gt;();int l=m.length,R=l*l,r,c,d;for(Set S;R--&gt;0;S.add(r==R/l&amp;c==R%l?-1:-2),L.add(S))for(S=new TreeSet(),r=R/l,c=R%l;S.add(r*l+c);r=(r-(d-d%3*d)/2+l)%l,c=(c-(d&lt;2?1-2*d:0)+l)%l)d=m[r][c];for(Set z:L){if(z.remove(-1)){c=0;for(Set q:L)if(q.remove(-2)){if(q.containsAll(z))c++;q.add(-2);}System.out.println(z.size()+&quot;,&quot;+c);}}}
</code></pre>
<p>-10 bytes thanks to <em>@ceilingcat</em>.</p>
<p>Uses a matrix of integers <code>0,1,2,3</code> for <code>&lt;,&gt;,v,^</code> respectively.</p>
<p><a href="https://tio.run/##fVLRbtowFH3vV1whMdnECSE8jRCqvm1S11XQN8Sk1DElzEnAMZkgyrfTaxNotTFkObGPz7n3@lyv4yp218nvY5ptCqVhjXtvp1Pp9ULo98EZfAVdgF4JeN1r4fJil@s7LuOyhB9xmtd3AGmuhVrGXMCT2QJURZoAJ4jPF/MFZDREuLnDT6ljnXJ4ghyiY@ZO6ipW8Bjl4g98i8vVTOgxzgmhIYpBRpknRf6mV2wayZ5kinGWhMtCEWTBLJy67sQPZ16cJERF0bQvv3D8deW9Oxi5AWWP9mhGqdXYPC9KCFQTypQRMG745xg96XAaqogolyRu0h32EtoPHEm7hkg4ouPgfuAGvWTkU4vTJMrmajHni0thh9EjrdMlOXhKZEUliDugtOaRf2FskYGE7YUQUKvYerzINfpaPkhJDpRyxwm3tjakhM1sX2qRecVOexuFFskck5TpQRDqdFjHFN80zTE0Xm92rxK9bi23PckwMplpVL5hX2J6apcWpSbGmrZhdT1kAxbgHDasHjAfx2k9ZGbgzq4DZqaPa5@dFMOmsb2@FhPPrcq/zTmzbFyTO2j5n9@PvYyVf7yx012uGNT5nm92egQd5@NxPygV70svEWLzUpwMIRlt67oW41kJrfeu3YsEg7XcjcWfDUyyG/qfO30qouXkHr/Fv37jz8n@vrh5WRYDBaMLesGhQlTRFvw3J@mMJ9WvjsdXsXrQpDp78f/qTH1mNsd3" rel="nofollow noreferrer">Try it online.</a></p>
<p><strong>Explanation:</strong></p>
<pre class="lang-java prettyprint-override"><code>import java.util.*;        // Required import for Set, HashSet, and TreeSet
m-&gt;{                       // Method with integer-matrix parameter and no return-type
  var L=new HashSet&lt;Set&gt;();//  Create a Set of Sets `L`, starting empty
  int l=m.length,          //  Set `l` to the dimensions of the input-matrix
      R=l*l,               //  Index integer `R` to loop over the cells
      r,c,                 //  Temp-integers `r,c` for the row and column
      d;                   //  Temp-integer `d` for the direction
  for(Set S;               //  Temp Set `S`, starting uninitialized
      R--&gt;0                //  Loop `R` in the range (`l*l`, 0] over all cells:
      ;                    //     After every iteration:
       S.add(r==R/l&amp;c==R%l?//      If `r,c` is still cell `R`:
              -1           //       Add -1 to Set `S`
             :             //      Else:
              -2),         //       Add -2 instead
       L.add(S))           //      And then add `S` to Set `L`
      for(S=new TreeSet(), //    Set `S` to a new empty sorted-Set
          r=R/l,c=R%l;     //    Set `r,c` to cell `R`
          S.add(r*l+c)     //    Add `r,c` as cell-index to Set `S` every iteration
                           //    and continue looping as long as it wasn't in `S` yet:
          ;                //      After every iteration:
           r=(r-(d-d%3*d)/2//       If `d` is 3:
                           //        Go to the cell above
                           //       Else-if `d` is 2:
                           //        Go to the cell below
              +l)%l        //       Adjust row wraparounds when we're out of bounds
           c=(c-(d&lt;2?1-2*d:0)
                           //       Else-if `d` is 0:
                           //        Go to the cell left
                           //       Else-if `d` is 1:
                           //        Go to the cell right
             +l)%l         //       Adjust column wraparounds when we're out of bounds
        d=m[r][c];         //     Set `d` to the current direction of cell `r,c`
  // After we've determined all paths per cell:
  for(Set z:L){            //  Loop `z` over each path of Set `L`:
    if(z.remove(-1)){      //   Remove a -1 (if present),
                           //   and if it indeed contained a -1 (infinite path):
      c=0;                 //    Use `c` as counter, starting at 0
      for(Set q:L)         //    Inner loop `q` over each path of Set `L`:
        if(q.remove(-2)){  //     Remove a -2 (if present),
                           //     and if it indeed contained a -2 (tributary path):
          if(q.containsAll(z))
                           //      If `q` contains all values of `z`:
            c++;           //       Increase the counter by 1
          q.add(-2);}      //      Add -2 back to `q` for the next iteration of loop `z`
      System.out.println(  //    Print with trailing newline:
        z.size()           //     The size of path `z`
        +&quot;,&quot;+c);}}}        //     and the counter (comma-separated)
</code></pre>
</div>
<div id="pu6" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, <s>&nbsp;44&nbsp;</s> 41 <a href="https://github.com/DennisMitchell/jelly/wiki/Code-page" rel="nofollow noreferrer">bytes</a></h1>

<p><sup>-3 as the grid is guaranteed to be square.</sup></p>

<pre><code>ŒṪœịı*ÆiƊ+⁸ʋƬ⁺⁹ɗ€⁸%LḞQ€LÞḢṢƲ€¹ƙ$Ẉ€µḟṂLṭṂ)
</code></pre>

<p>A monadic Link accepting a list of lists of integers which yields a list of lists of integers (each being a <code>[loop_size, tributary_count]</code> - i.e. <span class="math-container">\$(n_i, t_i)\$</span>).</p>

<p>The directions in the input are:</p>

<pre><code>^  2
&gt;  1
V  4
&lt;  3
</code></pre>

<p><strong><a href="https://tio.run/##y0rNyan8///opIc7Vx2d/HB395GNWofbMo91aT9q3HGq@9iaR427HjXuPDn9UROQuUPV5@GOeYFAts/heQ93LHq4c9GxTUDeoZ3HZqo83NUBYm59uGP@w51NPg93rgVSmv///4@ONtJRMNRRMAGTRrFcOtFA2hiMYAJAFRAEEoMKmIAFgKQxSMAYzIMYA9QSCwA" rel="nofollow noreferrer" title="Jelly – Try It Online">Try it online!</a></strong></p>

<h3>How?</h3>

<pre><code>ŒṪœịı*ÆiƊ+⁸ʋƬ⁺⁹ɗ€⁸%L...  - Link: list, X
ŒṪ                       - truthy multi-dimensional indices -&gt; [[1,1],[1,2],...,[h,w]]
                €        - for each:
               ɗ         -   last three links as a dyadic chain:
              ⁹          -     use chain's right argument as right argument
            Ƭ            -     collect up until no change occurs with:
           ʋ             -       last four links as a dyadic chain:
  œị                     -         multi-dimensional index into X
        Ɗ                -         last three links as a monadic chain:
    ı                    -           square root of -1
     *                   -           exponentiate
      Æi                 -           [real part, imaginary part] -&gt; move deltas
          ⁸              -         chain's left argument -&gt; the current position
         +               -         add together -&gt; the new position
             ⁺           -     repeat the Ƭ-collection, use the entire result
                   L     - length of X
                  %      - modulo -&gt; making all results have the same domain
</code></pre>

<p></p>

<pre><code>...ḞQ€LÞḢṢƲ€¹ƙ$Ẉ€µḟṂLṭṂ) - ...continued
   Ḟ                     - floor (we had a mix of ints and floats, but ƙ uses
                                  Python's repr, this makes them all ints again)
    Q€                   - deduplicate each
              $          - last two links as a monadic chain:
            ¹ƙ           - group by:
           €             -   for each
          Ʋ              -     last four links as a monadic chain:
       Þ                 -       sort by...
      L                  -       length
        Ḣ                -       head
         Ṣ               -       sorted
               Ẉ€        - length of each of each
                 µ     ) - for each:
                   Ṃ     -   minimum -&gt; loop length
                  ḟ      -   filter discard (keeping only tributary lengths)
                    L    -   length -&gt; number of tributaries
                      Ṃ  -   minimum -&gt; loop length
                     ṭ   -   tack -&gt; [loop length, number of tributaries]
</code></pre>
</div>
<div id="pu7" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a>, <s>250 247</s> 235 bytes</h1>

<p><em>Thanks Arnauld for pointing out that the grid is guaranteed to be square, saving 12 bytes!</em>
</p>

<pre class="lang-python prettyprint-override"><code>G=input()
n=len(G)
N={}
T={}
t=0
exec"j=t%n;i=t/n;A=[]\nwhile(i,j)not in A:A=[(i,j)]+A;d=G[i][j];i+=d/3-1;j+=d%3-1;i%=n;j%=n\nk=A.index((i,j))+1;x=min(A[:k]);N[x]=k;T[x]=T.get(x,[])+A[k:];t+=1;"*n*n
for x in N:print N[x],len(set(T[x]))
</code></pre>

<p><a href="https://tio.run/##NY8xb8MgEIV3/woUyRLENCm1qkhGNzB58@SNMNWkwU7PVkJUqqq/3QXSSqd3j497J1i@/HnGl3VtweFy95QVCBeLtGVFB98/RZ/Ew3Nhg33bjOBLlA78HqUCbY74eXYXSx0fGc6eOCSqiRcZmErJAVrtjB6NdBUM@/pJyDGaMhlXAsoxyhEnUDuHgw00J1klZIAPh1TpZjJMdjoYmGSfWr97t54Grg2rlJ4aI30FQm62uMXiNF9JSM/omuXq0JOU5OlDtxhKecbWVWvBySsnh6zCcKJjr3P9gzjxqMT@wCGDqHUCdT491ghjfgE" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>

<p>Takes input as a 2D list from <code>STDIN</code>, where up, right, down, left are encoded as the integers <code>1, 5, 7, 3</code> respectively.</p>

<p>For each cell in the grid, the program follows the directions starting from that cell until a loop is found. The loop length is stored in the dictionary <code>N</code>, and the list of tributary cells is stored in the dictionary <code>T</code>. The keys for both dictionaries are the min indices of each loop.</p>
</div>
<!-- TYYY -->

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/QNNN/">QNNN</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




