<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::243911</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
  <!-- TXXX -->
<tr d-ix="0"><td>935</td><td>Python3</td><td>220310T182137Z</td><td><a href="https://codegolf.stackexchange.com/questions/243911/reveal-all-clues-of-black-box/243953#243953">Ajax1234</a></td></tr>
<tr d-ix="1"><td>141</td><td>Charcoal</td><td>220310T005921Z</td><td><a href="https://codegolf.stackexchange.com/questions/243911/reveal-all-clues-of-black-box/243916#243916">Neil</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Python3, 935 bytes:</h1>
<pre class="lang-py prettyprint-override"><code>E=enumerate
S=lambda b,x:(x+1==len(b)or x==0)*[1,-1][x&gt;0]
def F(b,C,v,x,y,q,w,c=0):
 if int==type(b[x][y])and c:b[x][y]=[v,'R'][C==(x,y)];return
 if b[x][y]=='O':b[C[0]][C[1]]='H';return
 T=[]
 for i in[1,-1]:
  X=x+(i*(q==0)+(q!=0)*q);Y=y+(i*(w==0)+(w!=0)*w)
  if X&gt;=0 and Y&gt;=0:
   try:T+=[i]*(b[X][Y]=='O')
   except:1
 T*=b[x+q][y+w]=='.'
 if not c and T:b[C[0]][C[1]]='R';return
 if T:
  Q,W=0,0
  if len(T)==2:Q=q-1*(q!=0)*q;W=w-1*(w!=0)*w
  else:Q=(q==0)*T[0]*-1;W=(w==0)*T[0]*-1
  F(b,C,v,x,y,Q,W,c+1);return
 F(b,C,v,x+q,y+w,q,w,c+1)
def g(b):
 for x,j in E(b):
  for y,k in E(j):
   if k and type(k)==int:F(b,t:=(x,y),b[x][y],*t,S(b,x),S(b[0],y))
 return b
K=lambda b:'\n'.join(''.join(map(str,[[j,' '][y in[0,len(a)-1]]for y,j in E(a)]if i in[0,len(b)-1]else[[' ',j][y in[0,len(a)-1]]for y,j in E(a)]))for i,a in E(b))
f=lambda b,c=0:K(g((A:=[[0]+[(c:=c+1)for _ in b[0]]+[0]])+[[(M:=(c:=c+1))]+i+[M]for i in b]+eval(str(A))))
</code></pre>
<p><a href="https://tio.run/##jVPvT6QwEP18/BU9v9BC3YA/kgumJsZ4ucTcEXUTNb3GwG7XY0Vgobrw13szLbt6Zj8cCVBe30zfmxmawfypq8NvTfv2diF09fKs28xo70aU2XM@z0jO@4T2YSxEqSuas7olvRARC2TM92Ml@9NIeXO9IN9pzs/5K@/5wFd8zWdASjxSLEhRGSHM0Giay17JQbGsmpNZMn4J@cr9a1/JcyEoRDN10mrz0lY2eEMSfupDxLmMFDBlrJTwf/hb5lRI5ZEFqCvgPKcNTid3og9pEdAVag7p6itKX7GTezFYfO3wtcXXDCLgzLtTERHUeA8LzEJMOyTTUMhCBWDiTsl7pwgDiO5nujFJDCoCAXrDFSgO18iY@NZEVRsysxmnnz1c@x/dTvG0K34rIh45LVj1KRPiILkSq/042Fg4uRVr/ByVA1mXnQaSsxpM4ZBgPwaa87gBgPixU3AWn4Ux24rYboYrDiZcK4Fge/wIA5C4Mvd8CYUmFw6x0MCfHLS0EKp/sqZt75/ABExCggeYxHWaj93lgeE3gPcMXyAU9qC0ThPJvcvtNCb@78qfLOuiov74fs4a2pmWS7nkPoE5GnACIo6VyxjMgXLiRr0ZUziT75wcOVg8KSGcL/8jAWN20ni2KQHzFu8/DEx@ckkfKT1LhAQzoaSzRGARMeoBY9Aj4PBgoZT0J9RjpDAVFqH8qTajTHIV6tesRIv0jMH11om9vb10ApcHd4rP1K3HZwr7Xhdbml0e2GWaeimBO3XgIYIuFJOlLo3dOnJbNhveFjweQUf3xhC3icNh6oe8zto5nUP7v4y9k2XRGVqw7a9JFkVpdEt/1ZXmZD7pmrIwFLsK1j2bqKvLF1PU1T@JFvRDfhZigNe0MFB0S@@gDZ@heAd2sAM73IEd7cCOof5/AQ" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, <s>171</s> 141 bytes</h1>
<pre><code>≔⁺⁺ψ⭆θ ψη⊞υηＷＳ⊞υ⪫  ιυη≔⁰ζＦ⊕ＬυＦＬη«Ｊκι¿⁼ ＫＫ«≔⁻⁶⊗⌕ＫＶωδＭ✳δＷ⁼ＫＫ.«≔⊗Ｅ²№ＫＤ²✳⁺δ⁺²×⁴μOε≧⁺⊗⌈εδＭ✳δ≧⁻↨ε±¹δ»≡ＫＫO≔Hδ¿∧⁼ⅈκ⁼ⅉι≔Rδ«≔Ｉζδδ≦⊕ζ»Ｊκιδ»»Ｊ¹¦¹ＵＯＬθ⊖Ｌυ 
</code></pre>
<p><a href="https://tio.run/##dVNRb5swEH6GX3HiyZZctEzTHpqnrtm0VUsTddW0PrpwAStgErCbtVN@OztjE7KqQzrwne@@z9/5yErZZo2s@v6q61Sh2bqynX89C/hhWqWLpdyxvYAEEs4FPJOVfB6vbVcy69eHUlUI7JveWeNrGOcwZtw0SrMEIBGguKukBMPsaeUQAvs7AS/kbZrWoWUt1qgN5uw76sIQGCfYYTMESvL/xNGNrXf3Dds6gnkcqQ2wz3srq45oiXWNuGXcp0aBaak0afwoYNHYx4ooviidM5f5s9G3aGupNSOpB@5E5w42WjZPyBaqxcyoRrOcD9EgPhB6LupWmgTCkXEkcu18L@C6saTdpU@IFJ6c4RJyOr370s69qrFjHwTUnA@HSlbJ8MXhGBHheqY7VZRmKJ/ULeVvVdua4aTmP3Je4wyNEvBJdshQwC0W0iCbTThHsu6gTFZCUO91Z1ThzngJoQHJ12SsyXEjbWUuwV3VFTU@dO@Xa92WLPgPzlfu6kaMuxNGhBURDB0eW3wtO8NeJoWRH7DROyk7ny0/cZHX4ezVMJ1jHONjHLZnAmYUWj1WDU17GMc9US/wrbH1v8@879NV6p84TU8rH1v9Eztfrd6IhYr@4qn6Cw" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Takes input as a list of newline-terminated strings. Explanation:</p>
<pre><code>≔⁺⁺ψ⭆θ ψη⊞υη
</code></pre>
<p>Create a header row.</p>
<pre><code>ＷＳ⊞υ⪫  ι
</code></pre>
<p>Read the grid and pad the sides.</p>
<pre><code>υη
</code></pre>
<p>Output the grid and a footer.</p>
<pre><code>≔⁰ζ
</code></pre>
<p>Start with no rays.</p>
<pre><code>Ｆ⊕ＬυＦＬη«
</code></pre>
<p>Loop over all of the squares.</p>
<pre><code>Ｊκι¿⁼ ＫＫ«
</code></pre>
<p>Is this an entry point?</p>
<pre><code>≔⁻⁶⊗⌕ＫＶωδ
</code></pre>
<p>Work out which direction the ray leaves this entry point.</p>
<pre><code>Ｍ✳δ
</code></pre>
<p>Move onto the grid.</p>
<pre><code>Ｗ⁼ＫＫ.«
</code></pre>
<p>Repeat while the current cell is empty.</p>
<pre><code>≔⊗Ｅ²№ＫＤ²✳⁺δ⁺²×⁴μOε
</code></pre>
<p>Check the neighbours for <code>O</code>s.</p>
<pre><code>≧⁺⊗⌈εδ
</code></pre>
<p>If there are any then reverse direction so that the next move takes a step back. (This also handles the case of an <code>O</code> at the edge of the grid.)</p>
<pre><code>Ｍ✳δ
</code></pre>
<p>Take one step.</p>
<pre><code>≧⁻↨ε±¹δ
</code></pre>
<p>Adjust the direction if there was only one adjacent <code>O</code>.</p>
<pre><code>»≡ＫＫO≔Hδ
</code></pre>
<p>Did we hit an atom?</p>
<pre><code>¿∧⁼ⅈκ⁼ⅉι≔Rδ
</code></pre>
<p>Were we reflected?</p>
<pre><code>«≔Ｉζδδ≦⊕ζ»
</code></pre>
<p>Otherwise, output the next ray number at the exit point we just reached.</p>
<pre><code>Ｊκιδ
</code></pre>
<p>Output the result of the ray at its entry point.</p>
<pre><code>»»Ｊ¹¦¹ＵＯＬθ⊖Ｌυ 
</code></pre>
<p>Clear out the grid.</p>
</div>
<!-- TYYY -->

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/243911/">243911</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




