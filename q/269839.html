<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::269839</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>636</td><td>Python 3 PyPy n=4 repeated 40 times in 0.43 seconds</td><td>240216T112902Z</td><td><a href="https://codegolf.stackexchange.com/questions/269839/fastest-count-of-certain-hypercubes-with-labeled-vertices/270106#270106">gsitcia</a></td></tr>
<tr d-ix="1"><td>nan</td><td>Rust</td><td>240215T115804Z</td><td><a href="https://codegolf.stackexchange.com/questions/269839/fastest-count-of-certain-hypercubes-with-labeled-vertices/270080#270080">138 Aspe</a></td></tr>
<tr d-ix="2"><td>525</td><td>Ruby</td><td>240211T234521Z</td><td><a href="https://codegolf.stackexchange.com/questions/269839/fastest-count-of-certain-hypercubes-with-labeled-vertices/270004#270004">Level Ri</a></td></tr>
<tr d-ix="3"><td>nan</td><td></td><td>240207T162425Z</td><td><a href="https://codegolf.stackexchange.com/questions/269839/fastest-count-of-certain-hypercubes-with-labeled-vertices/269865#269865">user1502</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="http://pypy.org/" rel="nofollow noreferrer">Python 3 (PyPy)</a> (n=4 repeated 40 times in 0.43 seconds, n=6 in 36 seconds on TIO)</h1>

<pre class="lang-python prettyprint-override"><code>import itertools
import functools
from collections import Counter
import time

@functools.lru_cache(None)
def gen_rectangles(n):
    x = []
    for t in itertools.product([
        (0,0,0),
        (1,1,1),
        (0,0,1),
        (1,1,0),
        (0,1,0),
        (1,0,1),
    ], repeat=n):
        a = b = c = 0
        for a1, b1, c1 in t:
            a, b, c = a*2+a1, b*2+b1, c*2+c1
        if a &lt; b &lt; c:
            x.append((a, b, c, a^b^c))
    return x

def mask(n, k):
    return ((1&lt;&lt;(1&lt;&lt;n))-1)//((1&lt;&lt;(1&lt;&lt;k))+1)

def swap_parts(n, k1, k2):
    m1 = mask(n, k1)
    m2 = mask(n, k2)
    m12 = m1 ^ m2
    ma =  m1 &amp; ~m2
    mb = ~m1 &amp;  m2
    d = 2**k2 - 2**k1
    return m12, ma, mb, d

def swap(x, m12, ma, mb, d):
    xs = x &amp; m12
    a = x &amp; ma
    b = x &amp; mb
    return x ^ xs ^ (a&gt;&gt;d) ^ (b&lt;&lt;d)

def flip_parts(n, k):
    m = mask(n, k)
    k1 = 1 &lt;&lt; k
    return m, k1

def flip(x, m, k1):
    a = x &amp; m
    b = (x &gt;&gt; k1) &amp; m
    return (a &lt;&lt; k1) | b

@functools.lru_cache(None)
def parts(n):
    return [flip_parts(n, k) for k in range(n)], [swap_parts(n, k1, k2) for k2 in range(n) for k1 in range(k2)]

def reduce(x, n):
    fp, sp = parts(n)
    for p in fp:
        x1 = flip(x, *p)
        if x1 &lt; x:
            return x1, 0, p
    for p in sp:
        x1 = swap(x, *p)
        if x1 &lt; x:
            return x1, 1, p

def make_order(d):
    d = {a:b[0] for a,b in d.items()}
    C = Counter(d.values())
    empty = d.keys() - d.values()
    l = []
    while empty:
        i = empty.pop()
        j = d.get(i, None)
        if j is None: continue
        l.append(i)
        k = C[j] - 1
        if k == 0:
            empty.add(j)
        else:
            C[j] = k
    return l

@functools.lru_cache(None)
def gen_cubes(n):
    if n == 0:
        return [0, 1]
    if n == 1:
        return [0, 1, 2, 3]
    prev = gen_cubes(n-1)
    half = 2 ** (n-2)
    k = 2 ** (n-1)
    full = 2 ** k - 1
    n1 = n - 1
    bad = {}
    good = []
    for x in prev:
        bc = bin(x).count('1')
        if bc &gt; half:&#32;
            bad[x] = full ^ x, 2, full
            continue
        t = reduce(x, n1)
        if t:
            bad[x] = t
            continue
        good.append(x)
    order = make_order(bad)
    compatible = {}
    masks = []
    for a,b,c,d in gen_rectangles(n):
        if b &gt;= k or c &lt; k: continue
        a, b, c, d = 1 &lt;&lt; a, 1 &lt;&lt; b, 1 &lt;&lt; (c-k), 1 &lt;&lt; (d-k)
        masks.append((a|b, c|d, a, d, b, c))
    for b in good:
        l = prev
        for ma, mb, pa1, pb1, pa2, pb2 in masks:
            q = b &amp; mb
            if q == pb1:
                pa = pa1
            elif q == pb2:
                pa = pa2
            else:
                continue
            l = [a for a in l if a&amp;ma != pa]
        compatible[b] = l
    for x in reversed(order):
        pre, disc, p = bad[x]
        l = compatible[pre]
        if disc == 0:
            l = [flip(i, *p) for i in l]
        elif disc == 1:
            l = [swap(i, *p) for i in l]
        else:
            l = [p ^ i for i in l]
        compatible[x] = l
    out = []
    for x, l in compatible.items():
        x &lt;&lt;= k
        out.extend(x|i for i in l)
    return out


if __name__ == '__main__':
    t = time.time()
    for i in range(7):
        print(i, len(gen_cubes(i)))
    print(f'{time.time() - t:.1f} seconds 0-6')
    t = time.time()
    for _ in range(40):
        gen_cubes.cache_clear()
        parts.cache_clear()
        gen_rectangles.cache_clear()
        for i in range(5):
            gen_cubes(i)
    print(f'{time.time() - t:.3f} seconds 0-4 x40')

</code></pre>
<p><a href="https://tio.run/##lVdtc5s4EP7Or9B9acDF1HJydzMe13Mz/X5/wOMwAkRCwEIF3JJp2r@e210QQpzT3jlDsVe7j55d7Yuqn7vHWt2u9bN@fn0tzrpuOlZ0sunqumq9UZBfVDoI8qY@s7SuKpl2Ra1aNmp8qi8KrIxBV5yl5/012UVVc4lTkT5K/@9aycDLZM4epIobwBHqoZKtr4Kdx@DTs4/seKKved0woKMso0g3dXZJO/9ICvjxNyH8BaEV8BD@5gLU4EuNjavBlxjW5BSyRmopuo@GI34E8EzgSeHZTFKkLHjIEnhSjtw7a0JmsBaSkVht35MqvEkd3imflIscttjDFnuWuhB9JLSWKvP9ESxk4j65T4OA1BrZXRrFeo@ifBZt6auQlSP1cdX3@X6PjwqCNQ8@fJgEZRC858Fg3H4VOtai6VqCAJLldsQ5c3BhAufD1uftXLgdhZyknN3D@iDB2KHkHfthRBjKHyQyWhlItqtVuWVrevM5fwANAQceCEBm2fp9uFgzadUCXA/wsOqZ86Pfgn4m5mfiBBFIg@U988XhkAX4JdnvszE8eVXMw2MiM4/BEIISg8XZfs9KxwmMnIUi7hTMnctwIuj37HBAhUlqjlMQOCy8sOSXlTdSdjPiuPSGcrnEFG6gRCXoQyEcr6bEoLqd6w4ibkWgdhp8bSSUsERvDYVch6zV4KBhNpW/RoBc2wLoMZQmWisdzOsF1vasd4vFHCQQ3YRMu8DtEtik0P8D5gg8Vlsp47rJZOObxMM0/iZ2yXFzGrpDmODWWQRN7dz6wXfS@gRaYxP1s@iLqC7QEseClmfdPcN6FpXyGaRQD1aFNCrbM78@FpUcTCzfAtZJFOla@9a1J0J9kJ1fhGzIj5nXT6xoSbqDlq@6Ql3ktFyZHlRYkxJ9OD6dgJ/TxkAOLdKN3sBGZJn/ZAFk1UpXjeA@ulVT/afJkl6S2VABFmrBwqQ9ZAU/OUr8ulLIoK3cDqq6kV@A12yj9dgCH0WVY@NiqxUD6dgDy5loVMwvVWWk5RQyhVmopp@JoPQZcuShrjN3OPaYScjFMk5wtCSF8vsgSjGh/Bt@4xwraByI5o45sYa9jj1Gm5hB3yOH8Yej9q9U6MBkVtLc2Wwx/aY9up9joqsmw/oBkKqKWutUYoA2rKX1WYuuSCDzp2hhC27dcEHphWmYYdDeuHyYELEDJB1sCYMa2uqV/J8mb2Y6O0jonYxvP12XgfmerUsbFmJmZ/gLAr1kISJkA2xgGyA1CwyHJYhpg4fuXDrMvNN4pdB4n9Bii9@oK9OW7lF8pvvLNPBm3n/GIgAIV5/SXlCP5m4pV9Zm@6bNdmGzrPSraTD1NjGcH7pS0c3oHdwhfkPck2etTRIcE0yxyi0TCJhsWpn5lDuz84ZQQuCLFg4TR9CQok6wZ8igfJpnCtpdaW9EmqZUQcOEaBRE/@Q5gTMA/AoATaOfAiyjSGYaire4ajBzpLchqi/doq2EGGU1UzfDajYuIa9NYx5BItl3VLAv892dSyloeZ4HbsexEmcZx@j6TRyfRaHi@GaARzb4P4gI//FtKRT2MvGnc36FogFWSeXbjlwEYxUN6/nNtxkmNNhuF/H8O2slZF3Wss36j7FNvrV9bLe/28z2n7aMaA7FaSVFMxuydKd5Y81tQ28oLXz/PXDPfO7yLxy@dRy@Y/3dBpx@ff0H" rel="nofollow noreferrer" title="Python 3 (PyPy) – Try It Online">Try it online!</a></p>
<p>Based on <a href="https://codegolf.stackexchange.com/a/270004/95116">@Level River St's Ruby answer</a>. The main difference is that this answer exploits additional symmetry.</p>
<p>As a simple example, consider a single square of the hypercube. There are 3 cases:</p>
<ul>
<li>All four vertices are colored the same (2 cases like this (flip))</li>
<li>A single vertex is colored differently (8 cases like this (flip/rotate))</li>
<li>2 adjacent vertices are colored 1 (4 cases like this (rotate only))</li>
</ul>
<p>This answer considers the symmetries of the n-1 hypercube, drastically reducing the amount of work necessary (in the case of n=6, it reduces 94572 cases to only 63 cases)</p>
</div>
<div id="pu1" class="pu"><h1><a href="https://www.rust-lang.org/" rel="nofollow noreferrer">Rust</a>, n=4 repeated 40 times in 0.6 seconds on TIO</h1>
<p>A port of <a href="https://codegolf.stackexchange.com/a/270004/110802">@Level River St's Ruby answer</a> in Rust.</p>
<hr />
<p><a href="https://tio.run/##nVXbjtowEH0uXzGs1MimKQWW8rABPmEf@7LaopA1S4B1gi@t1G2@nY6dC3YSWqkWimX7zJkzFxuhpbpckoxLBY8PoGX6i8EK5tFgsOPwFqecUHgfAI4TU/CmFeQi5WqTaZXjYgVKaBZ5gPgBvrFkqRfzNZ7/YMnwafJcQgRLNjvNE5VmnExDCCy@ml1iWuLtZ5cJ2EDKYTIezyeo5kNLwi4@yUrD/zgpBoWN1rPjVTJCE461rGMKPY7qcJtlpzpR6Q44rOGxWpaSlBa8dudlS5fZIkgdgvehTfowe00m0ioTiw1Cxnn2kxAOn2FKIZag72fUcVv7OCBRCiNYRN4RsQkJLeRcTqKcJEULMgmh@tGow2kSP7luu0XijoTa5IjwA3x0JZiR43YOyyVM4TeQIwQYiI84I@LcIOZTWK@hDycQJxrc7OstnEScvOIWt3BYxSNW8b4Vixkm9KOPLrzVAb6s3Eivp8iqkHXeYtXjXMs9IVgMLAQWQVLaNm/1zbZ7y56v9zCPU2EifcLqkakJt/qWvUKpmdy2ChJTPGs2ThUTxO0jC3gxgLh72ADYXwC1LvO4EAbfIaGY/peusKjXzAS87950z72bPKMk0D0aasJXJGOm9LkpfdSLMw5fYWgFI/JsmwSCwBjXm8LZbJCyp52cBtjf0GXGVrD42G9ZDP69g@zDW/TbssdYj7DiRi97jYfcI@/hvbqx2yc@JHfvxV2Ink7M/G@MYNY8sZ2HmcMnqB/nbdh@l4vL5Q8" rel="nofollow noreferrer">Try it online!</a></p>
<pre class="lang-rust prettyprint-override"><code>const N: usize = 4;

fn main() {
    let mut print_output = true;
    let mut a: Vec&lt;u64&gt; = vec![0];
    rec_function(1, &amp;mut a, &amp;mut print_output);
    
    for _ in 0..40 {
        print_output = false;
        rec_function(1, &amp;mut a, &amp;mut print_output);
    }
}

fn rec_function(n: usize, a: &amp;mut Vec&lt;u64&gt;, print_output: &amp;mut bool) {
    if n &gt; N {
        return;
    }

    let mut u: Vec&lt;(u64, u64, u64, u64)&gt; = vec![];

    for i in 0..6_u64.pow((n - 1) as u32) {
        let mut j = i * 6;
        let (mut p, mut q, mut r, mut s) = (0, 0, 0, 0);
        let mut t = 0;
        for _ in 0..n {
            let k = j % 6;
            p = p &lt;&lt; 1 | (k &amp; 1);
            q = q &lt;&lt; 1 | (41 &gt;&gt; k &amp; 1);
            r = r &lt;&lt; 1 | (25 &gt;&gt; k &amp; 1);
            s = s &lt;&lt; 1 | (26 &gt;&gt; k &amp; 1);
            if k &gt; 3 {
                t = k;
            }
            j /= 6;
        }
        if t &gt; 4 {
            u.push((p, q, r, s));
        }
    }

    let mut b: Vec&lt;u64&gt; = vec![];
    let pairs = [0, (1 &lt;&lt; (1 &lt;&lt; (n - 1))) - 1];

    for &amp;c in pairs.iter() {
        for &amp;d in a.iter() {
            for &amp;e in a.iter() {
                let e = (e ^ c) | d &lt;&lt; (1 &lt;&lt; (n - 1));
                let mut h = false;
                for &amp;(p, q, r, s) in &amp;u {
                    let g = e &gt;&gt; p &amp; 1;
                    h = g != (e &gt;&gt; q &amp; 1) &amp;&amp; g == (e &gt;&gt; r &amp; 1) &amp;&amp; g != (e &gt;&gt; s &amp; 1);
                    if h {
                        break;
                    }
                }
                if !h {
                    b.push(e);
                }
            }
        }
    }

    if *print_output {
        println!(&quot;{}&quot;, b.len() * 2);
    }
    rec_function(n + 1, &amp;mut b, print_output);
}
</code></pre>
</div>
<div id="pu2" class="pu"><h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, n=5 in 25 seconds on TIO</h1>

<pre class="lang-ruby prettyprint-override"><code>N=5
f=-&gt;n=1,a=[0]{return if n&gt;N
#generate rectangles
u=[]
(6**(n-1)).times{|i|
  j=i*6
  p=q=r=s=0
  t=0
  n.times{
    k=j%6
    p=p&lt;&lt;1|(k&amp;1); q=q&lt;&lt;1|(41&gt;&gt;k&amp;1); r=r&lt;&lt;1|(25&gt;&gt;k&amp;1); s=s&lt;&lt;1|(26&gt;&gt;k&amp;1)
    t=k if k&gt;3 
    j/=6
  }
  u&lt;&lt;[p,q,r,s] if t&gt;4
}
#check colourings
b=[]
[0,(1&lt;&lt;2**n/2)-1].product(a,a).each{|z|c,d,e=z
  e=(e^c)|d&lt;&lt;2**n/2
  h=false
  u.each{|w|p,q,r,s=w 
    g=e&gt;&gt;p&amp;1
    h = g!=e&gt;&gt;q&amp;1 &amp;&amp; g==e&gt;&gt;r&amp;1 &amp;&amp; g!=e&gt;&gt;s&amp;1 
    break if h
  }
  b&lt;&lt;e unless h
} 
p b.size*2
f[n+1,b]
}
f[]
</code></pre>
<p><a href="https://tio.run/##NZFNboMwEIX3PoWrqAioQ2OasCnDEXIBRCUgw09IHbBBURNydmoMWdie93lmPE@WQ/Y3TUc4kAK2kQDOUoh3yUNiP0hB64KK6Eg2JQqUaY9UYt6norygIgPECbED17XFljuO19e/qB5jPRJKz1C7gT5b6ECCgp2Oe7OLNU@HlDZwfg9M1EIbhny0G4s737SDzqg9j6KFSJCG@IcXUaAWEizEtOmhmWduoi9q9PkT5v5PvYYwjFvWMclUMuf00Z48ySavMG9ofr1cB1mLUpFsthXvmM3D0Hdd8ek7W554rbyehry3U5Y6HqZ59RjvY85ODOGuuyPY@JM74@lVpFkFRXpROL@9VtzGdQK4LfOVgFHUWtyIigIt32bSWZxalr6dhVyFuVFamORMYmq8Vqu/LAyRDkL/jNLsSUlLM0/Vd3R9UsTig7Ms0YaLOJmmfw" rel="nofollow noreferrer" title="Ruby – Try It Online">Try it online!</a></p>
<h1><a href="https://www.ruby-lang.org/" rel="nofollow noreferrer">Ruby</a>, n=4 repeated 40 times in 1.3 seconds on TIO</h1>

<pre class="lang-ruby prettyprint-override"><code>N=4
printoutput=true
f=-&gt;n=1,a=[0]{return if n&gt;N
#generate rectangles
u=[]
(6**(n-1)).times{|i|
  j=i*6
  p=q=r=s=0
  t=0
  n.times{
    k=j%6
    p=p&lt;&lt;1|(k&amp;1); q=q&lt;&lt;1|(41&gt;&gt;k&amp;1); r=r&lt;&lt;1|(25&gt;&gt;k&amp;1); s=s&lt;&lt;1|(26&gt;&gt;k&amp;1)
    t=k if k&gt;3 
    j/=6
  }
  u&lt;&lt;[p,q,r,s] if t&gt;4
}
#check colourings
b=[]
[0,(1&lt;&lt;2**n/2)-1].product(a,a).each{|z|c,d,e=z
  e=(e^c)|d&lt;&lt;2**n/2
  h=false
  u.each{|w|p,q,r,s=w 
    g=e&gt;&gt;p&amp;1
    h = g!=e&gt;&gt;q&amp;1 &amp;&amp; g==e&gt;&gt;r&amp;1 &amp;&amp; g!=e&gt;&gt;s&amp;1 
    break if h
  }
  b&lt;&lt;e unless h
} 
p b.size*2 if printoutput
f[n+1,b]
}
40.times{f[];printoutput=false}
</code></pre>
<p><a href="https://tio.run/##TVLbboMwDH3PV2SahoClXdN1fRnmE/oDiElAzaV0achF1Vr67V1ImbSHJD7Hx44dR9ny537fwYZI1QlzskZaA0ZZJDUsUgGcFZCt8qtCY5WgXU1FuiPPDQpUhUGqsDKFaI6oiYUsJ@E2jkOx4FG0NN036uvYjYTSA3Tx1p0SBlCgYeVs43cx65xJaQ@Hl623JMgk4WPYBzz6pAMMHm14mj4YBcoz648/RoN@MNsH49MY6Kea@/Sdenx4gyn/zS2bJJlkA1NM55PGpBtyI89Vi1VPq9PxZN2LNJqUU1vZioU8SdZxLN7W0YLnS6lOe1uZsGBFtMSiaq/jZazYniFcXHaEEL@qaNz/BTmuhbo4apzuniPO41wBnB/1NYBpKgPuQUuBNk8TMwScBoHzTkDNwHu0A15cKix8r@3cX5kkSK1wk9GOu1EiabnU3QXj9ST7N29SZ@KVszJ3/W9W8zzqLP/8/yd86bf7/Rc" rel="nofollow noreferrer" title="Ruby – Try It Online">Try it online!</a></p>
<p>This is a recursive function which takes the solution for the previous <code>n</code>, makes a cartesian product of two copies, calculates all rectangles that bridge between them, then checks the colourings of these bridging rectangles. Because the solution for the previous <code>n</code> is known to be free of illegal colourings, it is only necessary to check rectangles that span the new dimension. This approach means there are only <code>1882 x 1882 = 3541924</code> colourings to check for <code>n=5</code> instead of <code>2**32 =  4 billion.</code> Also we only calculate colourings where the most significant bit is <code>0</code> which halves the number of calculations; the remaining colourings are the same but with all the 0's and 1's flipped. Precalculating the rectangles before checking colourings also helps.</p>
</div>
<div id="pu3" class="pu"><h1>Python + python-sat (about 1 second on my machine)</h1>
<pre><code>import itertools
from pysat.solvers import Glucose4

def count_cubes(n):
    clauses = []
    for (x, y, z) in itertools.combinations(range(1 &lt;&lt; n), 3):
        e0_p = y &amp; (~x)
        e0_n = x &amp; (~y)
        e0 = e0_p | e0_n
        e1_p = z &amp; (~x)
        e1_n = x &amp; (~z)
        e1 = e1_p | e1_n
        if e0 &amp; e1:
            continue
        w = x ^ (e0 | e1)
        x, y, z, w = x + 1, y + 1, z + 1, w + 1
        clauses.append([x, w, -y, -z])
        clauses.append([-x, -w, y, z])
    if not clauses:
        assert n == 1
        clauses.append([-1, 1, -2, 2])
    with Glucose4(bootstrap_with=clauses, incr=True) as m:
        count = 0
        while m.solve():
            count += 1
            model = m.get_model()
            m.add_clause([-v for v in model])
    return count

for t in range(40):
    for n in range(1, 5):
        r = count_cubes(n)
        if t == 0:
            print(n, r)
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/269839/">269839</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




