<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::148587</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>836</td><td>Regex PCRE2</td><td>191225T015626Z</td><td><a href="https://codegolf.stackexchange.com/questions/148587/is-it-a-valid-chess-move/197444#197444">Deadcode</a></td></tr>
<tr d-ix="1"><td>124</td><td>Python 2 with pythonchess</td><td>220705T035527Z</td><td><a href="https://codegolf.stackexchange.com/questions/148587/is-it-a-valid-chess-move/249561#249561">Deadcode</a></td></tr>
<tr d-ix="2"><td>693</td><td>JavaScript Node.js</td><td>210909T102446Z</td><td><a href="https://codegolf.stackexchange.com/questions/148587/is-it-a-valid-chess-move/235197#235197">ophact</a></td></tr>
<tr d-ix="3"><td>132</td><td>Python 2 with pythonchess</td><td>171119T221108Z</td><td><a href="https://codegolf.stackexchange.com/questions/148587/is-it-a-valid-chess-move/148609#148609">Jonathan</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Regex (PCRE2), <s>931</s> <s>925</s> <s>837</s> 836 bytes</h1>
<p>This solution departs from the problem statement in that two board states are passed to the regex, instead of one board state and a move. The move is inferred from the difference between the two board states. So I made it the job of the TIO program to take the test cases in the format provided by this question, find all instances of the described piece on the board, and with each one, try moving it to the destination position and evaluating the regex with that possibility, finding if any are reported by the regex as valid. If this is not okay, let me know; it's possible to implement a regex as position + move, but would be much less elegant and require serious refactoring.</p>
<p>The board is represented in 8×8 ASCII where white pieces are uppercase and black are lowercase: <strong>P</strong>awn, k<strong>N</strong>ight, <strong>B</strong>ishop, <strong>R</strong>ook, <strong>Q</strong>ueen, <strong>K</strong>ing. Black's side (the 8th rank) is on the top and white's side (the 1st rank) is on the bottom. Each rank is separated by a newline, and empty squares are marked as <code>-</code>. The two board positions are separated by an extra newline.</p>
<p>The actual aim of this project is to validate entire games, not just single moves. See below for the current state of progress.</p>
<pre><code>()?(?&gt;|((.|
(?=.)){2})((?=(\X{72})-))((?=(?(1)[-a-z]|[-A-Z])))((?5)(?(?=(.*
)
)[qnrb]|p))((?5)(?(?=(?8){8}
)[QNRB]|P)))(?&gt;((.)(?=(?5)\11)|(?(m)$)((?(1)(-(?=(?9))(?=(?3){8}((?3){9})?P(?4))(?(-1)(?=(?8){4}
))|[a-z](?=(?9))(?=(?3){7}(?2)?P(?4)))|(p(?4)((?=(?3){8}((?3){9})?-(?7))(?(-1)(?=(?8){7}
))|(?=(?3){7}(?2)?[A-Z](?7)))))|(?&lt;e&gt;(?6).)?(?=(?i:(?|(?(e)|(B|Q))(?27)(?(e)(B|Q))|(?(e)|(R|Q))(?31)(?(e)(R|Q))|(?(e)|(N))(?34)(?(e)(N))|(?(e)|(K))(?35)?(?(e)(K))))(?(e)(?&lt;=(?!(?6)).)(?4)|(?6).(?5)\19))(?(e)(?=(?5)\20)|(?!(?6)).(?4)))(?&lt;m&gt;)|(?(+1)$)(.))+
)+\k&lt;m&gt;
(?!\X{,70}((?(1)p|k)(?=(?3){7}(?2)?(?(1)K|P))|(?i:(?&lt;E&gt;(?!(?6))K)?((?(E)|((?6)[BQ]))(()?((?(-1)-)(?3){7}(?(-2)(?2)))+)(?(E)(?-4))|(?(E)|((?6)[RQ]))(-*|((?(-1)-)(?3){8})+)(?(E)(?-3))|(?(E)|((?6)N))((?&lt;=..)(?2){3}|(?=.)(?2){5}|(?2){8}(?2)?)(?(E)(?-2)))(?(E)|(?&amp;E))|K((?3){7,9})?K)))
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=7VjNduLIFV5kFZ6izGRaVQa5LfEjtTHmmDY57cM0bWMc97TM4chQGB1AoiXRxG38JNlkk-Vss8mTZJ4mt36EVMhJNrPIIpxuIX33r-53b90S_ssv49ViHbH_o8fx-BenqC9W45Caul0c_rP_w4ROPZ-iq_f9jjl6_-miM7rtXQ5Gd5cXgw_ILvzg-ePFekLRKTc6mp0VxjM3RKOVM0RN1C-2N5v5Q2X989PT58Gsvpnhv63jqW7_-rsLTFq4dbbF-GhbwK3mESHP5gvBcIvvPz9bcK8T8djCBnF0V_8-3Dr6uf5lSLigRkAC4qPDAikQ56sfPgy3K0XUssmz_QLC616_PdxeMcPWGYQkXFoj94ZBtqC7JH9gdhAI61z0jgiVCnOA-fe7F9K6wq0qk2DdIEmAKgQgW4etb9_UesEtM7GCQCt2g19zDFGtfccWd7zny2EEcGXusXVKz3CrTo6ISNg7wS2WEAVZe3vNXJoW4YB4ToR9IawYUtjPCntcVJWiXirockGNBWOSLuGMstvWKUQ_YEshjN0qM4FlCZLf7bQE6-YxE0ttQQ44WJ7xOCWDFQP6oVQgpfs5wNAfB9ATZev4RRRptZ3vc8zxLivxVrBw2jlLQnRBDPIOiNiz074esjYRKBCuk50nrJuMMlhQiXAT3NKrIv-deZ-b64db1dx-ydhUVJseb8vT5tER9_5cednynucPNfZg8n5gmex8mIJc5qP1pgMOu6JfrDLrGMa93Ey__zvZ32fFMjpcNUerktHIbNIonngB26RZKPT8RxXzAkCpu8zrnRU8P0YruI1HNAyDEI8DP4oR3_SHSxpF7iMlzxDn5GQMCuj0FEmU3XKc-pNFA4U0Xoc-MhovOZfseRxMKEHPBQQf7lx6ccxafdjgsDdFmE-d0SOVpiOphZl5GWExtm7ffzjv24dECsso8r7TYIqT5aK3CZLRB3Z5FPZR0ilyJcTjnaDiv82QW--yLIg0l67n4ySvlQOkLqiPV0Q3hs3jBlqDTsUcxShoHsMyAxihYkk3t-2bweXgdtAZdT4POr2LzgXa5mW3vZvOYNT5eDX4uYFYvEfwWtilIGoIgtU6biDBHWMKHYY0eV668Xg2mrixC_Xc3QtvIY3Wi7gscm8k4S-_dDgynUYUhME6hpwe45micBh8o-MYrCQtkFkSf7nyFhRL7m-uBn2yKkvTL53-p9Gg0_942TsfdC7KCFh5w6PLbxnzmKQtcRBCRSXv2a7iV6mXSbKZy3sEz25MR9MwWI5WbhzT0MchtE3v9qefpINpECLep99Z2Ti50IQLOCqxaBbPLwueSQN0jKTkySK_EwQy1thYu_c16TWRckPneNhsao6WNd3thofADScRP2OLuvzc-7_N3W_lJ-ux2FBzyAyNqMnTPRqPoD0xYQMrq8qZbjSiUtOw96lgH8kEjhzDGOqaAXyVENZsTQekOiSH2IYDhREVOdaQy1xN1841kESOyThuZ_nP1gE81IcHTa0MTh-gKeaq2ku-Lksex6znAxmvRmIt9M1deJNknyppC4LipsixscuVZXRow8Qox00gbTwLMWyCJbRaXCq9RtKSLserJyzsS9K-ZJSlR5iUAoLDLB-FNWieH1WrZLCEI6dyvF-DSiVbA0imqV1pb95wAdzbGmoh7VpDJ0K2ysgMLvsqZA309i1ipxKcFe6Gbe1gGcRe4CM3Qu5i4z5F-tc1pT7CM0D8ANHpFEYOAo14RgXLXvyEgil_XsJAIrms4jQhtlyoXz5zMQXVwcHnQ3aEJcTKg0U8wpjnIwz-peNGmSv7HShjncKEe6Wse1oHyWnR6fc_9Ue9Tx_PB-8_EGUKCtVXor0guogkTaVSWRhNcfHHCGEOEtjFScOQ_7QR2IqERS5I4vTe_3GC_sR04AQti6B7Ptlq_kvTsQ2QWee9f-l_2_lMCrDvO13rdBN6McXK9JFD-4iVjT1BvWCeB-uEMWGdOzGmIaU4fSbZw1UI4VDavfOIGsArgXh9--uvhX84TrENiy524VIpI3tYRhK5LvJV1FKkB5dqGVkqYilW7GKCWor0hZWtIraCXIlYloqYOQRWWFeRWg6p56ysHGInyF2SO_gxUuRa-KmkSE9EzyBtYWWqSD3J_S7J1FA8y9wziMy9oiKm4lnmvodUlVgy9z0dK4fYLFZuQSZMnTM0CNcU4QFMqTAI5myCzQw0dn0-tNjRsIHeBhgGWMFx4FQpI62r8bi8mgK51tJqCqSnpTmmiCV5EAi72IofdjFlBwqkr_GsKypiKDpXGq_LHpLwoOhYOaSuIgnD2l2SqZVEv0syTeoikJ6WdnuKWMl67pK8kq5IEVtBZF62ilSSNd8lK7SV6Fda2rcpUs3pGEpe0o81VBfNaWVd8UeXDWjcox6cXyGa-97jLEZxILoCvt0aYu-saANiyg65J-SG-z1iKXW71tI5kXZETamSXERd7QhLqVs7x1M321m7KtUVpJet9g6pKMzJ7jNVpM5IScN3NbmhMjyx7bOZwYRHD140C1ZoE6wXE_bazc__ufglBK9tdDzPc1RXObJf2zV7O8vOMWIqPLa1dLYru8bIIXv9b-f2kbr7pE49x76tsm_l9kgtV4-q4kfW1czVI6PTz-1QuUfqam_XXtsj5jDXevbrVRQvd-N1GFI_Xjwh9paXK2QZuf4EYC8Su2IS0MjX2J8X6DcwA4kb_7_Y_yvFtpLRlh54oppRrqA0mXcPi2A8j14rpJ2bbHWFyl6Wph1SyRWymjsP1VOim22ILN175Jq5Ahi5yVZR59iuj1JSYndORaOLbSBoyB_8Ri51U10yP9hUJb7mNNTN0l0sKP9hDszD6yxFqyCKvIcFZe_FKKbhMmK_nx6CtT9hhXoI_iz_Bvkv" rel="nofollow noreferrer" title="C++ (GCC) – Attempt This Online">Attempt This Online!</a> - PCRE2 v10.44+<br />
<a href="https://tio.run/##7Vhbc9pIFn7nV7SZnajbIMcSFynGmDIxW3ExITbG60wwRcnQGBUgKZII6xj/9fGcvgipkWf3ZR72YakUqL9z6/Od06flTIJAf5xMXn@Z0pnrUXT1sd8xxx@/XHTGt73Lwfju8mLwCdmFX1xvslxPKToNJiE1j@ZnhcncCdE4GI5QE/WL7c1m8VBZ//709HUwr2/m@BWTFm6dbTE@2hZwq3lEyLP5QjA84vuvzxY860QsW9ggQ93Rf462Q/1c/zYiXFAjIAHx0WGBFMjwuxc@jLaBImrZ5Nl@AeF1r98eba@YYesMQhIurZF7wyBb0F2RfzA7CIR1LvpAhEqFOcD898MLaV3hVpVJsG6QJEAVApDtkO1v39R6wS0zsYJAAXvAbzmGqNa@Y4s73vM1ZARwZe6xdUrPcKtOjohI2D3BLZYQBVl7e81cmhbhgFgnwr4QVgwp7GeFPS6qSlEvFXS5oMaCMUmXcEbZY@sUoh@wrRDGbpWZwLYEyR92WoJ185iJpbYgBxysznicksGKAf1QKpDS/QJg6I8D6InjsnX8IqoUbBf7JHO8y2q8FTScds6SGF0Qg7wDIrYetq9HrE8ECozrZOcJ6ybjDHZUItwEt/SqIGBn3ufm@uFWNbdfMjYV1abH@/K0eXTEvT9XXra86fmixhYmbwiWyc6HKdhlPlrvOuCwKxrGKrOWYeS/kv2DVSyjw6A5DkpGI3Mqo3jq@uxUZqHQ9R5VzPUBpc4qr3dWcL0YBfAYj2kY@iGe@F4UI37KD1c0ipxHSp4hzsnJBBTQ6SmSKHvkOPWmywYKabwOPWQ0XnIu2XriTylBzwUEH@5cehmatfqowWF3hjAfM@NHKk3HUgsz8zLCYk7dfvx03rcPiRSWUeT@pP4MJ9tF7xMkow@s8ijso6RT5EqIxztBxb/MkFvvsiyINFeO6@Ekr2AIpC6phwOiG6PmcQOtQadijmPkN49hmz7MTLGlm9v2zeBycDvojDtfB53eRecCbfOy295NZzDufL4a/N5ALN4jeC3sUhA1BEGwjhtIcMeYQochTdYrJ57Mx1MndqCeu2fhLaTRehmXRe6NJPzltw5HZrOIgtBfx5DTYzxXFA79H3QSg5WkBTJL4q8Cd0mx5P7matAnQVmafuv0v4wHnf7ny975oHNRRsDKOx5d/sqYxyRtiYMQKip5z3YV/5Z6mSSbubzHsHZiOp6F/mocOHFMQw@H0Da9299@kw5mfoh4n/5kZePkQhMu4W7Eollcryx4Jg3QMZKSJ5v8SRDIWGNj7d7TpNdEyg2Hx6NmUxtqWdPdaXjwnXAa8Uu1qMvPvff3PP1dfrIeiw01h8zQiJo83aPJGNoTEzawsqqc6UYjKjUNe58K9pFM4GhoGCNdM4CvEsKaremAVEfkENtwkzCioqE14jJH07VzDSTR0GQct7P8Z@sAHuqjg6ZWBqcP0BQLVe0lX5cVj2PW84GMNyOxFvrhLN1pck6VtAVBcVPk2NjlyjI6tGFilOMmkDaZhxgOwQpaLS6V3iJpRVeT4AkL@5K0Lxll6REmpYDgEstHYQ3a@EveE18s4WhYOd6vQaWSrQEk09SutHfvuACebQ21kHatoRMhCzIyg8u@C1kDvX@P2K0Ed4WzYUfbX/mx63vIiZCz3DhPkf59TamH8BwQz0d0NoORg0AjnlPBshs/IX/G1ysYSCSXVZwmxLYL9ctnLqagOjj4fMiOsIRYebGIJYx5PsLgXzpulLmy34Ey1ilMuDfKuqd1kNwWnX7/S3/c@/L5fPDxE1GmoFB9I9oLostI0lQqlYXRDBd/jRDmIIFTnDQM@U8Hge1IWOSCJE7vvV@n6F9MB27Qsgi655Pt5r80HTsAmX3ee5fej53PpAD7vtO9zjahG1OsTB85tI9Y2dgK6gXz3F8njAnr3I0xCynF6ZpkL1chhEtp984jagCvBK/DYbENey124atSRvaojCRyXeTBaynSg69qGVkqYilW7MsEtRTpCytbRWwFuRKxLBUxcwjssK4itRxSz1lZOcROkLskd/BjpMi18FNJkZ6InkHawspUkXqS@12SqaF4lrlnEJl7RUVMxbPMfQ@pKrFk7ns6Vg6xWazchkwYNmdoEK4pwgMYTqHvL9jgmhto4nh8VrEbYQMtDTDMrcJwCJdJGWldjcfl1RTItZZWUyA9Lc0xRSzJg0DYl634YV@m7ECB9DWedUVFDEXnSuN12UMSHhQdK4fUVSRhWLtLMrWS6HdJpkldBNLT0m5PESvZz12SV9IVKWIriMzLVpFKsue7ZIe2Ev1KS/s2Rao5HUPJS/qxRuqmOa2sK/7psLmMe9SFaytEC899nMco9kVXwK9TQ@xVFW1ATNnd9oSccL9HLKVu11o6J9KOqClVkpuoqx1hKXVr53jqZjtrV6W6gvSy1d4hFYU52X2mitQZKWn4riYPVIYndnw2cxjs6MGN5n6ANv56OWVv2/zaX4g/gOBtjU4WeY7qKkf2W6dm72TZOUZMhce2ls525dQYOWSv/@3cOVJPn9Sp59i3Vfat3Bmp5epRVfzIupq5etTVE6GeUHlG6mpv1946I@Yo13r221UU73STdRhSL14@IfZylytkGTneFGA3Eqdi6tPI09j/KtAfYAYSJ/5/sf9Xim0loy298EQ1o1xBaTLvHpb@ZBG9VUg7N9nqCpW9LE3tzLTZK2Q1dx@qt0Q32xBZuvfINXMFMHKTraLOsV0fpaTEzoKKRhfHQNCQv/iNXOqmumV@salKfM9pqJuVs1xS/vc4MA9vsRQFfhS5D0vKXodRTMNVxP5sevDX3pQV6sH/N/ljMls6j9GrvuSvurr9Jw" rel="nofollow noreferrer" title="C++ (gcc) – Try It Online">Try it online!</a> - PCRE2 v10.33 - old 837 byte version</p>
<p>Pretty-printed, and partially ungolfed (absolute backrefs changed to relative, and capturing groups changed to non-capturing, or in some cases atomic for speed):</p>
<pre><code># Chess move validation regex (PCRE)
()?                 # decide whether to evaluate this as white's or black's move; \1 set = white, \1 unset (NPCG) = black
(?&gt;|                # subroutines:
  ((.|\n(?=.)){2})                  # (?3) = for moving within the board, without wrapping to the next board, (?2) = (?3){2}
  ((?=                              # (?4) = assert that position of just-consumed piece is vacated on the next turn
    (\X{72})                        # (?5) = skip to the position of the just-consumed piece on the next turn
  -))
  ((?=(?(1)[-a-z]|[-A-Z])))         # (?6) = assert that the piece at the current position belongs to the current player's opponent or is empty
  ((?5)(?(?=(.*\n)\n)[qnrb]|p))     # (?7) = black pawn that might be promoted, (?8) = .*\n
  ((?5)(?(?=(?8){8}\n)[QNRB]|P))    # (?9) = white pawn that might be promoted
)
(?&gt;
  (?&gt;
    # Handle squares that don't change (empty-&gt;empty or pieces that doesn't move)
    (.)(?=(?5)\g{-1}) |
    # Handle a piece that moves (and optionally captures an enemy piece)
    (?(m)$)  # allow only one move to be made per turn
    (?&gt;
      (?(1)
        (?:                                                         # white pawn
            -  (?=(?9))(?=(?3){8}((?3){9})?P(?4))(?(-1)(?=(?8){4}\n)) |   # move 1 or 2 spaces forward
          [a-z](?=(?9))(?=(?3){7}(?2)?     P(?4))                     )   # capture diagonally
      |
        (?:p(?4)(?:                                                 # black pawn
          (?=(?3){8}((?3){9})?  -  (?7))(?(-1)(?=(?8){7}\n)) |            # move 1 or 2 spaces forward
          (?=(?3){7}(?2)?     [A-Z](?7)) )                   )            # capture diagonally
      ) |
      # bishops, rooks, queens, knights, or kings
      (?&lt;e&gt;(?6).)?   # decide between scanning forward (&lt;e&gt; is unset) or backwards (&lt;e&gt; is captured)
      (?=
        (?i:
          (?|
            (?(e)|(B|Q)) (?&amp;B)  (?(e)(B|Q)) | # bishops or queens
            (?(e)|(R|Q)) (?&amp;R)  (?(e)(R|Q)) | # rooks or queens
            (?(e)|(N  )) (?&amp;N)  (?(e)(N  )) | # knights
            (?(e)|(K  )) (?&amp;K)? (?(e)(K  ))   # kings
          )
        )
        (?(e)(?&lt;=(?!(?6)).)(?4)|(?6).(?5)\g{-2})   # verify that the piece moved, and optionally captured piece, are of the correct color
      )
      (?(e)(?=(?5)\g{-1})|(?!(?6)).(?4))   # verify that the piece moved is the same type and color at its destination in the next turn's board position
    )(?&lt;m&gt;) |
    (?(+1)$)(.)  # handle the destination/source square that a piece moved to/from (only allow matching one of these per turn)
  )+\n
)+
\k&lt;m&gt;         # assert that a move has taken place
\n
# don't allow moving into check  
(?!
  \X{,70}
  (?:
    # pawns (capture diagonally)
    (?(1)p|k)(?=(?3){7}(?2)?(?(1)K|P)) |
    # bishops, rooks, queens, knights, or kings
    (?i:
      (?&lt;E&gt;(?!(?6))K)?   # decide between scanning forward (&lt;E&gt; is unset) or backwards (&lt;E&gt; is captured)
      (?:
        (?(E)|((?6)[BQ])) (?&lt;B&gt;()?((?(-1)-)(?3){7}(?(-2)(?2)))+)         (?(E)(?-4)) | # bishops or queens
        (?(E)|((?6)[RQ])) (?&lt;R&gt;-*|((?(-1)-)(?3){8})+)                    (?(E)(?-3)) | # rooks or queens
        (?(E)|((?6) N  )) (?&lt;N&gt;(?&lt;=..)(?2){3}|(?=.)(?2){5}|(?2){8}(?2)?) (?(E)(?-2))   # knights
      )
      (?(E)|(?&amp;E)) |
      K(?&lt;K&gt;(?3){7,9})?K   # kings
    )
  )
)
</code></pre>
<p><em>-88 bytes by using non-atomic subroutine calls, thus retargeting from PCRE1 to PCRE2</em><br />
<em>-1 byte by using a new PCRE2 v10.43 feature (which is also in Ruby, and Perl v5.34+)</em></p>
<p>The version above has been modified not to allow en passant or castling, but the full project is currently at a state where it validates every type of move, starting at the initial board state (which must be the standard chess starting position – Chess960 is not supported, yet at least). The full rules of en passant and castling are enforced.</p>
<p><a href="https://regex101.com/r/GUZl7X/7" rel="nofollow noreferrer">Here is a sample game validated by the full regex [regex101.com]</a>.</p>
<p>An invalid move will result in every subsequent board position not being matched/highlighted. Checkmate/stalemate detection, and thus detection of who the winner is (or if it's a draw), is not yet implemented; that's why the final board state in this example is not highlighted.</p>
<p><a href="https://github.com/Davidebyzero/chessconv" rel="nofollow noreferrer">Here is a C/C++ program that converts algebraic notation into the format recognized by this regex.</a> The algebraic notation currently must be put in the form of an array inline in the source code, with separate strings for each move, but reading it as single string from stdin or a command-line argument, with the entire sequence of moves separated by spaces and dot-terminated move numbers, is planned.</p>
<p>I also started on a regex that validates a full game purely in algebraic chess notation, with the standard initial position being implied. All it needs is an empty &quot;scratch board&quot; appended at the end of the input (after the list of moves). I'm pretty sure it's possible to implement this in full, and plan on finishing it sometime.</p>
</div>
<div id="pu1" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a> (with <a href="https://github.com/niklasf/python-chess" rel="nofollow noreferrer">python-chess</a>), <s>127</s> <s>125</s> 124 bytes</h1>
<pre><code>import chess
a,m=input()
S=chess.Board(a+' - - 0 1')
for l in S.legal_moves:1/(m!=str(S.piece_at(l.from_square))+`l`[17:19])
</code></pre>
<p><a href="https://replit.com/@Davidebyzero/cgcc-148587-python2-test" rel="nofollow noreferrer">Try it on replit.com - test cases</a></p>
<p>Jonathan Allan never responded to the golf optimization and other comments I provided under <a href="https://codegolf.stackexchange.com/a/148609/17216">his answer</a>. So I'm finally doing that here. This program is based on his.</p>
<p>Input consists of two items:</p>
<ol>
<li>The board state, in the form of a <a href="https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation" rel="nofollow noreferrer">FEN record</a>. As per the challenge's specifications, this is abbreviated not to include extra information about the state (castling, en passant, halfmove clock, or fullmove number) but it must include the color whose turn is next to move.</li>
<li>The move whose legality is being queried; this is a 3-character string. The first character is the piece type; as in the challenge's input specification, this is one of <code>PRNBQK</code>, except that a white piece must be in uppercase, and a black piece must be in lowercase. The next two characters are the destination square for the move. This is given in standard chess column,row format, where the column is one of <code>abcdefgh</code> and the row is one of <code>12345678</code>.</li>
</ol>
<p>Python 2 automatically runs <code>eval()</code> on <code>input()</code>, so the input is taken in the form of comma-delimited Python string literals. Examples:<ul>
<code>'rnbqkbnr/pppppppp/8/8/8/5N2/PPPPPPPP/RNBQKB1R b','nf6'</code><br>
<code>'rnbqkb1r/pppppppp/5n2/8/8/5N2/PPPPPPPP/RNBQKB1R w','Pc4'</code></ul></p>
<p><a href="https://tio.run/##7VdNc9pIEL3zKzqknEEG7yIJJJUJSYXDXlxF2dlUcWAplxBjIyMkVhL2Jil@u7dnRkJqjZzzHpaDbD/153s9PTg4HK4eg@D19X0YB9Fxw@FjmGR5yv39p06QxFkO6ySJgD/70X0YH4454GcKeXrkk7pB4X4fJFGSng3COIe9H8Y9A352hGeWb66vMX4YP4IMN5HwA/r0hPGP6XCijB55HoUx78k/gjAeKHtjUoYSn/BBuCG8HK6mU7Zk9ZelwQ8D0CLY@mmP/RUzY4JZzAkxEy@xDz/dLL1Lb4X1/xyeGiayV2l4mU1l0t@Ce2ylZ/Qb0WQ3k0nWn5pesyDxUYl6zGNX2dIcrYxLD/rQw9/N1RUzmSEKyJbuSqDMZ1fsCzMu8b0lmpxhB1pI0Sf6O6t3UzZAFtao4I6anTq0BhRtHfnB7j5P7vfJM5c5LVOlaKHnEPKgMHJkZdT7MxSVwjUMjRZ/NHzZ8pQvrb4pGZaKZEt7uOqrLrFzY4DxbXs1gCb/osNqCuuSsiYh52l6EtP09NHDR7/fpoQI@gTvplhxFfD3NoLPMUMRM8SYbfHOzQbYoJL5SYobriatxqKA4K1I4lNWFeDY9vthe5QT8Cjjv4giCo@n4QQ2iYwCL9sw4ighKXE6HcKHD6I5TIbmV/Hk7YhYeFwjbcj6sfFGdZ1fIydNZ7JMMAmui/yh14WLoDsAbezWYuTYS1O1wqu2uT5Dlw2AXQQX2UXG4P1F1kVPEVYAGFqO@KCxy9BLmLUEUt5dnNlytnF6kUnbq5Wiujt1Tq@vy2V3hlm6N/iwB@DhlBfIHT7MAYwrZI6P0QBcirjESzwsNKuQr8rLo4hHkFuVy6WIpSFYoUORsYY4mperIV6JLMreMY5ZIXcqjl0hc5W9hsyUl0URp@x9UXZqkshF7zWk6N2miEUiF703kBHJVfTesHE1xBO5tIIsXH@f4BvekND7tuWQJskOkhi2JgR@DHKucd@84NlEmBudznKJOxkn7obJvFJNhdyxSk2FzFnVY4W4BQ8KEQ@PxBEPq5hAhXxlsmubIiaxuWVSlwZS8kBsXA1xKFIyzBZlp26ZfVF2WuqikDmrpr1C3LKeRdlXORUV4hGk6MujiF3WvCgr9Ej2W1bNbYWMNBuT9FXEcVe0aEmrmIo/fLHJe3Me5rhQYBeHj9sc94uaCvzpj@EhTfYg9w2g0Xfw0@aMuES3O1btiWoixkSlogiHToRLdJtpPN3UJ@uskkOQeV3tM2IT5orpsyjiCFKq9DesOFA1nsTxwbss57AOs21ygJfkGG3EtSSogZ36nol3Mg92OkcO5chrOzWNk@VpjFiExxmrdjs5NaaGNObf084RPX2FjaOx71H2Xe2MjDU9RiROoaul6eHQE0FPaHFGHDrb47YzYq200fPaVfz7yDnKdUxTHufRd9j6mS7kAPx4g3CYqVOxSXgWsxxvfP6MbvjGz/8X@78itluuturCU2pmmqC83HfrKAl2WZuQnrbZHELlvE7TrLZtGkKOtPuQ3hI39YGo090g19IEMLXNZtM9dp6jipTc33E16OoYKBr0i9/UWrdoyfJio0ay5irVn3s/irj8VxaZ3/uY7ZBkWbiO5DdfyHm6zyB5wH9fjvFGCLVO/jH@BQ" rel="nofollow noreferrer" title="C++ (gcc) – Try It Online">Here is a C++ program that converts the test cases.</a></p>
<p>The program <a href="https://codegolf.meta.stackexchange.com/a/5330/53748">outputs via its exit-code</a> given valid input:</p>
<ul>
<li><code>1</code> if the move is legal (the program raised a <code>ZeroDivisionError</code>)</li>
<li><code>0</code> it the move is illegal (the program exited normally)</li>
</ul>
<p><a href="https://replit.com/@Davidebyzero/cgcc-148587-python2" rel="nofollow noreferrer">Try it on replit.com</a></p>
<p>Can't <a href="https://tio.run/##HYhLCsIwFAD3PUVcJUFtfFXxA910K0i0S5EaNWoxn2cSBU9fiwwDw@A3Pbwruq616EMil4eOMVMjW7YO34nxrC7/L6@8ClemhpSMeyYEKM9uPhBDWkfq3Oi7Mo31Hx3XIJgdlDEFVufY6otuVGImvwVvm/h6q6A5H57M6QCLNayOvOtocOfXE1wQiFj0iqWYyamASs77lLLYoJRiv4UdVNs9OdMRxTvQHw" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a> (python-chess is not installed on TIO, nor is internet connectivity allowed, and even if it were, <a href="https://pypi.python.org/pypi" rel="nofollow noreferrer">Pypi</a> and the latest version of python-chess no longer support Python 2)</p>
<p>python-chess v0.23.11 was the last version to support Python 2. To install it for use with this program, you may run the following git command:</p>
<pre><code>git clone --branch 0.23.x https://github.com/niklasf/python-chess.git
</code></pre>
<p>And then symlink, copy, or move its <code>chess</code> subdirectory to the directory from where you are running this CGCC program.</p>
<h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a> (with <a href="https://github.com/niklasf/python-chess" rel="nofollow noreferrer">python-chess</a>), <s>134</s> <s>132</s> <s>121</s> 120 bytes</h1>
<pre><code>import chess
b,m=eval(input())
S=chess.Board(b)
for l in S.legal_moves:1/(m!=str(S.piece_at(l.from_square))+str(l)[2:4])
</code></pre>
<p>This is a straight port of the Python 2 version. Python 3 dropped support for the backtick alias for <code>repr</code>, so <code>str</code> is used instead. We can't use <code>str(l)[2:]</code> because an extra character is appended to <code>str(l)</code> in the case of pawn promotions, specifying what it is to be promoted to.</p>
<p>We save 11 bytes by using the latest python-chess, more than making up for the 7 bytes sacrificed by using Python 3, because python-chess v0.27 <a href="https://github.com/niklasf/python-chess/commit/65e872995c6380522d3839e60a7235f06899fced?diff=split" rel="nofollow noreferrer">added support for omitting the last 5 parts of the FEN string</a>. This still accomplishes exactly what the challenge requires – it defaults to treating castling and en passant as impossible moves. (We still need to include the current turn, because otherwise it defaults to white's turn.)</p>
<p><a href="https://ato.pxeger.com/run?1=LY7NisIwGEX3fYrMqgmjDek4UIRuuhUktstBSuqkWszPZ5KWmWdx043zTn0bO-riwoUD597rH_yGkzXjeOtDu8ymn06DdQEdTtL7qFnoXA5C4c5AHzAhUZU_SFJY4b5xQ6LWOqRQZ1CVKHkUqtZ2kH7NKNZvuQ8OVwl08iBrEbBKWmd17S-9cJKQ93-syFe6Xu3Jc_91Y5yy2JnmcmbGUQBI59CMrvgHZQX_nCvn6QY4p-WW7VixLVETL2I4svgpuAM" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Attempt This Online!</a><br />
<a href="https://ato.pxeger.com/run?1=nZS_b-M2FMfRdvNf8eoOklCdGFKxEzjQ4qFLAEFxbksPgmjRliCZpEkqjnN75-5dbmn_p7uxf0kfLecu7bVLbRgC33v8ft4v-bc_9NE1Sn74-L7daWUctCq2RxuPp77lk1psoGylHlwYLWDbK1714IR1N2CEG4w8HSZlyYe2d620ZZmcwiE737sBpYUMpz7OJvo4jaeHaZQcTOtEaKbT6e-D27y5_vh0TmHdCGsnPN5l4rHqwzM7mtxnJ0-yVJWpQx5NNspAD62E-6QX26ovd-pR2AUl4e77zDoT3ie6FWtRVi7sk41Ru9Luh8qIKPrRu_vogS0u30Uj_9M3EebyQBdv6LvoBrALia5cg8VYYVx4EUMQoP05uziBnQf7IOvqVi4mgJ92A88L0KaVmPCLxT2gYJYFP8tgAb4r7sEjTm7fEm8ZD-Y4yviP9u0rx46U5bl50-izf0R9HlNiRK-qOtRjhHhaC-1eqZ1SoljCn7_8GsTgYhCyzqZnQdFb8c_gi_8Kfs7ozdixD5---zZgnWHSEK2ppFprwjTVKdlfEcppQZeMFDRnd7QgtMAj_sgqvWUrOKBysGpYAD_AWzMICN82AoxSHSgJDYV1JcEPFLDbB5w4mkU0CVYspx3lZE9XVLOCXCLNcKTmlBRMXxLJDC1uKWF3eCzIciaXIyyvZh72U4XVQpiL1jXCQCfbbePAqRGGz2oGflfggG40NOIIfmcmAb8ic06JTPOUzLAyup8TlqcdJVinRNvdLQXuUV2TvkL5wg4Nbjvw1jZKw0ENfQ3-HUF16Fq59cuE273uEMN4iunPpSRmucpZp8mVJunqkqQ63ZMlZ0VxR4nBLEaYFNf_CtsPQqDqYIyQrj9CU9mveTFUskZza8f6ayWsDBwugXjEa-ip3P_JaTv7-2BHqP2KK14GwHu17uwLby5xgNIzrwlbsj3DZz7vCM3nhDOOCzVyOH-1QK7qxFji2IBRGdWuyZfvDLVmHb0d7--39Mv9-13V9_6NPGW4q1BCK2tb3ovYJ-6E2VlQG-BqkLUviKun87_HXw" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Attempt This Online! - test cases</a></p>
<p>To install the latest release of python-chess:</p>
<pre><code>pip install chess
</code></pre>
<h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a> (with <a href="https://github.com/niklasf/python-chess" rel="nofollow noreferrer">python-chess</a>), <s>158</s> <s>152</s> <s>141</s> 138 bytes</h1>
<pre><code>import chess
b,p,n=input().split()
S=chess.Board(b)
S.turn=p&lt;'a'
for m in S.legal_moves:p[p+n==str(S.piece_at(m.from_square))+str(m)[2:4]]
</code></pre>
<p>The <a href="https://codegolf.stackexchange.com/a/148609/17216"><strong>132 byte</strong></a>, <strong>124 byte</strong>, and <strong>120 byte</strong> versions of this program have a problem. Their input is not bijective to the input specification given by the challenge – the color to move next must be given in two places, and if they disagree, the move is considered illegal.</p>
<p>This version solves that in the most natural way, by taking the color of the piece to move in the same place as the move itself is specified (i.e., whether the the piece identifier is in uppercase).</p>
<p>Also, evaluating the input as Python code is bad; there's a reason that was dropped in Python 3. So this answer uses <code>split</code> instead of <code>eval</code> on the input.</p>
<p>For optimal golf, the piece type and its destination coordinates are to be separated by a space in the move to be queried. Examples:<ul>
<code>rnbqkbnr/pppppppp/8/8/8/5N2/PPPPPPPP/RNBQKB1R n f6</code><br>
<code>rnbqkb1r/pppppppp/5n2/8/8/5N2/PPPPPPPP/RNBQKB1R P c4</code></ul></p>
<p><a href="https://tio.run/##7VdNc9pIEL3zKzqknEEG7yIBksqEpMJhL66i7GyqOLCUS4jByAiJlYTZJMVv9/bMSEitkXPew@owxk/9/bp7wD8cbp58//X1fRD54XHN4WMQp1nCvf2nlh9HaQarOA6Bv3jhYxAdjhngM4GNF6Z8XJXI9R/9OIyTUiKIMth7QdQx4GdL6KbZ@vYWPQTRE0iDYwlvUKkjhH9M@mMl9MSzMIh4R/7jB1FPyRvjwpR4go1QQ3jRX04mbMGqLwuBHwaghL/1kg77K2LGGL2YYyImXmIiXrJeuNfuEhP42T/XRGSyUvA6nUinv/mPmErH6NasyWzG47Q7Md16QOJRjjrMZTfpwhwujWsXutDBz@byhpnMEAGkC2cpUOaxG/aFGdf43hJJTjEDzaTIE/Xt5bsJ62EVVsjhjoqdWzQGZG0Vev7uMYsf9/ELlz4tU7loKM8h4H4uZMvIqPZnyCOFW@gbDfooeNryhC@srikrLBlJF4P@squyxMyNHtofDJY9qNdfZFj2YZVSVi/IpZueRTc9f3Tx6HabmBBGn@HdBCMuDf7eVOCLzUDYDNBmk71Lsj4mqGh@luQGy3GjsAjAf8uSeIqofGzbbjdotnIGjuP2Cysi8GgSjGEdSytw2gYhRwpJiJNJHz58EMmhMxS/icZvW8TAo0rR@qwbGW9E1/o1ctZ4JtsEneC6yDadNlz57R5obbcSLcdOddZyrcru@gxt1gN25V@lVymD91dpGzWFWQGgadnivdoyQy0h1mBIabexZ4vexu7FSg7cSigqu3Pr/Pq6WLSn6KV9h8egBy52eY484GH2YFQiMzyGPXAo4hAtcVgoViJflZZLEZcg98qXQxFLQzBCmyIjDbE1LUdD3AKZF7mjHbNEHpSdQYnMlPcKMlVaFkXsIvd5kalJLOe5V5A89wFFLGI5z72GDImvPPeajKMhrvClBWTh@vsE35IjTuC3LYckjncQR7A1wfcikH2N@@aEs4kwN1qtxQJ3MnbcHZN@JZsKeWAlmwqZsTLHEnHyOihEHC6xIw4r70CFfGUy6wFFTCJzzyQvNaSoA5FxNMSmSFFhNi8ydQrv8yLTgheFzFjZ7SXiFPHMi7yKrigRlyB5Xi5FBkXM8yJCl3i/Z2XflshQkzFJXrkdZ0mDlmUVXfGH@OIEnRkPMlwosIuCp22G@0V1Bf71RrBJ4j3IfQMo9B28pN4jDuHtgZV7ouyIEWEpD8KmHeEQ3qZane6qnXVhySbIrMr2BRmQyuXdZ1HEFkUp3d@xfKAqdRLjg3dZxmEVpNv4AKf4GK7FtSRKAzv1PRPvZO7v9BrZtEZu09TUJsvVKmKROk5ZudvJ1JgaUut/V5sjOn25jK1V36XVd7QZGWl8DImdnFdL48OmE0EnNJ8Rm/b2qGlGrKXWem4zi38fOUe6jknCoyz8Dlsv1YnsgRetEQ5SNRXrmKcRy/DG5y@ohm@87H@y/ytkO8VqKy88xWaqEcqLfbcKY3@XNhHpapvNJqWcVcs0rWybGpFD7T6kt8RdtSGq5a4V19IIMLXNNqB77NJHZVEyb8dVo6sxUGXQL35TS92iIcuLjQrJmEtXf@69MOTypyxWfu@ht0OcpsEqlN98IePJPoV4gz9fjtFaELWK/zH@BQ" rel="nofollow noreferrer" title="C++ (gcc) – Try It Online">Here is a C++ program that converts the test cases.</a></p>
<p>Unlike the others, the error used to trigger an exit code of <code>1</code> in this version is <code>IndexError</code>, by attempting to access the second character of a single-character string.</p>
<p><a href="https://ato.pxeger.com/run?1=LY7BisIwGITvfYrcbFETUhVEzKVXQaI9ipRUUw02ye-fVNhX2FfYSy-77-TbbHf1MMwwHwPz9QMf8epd3393sZkun5_GgsdITlcdQlJPYOKEcdDFNKMBWjN4Uop_Sguv8JzWQ0Fjh07AeqRGSeORWGIcKWmrL6qtrH_osIIDjJ0QIWJaUjD6pCsVU0sb9LYK906hzrLxH7bZIV_Nj8fXo_ex_jlDV99v3CEDgHwQW7K5nDFeyMUQpcw3ICXbb_mOF9s9AXLhr-0v" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Attempt This Online!</a><br />
<a href="https://ato.pxeger.com/run?1=lVGxbtswFERWfcWDFkmIIuZRtmPI1aLVgCDboxsIYkzbgmSKouimTvcOnbp3ydL-UzL2S0pZRloU6FASAvHeO94dT99-yJPeN-L55VN5kI3SUDZ-d-r8oapLZm34FvJSyKN2vQh2dcOKGjTv9AwU10clzoWV5-xY1roUXZ4HZzjEl3szaCQXrt3jukCebN9-tL3gUZWau8q27e9Hvb2Zvny5WHjY866zmC99EV-Eg07WpTmtVXyeBklTqI3LTCPoPcTynVM41rZRcIBSwCqo-a6o80PzgXeRXMtrEcedVu4qkCV_4Hmh3UOwVc0h79pjobjnXffjg7em0ej-fnD0euUZd2uMbvDem4HJJZCF3pvndVxp99YHxzH9p_j2rKx75R7U6U0pIgvMKrfwFIFUpejdXzp6bQjj2HkvnAj6nPS6lziP-5D6zlCo00DTL9kHmg8Z5fklTtt7mw9Sbz8uULxuio0rBwT_-MCl_oPtbAnNE35-_ur4oH3gYhPbF0Jed_xv8O2_wE8xzobEnl-vElopKhSREgVKKQmVKEPS3hFkmGFCSYYpXWBGMDOl-cgynNMlLGFPrSVNsUJGWlyipBkZmauKGYoUSUbliAiqMJsjoQtTZiQZiwRSKMYWuyMThkSEaUjGRgXbCaFpWCExmsL0FnOECvahRVloCCZCEJUsU1pJcidJuByRUIYtSRjNsgUSZYhAAJ_-H343tibC2BP9nSmhCW2pOdNJRTCdEEaZeTswYNSakt97bFDjCufQwg6HLH8B" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Attempt This Online! - test cases</a></p>
<h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a> (with <a href="https://github.com/niklasf/python-chess" rel="nofollow noreferrer">python-chess</a>), <s>294</s> <s>278</s> <s>276</s> <s>270</s> 197 bytes</h1>
<pre><code>from chess import*
b,m=input()
S=Board()
S.clear()
S.turn=m[0]&lt;'a'
for P in b:S.set_piece_at(P[1],Piece.from_symbol(P[0]))
for l in S.legal_moves:1/(m!=[str(S.piece_at(l.from_square)),l.to_square])
</code></pre>
<p>Even the 138 byte program's input is not quite bijective to the input specification given by the challenge, in which the board's pieces can be listed in any order.</p>
<p>In this version, the board is provided as a list of pieces, as in the challenge's specification. Each piece's type (one of <code>PRNBQK</code>) is specified in lowercase for black or uppercase for white, instead of providing the color as a separate element. The coordinates are specified as single numbers, where <code>a1</code> is <code>0</code>, <code>b1</code> is <code>1</code>, …, <code>a2</code> is <code>8</code>, …, and <code>h8</code> is <code>63</code>. Following this list is a comma, followed by the move to be queried (in the same format as the pieces already on the board). Examples:</p>
<pre><code>[['r', 56], ['n', 57], ['b', 58], ['q', 59], ['k', 60], ['b', 61], ['n', 62], ['r', 63], ['p', 48], ['p', 49], ['p', 50], ['p', 51], ['p', 52], ['p', 53], ['p', 54], ['p', 55], ['P', 8], ['P', 9], ['P', 10], ['P', 11], ['P', 12], ['P', 13], ['P', 14], ['P', 15], ['R', 0], ['N', 1], ['B', 2], ['Q', 3], ['K', 4], ['B', 5], ['N', 21], ['R', 7]], ['n', 45]
[['r', 56], ['n', 57], ['b', 58], ['q', 59], ['k', 60], ['b', 61], ['n', 45], ['r', 63], ['p', 48], ['p', 49], ['p', 50], ['p', 51], ['p', 52], ['p', 53], ['p', 54], ['p', 55], ['P', 8], ['P', 9], ['P', 10], ['P', 11], ['P', 12], ['P', 13], ['P', 14], ['P', 15], ['R', 0], ['N', 1], ['B', 2], ['Q', 3], ['K', 4], ['B', 5], ['N', 21], ['R', 7]], ['P', 19]
</code></pre>
<p>In this way, the input is fully bijective with the challenge's specification, but optimally golfy.</p>
<p><a href="https://tio.run/##7VZNj5swEL3nV4y2B5OWrgokgCptD5G2l5XS3bZSDlEOJHEKCmBqnE33129tbMdMvD@gh@bgwMPMx3szY7oXUbI2eX2tmo5xAZxOJnt6gB1rnykXjxXd0aBT6/TzBOSPU3HiLawHbB1toDqAvv60ubsjKwK07inYx7c1O1MeTEPQVtbx5mM0hQ/2NlG37/PNZHIuq5pCpL0I/qIv1G/LCr6HO6DPRR1UbXcSwXR6edqwZxrKeJuGtkLuMhtu@66uREDg7gsQvNuaUtdTz0td9SJoii4YUxDqx1PPEOIJG@x41YqgFzzQ734gIQlB3Q/7QiDvzL0JfmTdJDHc0z872gm4//b1nnPGR7xwWhxfX9frm8VNCDcPcklCyDchGORJLlEIc4cs5TILIcNIht5SSyy3OeS7fivHSI6QR@0rw0jsITLCFCNzD0m9tzIPyS2ysrlLO5FDnrSdxCFL7X2ELPRbMUZSm/vKZhohyyb3EWJyTzASI8sm9ytkhnyZ3K/2ZB6SK1@bCY4n3qhS/8lPFIKfJQXO2BFYC2UEu6LV9Xpg/KyqnLWyTifrNVnICiQPZHA7iKmRJ@LE1MiSuBQdkhkaNKKWHNlRS2wKUCPfyZB0gpEI7XkkgyxXiKUB7ck8JMWIJVgOJpNpZr2vbKZWFo0siSt2h2Q2npXNyxaFQ3KEmLxyjCQ25pWNMEfeH4krW4fMvD0RysvYyVRRuJgHVlVRfC3USA6WtBIl5XBsq1@lAMF0Ucj/Yg4Hzho4y8cSKOkLFPy6RDIk2xNxU8IVxByJZIJIcUFkSLaFR9PDuLAuIqUIWY7FviAJIs4UX4yRVJGiaLrkNXTTiCbVPPIwEhS2VV@yDs7sVO9BDmTFDByr9pecz7Ar6e7oU5RiivK3euaqr3KPkBjRuCBusKOeiTzkqvpzr4tw75k9qUd@jsnPvA6Ze3LMkB0ja@zJkeJ@wP1pOiTFlT1/q0NiJ6KJJ39bxN8nSqVaJ87lEVu/QFn0vo4hFO1ewlWve2LPaN8SIc9w@qw@K0RZiP9a/yNaZ3auucNOi9l7elI77LY12x37t3TMvbGWIiaXY5YWo1FzpePMOwvxCfEwrocx21fcxh7/kTfWEjTELlXkOBHFkeoy102gWfDP/MjLPMYRD2faxdMlYufpR1PUNe2F5r0ppLOO9X21reVHs5RDUN70wA7yA/rU7pVMW/Zn@hc" rel="nofollow noreferrer" title="Python 3 – Try It Online">Here is a Python program that converts the test cases.</a></p>
<p><a href="https://replit.com/@Davidebyzero/cgcc-148587-v3-python2" rel="nofollow noreferrer">Try it on replit.com</a><br />
<a href="https://replit.com/@Davidebyzero/cgcc-148587-v3-python2-test" rel="nofollow noreferrer">Try it on replit.com - test cases</a><br />
Can't <a href="https://tio.run/##Rc5Bb4MgFAfwu5@CnZTFOLWF2mZeel2yuHk0xKilqxmIBVzST@8EG7z9eLz/e2986JsY0nm@SsFBd6NKgZ6PQupXrw153g/jpAPolflZNPJiFHWMNtJKT3LIeRWTd7/xvauQoAD9ANpTGSmq67GnHa0bHRRVQsLCvCKzp1YP3gq2lGMCoc0xkysjRn8aVnPxR9UpeQv4S14pLYMycqPYc8J9aiSFMGSRFs8XgfNcVb70Q4AwCUHlD4YHy9Yws7wbHi1/F@LY9eLU0kzAO8tx4T7beHRE8catF@03IsdkbSgW7tbLzgtT5Kopdsyc1l0fJp@6YrLfuOa/F663fJqi1ZfZ5BYh94td4kDcdZj8Aw" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></p>
<h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a> (with <a href="https://github.com/niklasf/python-chess" rel="nofollow noreferrer">python-chess</a>), <s>309</s> <s>306</s> <s>290</s> <s>288</s> <s>282</s> <s>271</s> 203 bytes</h1>
<pre><code>from chess import*
b,m=eval(input())
S=Board()
S.clear()
S.turn=m[0]&lt;'a'
for P in b:S.set_piece_at(P[1],Piece.from_symbol(P[0]))
for l in S.legal_moves:1/(m!=[str(S.piece_at(l.from_square)),l.to_square])
</code></pre>
<p>This is a straight port of the Python 2 fully-bijective-input version.</p>
<p><a href="https://ato.pxeger.com/run?1=RdDNToMwHADweN1T1BNgEIGNji1y2dXEoBxJQ2B2jthSVsqSPYuXXfRlfAJ9GvtByu3Xf_9f7ed3fxFH1l2vX6M43Ke_PwfOKNgf8TCAlvaMi7tF49MMn2vitl0_CtfzFkW2YzV_c6WCPcE11xIj7zJahujRqZ3FgXGQg7YDzbYIBiyqvsV7XNXCzcsI-bk6BWpaNVxow4gMh0j2VnVE1RUBwe81qSg742EbPbj0NisHwd0isK3I1OE01hx7nk8CwaYT8syTppdd_25gWTrc8UECkQ9Kp1NcazaKqeZJcaP5IQlDmwtjTdUBLjV7yVU6c2OZhDPn3GQ1M7GMTEIuuTSb7STjxEZjaJlamVlPqj62wWg109S_SppdnlVQ60VNsoMSewttxRrZ7SAy__cP" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Attempt This Online!</a><br />
<a href="https://ato.pxeger.com/run?1=5Za9juM2EMeRKoCBvMNEKSgHWkXy1629cbPFNQcY3tvrFEOQbHolWCZlkl6fN33q9GmuSV4mT3BX5klCcmTSl0ueIG7802jImflzOPZvf7RnVXH24ePP9b7lQkHNI3mWET41ddnb0C3kNWuPKuzP4KnhZdGAolLdgaDqKJh96OV5eawbVTOZ57F1h3m37g54S1kYGD8Zt-cgCk5BPz6JWtFQBEHw-1Ftb24__rkVfA_rikoJGP_7Xhnt5_S5aMIug37vcX7PC7EJNcXrhhbCkklkvs-S1Y-kIL0tF7CEmkE5e4wlVXlb0zXNCxUus3QVLc1TbKLl8rwveaPNyUrvbdY1Zt1j3NCnosn3_JnKWfpDuP92nkklwsfYbdV0OxyOhaD9ftTEindPqz6W9OmrG11els5u0lX_DrSwcVuoSusjqVBhEgEh2v4yT2xoZUIbJ6k2NZv1QH_qLbzMoBU1UyH5iZH-xaoyvel8bmwzMGKrzISxr43SxoIP4oxbmU9rTiVHdfO8O5Og795jOHf6saANLzZhix70_Zq26mo3m1aqy_jrl19JBCoCyjbzoNuQNpL-0zn5L-eXeXqHqn349PU3WRbsggjGt6sIsuCgcTiwyIw1dThBa6lxMLYojMPU4WRosdU4uvU49TjwOHI49svGV1YM8cb4WnowcTGbhcYUI9wbHDgcYLC3GhNHrywtjefE4dQbE4eDK9ehx5F3GK7ctul4Bd_BO3GkEL6rKAjOd8AZVCmsCwamn0G32knfIG2m_V6WkZ0-jIktghzIRSbCyCU1i0gluShqcYgojOvUIZ4UaQ1OHGLCFsfeYeStWCd5YxAdHshFCLIgl1O1OMQc70knqSVc_9Z4Tjzi-yWx2lwQzwytHgcjh_qkfbCB0fR1obsZwgWtVUUF7Fj9VClQHDXV38UY7AA76dfaUNEzmMFwUbirySiMnYoKDxyOEqcrthzixKkycaKMXW6dfgZTr8nU0fAV1mEzGF7VYZrjVOkJDGUtK97CiR-bDZi5rVOHXc2ezDTS03i9czWMJr6GoUu8y5aRywWxiU99CbeuNRJHXbW2Saa-STyOfDtMrtrB13tFQ1ev12CUuh4Y-M7A244Hf4V4g7DRk39V6XCkVMtxFIIy1ZyhKuSXQkVQsI021xK7YsOpZETp0Uef9TL9plD_KzH1Pf1sHKFa8gvB6OU-lQ1f7-TnQnXqHLCd3Tn5mzP2N8fPpsRV3En64K7Qwim68EPO3pbR6kpyl7kqdhRPG3sBc3X5jV16OJ9t0O7eHWxQt9Pjvmga8-Nsq98XerOWS1mXDY2MKIqKvQS-hZIf2caIVfL33Z-JvwE" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Attempt This Online! - test cases</a></p>
<p>It's almost a shame there turned out to be an interface in python-chess whereby the direct placing of the pieces and setting of the current turn could be done concisely, because there was some fun golf in converting the board to FEN in the <strong>271 byte</strong> version:</p>
<pre><code>import chess
b,m=eval(input())
B=['1']*64
for P in b:B[P[1]]=P[0]
B='/'.join(map(''.join,[*zip(*[iter(B)]*8)][::-1]))
i=8
while i:B=B.replace('1'*i,str(i));i-=1
S=chess.Board(B+' '+'bw'[m[0]&lt;'a'])
for l in S.legal_moves:1/(m!=[str(S.piece_at(l.from_square)),l.to_square])
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=RdDNToMwHADweN1T1BNgEIGNji1y2dXEoBxJQ2B2jthSVsqSPYuXXfRlfAJ9GvtByu3Xf_9f7ed3fxFH1l2vX6M43Ke_PwfOKNgf8TCAlvaMi7tF49MMn2vitl0_CtfzFkW2YzV_c6WCPcE11xIj7zJahujRqZ3FgXGQg7YDzbYIBiyqvsV7XNXCzcsI-bk6BWpaNVxow4gMh0j2VnVE1RUBwe81qSg742EbPbj0NisHwd0isK3I1OE01hx7nk8CwaYT8syTppdd_25gWTrc8UECkQ9Kp1NcazaKqeZJcaP5IQlDmwtjTdUBLjV7yVU6c2OZhDPn3GQ1M7GMTEIuuTSb7STjxEZjaJlamVlPqj62wWg109S_SppdnlVQ60VNsoMSewttxRrZ7SAy__cP" rel="nofollow noreferrer" title="Python 3 – Attempt This Online!">Attempt This Online!</a><br />
<a href="https://ato.pxeger.com/run?1=5Za9kts2EMcnVWY0k8krbJgC5JlHixJFS7qwUeHGMzd3PncMh0NK0BERRVAgdLIufWr3btwk7xSXeZLggwTkOHmCqNGPiyV2978LSB__aM-8os2nP38l-5YyDoT63bnz9VNNytEGbyEnTXvkrreEx5qWRQ0cd_wGGOZH1qiHUZ6XR1Jz0nR5Hih3SPr3boC2uHEd6dcF7dnxnZPjBSdGOHaZ4zi_H_n2ev75m-_7HNYV7rpR6e8T_FTUbh_cG62SFIUou4qj0ZYyuAPSQLlcpXdpmGXJXTrOhAt6iYJfKGncfdG6SLOfXj2T1r1KRUTmrrzsau5l6XJ5HWZiW5LMR6eK1BjIcpWsAobbulhjV8S6In7HmUs874ZcJ-HoIVG5BStasI27eoEAvUDlCaV7EfwnVKDMU6nVMrWHoMaPRZ3v6RPuluFLd_9DksrtHoKW4DXOC-7WwZbRfd4djgXDnufXAaf9U-YNulwLjdJQZXsDojtBW_BKiNxhxt2xDwgJ-3MyVqG5DC2dOr4hzXIE4kO28LyElpGGu-jnBnmDladi0ySRtiXIjvFUhlHLsl3Soh_YWW8lP61sba6bled9Yx3PrOtwZoSEoDUtNm6rPfD7NW75xW4qrVCU8ddvH5AP3AfcbBKn3xDXHf6n8_i_nJ-T8Ear9unzt9-lqbNzfJjNMx9S5yBwOlHYSGtoMNbWUuBkppBJh4XBeKqwFRjNLS4sTixGBmf2tdmFVYd4I30V3cu4OptbgaGOsJI4MTjRwd4KHBt6pehOesYGF9Y4Nji5cJ1ajKzDNDPbhrMMfoR37IjBfVdhYJTugDZQhbAuGpDzDGLUTuIMCDP2RmmKdqIZsSoCHdAgE2rQkJpCTSUaFFU41cik68Kg7hRqJcYGdcIKZ9YhslZdJ3ojUTvco0EIdIuGriqc6hxXqJdUkX7_rfSMLer1O6S0GVD3TFstTiKDotM22ERq-roQ0wzuLSa8wgx2DXmsOHCqNRXfxQzkhQAnsSwMFT6DvBgGhfuapMJ6UrXCE4PR2OiqR05jbFSJjSgzk1uvn8TQarIwNH2l61AZTC_qkMMhbk6OoSRdRVs40WO9AXn5i9RhR5pHeRuJO3O9MzVEsa1hahLvs23QcEBU4gtbwtyMxthQX60akoUdEouRHYf4YhxsvRc0NfVaDaLQzMDEToY-7brxF6hPkB708b-qdDhiLOQ4MoYbXp-hKrqvhfKhaDbCTDo9FRuKuwZxcfXhJ_GaWCn4_0pMcU6_uI60Wt1XguHhPJU1Xe-6L4Xq1TnocTZ9sidnZk-OvZvGpuJe0ntzhG6Norf2klOnJcouJDeZ82KHdbf1LOhcTX4zk56-n1XQ_twdVFCz08O-qGv546yq3xdis5Z2HSlr7EtRxH-cfQd0CyU9NhspVknf938m_gY" rel="nofollow noreferrer" title="Python 3 – Attempt This Online!">Attempt This Online! - test cases</a></p>
<h1><a href="https://docs.python.org/3/" rel="nofollow noreferrer">Python 3</a> (with <a href="https://github.com/niklasf/python-chess" rel="nofollow noreferrer">python-chess</a>), 163 bytes</h1>
<pre><code>from chess import*
b,m=eval(input())
S=Board()
S.clear()
S.turn=m[0].color
S.set_piece_map(b)
for l in S.legal_moves:1/(m!=[S.piece_at(l.from_square),l.to_square])
</code></pre>
<p>An even smaller code size is achieved here by setting a rather ridiculously specific input specification. Examples:</p>
<pre><code>{56: Piece(ROOK, BLACK), 57: Piece(KNIGHT, BLACK), 58: Piece(BISHOP, BLACK), 59: Piece(QUEEN, BLACK), 60: Piece(KING, BLACK), 61: Piece(BISHOP, BLACK), 62: Piece(KNIGHT, BLACK), 63: Piece(ROOK, BLACK), 48: Piece(PAWN, BLACK), 49: Piece(PAWN, BLACK), 50: Piece(PAWN, BLACK), 51: Piece(PAWN, BLACK), 52: Piece(PAWN, BLACK), 53: Piece(PAWN, BLACK), 54: Piece(PAWN, BLACK), 55: Piece(PAWN, BLACK), 8: Piece(PAWN, WHITE), 9: Piece(PAWN, WHITE), 10: Piece(PAWN, WHITE), 11: Piece(PAWN, WHITE), 12: Piece(PAWN, WHITE), 13: Piece(PAWN, WHITE), 14: Piece(PAWN, WHITE), 15: Piece(PAWN, WHITE), 0: Piece(ROOK, WHITE), 1: Piece(KNIGHT, WHITE), 2: Piece(BISHOP, WHITE), 3: Piece(QUEEN, WHITE), 4: Piece(KING, WHITE), 5: Piece(BISHOP, WHITE), 21: Piece(KNIGHT, WHITE), 7: Piece(ROOK, WHITE)}, [Piece(KNIGHT, BLACK), 45]
{56: Piece(ROOK, BLACK), 57: Piece(KNIGHT, BLACK), 58: Piece(BISHOP, BLACK), 59: Piece(QUEEN, BLACK), 60: Piece(KING, BLACK), 61: Piece(BISHOP, BLACK), 45: Piece(KNIGHT, BLACK), 63: Piece(ROOK, BLACK), 48: Piece(PAWN, BLACK), 49: Piece(PAWN, BLACK), 50: Piece(PAWN, BLACK), 51: Piece(PAWN, BLACK), 52: Piece(PAWN, BLACK), 53: Piece(PAWN, BLACK), 54: Piece(PAWN, BLACK), 55: Piece(PAWN, BLACK), 8: Piece(PAWN, WHITE), 9: Piece(PAWN, WHITE), 10: Piece(PAWN, WHITE), 11: Piece(PAWN, WHITE), 12: Piece(PAWN, WHITE), 13: Piece(PAWN, WHITE), 14: Piece(PAWN, WHITE), 15: Piece(PAWN, WHITE), 0: Piece(ROOK, WHITE), 1: Piece(KNIGHT, WHITE), 2: Piece(BISHOP, WHITE), 3: Piece(QUEEN, WHITE), 4: Piece(KING, WHITE), 5: Piece(BISHOP, WHITE), 21: Piece(KNIGHT, WHITE), 7: Piece(ROOK, WHITE)}, [Piece(PAWN, WHITE), 19]
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=7VdNbuM2FF5050XPQKQL2o3HGMm2JARwgXrgAQZpHSczgBeGEcg2PRIsiypFxeMUPclsspmeoKeZ05QUSVHPzAG6qBeM9Onp_Xzfe6Ty9e_izBOav7x8q_j-TfT9hx_TY0EZR4z00TYhZdnp7MgebWn-RBhfpGRLuoVcezcdJH4Fmii7Qf1ssGf0-FiejxuaKbuVt0bpHqnrt-vJBC8xIllJkHk8yOiJsG6vVztkhFcsRyusYuFr7f3D7N3scf7r77OPq2JQv_rIzwVZD6qikG9f4z4yxu_ufrt7aIy3NKOsZdcTljo3f_3G66FrczuUtz9H607nefK2c0rSjCBP1cnZWV3I34bGbCcKJ09x1k3zouIme_k70idJHj0eSc6FlTYYlEWW8i5Gk18QhtbGlby2TwRrzzeoYGku3m7Q54nXXKtn-E9REMl3E9xyexYFmOs9ZUKnNFd52zJ0kLMJIhl0PSlvHrhfSNVBS0B75a_krLsQAgvOb4Q2CyG_617XD7xBHnRyf_Vlfit8LZ8KV0pwGaMG6jBrif0kFglrBXpuTK1IfU--bEnB0ezu_YwxyloiMxIf1Fjo6Xj53vlntbqaXvXR1a1Yhn0UiYo0ci8Wr4_GFpmLZdRHIURC8JZcfGFmkQf1VgSRCCALFSuEiO8gIsMAImMHCZy3QgeJDLI0tQs_nkXulZ-hReYqeguZqrd8iASm9qWp1AOede0tRNc-hIgPPOvaL5ARiKVrv7AJHSSSsdYdmI-_lmP8iVUEdT8lBDFKD4jmKPHQNs5VU4uxO8l9guaimTurFZ7K7rzFddhaTIXcYyumQubYlmiRUNOgELlEwI9cfN2ACnnAddFDiHjAZoFrWS4QQwOwCR0kgIghWGzxutLQRF-aSo0sCplj2-wWCU0-S1OXaQqLRADRdUUQGZqclybDCERfYNu2Fhk5Nh6oS_sJZVPYnGtWZVO8j-Xh1p2TlCeEoUOefk444lQ1hfgbj5E8JdFJPBZAQs4oZpctEgLZ7rHdJWxDjIFIOokANkQIZJs6NN22G6sRKQDIvC12gwwBcbr5fIgEkhRJU1NXPU0tmuTwiIOWE7RJy4QW6ESrbIfE_iyZQYc0_yxPLnGubw8uRQGkKHptZi7mKnII8QGNU2w3djAznoNcdH_kTBGcPW0TOORHkPzQmZCxI8cI-NGy-o4cLZsHZz71hASws8evTYhvRdT5RK-L-EdFiFCrYkycvNkZJXHp6thHcb4TcFqqmdhRUuaYi4OePMlPJp7E_H-t_yNah2Zfs4edErN09CRms9tkdHsoX9Mxcra1ADA5b7PUIENHx5FzFsIT4rbdD222L7j1Hf49Z1sbgk2s6SLLCY8PRLW5GgLFgnvme07lPsy4PtOaSE3GNtLHY5xlpOSK92MsghW0LNNNJv7jEHJwwo4lonvxpV_lOynThn7pqa_XfwE" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Here is a Python program that converts the test cases.</a></p>
<p><a href="https://ato.pxeger.com/run?1=ddPNTsIwAAfwgyd5inoxnZlz33wkO4AhsmAAHYYDIUuZRZZ06-w6EmN8Ei8kRt9Jn0YQhmNZb-3v37X_pN37V_LClzRerz8zvrhsfH8sGI1AsMRpCsIooYxf1OZy5OAVIjCMk4xDSap5Toci9gg3IyUgGLG_Ec9Y7ERTdaYElFC2kRRzPwlxgP0IJXAu1RaUAQLCGHgKwU-I-BFd4bSlXcHozJl6ym4x4pAo2yJ--pwhhiWZKJzuJzNpV3XfeP1zcv5q2S0w2n4K74fDvgw6t-3rviQDq557f-De9MaFpJEnHdfrDUeFpJkndw_d7uA_sNXDZu7gpuCaaCtbFx1vG9WFzUOtUXtSONtsVrulClwTuC5wQ-CmwK1qL9Wf9Nxxd8PNatZUgWsC1wVuCNwUuFXt6vGlHJaXbzEP9PLF54FRekK5m8cvKGdLtI8uPLpeVfVNBtPq92Zas9Pd__IL" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Attempt This Online!</a><br />
<a href="https://ato.pxeger.com/run?1=7Vc9b-NGEEVaFalTTpRCZEAzIilKsgwV54NzNhzYTuTgCsUgKGllEqK4vN2VdbKRNnX6NAcEyX-6K_NLsitKpLTkBEh_bCS-2Y_ZN29mln_8nW1ERNMPH1_iZUaZgJhafMOt_C2JJ40ZmUMQp9lKGOYAHhM6CRMQhIszYESsWLp9aQTBZBUnIk55ENjb4TDczTsDmpHUaKpx3M42Tau5bpr2msWCGKzZbP61EvOT_sc_54wuYRoRziHf_9vGxFoOyVOYGDsPzMZoeE5DNjPkP3uakJBt_ylHhstx-8Ge0oQyiXAigiwmUxIsw8yYmI05ZZBAnMLITshjmARL-kT4wPnOWH49HI_sfHAojMRWjgT83SpkxLQSW9Ddy4OZu_rpixPp9tgZnDgP5hlIwuwsFJE8NydMGG0LWi2JPw_b212F2lUN4mIWp4MGyCeew_MAMhanwmj9krbMPSrGctHhUGEDUCSKsdpma1YMKiR_YZt8KfVkiu0gZy0Idlw3zcKeb1dE1WYkoeHMyPIR5P2UZOJgta1bjjzGP7_93rJAWEDS2bC5W5AknOiD29jg56FzlrP24dOXX734_QHcKaaN66ubNxac__Dq9bVpgefu8R9_vri4KQ2-U0y4uXpzeV9aui5mcf295fxqdHl7d7Da6d7y0-3t9cFaXj3eKdy9e_X2wKvOKYK7CN6px30PwbHxPrL-MatvL6_uLxQRjsbq3uD0de4Ki6tzVyx2ilnax-Tt4V497HSPz7DHT-thp12Puz1kvIfgHWSd2vG_WjCudd5_gG_gnq0IGPcRAUbpAmgKkQPTMAVVU0Dm_FqWKAkTs_HSdeoVX0pLU3zJT0XxqMHDBO-hFgdJhTITNbxbLz2d10Kq_zMV9HgWuFuv7VIXmrbLHNe17aGqb2PS7mEGv1uvbh9JBsdH5OcgckVwF5GxXhl0GVe4cJWQvw9lLQfjhsQiIgwWafwYCRA0F7L8DX3YtuW1NEsgIhtQXbHxooelWnt1WaPlutPGLGUZrBTyLmbp1stFd2uPl3KsVEJULWgh9BC5HIThmCzvIAiqnKwjeSmCScwjmsGarpIZqKuU5B0WcfqoLhLygjRdyAB0ukgAPCQAfuWk1a6iWyonLab0MYum_2qQtbKCdFIH67BImehiZaKDBR6LbsfDLJUzF1MczOIiTbDj1uOOW5fGWFerpndBR7tWWe9WhEgJrRgjqUg2EIW8Ki4LwnQm4ZjnZWBGCU9bQt70yJOcJi2h-CzAzwL8TwF6_eOLUq4wXhEZ2TedSUKnC74XVyki7Tuhh4gL_xrw0faC3o0q14EaCR8FuYvEGL2KVC95RQ-p9Dydat2p05JpES5IntF5vufcSj79ejodLFd7decsXdDJLz0YLcMkUd-p2ygvQ-lERjmPJwmxVPAFYUsOdA4TukpnShQT-n73Xf0v" rel="nofollow noreferrer" title="Python 3 – Attempt This Online">Attempt This Online! - test cases</a></p>
</div>
<div id="pu2" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 693 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>(b,M,[c,p,x,y]=M,m=Math.abs,J='some',F=(C,X,Y,W,T,Q=P=&gt;P[2]==X&amp;P[3]==Y)=&gt;W.filter(([i,j,k,l])=&gt;i==C&amp;j==(T||j)&amp;[B=m(H=k-X)==m(V=l-Y)&amp;!W[J](([I,J,K,L])=&gt;(K-k)/H==(L-l)/V&amp;(k&gt;X?K&lt;k&amp;K&gt;X:K&gt;k&amp;K&lt;X)&amp;(l&gt;Y?L&lt;l&amp;L&gt;Y:L&gt;l&amp;L&lt;Y)),R=!(k-X&amp;&amp;l-Y)&amp;!W[J](([I,J,K,L])=&gt;k-X?L==Y&amp;(k&gt;X?K&lt;k&amp;K&gt;X:K&gt;k&amp;K&lt;X):K==X&amp;(l&gt;Y?L&lt;l&amp;L&gt;Y:L&gt;l&amp;L&lt;Y)),B|R,k==X?!W[J](Q)&amp;(l-Y==1-2*(C&lt;'E')|l-Y==2-4*(C&lt;'E')&amp;!W[J](E=&gt;E[2]==X&amp;E[3]==Y+1-2*(C&lt;'E'))):m(k-X)==1&amp;l-Y==1-2*(C&lt;'E')&amp;W[J](E=&gt;Q(E)&amp;E[0]!=i),(k-X)**2+(l-Y)**2==5,(k-X)**2+(l-Y)**2&lt;3]['BRQPNK'.search(j)]))=&gt;x&gt;0&amp;x&lt;9&amp;y&gt;0&amp;y&lt;9&amp;!b[J](([i,j,k,l])=&gt;k==x&amp;l==y&amp;(i==c|j=='K'))&amp;F(c,x,y,b,p).some(e=&gt;!F(c&lt;'E'?'W':'B',...(W=b.map(E=&gt;E[J]((a,i)=&gt;a!=e[i])?E:M)).find(Z=&gt;Z[0]==c&amp;Z[1]=='K').slice(2),W)[0])
</code></pre>
<p><a href="https://tio.run/##7Vddj9o4FH3nV4R5iO2pSZsASRbhIDGi6k4YBKhqYNJIDTSzBcKHJqia0bK/fdbOB8nF9L0PfbHRiX3vPeceO2Ed/gyT5fPqcGzs9t@jtyf2hhf0gfpLeqAv9DVgD3TLHsLjDy1cJPSeoWS/jRD9yPAdndE59ehnOmFj5ox9I2Bspo79Jp/nhDme9rSKj9Ezxv6KrumGxgFHV4zdqWvG8OfTaU1Uv8@2@BPbNGaE8V9fWNyYE7Xu@fcB3/c3vacuHYp92G1syPtPfOOwEZP3X1S8cWY9t7tRXWfWcR0@d2dExbEz7w27sTp05p2hw@funBA6ZXXMc6jqr8Lzh70hr/t62I4rqP0idv80pRv@vJeFnYgiGnPG9IZxi@@6aIDIKQWMRqsA8hIGzBnkug0y3d5VdhHS2eJMGV29DKkWASZ4QPjuD0GdrQhN19/eGu9EDeIHY20Z7DYDH/Wnk/HIRVoShc/LH3hNAsKFeHE@qC/dv9RXPr/yub7ItKq0kJN9UWPGXlXMu7k88W4il5erfsRLYRq6oAeiCaPgiDl1joqKe8hDHdRHVNM07LGFtg0PmQAifkhXPHJYZ5G/Ckhv0HkghPtn9x0/MueRs@OJ1EdfD7JcWhKvlhE2CPUIf0jejlFyvAuTKFGY8u0J@/5N/4YqNy4fmlSxA6rkyIQPOlXaJTLiQ4sqFkQssEsMBl9WItNslw0RGyDjLJcFEUNCeIUmRNoSYkq7LAmxC8QruPM4eolMsjjNEhll2StIP9tlQMQsuHsFUx1EzrlXkJx7EyIGiJxzv0BaIFfO/WKNJSG2yCUVZASkVhN2EMZTuHPSYGmLMmSCyhZlyAiVhZeIlZPLEDHYII4YjNxWGTJFKZUmRHSwZoxSsS@QghxYY0mICZFCNn7McqZWkd0rmBZiZ8gIlRYuEauoxyt4Fa0uERsgOS8bIs2iZq@o0AbZx6g0Y4m0pDU64JXHsQJYdCqr1GoLyD9B5RkuG9sGYuexTNhYC8jfl@i6VYOcxTYBMqo27Yw0gQC5iQyImIJbmd5Fudmv0TUhXfuajy@8bkvkDCBJH5VXKPCxLiEXjrQlZ8PzkK8xJSFtKKQlubYtSdsCcfIWGZK0JvQoPDO5a03otvY11xqB5CL7T0N@o4ZYVy8EW7oQTCDJqEq3XzmkFw1pSW8DeEe61cZWZbsQyZCE1KULoQmP/9kP115sukTOgEWlFzdclFZFvtVq6ScU/xMgPqHOn1NacohXR4y@7r7ukEi5f1bwcr9LjsqSr1X2T8p5H1H@rSmKeLiPIy3e/4Ojn2GMxTpCav@9/Q8" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p>I sought out this challenge with the aim of combining CodeGolf with a project idea for a chess app. I realized that most of the functionality of a chess app hinges on the ability to validate a chess move, and while the challenge's input format does not explicitly include <em>which</em> piece in particular (which white bishop?) is moving, I still found this fun to write. My original working code was 1200 bytes, so I'm proud I managed to cut it down to 693. It takes input in the same format as the spec and outputs 0 for invalid, 1 for valid.</p>
<h2>Explanation</h2>
<p>Really simple when you get down to it. We call a huge function <code>F</code> which returns the list of pieces that can move to an <code>X,Y</code> coordinate with color <code>C</code> and type <code>T</code> within a board <code>W</code>. This is called to retrieve the list of eligible pieces based on the <code>[c,p,x,y]</code> input, and again to determine whether there is check or not. Here we do not call with a type parameter as we want to consider every piece.</p>
<p>The large list in the <code>filter</code> function body is simply a list of booleans which check Xs and Ys, the code is too unreadable for me to explain how that works... but it should be easy to figure it out by reading the code. Notably, all a queen needs is either bishop eligibility or rook eligibility. The pawn code was what took the longest to write.</p>
<p>Then we have a simple <code>some</code> call which operates on the filtered list, checking if there is any piece where, after recalling <code>F</code> with a slightly modified board (that particular piece is moved to the target), we get an empty list (no eligible pieces of the opposite color) or in other words there is no first element.</p>
<p>Here's an expanded version of my code (thanks Emanresu A!):</p>
<pre class="lang-js prettyprint-override"><code>(b,M,
  [c,p,x,y]=M,
  m=Math.abs,
  J='some',
  F=(C,X,Y,W,T,
    Q=P=&gt;
      P[2]==X&amp;
      P[3]==Y
  )=&gt;W.filter(
    ([i,j,k,l])=&gt;
      i==C&amp;
      j==(T||j)&amp;
      [
        B=m(H=k-X)==m(V=l-Y)
        &amp;!W[J](
          ([I,J,K,L])=&gt;
            (K-k)/H==(L-l)/V
            &amp;(
              k&gt;X?
              K&lt;k&amp;K&gt;X
             :K&gt;k&amp;K&lt;X
            )
            &amp;(
              l&gt;Y?
              L&lt;l&amp;L&gt;Y
              :L&gt;l&amp;L&lt;Y
            )
        ),
        R=
          !(k-X&amp;&amp;l-Y)
          &amp;!W[J](
            ([I,J,K,L])=&gt;
              k-X?
                L==Y
                &amp;(
                  k&gt;X?
                  K&lt;k&amp;K&gt;X
                  :K&gt;k&amp;K&lt;X
                )
              :K==X
                &amp;(
                  l&gt;Y?
                  L&lt;l&amp;L&gt;Y
                  :L&gt;l&amp;L&lt;Y
               )
          ),
        B|R,
        k==X?
          !W[J](Q)
          &amp;(
            l-Y==1-2*(C&lt;'E')
            |l-Y==2-4*(C&lt;'E')
            &amp;!W[J](
              E=&gt;
                E[2]==X
                &amp;E[3]==Y+1-2*(C&lt;'E')
            )
          )
        :m(k-X)==1
          &amp;l-Y==1-2*(C&lt;'E')
          &amp;W[J](E=&gt;Q(E)&amp;E[0]!=i),
        (k-X)**2+(l-Y)**2==5,
        (k-X)**2+(l-Y)**2&lt;3
      ]['BRQPNK'.search(j)]
    )
  )=&gt;
    x&gt;0
    &amp;x&lt;9
    &amp;y&gt;0
    &amp;y&lt;9
    &amp;!b[J](
      ([i,j,k,l])=&gt;
        k==x
        &amp;l==y
        &amp;(
          i==c
          |j=='K'
        )
    )
    &amp;F(c,x,y,b,p).some(
      e=&gt;!F(
        c&lt;'E'?
        'W'
        :'B',
        ...(
          W=b.map(
            E=&gt;E[J](
              (a,i)=&gt;
                a!=e[i]
            )
            ?E
            :M
          )
        ).find(
          Z=&gt;
            Z[0]==c
            &amp;Z[1]=='K'
        ).slice(2),
      W)[0]
    )
</code></pre>
</div>
<div id="pu3" class="pu"><h1><a href="https://docs.python.org/2/" rel="nofollow noreferrer">Python 2</a> (with <a href="https://github.com/niklasf/python-chess" rel="nofollow noreferrer">python-chess</a>), <s> 141 138 134 133 </s> 132 bytes</h1>
<p>Without doing any of the really interesting code - but maybe this can compete with golfing languages or (dare I mention it) Mathematica?</p>

<p>Note: <a href="https://github.com/niklasf/python-chess" rel="nofollow noreferrer">python-chess</a> is a <a href="https://pypi.python.org/pypi" rel="nofollow noreferrer">Pypi</a> package install it on Python 2.7.9+ with:<br />
<code>python -m pip install python-chess</code>)</p>
<pre class="lang-python prettyprint-override"><code>import chess
a,p,n=input()
S=chess.Board(a+' - - 0 1')
for m in S.legal_moves:1/(m.to_square!=n)**(`p`in`S.piece_at(m.from_square)`)
</code></pre>
<p>A full-program accepting input of three items:</p>
<ol>
<li>the beginning of a <a href="https://en.wikipedia.org/wiki/Forsyth%E2%80%93Edwards_Notation" rel="nofollow noreferrer">FEN record</a> - the string containing the first two fields. This is to define the board state AND which colour is moving (since this is the information in the input in the OP, whereas fields three through six are &quot;fixed&quot; by the OP hence should not be a part of the input)</li>
<li>the piece-name attempting to move (as given in the OP -- one of <code>PRNBQK</code>)</li>
<li>the square to which the named piece is attempting to move where <code>a1</code> is <code>0</code>, <code>b1</code> is <code>1</code>, ... <code>a2</code> is <code>8</code>, ..., <code>h8</code> is <code>63</code>,</li>
</ol>
<p>The program <a href="https://codegolf.meta.stackexchange.com/a/5330/53748">outputs via its exit-code</a> given valid input:</p>
<ul>
<li><code>1</code> if the move is a valid one (the program raised an error - due to division by
zero);</li>
<li><code>0</code> it it is not (the program exited normally)</li>
</ul>
<p>(Don't) <strong><a href="https://tio.run/##NY/BTsQgEIbvfQo8AWsXHPZgNOmlVxOD26MxLa6sSywwC6zGp6/YaCYzyffnm8OP3@UUg1qcx5gKQYdNXeGNC@yZupCLmWfaEoqruD2cbM70hf8/rNyYFtvQuYCXwngzdGsq@mjSGzPXlGzr3BCgvDnGRDxxgQxitu9mHn38tPkeJPOixDGfLybZqy7wzYZNOLkwDQKdPdjRlKocU/R/Ep/4slD1kVRIEhECIKJUCLiT51sJr6ChV1LDo3pSEnQlrbXc7x7Unnz9Vurrgbsf" rel="nofollow noreferrer" title="Python 2 – Try It Online">Try it online!</a></strong> (because the python-chess package is not installed there and TIO does not allow internet connectivity so the pip-install code in the header wont work).</p>
<p>Note that the power operator in Python makes <code>1**1 == 1**0 == 0**0 == 1</code> but <code>0**1 == 0</code><br />
...hence <code>1/0**1</code> raises a division by zero error while <code>1/1**1</code>, <code>1/1**0</code>, and <code>1/0**0</code> all succeed<br />
(...and that in Python <code>False</code> and <code>True</code> equate to <code>0</code> and <code>1</code> respectively).</p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/148587/">148587</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




