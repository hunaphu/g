<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::118856</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>385</td><td>Python3</td><td>250516T204508Z</td><td><a href="https://codegolf.stackexchange.com/questions/118856/binary-puzzle-solver/279756#279756">Ajax1234</a></td></tr>
<tr d-ix="1"><td>270</td><td>JavaScript ES6</td><td>170504T141710Z</td><td><a href="https://codegolf.stackexchange.com/questions/118856/binary-puzzle-solver/118881#118881">Arnauld</a></td></tr>
<tr d-ix="2"><td>051</td><td>Jelly</td><td>170504T170542Z</td><td><a href="https://codegolf.stackexchange.com/questions/118856/binary-puzzle-solver/118931#118931">Jonathan</a></td></tr>
<tr d-ix="3"><td>034</td><td>Brachylog</td><td>170504T205739Z</td><td><a href="https://codegolf.stackexchange.com/questions/118856/binary-puzzle-solver/118963#118963">Fatalize</a></td></tr>
</table>
<div id="pu0" class="pu"><h1>Python3, 385 bytes</h1>
<pre class="lang-py prettyprint-override"><code>E=enumerate
V=lambda B:len(K:=[tuple(i)for i in B if'.'not in i])==len({*K})
W=['1','0']
def f(b):
 q=[b]
 for b in q:
  if(O:=[(x,y)for x,r in E(b)for y,v in E(r)if'.'==v])==[]:return b
  x,y=O[0]
  for i in W:
   B=eval(str(b));B[x][y]=i;L=B+[*zip(*B)]
   if any(any(j.count(k)&gt;len(j)/2 for k in W)for j in L)or any(i*3in''.join(k)for k in L):continue
   if V(B)and V(zip(*B)):q+=[B]
</code></pre>
<p><a href="https://tio.run/##pVJNb5swGD7Pv8LKxTZlzCSaNFF5B6SeGq239uCiChqjOSWGGBOFTvvtmV8DrXqrNEvg9@P5MLzuRve7NZsfnb1cboQyw0HZ0il0L5ryUO1KnGeNMvQ2E9INXaOoZnVrscba4BzrmiTEtA4yXTAhAPsnuv3L0IOQJCUx4aRAO1XjmlYsQ/goZFUgDBoVsI6@5mXonTeg53gM6ufYQu/GUyAd49OUWhYMhTiBlywyq9xgDa68hueKO8m9Nn474AOI41yoU9nQ3lmvx65zeS7kWAh9vRX5lYxedUejnAHRHwSXZqTw7JPndjCOvrCf8FF79m0dhF@CcDjXHsIt8xEQdLTRhpBk32rjWW/YLcueW@O0GdRscU9zVpqd32dvlh2vhMyLS59igVerFUqThCcJ8m@epAjesIWFoAQ9wHAEaNSvZx4UQ497vldJF2QQ8wFfVADdbxbatAIYvMAOwlDigZRO/SA6oz/SpjYPPsEXaHzRQDw0g244MtwJ1z5VbWl3tPdX48s8TCkjXbzPsNaNU5b@ao2KcZ/0XaMdJY@GMD8y1FltpnT674eyo/MM4pq@66cM1gL/SqLvnH2avP4f8iaQL/8A" rel="nofollow noreferrer">Try it online!</a></p>
</div>
<div id="pu1" class="pu"><h2>JavaScript (ES6), <s>274</s> 270 bytes</h2>

<p>Takes input as a 2D array, where empty cells are marked with <code>2</code>. Prints all possible solutions to the console.</p>

<pre class="lang-js prettyprint-override"><code>f=(a,x=0,y=0,w=a.length,p,R=a[y])=&gt;(M=z=&gt;!a.some((r,y)=&gt;/(0|1),\1,\1/.exec(s=r.map((v,x)=&gt;(v=z?v:a[x][y],b-=v&amp;1,c-=!v,m|=v&amp;2,v),b=c=w/2))||b*c&lt;0|o[b*c||s]&amp;(o[s]=1),o={}))(m=0)&amp;M(1)&amp;&amp;(m?R&amp;&amp;[0,1].map(n=&gt;(p=R[x])==n|p&gt;1&amp;&amp;(R[x]=n,f(a,z=(x+1)%w,y+!z),R[x]=p)):console.log(a))
</code></pre>

<h3>How it works</h3>

<p>The first part of the code uses the <code>M()</code> function to check the validity of the current board, both horizontally and vertically.</p>

<pre class="lang-js prettyprint-override"><code>M = z =&gt;
  !a.some((r, y) =&gt;
    /(0|1),\1,\1/.exec(
      s = r.map((v, x) =&gt;
        (
          v = z ? v : a[x][y],
          b -= v &amp; 1,
          c -= !v,
          m |= v &amp; 2,
          v
        ),
        b = c = w / 2
      )
    ) ||
    b * c &lt; 0 |
    o[b * c || s] &amp;
    (o[s] = 1),
    o = {}
  )
</code></pre>

<p>It maps a full row or column to the string <strong><em>s</em></strong>. This is actually an array coerced to a string, so it looks like <code>"1,2,2,0,2,2"</code>.</p>

<p>It uses:</p>

<ul>
<li>The regular expression <code>/(0|1),\1,\1/</code> to detect 3 or more consecutive identical digits.</li>
<li>The counters <strong><em>b</em></strong> and <strong><em>c</em></strong> to keep track of the number of <em>ones</em> and <em>zeros</em>. Both counters are initialized to <strong><em>w&nbsp;/&nbsp;2</em></strong> and decremented each time a <em>one</em> or a <em>zero</em> (respectively) is encountered. This leads to either:

<ul>
<li><strong><em>b = c = 0</em></strong> → <strong><em>b * c = 0</em></strong> → the line is complete and correct (as many <em>zeros</em> as <em>ones</em>)</li>
<li><strong><em>b > 0 AND c > 0</em></strong> → <strong><em>b * c > 0</em></strong> → the line is not complete but correct so far (we don't have more than <strong><em>w&nbsp;/&nbsp;2</em></strong> <em>zeros</em> or more than <strong><em>w&nbsp;/&nbsp;2</em></strong> <em>ones</em>)</li>
<li><strong><em>b &lt; 0 OR c &lt; 0</em></strong> → <strong><em>b * c &lt; 0</em></strong> → the line is invalid</li>
</ul></li>
<li>The flag <strong><em>m</em></strong> (for 'missing') which is non-zero if there's at least one remaining <em>two</em> on the board.</li>
<li>The object <strong><em>o</em></strong> to keep track of all line patterns encountered so far.</li>
</ul>

<p>If the board is invalid, we stop immediately. If the board is valid and complete, we print it to the console. Otherwise, the second part of the code attempts to replace each <em>2</em> with either a <em>zero</em> or a <em>one</em> with recursive calls:</p>

<pre class="lang-js prettyprint-override"><code>[0, 1].map(n =&gt;
  (p = a[y][x]) == n |
  p &gt; 1 &amp;&amp; (
    a[y][x] = n,
    f(a, z = (x + 1) % w, y + !z),
    a[y][x] = p
  )
)
</code></pre>

<h3>Demo</h3>

<p><div class="snippet" data-lang="js" data-hide="true" data-console="true" data-babel="false">
<div class="snippet-code snippet-currently-hidden">
<pre class="snippet-code-js lang-js prettyprint-override"><code>f=(a,x=0,y=0,w=a.length,p,R=a[y])=&gt;(M=z=&gt;!a.some((r,y)=&gt;/(0|1),\1,\1/.exec(s=r.map((v,x)=&gt;(v=z?v:a[x][y],b-=v&amp;1,c-=!v,m|=v&amp;2,v),b=c=w/2))||b*c&lt;0|o[b*c||s]&amp;(o[s]=1),o={}))(m=0)&amp;M(1)&amp;&amp;(m?R&amp;&amp;[0,1].map(n=&gt;(p=R[x])==n|p&gt;1&amp;&amp;(R[x]=n,f(a,z=(x+1)%w,y+!z),R[x]=p)):console.log(a))

console.log('Example #1')
f([
  [1,2,2,0,2,2],
  [2,2,0,0,2,1],
  [2,0,0,2,2,1],
  [2,2,2,2,2,2],
  [0,0,2,1,2,2],
  [2,1,2,2,0,0]
])

console.log('Example #2')
f([
  [2,2,2,2,2,2,2,1,2,2],
  [2,0,0,2,2,0,2,2,1,2],
  [2,0,2,2,1,2,2,0,2,0],
  [2,2,1,2,2,2,1,2,2,2],
  [1,2,1,2,2,2,2,2,2,1],
  [2,2,2,2,2,2,2,1,2,2],
  [2,0,2,2,1,2,2,2,0,2],
  [2,2,2,2,1,1,2,2,2,0],
  [2,0,2,0,2,2,1,2,2,0],
  [0,2,2,2,0,2,2,2,1,2]
])</code></pre>
</div>
</div>
</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://github.com/DennisMitchell/jelly" rel="nofollow noreferrer">Jelly</a>, <s>53</s> 51 <a href="https://github.com/DennisMitchell/jelly/wiki/Code-page" rel="nofollow noreferrer">bytes</a></h1>

<pre><code>ṡ€3ḄFf0,7L
SḤnLṀȯÇ
⁻QȯÇ
Fṣ©2L’0,1ṗż@€®F€s€LÇÐḟZÇ$Ðḟ
</code></pre>

<p>Takes a list of lists representing the grid, containing <code>0</code>, <code>1</code>, and <code>2</code> (the spaces). Returns a list of lists of lists, each list of lists is in the same format (although with no <code>2</code>s) and represents a possible solution to the input.</p>

<p><strong><a href="https://tio.run/nexus/jelly#@/9w58JHTWuMH@5ocUsz0DH34Qp@uGNJns/DnQ0n1h9u53rUuDsQzHB7uHPxoZVGPo8aZhroGD7cOf3oHgegxkPr3IBkMRD7HG4/POHhjvlRh9tVwIz/h9sj3f//j4421DECQgMQjtXhUogGs8B8QzDfEMqD8Y10YBCmHmijjiGSekOoeoPYWAA" rel="nofollow noreferrer">Try it online!</a></strong> (this wont run any of the question's test cases due to memory limitations - all 2<sup>nSpaces</sup> grids are created as a list of list of lists of integers - but I've put a relatively hefty case there with a single solution). The footer separates out and formats the grids.</p>

<p>Pure brute force method - implements the rules and checks them for each grid that could be formed by replacing any of the <code>2</code>s with <code>1</code>s or <code>0</code>s.</p>

<pre><code>ṡ€3ḄFf0,7L - Link 1, # of runs of 3 1s or 3 0s by row: list of lists
ṡ€3        - all contiguous slices of length 3 for €ach list
   Ḅ       - convert all results from binary
    F      - flatten into one list
     f     - filter keep values in:
      0,7  -   0 paired with 7: [0,7]
         L - length

SḤnLṀȯÇ - Link 2, unequal counts of 1s and 0s by column ...or link 1: list of lists
S       - sum (vectorises, hence "by column", counts 1s since only 1s or 0s appear)
 Ḥ      - double
   L    - length (number of rows - OK since square)
  n     - not equal? (vectorises)
    Ṁ   - maximum (1 if any not equal)
     ȯÇ - ... or last link (1) as a monad

⁻QȯÇ - Link 3, rows are unique ...or link 2: list of lists
 Q   - unique
⁻    - not equal?
  ȯÇ - ... or last link (2) as a monad

Fṣ©2L’0,1ṗż@€®F€s€LÇÐḟZÇ$Ðḟ - Main link: list of lists
F                           - flatten
 ṣ©2                        - split at 2s and copy the result to the register
    L                       - length (# of such slices)
     ’                      - decrement (# of 2s)
      0,1                   - 0 paired with 1
         ṗ                  - Cartesian power (all binary lists of length # of 2s)
             ®              - recall value from register (the flat version split at 2s)
          ż@€               - zip (reversed @rguments) for €ach (1s &amp; 0s where 2s were)
              F€            - flatten €ach
                s€L         - split €ach into chunks of length length(input) (into rows)
                    Ðḟ      - filter discard if:
                   Ç        -   call last link(3) as a monad
                         Ðḟ - filter discard if:
                        $   -   last two links as a monad:
                      Z     -     transpose
                       Ç    -     call last link(3) as a monad
</code></pre>
</div>
<div id="pu3" class="pu"><h1><a href="https://github.com/JCumin/Brachylog" rel="nofollow noreferrer">Brachylog</a>, 34 bytes</h1>
<pre><code>{ℕ&lt;2}ᵐ²&amp;≜{d?ọᵐctᵐ=&amp;{ḅlᵐ⌉&lt;3}ᵐ}&amp;\↰₂&amp;
</code></pre>
<p><a href="https://tio.run/nexus/brachylog2#@1/9qGWqjVHtw60TDm1Se9Q5pzrF/uHuXiA3uQRI2KpVP9zRmgNkPerptDEGKatVi3nUtuFRU5Pa///R0YY6jjqGOk6xOtEGOs46LjqGQJarjpuOu44HkGWoY6DjqeMVG/s/CgA" rel="nofollow noreferrer" title="Brachylog – TIO Nexus">Try it online!</a></p>
<p>This is pretty damn slow, so the test case on TIO is 4x4. I am currently running the 6x6 test case on my computer to see how much time it takes.</p>
<p>This takes a list of lists as input. The unknown values should be indicated with variables, that is with all-uppercase strings (and they should all be different, as otherwise you would be indicating that some cells must have the same value)</p>
<h3>Explanation</h3>
<p>We constrain the values to be in <code>{0,1}</code>, then we try instantiations of the variables until one respects all 3 rules. This is why this is so slow (because it will try all of them until finding one; and because in that case Brachylog is not implemented well enough so that constraints can be imposed before trying a possible matrix).</p>
<pre><code>                                 &amp;  Output = Input
{   }ᵐ²                             Map two levels on the Input (i.e. each cell):
 ℕ&lt;2                                  The cell is either 0 or 1
       &amp;≜                           Assign values to all cells
         {                  }       Define predicate 2:
          d?                          The Input with no duplicates is still the Input
                                        (i.e. all rows are different)
           ?ọᵐctᵐ=                    All occurences of 1s and 0s for each rows are equal
                  &amp;{      }ᵐ          Map on rows:
                    ḅlᵐ                 Get the lengths of runs of equal values
                       ⌉&lt;3              The largest one is strictly less than 3
                             &amp;\↰₂   Apply predicate 2 on the transpose of the Input
                                      (i.e. do the same checks but on columns)
</code></pre>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/118856/">118856</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




