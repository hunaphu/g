<!DOCTYPE html>
<html>
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6EBTM9J4LK"></script>
<script src="../g.js"></script>
    <title>cg::254710</title>
    <link rel="stylesheet" href="../c.css">
</head>
<body>
    <br><br>
    <div id = "content">
    <div id="container">
    <div id="mf">
        <a href="#" class="nonewtab" d-g="g">g</a> | 
        <a href="#" class="nonewtab" d-g="x">x</a> | 
        <a href="#" class="nonewtab" d-g="w">w</a> | 
        <a href="#" class="nonewtab" d-g="">all</a>
    </div>
    <input type="text" id="mi" placeholder="/">
    </div>

<table id="mt">
  <tr class="header">
    <th class="tbytes">Bytes</th>
    <th class="tlang">Lang</th>
    <th class="ttime">Time</th>
    <th class="tlink">Link</th>
  </tr>
<tr d-ix="0"><td>104</td><td>JavaScript Node.js</td><td>250128T162801Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/277963#277963">Fhuvi</a></td></tr>
<tr d-ix="1"><td>280</td><td>CASIO BASIC CASIO fx9750GIII</td><td>250122T215151Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/277812#277812">madeforl</a></td></tr>
<tr d-ix="2"><td>146</td><td>JavaScript Node.js</td><td>221127T211139Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/254919#254919">Conor O&</a></td></tr>
<tr d-ix="3"><td>153</td><td>Python</td><td>221119T134615Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/254718#254718">Mukundan</a></td></tr>
<tr d-ix="4"><td>072</td><td>Charcoal</td><td>221119T222343Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/254725#254725">Neil</a></td></tr>
<tr d-ix="5"><td>248</td><td>Retina</td><td>221119T121648Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/254717#254717">Neil</a></td></tr>
<tr d-ix="6"><td>040</td><td>Vyxal D</td><td>221123T154337Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/254836#254836">u-ndefin</a></td></tr>
<tr d-ix="7"><td>047</td><td>05AB1E</td><td>221122T084143Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/254788#254788">Kevin Cr</a></td></tr>
<tr d-ix="8"><td>287</td><td>Python3</td><td>221119T050240Z</td><td><a href="https://codegolf.stackexchange.com/questions/254710/implement-casios-m/254714#254714">Ajax1234</a></td></tr>
</table>
<div id="pu0" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 104 <sup><s>108</s> <s>99</s></sup> bytes</h1>
<blockquote>
<p>+9 bytes because <code>0</code> was considered like <code>NaN</code> <br>
New tests added to handle special cases provided with <em>Shaggy</em> and <em>l4m2</em> 's help <br>
-4 bytes thanks to <em>Shaggy</em></p>
</blockquote>
<p>Outputs <code>NaN</code> if the expression is invalid.<br>
In this answer, we'll consider <code>MR</code> followed by <code>M+</code> (or <code>M-</code>) invalid</p>

<pre class="lang-none prettyprint-override"><code>s=&gt;s.replace(/\d+|M[-+R]?/g,x=&gt;(y=v!=v|v,v=x**x?x*y:x[1]?(x&gt;&quot;MQ&quot;?M*=0:eval(x+&quot;=&quot;+v),-s):M*y),M=0,v=1)&amp;&amp;M
</code></pre>
<p><a href="https://tio.run/##jZPRbpswGIXv8xT/fNHiGBJClSmJ5CBN2qUrjdu2Fxb8ZEwEI@wwkHq7u0l7ge0B@lp5kcwkXdsEJhUZCdDxZ5/D8TdZSx1XWWm8QiV4SPlB87WeVFjmMkZnep@wR3HnseghnG7chq@dltcfeP1YuzVvxuMmbMbtqrmbPYROsybiCwnFmPsrrGXuNIxwwmrqepquxLilruC@nTejV1fiILXGynCnlJXcutiUGBtMKF/HqtAqx0muNo7jVKh3ueGEsPQkpZR3b/8mhGT/@weQFdn/@QmEsqNmUsrkc5E4gU8Zgf2vJyDsBKKj0WlhB8hSMDsInF8uzBYA9K0sGpQt4ULGxLto3nGcK13wln1aD2cX9c9ki5lg3T3/KLybufBmQTfHhcVNjxYN0G7l7aWs52BA1pOcZP5AIAO0i9zsjgMRiF4gp9xGb9tA7otPqthpMKgNxFKjJpfbF9GwS/s0nUKNVZZmaAlfpQERWUhxbQAry7LfELa4VVULKgVZQFbYGmcJ2K7Z9uhMFWfb9od@UNC5G1rMh0zDd8xzkHGMpa2u5UOstuXOSGPZ@hU@73z0Svcc3X@cHD1owDS15yKrMW@PhsSzpXeWYQiemWv9koVRNjNrQjCQqcEKEpUVmy4tER3@Ag" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<hr />
<ul>
<li>Uses the same regex as <em>Conor O'Brien</em> 's JS answer</li>
<li>The result of <code>replace</code> is never used. It seems to be the shortest function allowing to use a regex and an arrow function on a string</li>
<li>The regex separates the string into the elements <code>[numbers]</code> <code>M</code> <code>M+</code> <code>M-</code> and <code>MR</code></li>
<li>The result of the function will be returned via the <code>M</code> variable with the <code>&amp;&amp;M</code> at the end. The variable is named exactly <code>M</code> because we use an <code>eval</code> at some point</li>
<li><code>x</code> is the current element parsed in the string parameter, and <code>v</code> contains the current computation of <code>[numbers]</code> and <code>M</code></li>
<li><code>x**x?</code> checks if <code>x</code> is a number</li>
<li><code>x[1]?</code> checks if the second character of <code>x</code> exists (to differentiate between <code>M</code> and <code>M+</code> <code>M-</code> <code>MR</code>)</li>
<li><code>x&gt;&quot;MQ&quot;</code> is used to differentiate between <code>MR</code> and <code>M+</code> <code>M-</code> (using alphabetical order)</li>
<li><code>v</code> will contain <code>NaN</code> after each operation (<code>M+</code> <code>M-</code> or <code>MR</code>). It serves as some kind of &quot;poison&quot; that will go into <code>M</code> if <code>M+</code> or <code>M-</code> are used at an inappropriate moment</li>
<li>if <code>v</code> contains <code>NaN</code>, any <code>[number]</code> or <code>M</code> can &quot;cure&quot; it with <code>v!=v|v</code> (stored in <code>y</code>). This code is also necessary to differentiate between <code>NaN</code> and <code>0</code></li>
<li>if <code>M</code> contains <code>NaN</code>, it will contain it forever (to detect and remember if the expression is invalid. Which is why we have to do <code>M*=0</code> instead of <code>M=0</code> so that <code>MR</code> can't erase the memory of an invalid expression). <code>NaN</code> is particularly useful here because <code>NaN</code> remains <code>NaN</code> if used in any computation.</li>
<li><code>eval(x+&quot;=&quot;+v)</code> uses <code>M+</code> and concatenates it to construct <code>M+=[number in v]</code> (same with <code>M-</code>)</li>
<li><code>-s</code> is used to generate <code>NaN</code> in 2 bytes, and some parenthesis are used to put this <code>NaN</code> in <code>v</code> after any of <code>M+</code> <code>M-</code> <code>MR</code></li>
<li><code>v</code> is initialized with <code>1</code> because it's the neutral element in multiplication</li>
</ul>
</div>
<div id="pu1" class="pu"><h1>CASIO BASIC (CASIO fx-9750GIII), 280 bytes</h1>
<p>CASIO function on  a CASIO calculator that doesn't have the function, lol.</p>
<p>I'm the only person that's coding in CASIO BASIC here now, and it's sad :(</p>
<pre><code>?→Str 1
For 1→I To StrLen(Str 1
1→P
StrMid(Str 1,I,1→Str 2
StrMid(Str 1,I,2→Str 8
If StrSrc(&quot;0123456789&quot;,Str 2
Then For 1→K To StrLen(Str 1
Not StrCmp(&quot;M&quot;,StrMid(Str 1,I+K,1))⟹Break
Next
Exp(StrMid(Str 1,I,K))(O+Not O→O
I+K-2→I
0→P
IfEnd
O≠0
If Not StrCmp(&quot;M+&quot;,Str 8
Then O+MAns→M
0→O~P
IfEnd
If Not StrCmp(&quot;M-&quot;,Str 8
Then MAns-O→M
0→O~P
IfEnd
Not StrCmp(&quot;MR&quot;,Str 8)⟹0→M~P
I+Not P→I
PNot StrCmp(&quot;M&quot;,Str 2)⟹MO+MNot O→O
Next
M
</code></pre>
<p>outputs 0 if the string is invalid.</p>
</div>
<div id="pu2" class="pu"><h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 146 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>s=&gt;eval(s.replace(/\d+|M[-+R]?/g,b=&gt;`_${c?&quot;*&quot;:&quot;&quot;}=${b&lt;&quot;:&quot;?(d=c++,b):d&amp;&amp;b[1]?&quot;m=``//&quot;:`m${(d=b[1])||&quot;;a&quot;}=_;${c=!d,b&gt;&quot;M-&quot;&amp;&amp;&quot;m=0&quot;}`};`,m=c=d=0)+&quot;m&quot;)
</code></pre>
<p><a href="https://tio.run/##ZZBNboMwEIX3OYUzQghqE0KiVAnUcAI22VIU82OiVBBHEEWVCDeo1E2X7T16nl6gR6CGVmlorbE0@ua98YwfolNUJeXucDT2IuVtRtuKuvwU5Vo1KfkhjxKumfcpPvuBgdehZ25JTF22UerEgxuwARqq1PGdzDwtpQnGJNbtVFXjwAo9KChjpgk2K5Raljuon8/gRNK2cWQTOk5J7IJvgKpK9RQa1jiMFDShKZ3qGArQ25wfURJVvEIUBSMkTwArH8sAYi1DckHrHq2uCPb/iYw@JDX@CHvv9MKWlo@7u7j1jfnCN6xZJ1jOB6Z1xxgbMIyGCMh0@ND1iLLpzJ/9Thk6o0yUWrdysCNIhEhk38vrqO49XamUP5FpO93pSSL2lcj5JBdbTVYoRQJ5CD5eXz7fnwHZMn17AoJkPzBcmZQy0PhHxzT@eODJkadIqUWjs84AsnXTfgE" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p>Creates a program based on the input and then evaluates it. Returns the empty string for invalid inputs. My favorite aspect of this solution is using <code>b&lt;&quot;:&quot;</code> to separate numeric strings from the other kinds of strings that can appear here.</p>
<hr />
<h1><a href="https://nodejs.org" rel="nofollow noreferrer">JavaScript (Node.js)</a>, 138 bytes</h1>

<pre class="lang-javascript prettyprint-override"><code>s=&gt;eval(s.replace(/\d+|M[-+R]?/g,b=&gt;`_${c?&quot;*&quot;:&quot;&quot;}=${b&lt;&quot;:&quot;?(d=c++,b):d&amp;&amp;b[1]||`m${(d=b[1])||&quot;;a&quot;}=_;${c=!d,b&gt;&quot;M-&quot;&amp;&amp;&quot;m=0&quot;}`};`,m=c=d=0)+&quot;m&quot;)
</code></pre>
<p><a href="https://tio.run/##ZZBNbsIwEIX3nGI6QiiuHX5FBaSGE2TDNo1w4hhKFTBKItQqyQ0qddNle4@epxfoEaiTIgqtNZbG37zn8fgh2AepTNa7zN7qSB2W/JDyqdoHsZW2E7WLA6mszl1EC9ez6dyfdVYs5FOxaOZyhtc4QSx5Mw9vTTazIi4pZSGZRK1W6PX8ohCbZm5wdSBFgU5g5AvHmPlVxMIpuja2WrjhXSxF6Qi24ZJHvEsobpAcYpWBDFKVAgevAWZ5OHapCWS9kc9OaF6j8Rmh7j@RXYeh9h9h7e2e2Kjn0moPb1x7MHTtXr8SjAYXpnnFhLhgFC4Rsu5lo/Mnmkv7bv/3lb7TWOrEqkb21gy0D3r5MzyBvPZUpcSp0yx5ghwS8y1La00cKI0yk/eWIkcshIG1VOptqmPVjvXKMhXOQcMM8PPt9evjBWFi0vdnZGB6oj01SWICro46YanHnZKZiqCZ65KIyoDEaZSHbw" rel="nofollow noreferrer" title="JavaScript (Node.js) – Try It Online">Try it online!</a></p>
<p>Similar to <a href="https://codegolf.stackexchange.com/a/254718/31957">@Mukundan314's reasoning</a>, this version throws an error instead of returning a specific value.</p>
</div>
<div id="pu3" class="pu"><h1><a href="https://www.python.org" rel="nofollow noreferrer">Python</a>, <sup><s>172</s> <s>179</s> <s>174</s> <s>169</s> <s>164</s> <s>156</s></sup> 153 bytes</h1>
<pre class="lang-python prettyprint-override"><code>def f(x,M=0):
 try:exec(s(&quot;M(?=\d|M)&quot;,&quot;M*&quot;,s(&quot;(\d|M)M&quot;,&quot;\\1*M&quot;,s(&quot;R=&quot;,&quot;*=0M&quot;,s(&quot;(.*?)(M[-+R])&quot;,r&quot;\2=\1;&quot;,x))))+&quot;\nprint(M)&quot;)
 except:0
import re
s=re.sub
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=XVDBTuMwEBVXf8XIl9iNEyVFoLbI5czBWqkcCUIsdcBScSLbRa3Ej6C99ML-E3wNEzvLdteypXnvzZvxzK_f_T48dfZweN-Gtph9vK11Cy3bCSUrviAQ3H6hd_qBeUYVu5TN-lVxKqiaUIEUi1gh0TT1REVuJRFOZJUQKyeXnKmbIl_dotHRZiqb-oKKHceT08b2ztjAsConoHcPug-LipjnvnMBnCZeOl367c_0wc-T5Sj5vf-TZTpC2s7BxlgNxg5S6cPaWBwAj7G9wMo9SHi-75kPDlVnkBwMpe83JjAKxRIo5yRaxgrdNgi4SwG6TVdeo9E-Xv1glHJxlBZdLcNWPIbJ8FcvH3V4ud9sNeOpOeP_NcL0sRM5qpBdWbSZdQamTZQESkFvvIbv1LTBUcVBRRo5K5aZgDhDJmUWd8DTGg8f73OV4x2mrmdkrlYjmGOcqyOhiDfiYhTHzIrMapUP7-xcFadnqqinSZqdxsRVQuMIkcrhH2YAVSqammOBqZp-90-__QI" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>-3 bytes thanks to <a href="https://codegolf.stackexchange.com/users/114446/the-thonnu">@The Thonnu</a></p>
<hr />
<h1><a href="https://www.python.org" rel="nofollow noreferrer">Python</a>, <sup><s>148</s> <s>155</s> <s>150</s> <s>145</s> <s>140</s></sup> 137 bytes</h1>
<pre class="lang-python prettyprint-override"><code>lambda x,M=0:exec(s(&quot;M(?=\d|M)&quot;,&quot;M*&quot;,s(&quot;(\d|M)M&quot;,&quot;\\1*M&quot;,s(&quot;R=&quot;,&quot;*=0M&quot;,s(&quot;(.*?)(M[-+R])&quot;,r&quot;\2=\1;&quot;,x))))+&quot;\nprint(M)&quot;)
import re
s=re.sub
</code></pre>
<p><a href="https://ato.pxeger.com/run?1=bVBLTsMwFBTbnMLyJnbjRE0rUFtkWLOwkMqSIBSoA5ZSJ7JdlEpcgDOwYVPuBKfhxQ6lICxH8cybeb_X93brHhv9tqsQR8Vu46p09vFSl-u7VYk6Jvh4ITt5TyzBgpzzYvUsKGZYjDADingsgCiKfCQ8t-QAR3wcEMlG55SI6zRZ3oDR4GLCi_wUs47CSXChW6O0I5CVRmrdNsYhIyPLjczs5i409HlUDiG7td8q1URR1RhUKy2R0vC3jkA8s26lNF1ECI7SLUOya2G4ddkS6wyEjQKyt2W2rZUjGKVnCFPqHc5sg7U_Q7pm4xi6DQ_IpJrsCpLoh4tLgjFlB7K9syJQmu5hMP7osgfpnsp6IwkNDZGgld29bN3ijy--0CBWq9jzldJlXf_bJWhvDxoJq_U877fAwj7i9CxmyA8Vcx77BdGw6beP3VwkcPuV5LNoLpYDmMM7EQeB1F-P0yE4KMfRLBdJ_x2fiHR6LNJ8EkKzqRcuAxqm8lSCfjE9GIekoTgkmIjJvn7o9gs" rel="nofollow noreferrer">Attempt This Online!</a></p>
<p>Shorter version which throws an error for invalid expressions.</p>
<p>+7 bytes to both versions due to bug in code.</p>
</div>
<div id="pu4" class="pu"><h1><a href="https://github.com/somebody1234/Charcoal" rel="nofollow noreferrer">Charcoal</a>, <s>78</s> 72 bytes</h1>
<pre><code>≔¹ηＦ⪪⁺RθM«¿⊙ι№-+Rκ«≡§ι⁰-¿υ≧⁻Πυζ≔⁰η+¿υ≧⁺Πυζ≔⁰η≔⁰ζ≔⟦⟧υ≔Φιλι»⊞υζ¿ι⊞υＩι»¿ηＩζ
</code></pre>
<p><a href="https://tio.run/##jZA9a8MwFEXn@Fc8NOlhGdKM8RQChQ4Ck46lg/BH9IiQU0vqh0t@uyvZbulSKELLPVdHT6q1GupemWk6OEdny@8EaCyzrh@AP14NeV6Z4Dg7MQEvKIBJhgif2YY64Af7wUnAsQ/Wc1bkqXTBhW/cG/lax5J/sE37norbFdXKtcAKtodkCQhSXZf7T3TWnkuywQmohr4JtY8FASOW0Jp4bJ1zu8z57cr/dKXx/6lq2k4F4/e/wDiDW9xr9vQsIMzhGtyT8e2QXmeimxKK9dlfBad5WCVpOsKf7Kic56l9yxLRkQwUf3HOR8RymnaykLu48ql4NV8" rel="nofollow noreferrer" title="Charcoal – Try It Online">Try it online!</a> Link is to verbose version of code. Explanation:</p>
<pre><code>≔¹η
</code></pre>
<p>Start by assuming the expression is valid.</p>
<pre><code>Ｆ⪪⁺RθM«
</code></pre>
<p>Split the input on <code>M</code> and loop over the parts, however prefix an <code>R</code> to the first part to get a free memory reset.</p>
<pre><code>¿⊙ι№-+Rκ«
</code></pre>
<p>If this part contains a <code>-</code>, <code>+</code> or <code>R</code>, then:</p>
<pre><code>≡§ι⁰
</code></pre>
<p>Switch over the first character in the part.</p>
<pre><code>-¿υ≧⁻Πυζ≔⁰η
</code></pre>
<p>If it's a <code>-</code> then subtract the product of the stack from the memory, but if the stack is empty then mark the expression as invalid.</p>
<pre><code>+¿υ≧⁺Πυζ≔⁰η
</code></pre>
<p>Similarly for <code>+</code>.</p>
<pre><code>≔⁰ζ
</code></pre>
<p>Otherwise, this is an <code>R</code>, so clear the memory.</p>
<pre><code>≔⟦⟧υ
</code></pre>
<p>Clear the stack.</p>
<pre><code>≔Φιλι
</code></pre>
<p>Remove the leading character from the part.</p>
<pre><code>»⊞υζ
</code></pre>
<p>Otherwise, push the memory to the stack.</p>
<pre><code>¿ι⊞υＩι
</code></pre>
<p>If the part isn't empty then push its value to the stack.</p>
<pre><code>»¿ηＩζ
</code></pre>
<p>If the expression was valid then output the memory.</p>
</div>
<div id="pu5" class="pu"><h1><a href="https://github.com/m-ender/retina/wiki/The-Language" rel="nofollow noreferrer">Retina</a>, 248 bytes</h1>
<pre><code>\d+|M
¶$&amp;
\d+
*
{`^(.*)¶(_*¶)?MR|^.*¶M[-+](¶.*)*

+`^(.*)(¶-?_*¶?)M(?!.)
$1$2$1
^(.*¶-?)(_*)¶(-?)(_*)(?!.)
$1$3$.2*$4
--

^(.*)¶(.*)¶M([-+])
$1$3$2
\+-
-
--
+
^(_*)\+|^(-_*)-|^-(_*)\+\3|^(-_*?)(_*)\+\5
$1$2$4
)`(_+)-\1(\B)?
$#2*-
L$`^(-?)(_*)
$1$.2
</code></pre>
<p><a href="https://tio.run/##PY6xTsQwDIZ3vwUih5xYjpT0irgpEssteOlK6BUJBhaG0230ufoAfbHiNAHJyW/7/2T7@nn7@n4P2wHP05Y/aBZYF/MAmoKDn2lE7@y64MWti00yzKPXTF6Z3nBd1HMAVCmtORUuWcF05y2YYKIJUNziWZ1SZrXsn@mMj84cgRngb9/@C5Y9jYmQiYELRYrpgEzziKwJzyPXRu5qq27Quq9HHMFOeCHLOWB@tgnMfXQML0ZPb@cU0MdtOwlpwEmGKiS78B6tofoUhMrrH4W7XjjEZg5N9a/wLw" rel="nofollow noreferrer" title="Retina – Try It Online">Try it online!</a> Link includes test cases. Explanation:</p>
<pre><code>\d+|M
¶$&amp;
</code></pre>
<p>Insert newlines before each number or memory operation. The newline before the very first operation serves to set the initial memory to zero.</p>
<pre><code>\d+
*
</code></pre>
<p>Convert all the numbers to unary.</p>
<pre><code>{`
)`
</code></pre>
<p>Repeat until all of the numbers and memory operations have been processed.</p>
<pre><code>^(.*)¶(_*¶)?MR|^.*¶M[-+](¶.*)*

</code></pre>
<p><code>MR</code> will reset just the memory and <code>M-</code> or <code>M+</code> in an invalid place will clear everything resulting in an output of zero.</p>
<pre><code>+`^(.*)(¶-?_*¶?)M(?!.)
$1$2$1
</code></pre>
<p><code>M</code> either immediately after an <code>MR</code>, <code>M-</code> or <code>M+</code>, or with a number in between, will read the memory.</p>
<pre><code>^(.*¶-?)(_*)¶(-?)(_*)(?!.)
$1$3$.2*$4
--

</code></pre>
<p>Two values (at least one of which will have been the result of a memory read) will multiply together.</p>
<pre><code>^(.*)¶(.*)¶M([-+])
$1$3$2
\+-
-
--
+
^(_*)\+|^(-_*)-|^-(_*)\+\3|^(-_*?)(_*)\+\5
$1$2$4
(_+)-\1(\B)?
$#2*-
</code></pre>
<p><code>M+</code> and <code>M-</code> after the value will add it to or subtract it from the memory.</p>
<pre><code>L$`^(-?)(_*)
$1$.2
</code></pre>
<p>Convert the final memory to decimal, ignoring any pending value.</p>
</div>
<div id="pu6" class="pu"><h1><a href="https://github.com/Vyxal/Vyxal" rel="nofollow noreferrer">Vyxal</a> <code>D</code>, 40 bytes</h1>
<pre><code>⁽±ḊƛǍ[f;f(nw‛MR‛¥⁼½dĿ÷Ė‟n±ß¥£!3=ß*)¥D⌊=*
</code></pre>
<p><a href="https://vyxal.pythonanywhere.com/#WyJEQSIsIiIsIuKBvcKx4biKxpvHjVtmO2YobnfigJtNUuKAm8Kl4oG8wr1kxL/Dt8SW4oCfbsKxw5/CpcKjITM9w58qKcKlROKMij0qIiwiIiwiJzlNKzlNKydcbic5TVI5TSsnXG4nOU0rTU0rJ1xuJzlNLTlNLTlNKydcbic5TStNTU0rJ1xuJzgxTSs4MU0rNTZNLTM1TS0xMk0rJ1xuJzlNK01STSsnXG4nOU0rTSsnXG4nOSdcbic5TStNTSdcbicyTSsyTTJNTSsnIl0=" rel="nofollow noreferrer">Test suite</a>. Returns blank in the case of an invalid expression.</p>
<p><strong>Explanation:</strong></p>
<pre><code>⁽±Ḋ                                      # group digits and non-digits together, preserving order
   ƛǍ[f;                                 # split into list of chars for non-digit items
        f                                # flattened
         (                        )      # for each item:
          nw                             #  item, wrapped in a single list
            ‛MR                          #  literal &quot;MR&quot;
               ‛¥⁼½d                     #  list [&quot;¥¥&quot;,&quot;⁼⁼&quot;] (D flag: do not decompress string)
                    Ŀ                    #  transliterate
                     ÷Ė                  #  unwrap and execute the item:
                                         #    M: push register twice
                                         #    R: always 0, also makes stack length to 1
                                         #    + &amp; -: add and subtract respectively
                                         #      concatenates with input if stack is insufficient
                                         #    &lt;number&gt;: push &lt;number&gt; as int
                       ‟                 #  rotate the item to the back of stack
                        n±ß¥             #  if the current item is numeric, push register
                                         #    (preventing the number from being stored)
                            £            #  store to register
                             !3=ß*       #  if stack length == 3, multiply
                                   ¥     # push register
                                    D⌊=* # multiply depending on being an integer
                                         # implicit output
</code></pre>
</div>
<div id="pu7" class="pu"><h1><a href="https://github.com/Adriandmen/05AB1E/wiki/Commands" rel="nofollow noreferrer">05AB1E</a>, <s>52</s> 47 <a href="https://github.com/Adriandmen/05AB1E/wiki/Codepage" rel="nofollow noreferrer">bytes</a></h1>
<pre><code>0U…+-RS©D¶«.:¶¡ε®'Mì„X+…Xs-‚…)\0ª'U«:'M„XP:.V}X
</code></pre>
<p><a href="https://tio.run/##yy9OTMpM/f/fIPRRwzJt3aDgQytdDm07tFrPCkguPLf10Dp138NrHjXMi9AGKogo1n3UMAvI0IwxOLRKPfTQait1X5BkgJVeWG3E//9GvtpGvka@vtr/dXXz8nVzEqsqAQ" rel="nofollow noreferrer">Try it online</a> or <a href="https://tio.run/##yy9OTMpM/V9Waa@k8KhtkoKSfeV/g9BHDcu0dYOCD610ObTt0Go9KyC58NzWQ@vUfQ@vedQwL0IbqCCiWPdRwywgQzPG4NAq9dBDq63UfUGSAVZ6YbUR/130Dq9/1Lng8IJMJc@8ssSczBSlWp3/0UqWvtpApKQDZATBGNq@UIYuGMEFwSwLQ19tEDY189U1NvXVNTSCKwiCs8A0TBuQBqox8jUCGRD7X1c3L183J7GqEgA" rel="nofollow noreferrer">verify all test cases</a>.</p>
<p><strong>Explanation:</strong>&quot;</p>

<pre class="lang-python prettyprint-override"><code>0U            # Set variable `X` to 0 (it's 1 by default)
…+-RSD¶«.:¶¡  # Split the (implicit) input after each &quot;+&quot;/&quot;-&quot;/&quot;R&quot;:
…+-RS         #  Push triplet [&quot;+&quot;,&quot;-&quot;,&quot;R&quot;]
     ©        #  Store it in variable `®` (without popping)
      D       #  Duplicate it
       ¶«     #  Append a newline to the values in the pair
         .:   #  Replace all &quot;+&quot;/&quot;-&quot;/&quot;R&quot; with &quot;+\n&quot;/&quot;-\n&quot;/&quot;R\n&quot; respectively in the
              #  (implicit) input
           ¶¡ #  Then split on newlines
ε             # Map over each substring:
              # (used as a foreach, where all will have their own separated stack):
 ®            #  Push triplet [&quot;+&quot;,&quot;-&quot;,&quot;R&quot;] from variable `®`
  'Mì        '#  Prepend an &quot;M&quot; in front of each
 „X+          #  Push string &quot;X+&quot;
     ‚        #  Pair it with
 …Xs-         #  String &quot;Xs-&quot;
     ª        #  And also append
 …)\0         #  String &quot;)\0&quot;
      'U«    '#  Append an &quot;U&quot; after all three: [&quot;X+U&quot;,&quot;Xs-U&quot;,&quot;)\0U&quot;]
 :            #  Replace all &quot;M+&quot;/&quot;M-&quot;/&quot;MR&quot; with &quot;X+U&quot;/&quot;Xs-U&quot;/&quot;)\0U&quot; respectively
 'M„XP:      '#  Then replace all remaining &quot;M&quot; with &quot;XP&quot;
 .V           #  Execute it as 05AB1E code (see below)
}X            # After the map: push value `X`
              # (which is output implicitly as result)
</code></pre>

<pre class="lang-python prettyprint-override"><code>)\0U          # MR:
)             #  Wrap the entire stack into a list
 \            #  Discard it
  0U          #  Reset `X` to 0

X+U           # M+:
X+            #  Add `X` to the top value
  U           #  Pop and store it as new value `X`

Xs-U          # M-:
X             #  Push `X`
 s            #  Wrap the top two values on the stack
  -           #  Subtract the value from `X`
   U          #  Pop and store it as new value `X`

XP            # Remaining M:
X             #  Push value `X`
 P            #  Get the product of all values on the stack (for the current group)
</code></pre>
</div>
<div id="pu8" class="pu"><h1>Python3, 287 bytes:</h1>
<pre class="lang-py prettyprint-override"><code>import re
R=re.findall
V=lambda m,x,k=1:k if[]==x else V(m,x[1:],k*(int(x[0])if x[0].isdigit()else m))
E=lambda x,M=0:M if[]==x else E(x[1:],M+[-1,1][x[0][1][-1]!='-']*V(M,R('\d+|M',x[0][0]))*(x[0][1]!='MR'))
f=lambda x:''.join(map(''.join,k:=R('([M\d]+)(M(?:\-|\+)|MR)',x)))==x and E(k)
</code></pre>
<p><a href="https://tio.run/##bY89b4MwEIZ3fgWdfI5tFDdKlSJZnTLewpDFeKACWpdPEQYq8d@pnaRV8yGdddZ7r5/33H@Pn1272fXDstim74YxHIogUUMRlbbNs7oODqrOmvc8Cxs@8UrJuAptqY1SU1jUxyI8gBtoGRtercC2I0x6bagtQ98je8zthx2BnrwNpcH@lzdxVOsYr2l7OLOQaSG5NNpTtOtCmidFBDGrAyBPgKQ5m5Hw09wF0hVcrM6GCXFJ5V9STEj01dkWmqyHy51XsXIY0JjmhlFAeItTMaeMzphQB6aU@rWyNndbVXTpB/@7EsgrMlc@4Z@U3EsM7yRxqmsVz9teP7zx7CQyf7YvKDZbFPL5QVpyC763eGX5AQ" rel="noreferrer">Try it online!</a></p>
</div>

<table id="st">
<!-- Popups content will be added here -->
</table>

<table id="at">
<!-- Popups content will be added here -->
</table>

</div>





  <div class="footer">
      <b><a class="nonewtab" href="../">GOLFSCORE/</a><a href="https://codegolf.stackexchange.com/questions/254710/">254710</a></b>
  </div>
<div class="footer-space">&nbsp;</div>



<script src="../c.js"> </script>
</body>
</html>




